#namespace = ko

###################################
#
# Korean Events
# By Okawoa
# Id ko.1 - ko.1200
#
###################################

# TODO:
# Remove things from here as the new versions get made or if something is safe to cut right away

# Old TODO:
# Split into multiple files to make it easier to find things (and to allow multiple people to work on different files at the same time)
# Check comments and fix related issues
# Check the errors reported by the Validator and fix them if they're actual issues
# Add comments on what different event options are so that we don't have to consult the localization to know what is going on
# Check if anything is possible to cut; the amount of flavour for Korea consists of more events than all of MNM, and quality > quantity
# Check that these events are balanced in line with vanilla; at a glance, the Siberian Tiger events seem to give better rewards than the Indian tiger hunt events, which shouldn't be the case
# DLC lock EVERYTHING that is a close copy of DLC stuff, remove it, or make SIGNIFICANT changes!
# Make sure that various DLC-specific stuff that doesn't require a DLC lock still is restricted by the DLC (e.g. the Maimed trait should never be gained with RD)
# Check for unnecessary event options/duplicate outcomes
# Check for missing event delays; a lot of events appear to trigger follow-ups on the same day, which generally is rare
# Justify WHY there are dynasty-specific options, or remove them (vanilla has near-zero dynasty-specific features)
# Make sure that any_X/random_X are used correctly
# Consider whether random_child needs limits; you can randomly target landed adult children with stuff right now, for example
# Check if infinite recursion is possible in certain places, and fix it if that is the case
# Make sure that there is NO tumbling/lovers before age 16
# Make sure that attraction is checked correctly
# Reconsider granting congenial traits
# Add trait weights to stuff
# Make sure that events that target other characters actually lets them know what is going on if they aren't guaranteed to be a courtier since they could be a player
# Reconsider adding traits for other characters that could be players without their input

###########################################
# Mu                                      #
###########################################

# Introducing the Mu
character_event = {
	id = ko.330
	desc = EVTDESC_KO_114
	picture = GFX_evt_mu
	capable_only = yes
	prisoner = no
	only_playable = yes
	min_age = 16
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_KO_114
		trigger = { is_adult = yes } 
		set_character_flag = mu_in_the_house
		 character_event = { id = ko.331 }					
	}
	option = {
		name = EVTOPTC_KO_114
		trigger = { is_adult = yes } 
		character_event =  { id = ko.417 }	
	}
	option = {
		name = EVTOPTD_KO_114	
			clr_character_flag = do_not_disturb
			clr_character_flag = story_pend
			clr_character_flag = mu_in_the_house
	} 
}			

# Gut Ritual
character_event = {
	id = ko.331
	desc = EVTDESC_KO_122
	picture = GFX_evt_feast

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_KO_122
		piety = 10
		add_character_modifier = {
			name = deaths_gift
			days = 360
		}
		character_event = { id = ko.333 }								
	}
	option = {
		name = EVTOPTB_KO_122
		character_event = { id = ko.333 }	
			add_character_modifier = {
			name = invigorated
			days = 180
		}
	}
	option = {
		name = EVTOPTC_KO_122
		tooltip_info = kinslayer # Needs to be updated for 2.8
		trigger = { trait = kinslayer } # Needs to be updated for 2.8
		character_event = { id = ko.332 }							
	}
	option = {
		name = EVTOPTD_KO_122
		trigger = {
			NOT = { trait = kinslayer } # Needs to be updated for 2.8
		}
		character_event = { id = ko.333 }
		add_character_modifier = {
			name = friends_in_high_places
			days = 360
		}
	}
}

# Ancestor Gods reject you
character_event = {
	id = ko.332
	desc = EVTDESC_KO_125
	picture = GFX_evt_lightning_strike

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_KO_125
		tooltip_info = lustful
		trigger = { trait = lustful }
		piety = -50
		add_character_modifier = {
			name = lovers_entertainment
			days = 14
		}
		character_event = { id = ko.334 }								
	}
	option = {
		name = EVTOPTA_KO_125
		piety = 10
		add_character_modifier = {
			name = bad_person
			days = 90
		}
		character_event = { id = ko.334 }								
	}
}

# Preritual
character_event = {
	id = ko.333
	desc = EVTDESC_KO_123
	picture = GFX_evt_mu_musican

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_KO_123
		character_event = { id = ko.334 }								
	}
}

# Preritual Son enters
character_event = {
	id = ko.334
	desc = EVTDESC_KO_124
	picture = GFX_evt_illness

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_KO_124
		character_event = { id = ko.335 }								
	}
	option = {
		name = EVTOPTB_KO_124
		character_event = { id = ko.335 }								
	}
}	

# Preritual Son leaves
character_event = {
	id = ko.335
	
	# Multiple descs but no triggers; fix this!
	
	desc = EVTDESC_KO_126.1
	desc = EVTDESC_KO_126.2
	desc = EVTDESC_KO_126.3
	desc = EVTDESC_KO_126.4
	desc = EVTDESC_KO_126.5
	desc = EVTDESC_KO_126.6
	picture = GFX_evt_mu_dang

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_KO_126
		character_event = { id = ko.336 }								
	}
	option = {
		name = EVTOPTB_KO_126
		character_event = { id = ko.336 }								
	}
}	

# Preritual Buddha arrives
character_event = {
	id = ko.336
	desc = EVTDESC_KO_127
	picture = GFX_evt_roi_meditating_in_temple

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_KO_127
		tooltip_info = charitable
		trigger = { trait = charitable }
		character_event = { id = ko.337 }
		piety = 40
	}
	option = {
		name = EVTOPTB_KO_127
		random_list = { 
			6 = {
				narrative_event = { id = ko.374 }
			}
			6 = { 
				narrative_event = { id = ko.393 }
			}
			6 = { 
				narrative_event = { id = ko.390 }
			}
			6 = { 
				narrative_event = { id = ko.397 }
			}
			6 = { 
				narrative_event = { id = ko.401 }
			}
			6 = { 
				narrative_event = { id = ko.404 } 
			}
			6 = { 
				narrative_event = { id = ko.407 } 
			}
			6 = { 
				narrative_event = { id = ko.410 } 
			}
			6 = { 
				narrative_event = { id = ko.414 } 
			}
			6 = { 
				narrative_event = { id = ko.488 } 
			}
			6 = { 
				narrative_event = { id = ko.485 } 
			}
			5 = { 
				narrative_event = { id = ko.480 } 
			}
			5 = { 
				narrative_event = { id = ko.475 }  
			}
			5 = { 
				narrative_event = { id = ko.648 } 
			}
			5 = { 
				narrative_event = { id = ko.656 } 
			}
			5 = { 
				narrative_event = { id = ko.682 }
			}
			5 = { 
				narrative_event = { id = ko.728 }
			}
			5 = { 
				narrative_event = { id = ko.732 }
			}
			5 = { 
				narrative_event = { id = ko.1034 }
			}
			5 = { 
				narrative_event = { id = ko.1030 }
			}
			5 = { 
				narrative_event = { id = ko.1028 }
			}
			5 = { 
				narrative_event = { id = ko.1026 }
			}
			5 = { 
				narrative_event = { id = ko.1023 }
			}
		}
	}
	option = {
		name = EVTOPTC_KO_127
		character_event = { id = ko.337 }
		random_list = {
			75 = {
				add_trait = greedy
			}
			25 = {}
		}									   
	}		
}

# Ancestors
character_event = {
	id = ko.337
	desc = EVTDESC_KO_128
	picture = GFX_evt_father_dies_korea

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_KO_128
		character_event = { id = ko.372 }
		piety = 25
	}
	
	option = {
		name = EVTOPTB_KO_128
		trigger = {
			father_even_if_dead = {
				is_alive = no
			}
		}
		character_event = { id = ko.384 }
	}
}

# Ancestor Trait Sequencer
character_event = {
	id = ko.384
	picture = GFX_evt_suspicious_noble
	border = GFX_event_normal_frame_religion
	
	# These descs aren't exclusive (e.g. Ambitious + Lustful can both be true); fix that!
	
	desc = {
		picture = GFX_evt_suspicious_noble
		text = EVTDESC_KO_129
		trigger = { trait = ambitious } 
	}
	desc = {
		picture = GFX_evt_suspicious_noble
		text = EVTDESC_KO_130
		trigger = { prestige = 500 }
	}
	desc = {
		picture = GFX_evt_suspicious_noble
		text = EVTDESC_KO_131
		trigger = { trait = wroth } 
	}
	desc = {
		picture = GFX_evt_suspicious_noble
		text = EVTDESC_KO_132
		trigger = { trait = lustful }
	}
	desc = {
		picture = GFX_evt_suspicious_noble
		text = EVTDESC_KO_133
		trigger = { father_even_if_dead = { death_suicide_trigger = yes }  }
	}
	desc = {
		picture = GFX_evt_suspicious_noble
		text = EVTDESC_KO_134
		trigger = { trait = zealous }
	}
	desc = {
		picture = GFX_evt_suspicious_noble
		text = EVTDESC_KO_135
		trigger = {  trait = drunkard  }
	}
	desc = {
		picture = GFX_evt_suspicious_noble
		text = EVTDESC_KO_136
		trigger = { trait = scholarly_theologian }
	}
	desc = {
		picture = GFX_evt_suspicious_noble
		text = EVTDESC_KO_138
		trigger = { trait = hedonist }
	}
	
	desc = {
		picture = GFX_evt_suspicious_noble
		text = EVTDESC_KO_139
		trigger = { trait = deceitful }
	}
	desc = {
		picture = GFX_evt_suspicious_noble
		text = EVTDESC_KO_144
		trigger = { prestige = -50 } 
	}
	desc = {
		picture = GFX_evt_suspicious_noble
		text = EVTDESC_KO_140
		trigger = { trait = greedy  }
	}
	desc = {
		picture = GFX_evt_suspicious_noble
		text = EVTDESC_KO_141
		trigger = {  trait = gregarious }
	}
	desc = {
		picture = GFX_evt_suspicious_noble
		text = EVTDESC_KO_142
		trigger = { primary_title = { lower_tier_than = EMPEROR } }
	}
	desc = {
		picture = GFX_evt_suspicious_noble
		text = EVTDESC_KO_143
		trigger = { trait = fair  }
	}
	desc = {
		picture = GFX_evt_suspicious_noble
		text = EVTDESC_KO_148
		trigger = { trait = strong }
	}
	desc = {
		picture = GFX_evt_suspicious_noble
		text = EVTDESC_KO_145
		trigger = { trait = cynical }
	}
	desc = {
		picture = GFX_evt_suspicious_noble
		text = EVTDESC_KO_146
		trigger = { trait = hunter  }
	}
	desc = {
		picture = GFX_evt_suspicious_noble
		text = EVTDESC_KO_147
		trigger = { trait = brilliant_strategist  }
			 
	}
	desc = {
		picture = GFX_evt_suspicious_noble
		text = EVTDESC_KO_148
		trigger = {
			father_even_if_dead = { 
				OR = {
					and = {
						death_murder_known_trigger = yes
						killer = { character = ROOT }
					}
					and = {
						death_execution_trigger = yes
						killer = { character = ROOT }
					}
					and = {
						death_reason = death_dungeon 
						killer = { character = ROOT }
					}
					and = {
						death_sacrificed_trigger = yes
						killer = { character = ROOT }
					}
				}
			} 
		} 
	}
	desc = {
		picture = GFX_evt_suspicious_noble
		text = EVTDESC_KO_149
		trigger = { trait = inbred }
	}
	desc = {
		picture = GFX_evt_suspicious_noble
		text = EVTDESC_KO_150
		trigger = {
			father_even_if_dead = { 
				OR = {
					and = {
						death_murder_known_trigger = yes
						killer = { character = ROOT }
					}
					and = {
						death_execution_trigger = yes
						killer = { character = ROOT }
					}
					and = {
						death_reason = death_dungeon 
						killer = { character = ROOT }
					}
					and = {
						death_sacrificed_trigger = yes
						killer = { character = ROOT }
					}
				}
			}
		}
	}
	desc = {
		picture = GFX_evt_suspicious_noble
		text = EVTDESC_KO_151
		trigger = { father_even_if_dead = { death_reason = death_battle } }
	}			
	desc = {
		picture = GFX_evt_suspicious_noble
		text = EVTDESC_KO_157
		trigger = {
			father_even_if_dead = { 
				death_murder_known_trigger = yes
				NOT = { killer = { character = ROOT } }
			}
		}
	}
	
	is_triggered_only = yes

	option = {
		name = EVTOPTA_KO_151
		 character_event = { id = ko.372 }								
	}
	option = {
		name = EVTOPTB_KO_151
		 character_event = { id = ko.370 }								
	}
}

# The ceremony is finished like
character_event = {
	id = ko.372
	desc = EVTDESC_KO_155
	picture = GFX_evt_mu

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_KO_155
		piety = 25
		any_vassal = {
			limit = {
				OR = {
					is_republic = yes
					is_theocracy = yes
				}
			}
			opinion = {
				modifier = opinion_approves
				who = ROOT
				years = 5
			}
		}
		clr_character_flag = mu_in_the_house
		clr_character_flag = do_not_disturb		
	}
}

# The ceremony is finished didn't like
character_event = {
	id = ko.370
	desc = EVTDESC_KO_156
	picture = GFX_evt_mu

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_KO_155
		piety = 25
		any_vassal = {
			limit = {
				OR = {
					is_republic = yes
					is_theocracy = yes
				}	
				opinion = {
					modifier = opinion_approves
					who = ROOT
					years = 5
			    }
			}
		}
		clr_character_flag = mu_in_the_house
		clr_character_flag = do_not_disturb		
	}
}

# Child bounce event for Mu
character_event = {
	id = ko.462
	desc = EVTDESC_KO_350.60
	picture = GFX_evt_mu
	border = GFX_event_normal_frame_religion	
	is_triggered_only = yes
	
	trigger = { 
		calc_true_if = { # If I'm reading this correctly, you can get this event *without* being Muist/Reformed Muist because you can live up to four other items; is this meant to be the case?
			amount = 4
			religion = korean_pagan_reformed
			religion = korean_pagan
			trait = detached_priest
			trait = martial_cleric
			trait = scholarly_theologian
			trait = mastermind_theologian
			trait = mystic
			trait = zealous
			is_female = yes
			trait = possessed
			trait = lunatic
			learning = 10
		}
	}

	weight_multiplier = {
		days = 1
		modifier = {
			factor = 3
			trait = zealous   
		}
		modifier = {
			factor = 0.5
			trait = sceptical  
		}
		modifier = {
			factor = 3
			trait = trusting
		}
		modifier = {
			factor = 1.5
			trait = patient
		}
		modifier = {
			factor = 0.5
			trait = wroth
		}
		modifier = {
			factor = 0.1
			trait = proud
		}
		modifier = {
			factor = 0.1
			trait = humble
		}
	}
	option = {
		name = EVTOPTA_KO_350.60
		piety = 50
		prestige = -100
		father  = {
			character_event = { id = ko.463 }
		}
	}

	option = {
		name = EVTOPTB_KO_350.60
		ai_chance = {
			factor = 3
			modifier = {
				factor = 2.0
				trait = craven
			}
			modifier = {
				factor = 2.0
				trait = content
			}
			modifier = {
				factor = 100
				trait = skeptical
			}
			modifier = {
				factor = 2
				trait = ambitious
			}				
		}		
		add_trait = content
	}
}

# Father receives message
character_event = {
	id = ko.463
	desc = EVTDESC_KO_350
	picture = GFX_evt_daughter_asking_father
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	option = {
		name = EVTOPTA_KO_350
		set_character_flag = mu_daughter
		FROM = {
			opinion = {
				modifier = opinion_ambition_fulfilled
				who = ROOT
				years = 5
			}
			add_trait = zealous
			add_character_modifier = {
				name = Mu
				duration = -1
			}
		}
	}
	option = {
		name = EVTOPTB_KO_350 # This is a rather powerful event option, especially since it doesn't affect YOUR character...
		FROM = {
			opinion = {
				modifier = opinion_disgruntled
				who = ROOT
				years = 10
			}
			remove_trait = detached_priest
			remove_trait = martial_cleric
			remove_trait = scholarly_theologian
			remove_trait = mastermind_theologian
			add_trait = indulgent_wastrel
		}
	}
	option = {
		name = EVTOPTC_KO_350
		piety = 20
		prestige = -50
		FROM = {
			add_trait = zealous
			add_trait = celibate
			opinion = {
				modifier = opinion_flattered
				who = ROOT
				years = 5
			}
			add_character_modifier = {
				name = fake_it_til_you_make_it
				duration = 500
			}
			add_character_modifier = {
				name = Mu
				duration = -1
			}
		}
	}
	option = {
		name = EVTOPTD_KO_350
		set_character_flag = mu_daughter
		piety = -50
		prestige = 50
		FROM = {
			opinion = {
				modifier = opinion_banished_same_faith # This is the wrong event option (this is for banishing all X); the regular banishment event option is probably what you're looking for, and that's automatically triggered by "banish = yes"...
				who = ROOT
				years = 10
			}
			add_character_modifier = {
				name = Mu
				duration = -1
			}
			add_trait = zealous
		}		
	}
}
	
