# Japanese regency stuff

plot_overthrow_my_regent = {
	type = realm_characters
	military_plot = yes
	
	# Plotter scope
	potential = {
		is_landed = yes
		religion = shinto
		controls_religion = yes
		trait = under_regency
		has_actual_regency_trigger = no
	}
	
	# Target scope
	target_potential = {
		liege = {
			character = FROM
		}
		trait = japanese_regent
		has_regent = no
	}
	
	allow = {
		NOT = {
			has_non_aggression_pact_with = FROM # If we have an NAP, we should break that first!
		}
	}
	
	# ROOT = target FROM = joiner FROMFROM = plotter
	allow_join = {
		ROOT = {
			any_vassal = {
				higher_tier_than = baron
				character = FROM
			}
		}
	}
	
	success = {
		NOT = {
			trait = japanese_regent
		}
		FROM = {
			NOT = {
				trait = under_regency
			}
		}
	}
	
	# Based on plot_gain_title's logic
	chance = {
		factor = 50
		
		modifier = {
			factor = 0.0
			FROM = {
				ai = yes
				war = yes
			}
		}
		modifier = {
			factor = 0.01
			FROM = { trait = content }
		}
		modifier = {
			factor = 0.2
			FROM = {
				OR = {
					trait = dull
					trait = slow
				}
			}
		}
		modifier = {
			factor = 0.2
			FROM = { trait = kind }
		}
		modifier = {
			factor = 0
			FROM = { opinion = { who = LIEGE value = 50 } }
			OR = {
				FROM = { trait = envious }
				FROM = { trait = deceitful }
				FROM = { trait = ambitious }
			}			
		}		
		modifier = {
			factor = 0
			FROM = { opinion = { who = LIEGE value = 25 } }
			NOT = {
				OR = {
					FROM = { trait = envious }
					FROM = { trait = deceitful }
					FROM = { trait = ambitious }
				}
			}
		}
		modifier = {
			factor = 0.2
			FROM = { opinion = { who = LIEGE value = 0 } }
			NOT = {
				OR = {
					FROM = { trait = envious }
					FROM = { trait = deceitful }
					FROM = { trait = ambitious }
				}
			}
		}
		modifier = {
			factor = 0.2
			FROM = { opinion = { who = LIEGE value = 25 } }
			OR = {
				FROM = { trait = envious }
				FROM = { trait = deceitful }
				FROM = { trait = ambitious }
			}
		}
		modifier = {
			factor = 1.5
			NOT = { FROM = { opinion = { who = LIEGE value = -50 } } }
		}
		modifier = {
			factor = 1.5
			NOT = { FROM = { opinion = { who = LIEGE value = -75 } } }
		}
		modifier = {
			factor = 1.5
			FROM = { is_smart_trigger = yes }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = envious }
		}
		modifier = {
			factor = 2.0
			FROM = { trait = deceitful }
		}
		modifier = {
			factor = 4.0
			FROM = { trait = ambitious }
		}
		# If we're the top liege, make us more likely to try to depose the regent
		modifier = {
			factor = 2.0
			FROM = {
				tier = emperor
			}
		}
		# If the regent is low tier, make us more likely to try to depose the regent
		modifier = {
			factor = 1.5
			NOT = {
				tier = king
			}
		}
		modifier = {
			factor = 1.5
			NOR = {
				tier = king
				tier = duke
			}
		}
		# If the regent has no playable vassals, make us more likely to try to depose the regent
		modifier = {
			factor = 5
			NOT = {
				any_vassal = {
					higher_tier_than = baron
				}
			}
		}
	}
	
	abort = {
		OR = {
			FROM = {
				NAND = {
					is_landed = yes
					religion = shinto
					controls_religion = yes
					trait = under_regency
					has_actual_regency_trigger = no
				}
			}
			NAND = {
				OR = {
					liege = {
						character = FROM
					}
					liege_before_war = {
						character = FROM
					}
				}
				trait = japanese_regent
				has_regent = no
			}
		}
	}
	
	effect = {
		FROM = {
			if = {
				limit = {
					NOT = { diplomacy = 10 }
				}
				change_diplomacy = 1
			}
			any_plot_backer = {
				reverse_opinion = {
					modifier = opinion_grateful
					who = FROM
					years = 5
				}
			}
			# Clear flags
			hidden_tooltip = {
				clr_character_flag = plot_overthrow_my_regent_taken
			}
		}
	}
}