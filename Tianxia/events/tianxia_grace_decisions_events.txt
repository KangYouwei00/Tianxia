# New Grace events

namespace = grace

##### Tributes (1-37; reserved ids 1-300)

### Send Gift (1-3)

# The EoC gets the gift, can accept or refuse
narrative_event = {
	id = grace.1
	is_triggered_only = yes
	title = EVTTITLE_GRACE_1
	desc = EVTDESC_GRACE_1
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			trait = greedy
			OR = {
				ai = no
				china_accepts_gold_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_1 # Accept the gift, and give extra Grace due to greed
		
		wealth = 500
		
		FROMFROM = {
			letter_event = { id = grace.2 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_gift
		}
	}
	
	option = {
		trigger = {
			NOR = {
				trait = greedy
				trait = charitable
			}
			OR = {
				ai = no
				china_accepts_gold_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTB_GRACE_1 # Accept the gift
		
		wealth = 500
		
		FROMFROM = {
			letter_event = { id = grace.2 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_gift
		}
	}
	
	option = {
		trigger = {
			trait = charitable
			OR = {
				ai = no
				china_accepts_gold_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTC_GRACE_1 # Accept the gift, but give less Grace due to being Charitable
		
		wealth = 500
		
		FROMFROM = {
			letter_event = { id = grace.2 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_gift
		}
	}
	
	option = {
		trigger = {
			china_accepts_gold_tribute_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTD_GRACE_1 # Refuse the gift, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.3 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_accepts_gold_tribute_fromfrom_trigger = yes
		}
		name = EVTOPTE_GRACE_1 # Refuse the gift, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.3 }
		}
		
		# TODO: Penalize
	}
}

# Gift accepted, sender gets Grace and loses the money
letter_event = {
	id = grace.2
	is_triggered_only = yes
    border = GFX_event_letter_frame_diplomacy
	
	desc = {
		trigger = {
			FROM = {
				trait = greedy
			}
		}
		text = EVTDESC_GRACE_2_A
	}
	
	desc = {
		trigger = {
			FROM = {
				NOR = {
					trait = greedy
					trait = charitable
				}
			}
		}
		text = EVTDESC_GRACE_2_B
	}
	
	desc = {
		trigger = {
			FROM = {
				trait = charitable
			}
		}
		text = EVTDESC_GRACE_2_C
	}
	
	option = {
		trigger = {
			FROM = {
				trait = greedy
			}
		}
		
		name = EVTOPTA_GRACE_2
		
		wealth = -500
		sound_effect = china_grace_gain
		change_variable = {
			which = grace
			value = 450
		}
		set_character_flag = grace_character
		log = "[From.GetTitledName] accepted [Root.GetTitledName]'s gold tribute!"
	}
	
	option = {
		trigger = {
			FROM = {
				NOR = {
					trait = greedy
					trait = charitable
				}
			}
		}
		
		name = EVTOPTB_GRACE_2
		
		wealth = -500
		sound_effect = china_grace_gain
		change_variable = {
			which = grace
			value = 300
		}
		set_character_flag = grace_character
		log = "[From.GetTitledName] accepted [Root.GetTitledName]'s gold tribute!"
	}
	
	option = {
		trigger = {
			FROM = {
				trait = charitable
			}
		}
		
		name = EVTOPTC_GRACE_2
		
		wealth = -500
		sound_effect = china_grace_gain
		change_variable = {
			which = grace
			value = 150
		}
		set_character_flag = grace_character
		log = "[From.GetTitledName] accepted [Root.GetTitledName]'s gold tribute!"
	}
}

# Gift refused, sender's opinion of the EoC lowered
letter_event = {
	id = grace.3
	is_triggered_only = yes
	desc = EVTDESC_GRACE_3
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_3
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_gift
		}
		log = "[From.GetTitledName] refused [Root.GetTitledName]'s gold tribute!"
	}
}

### Become Tributary (4-7)

# The EoC gets the offer, can accept or refuse
narrative_event = {
	id = grace.4
	is_triggered_only = yes
	title = EVTTITLE_GRACE_4
	desc = EVTDESC_GRACE_4
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_accepts_tributary_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_4 # Accept the tributary
		
		FROMFROM = {
			letter_event = { id = grace.5 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_became_tributary
		}
	}
	
	option = {
		trigger = {
			china_accepts_tributary_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTB_GRACE_4 # Refuse the tributary, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.6 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_accepts_tributary_fromfrom_trigger = yes
		}
		name = EVTOPTC_GRACE_4 # Refuse the tributary, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.6 }
		}
		
		# TODO: Penalize
	}
}

# Tributary status accepted, sender gets Grace and becomes a tributary
letter_event = {
	id = grace.5
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_5
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_5
		
		change_variable = {
			which = grace
			value = 200
		}
		set_character_flag = grace_character
		
		sound_effect = china_grace_gain
		FROM = {
			make_tributary = {
				who = ROOT
				tributary_type = permanent
			}
		}
		hidden_tooltip = {
			character_event = { id = grace.7 days = 30 }
		}
		log = "[From.GetTitledName] accepted to make [Root.GetTitledName] a tributary!"
	}
}

# Tributary status refused, sender's opinion of the EoC lowered
letter_event = {
	id = grace.6
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_6
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_6
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_tributary
		}
		log = "[From.GetTitledName] refused to make [Root.GetTitledName] a tributary!"
	}
}

# Monthly Grace gain for being a tributary
character_event = {
	id = grace.7
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		suzerain = { is_chinese_emperor_trigger = yes }
	}
	
	immediate = {
		change_variable = {
			which = grace
			value = 2
		}
		# Extra Grace gain if we have the same culture group and religion as the EoC
		if = {
			limit = {
				suzerain = {
					culture_group = ROOT
					religion = ROOT
				}
			}
			change_variable = {
				which = grace
				value = 1
			}
		}
		# Extra Grace gain if we have the same culture and religion as the EoC
		if = {
			limit = {
				suzerain = {
					culture_group = ROOT
					religion = ROOT
				}
			}
			change_variable = {
				which = grace
				value = 1
			}
		}
		repeat_event = { id = grace.7 days = 30 } # Keep the Grace coming
	}
}

### Supply Horses (8-11)

# The EoC gets the offer, can accept or refuse
narrative_event = {
	id = grace.8
	is_triggered_only = yes
	title = EVTTITLE_GRACE_8
	desc = EVTDESC_GRACE_8
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_accepts_horses_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_8 # Accept the horses
		
		# TODO: Give bonus from horses
		
		FROMFROM = {
			letter_event = { id = grace.9 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_supplying_horses
		}
	}
	
	option = {
		trigger = {
			china_accepts_horses_tribute_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTB_GRACE_8 # Refuse the horses, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.10 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_accepts_horses_tribute_fromfrom_trigger = yes
		}
		name = EVTOPTC_GRACE_8 # Refuse the horses, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.10 }
		}
		
		# TODO: Penalize
	}
}

# Horses accepted, sender gets Grace + negative manpower modifier + monthly Grace gain event
letter_event = {
	id = grace.9
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_9
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_9
		
		change_variable = {
			which = grace
			value = 200
		}
		set_character_flag = grace_character
		
		sound_effect = china_grace_gain
		add_character_modifier = {
			inherit = yes # Ensure the Grace gain is inherited!
			modifier = china_supply_horses
			duration = -1
		}
		hidden_tooltip = {
			character_event = { id = grace.11 days = 30 }
		}
		log = "[From.GetTitledName] accepted [Root.GetTitledName]'s horse tribute!"
	}
}

# Horses refused, sender's opinion of the EoC lowered
letter_event = {
	id = grace.10
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_10
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_10
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_horses
		}
		log = "[From.GetTitledName] refused [Root.GetTitledName]'s horse tribute!"
	}
}

# Monthly Grace gain for supplying horses
character_event = {
	id = grace.11
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = china_supply_horses
	}
	
	immediate = {
		if = {
			limit = {
				is_nomadic = no
			}
			remove_character_modifier = china_supply_horses
			break = yes
		}
		if = {
			limit = {
				any_war = {
					OR = {
						AND = {
							any_attacker = {
								character = ROOT
							}
							any_defender = {
								is_chinese_emperor_trigger = yes
							}
						}
						AND = {
							any_defender = {
								character = ROOT
							}
							any_attacker = {
								is_chinese_emperor_trigger = yes
							}
						}
					}
				}
			}
			remove_character_modifier = china_supply_horses
			break = yes
		}
		change_variable = {
			which = grace
			value = 2
		}
		repeat_event = { id = grace.11 days = 30 } # Keep the Grace coming
	}
}

### Stop Supplying Horses (12-13)

# The EoC is informed of the end of the tribute
narrative_event = {
	id = grace.12
	is_triggered_only = yes
	title = EVTTITLE_GRACE_12
	desc = EVTDESC_GRACE_12
	picture = GFX_evt_china_golden_age # TODO: Update
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_GRACE_12 # Make your displeasure known
		
		# TODO: Remove bonus from horses
		
		FROMFROM = {
			letter_event = { id = grace.13 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_stopped_supplying_horses
		}
	}
}

# The sender is informed of the EoC's displeasure + loses Grace
letter_event = {
	id = grace.13
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_13
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_13
		
		sound_effect = china_angered_emperor
		change_variable = {
			which = grace
			value = -100
		}
		log = "[Root.GetTitledName] stopped supplying horses to [From.GetTitledName]!"
	}
}

### Offer Eunuch (14-17)

# The EoC gets the offer
narrative_event = {
	id = grace.14
	is_triggered_only = yes
	title = EVTTITLE_GRACE_14
	desc = EVTDESC_GRACE_14
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_accepts_eunuch_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOR = {
				test_grace_refusal_trigger = yes
				AND = {
					china_hates_fromfromfrom_trigger = yes
					test_grace_acceptance_trigger = no
				}
			}
		}
		name = EVTOPTA_GRACE_14 # Accept the eunuch
		
		FROMFROM = {
			letter_event = { id = grace.15 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_eunuch
		}
		
		ai_chance = {
			factor = 10 # TODO: Make more likely for a good eunuch
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_accepts_eunuch_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOR = {
				test_grace_refusal_trigger = yes
				AND = {
					china_hates_fromfromfrom_trigger = yes
					test_grace_acceptance_trigger = no
				}
			}
			any_realm_lord = {
				higher_tier_than = baron
				# TODO: Ensure the EoC doesn't hate the vassal
			}
		}
		name = EVTOPTB_GRACE_14 # Accept the eunuch, but give him to a vassal
		
		FROMFROM = {
			letter_event = { id = grace.16 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_eunuch_small
		}
		
		ai_chance = {
			factor = 90 # TODO: Make more likely for a bad eunuch
		}
	}
	
	option = {
		trigger = {
			OR = {
				china_accepts_eunuch_tribute_fromfrom_trigger = no
				china_hates_fromfromfrom_trigger = yes
			}
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTC_GRACE_14 # Refuse the eunuch, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.17 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_accepts_eunuch_tribute_fromfrom_trigger = yes
			china_hates_fromfromfrom_trigger = no
		}
		name = EVTOPTD_GRACE_14 # Refuse the eunuch, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.17 }
		}
		
		# TODO: Penalize
	}
}

# Eunuch accepted, sender gets Grace
letter_event = {
	id = grace.15
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_15
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_15
		
		hidden_tooltip = {
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			change_variable = {
				which = grace_gain
				value = 100
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						diplomacy = 8
						NOT = { diplomacy = 12 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						diplomacy = 12
						NOT = { diplomacy = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						diplomacy = 16
						NOT = { diplomacy = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						diplomacy = 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 8
						NOT = { martial = 12 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 12
						NOT = { martial = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 16
						NOT = { martial = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						stewardship = 8
						NOT = { stewardship = 12 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						stewardship = 12
						NOT = { stewardship = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						stewardship = 16
						NOT = { stewardship = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						stewardship = 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						intrigue = 8
						NOT = { intrigue = 12 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						intrigue = 12
						NOT = { intrigue = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						intrigue = 16
						NOT = { intrigue = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						intrigue = 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 8
						NOT = { learning = 12 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 12
						NOT = { learning = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 16
						NOT = { learning = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = fair
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = genius
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = quick
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = strong
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = robust
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = shrewd
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = architect
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = administrator
					}
				}
				change_variable = {
					which = grace_gain
					value = 60
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = strategist
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = scholar
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = faqih
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						OR = {
							trait = intricate_webweaver
							trait = charismatic_negotiator
							trait = fortune_builder
							trait = skilled_tactician
							trait = scholarly_theologian
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						OR = {
							trait = elusive_shadow
							trait = grey_eminence
							trait = midas_touched
							trait = brilliant_strategist
							trait = mastermind_theologian
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						is_adult = no
					}
				}
				change_variable = {
					which = grace_gain
					value = 60
				}
			}
		}
		
		change_variable = {
			which = grace
			which = grace_gain
		}
		set_character_flag = grace_character
		
		sound_effect = china_grace_gain
		
		FROMFROMFROMFROM = {
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			
			move_character = FROM
			force_host = FROM
		}
		log = "[From.GetTitledName] accepted [Root.GetTitledName]'s eunuch tribute, [FromFromFromFrom.GetBestName]!"
	}
}

# Eunuch accepted but not deemed suitable for the Imperial Court, sender gets less Grace + lowered opinion of the EoC
letter_event = {
	id = grace.16
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_16
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_16
		
		hidden_tooltip = {
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			change_variable = {
				which = grace_gain
				value = 50
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						diplomacy = 8
						NOT = { diplomacy = 12 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 10
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						diplomacy = 12
						NOT = { diplomacy = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						diplomacy = 16
						NOT = { diplomacy = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 38 # Rounded up
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						diplomacy = 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 60
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 8
						NOT = { martial = 12 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 10
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 12
						NOT = { martial = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 16
						NOT = { martial = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 38 # Rounded up
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 60
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						stewardship = 8
						NOT = { stewardship = 12 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 10
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						stewardship = 12
						NOT = { stewardship = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						stewardship = 16
						NOT = { stewardship = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 38 # Rounded up
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						stewardship = 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 60
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						intrigue = 8
						NOT = { intrigue = 12 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 10
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						intrigue = 12
						NOT = { intrigue = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						intrigue = 16
						NOT = { intrigue = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 38 # Rounded up
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						intrigue = 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 60
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 8
						NOT = { learning = 12 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 10
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 12
						NOT = { learning = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 16
						NOT = { learning = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 38 # Rounded up
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 60
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = fair
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = genius
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = quick
					}
				}
				change_variable = {
					which = grace_gain
					value = 15
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = strong
					}
				}
				change_variable = {
					which = grace_gain
					value = 10
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = robust
					}
				}
				change_variable = {
					which = grace_gain
					value = 10
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = shrewd
					}
				}
				change_variable = {
					which = grace_gain
					value = 15
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = architect
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = administrator
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = strategist
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = scholar
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = faqih # Block if Zealous, increase if Sympathy?
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						OR = {
							trait = intricate_webweaver
							trait = charismatic_negotiator
							trait = fortune_builder
							trait = skilled_tactician
							trait = scholarly_theologian
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = 13 # Rounded up
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						OR = {
							trait = elusive_shadow
							trait = grey_eminence
							trait = midas_touched
							trait = brilliant_strategist
							trait = mastermind_theologian
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						is_adult = no
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
		}
		
		change_variable = {
			which = grace
			which = grace_gain
		}
		set_character_flag = grace_character
		
		sound_effect = china_grace_gain
		
		FROMFROMFROMFROM = {
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			add_trait = sent_to_china # Disinherits
			
			letter_event = { id = grace.903 }
		}
		
		opinion = {
			who = FROM
			modifier = opinion_china_eunuch_not_imperial
		}
	}
}

# Eunuch refused, sender's opinion of the EoC lowered, eunuch gets upset about the attempted snipping off to China
letter_event = {
	id = grace.17
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_17
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_17
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_eunuch
		}
		log = "[From.GetTitledName] refused [Root.GetTitledName]'s eunuch tribute, [FromFromFromFrom.GetBestName]!"
	}
}


### Offer Concubine (18-22)

# The EoC gets the offer
narrative_event = {
	id = grace.18
	is_triggered_only = yes
	title = EVTTITLE_GRACE_18
	desc = EVTDESC_GRACE_18
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			AND = {
				is_female = no
				is_adult = yes
				NOR = {
					trait = eunuch
					trait = incapable
					trait = celibate # No interest
					trait = homosexual # Should not bother with lots of concubines
				}
				prisoner = no
				is_inaccessible_trigger = no
			}
			OR = {
				ai = no
				china_accepts_concubine_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOR = {
				test_grace_refusal_trigger = yes
				AND = {
					china_hates_fromfromfrom_trigger = yes
					test_grace_acceptance_trigger = no
				}
			}
		}
		name = EVTOPTA_GRACE_18 # Accept the concubine
		
		FROMFROM = {
			letter_event = { id = grace.19 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_concubine
		}
		
		ai_chance = {
			factor = 10 # TODO: Make more likely for a good concubine
		}
	}
	
	option = {
		trigger = {
			AND = {
				current_heir = {
					is_female = no
					is_adult = yes
					NOR = {
						trait = eunuch
						trait = incapable
						trait = celibate # No interest
						trait = homosexual # Should not bother with lots of concubines
					}
					prisoner = no
					is_inaccessible_trigger = no
					is_landed = no
				}
			}
			OR = {
				ai = no
				china_accepts_concubine_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOR = {
				test_grace_refusal_trigger = yes
				AND = {
					china_hates_fromfromfrom_trigger = yes
					test_grace_acceptance_trigger = no
				}
			}
		}
		name = EVTOPTB_GRACE_18 # Accept the concubine, but give her to your heir
		
		FROMFROM = {
			letter_event = { id = grace.20 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_concubine
		}
		
		ai_chance = {
			factor = 10 # TODO: Make more likely for a good concubine
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_accepts_concubine_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOR = {
				test_grace_refusal_trigger = yes
				AND = {
					china_hates_fromfromfrom_trigger = yes
					test_grace_acceptance_trigger = no
				}
			}
			any_realm_lord = {
				higher_tier_than = baron
				# TODO: Ensure the EoC doesn't hate the vassal
				is_female = no
				has_concubinage = yes
				NOT = {
					num_of_consorts = 3 # Can't take additional concubines
				}
				is_adult = yes
				NOR = {
					trait = celibate
					trait = eunuch
					trait = incapable
				}
				prisoner = no
				is_inaccessible_trigger = no
			}
		}
		name = EVTOPTC_GRACE_18 # Accept the concubine, but give her to a random vassal
		
		FROMFROM = {
			letter_event = { id = grace.21 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_concubine_small
		}
		
		ai_chance = {
			factor = 90 # TODO: Make more likely for a bad concubine
		}
	}
	
	option = {
		trigger = {
			OR = {
				china_accepts_concubine_tribute_fromfrom_trigger = no
				china_hates_fromfromfrom_trigger = yes
			}
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTD_GRACE_18 # Refuse the concubine, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.22 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_accepts_concubine_tribute_fromfrom_trigger = yes
			china_hates_fromfromfrom_trigger = no
		}
		name = EVTOPTE_GRACE_18 # Refuse the eunuch, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.22 }
		}
		
		# TODO: Penalize
	}
}

# Concubine accepted as EoC's personal concubine, sender gets Grace
letter_event = {
	id = grace.19
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_19
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_19
		
		hidden_tooltip = {
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			change_variable = {
				which = grace_gain
				value = 100 # TODO: Concubine Grace gain scaling
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						diplomacy = 8
						NOT = { diplomacy = 12 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						diplomacy = 12
						NOT = { diplomacy = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						diplomacy = 16
						NOT = { diplomacy = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						diplomacy = 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 8
						NOT = { martial = 12 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 12
						NOT = { martial = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 16
						NOT = { martial = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						stewardship = 8
						NOT = { stewardship = 12 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						stewardship = 12
						NOT = { stewardship = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						stewardship = 16
						NOT = { stewardship = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						stewardship = 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						intrigue = 8
						NOT = { intrigue = 12 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						intrigue = 12
						NOT = { intrigue = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						intrigue = 16
						NOT = { intrigue = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						intrigue = 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 8
						NOT = { learning = 12 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 12
						NOT = { learning = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 16
						NOT = { learning = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = fair
					}
				}
				change_variable = {
					which = grace_gain
					value = 80
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = ugly
					}
				}
				change_variable = {
					which = grace_gain
					value = -80
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = genius
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = quick
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = strong
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = robust
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = shrewd
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = charitable
						FROM = {
							NOT = {
								trait = greedy # Opposites do not attract in CK2!
							}
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = gregarious
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = kind
						FROM = {
							# Opposites do not attract in CK2!
							NOR = {
								trait = cruel
								trait = envious
							}
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = lunatic
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						OR = {
							trait = intricate_webweaver
							trait = charismatic_negotiator
							trait = fortune_builder
							trait = skilled_tactician
							trait = scholarly_theologian
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						OR = {
							trait = elusive_shadow
							trait = grey_eminence
							trait = midas_touched
							trait = brilliant_strategist
							trait = mastermind_theologian
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			if = {
				limit = {
					FROM = {
						trait = lustful
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 2
				}
			}
			if = {
				limit = {
					FROM = {
						trait = lustful
					}
					FROMFROMFROMFROM = {
						trait = lustful
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 2
				}
			}
			if = {
				limit = {
					FROM = {
						trait = lustful
					}
					FROMFROMFROMFROM = {
						trait = seductress
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 2
				}
			}
			if = {
				limit = {
					FROM = {
						trait = chaste
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 0.5
				}
			}
		}
		
		change_variable = {
			which = grace
			which = grace_gain
		}
		set_character_flag = grace_character
		
		sound_effect = china_grace_gain
		
		FROMFROMFROMFROM = {
			any_spouse = {
				remove_spouse = PREV # Should be unnecessary, but...
			}
			any_consort = {
				remove_consort = PREV # Should be unnecessary, but...
			}
			add_trait = sent_to_china # Blocks marriage and disinherits
			
			move_character = FROM
			force_host = FROM
			add_consort = FROM
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
		}
		log = "[From.GetTitledName] accepted [Root.GetTitledName]'s concubine tribute, [FromFromFromFrom.GetBestName]!"
	}
}

# Concubine accepted as EoC's heir's concubine, sender gets Grace
letter_event = {
	id = grace.20
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_20
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_20
		
		hidden_tooltip = {
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			change_variable = {
				which = grace_gain
				value = 100 # TODO: Concubine Grace gain scaling
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						diplomacy = 8
						NOT = { diplomacy = 12 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						diplomacy = 12
						NOT = { diplomacy = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						diplomacy = 16
						NOT = { diplomacy = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						diplomacy = 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 8
						NOT = { martial = 12 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 12
						NOT = { martial = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 16
						NOT = { martial = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						stewardship = 8
						NOT = { stewardship = 12 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						stewardship = 12
						NOT = { stewardship = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						stewardship = 16
						NOT = { stewardship = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						stewardship = 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						intrigue = 8
						NOT = { intrigue = 12 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						intrigue = 12
						NOT = { intrigue = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						intrigue = 16
						NOT = { intrigue = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						intrigue = 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 8
						NOT = { learning = 12 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 12
						NOT = { learning = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 16
						NOT = { learning = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = fair
					}
				}
				change_variable = {
					which = grace_gain
					value = 80
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = ugly
					}
				}
				change_variable = {
					which = grace_gain
					value = -80
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = genius
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = quick
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = strong
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = robust
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = shrewd
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = charitable
						FROM = {
							current_heir = {
								NOT = {
									trait = greedy # Opposites do not attract in CK2!
								}
							}
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = gregarious
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = kind
						FROM = {
							# Opposites do not attract in CK2!
							current_heir = {
								NOR = {
									trait = cruel
									trait = envious
								}
							}
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = lunatic
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						OR = {
							trait = intricate_webweaver
							trait = charismatic_negotiator
							trait = fortune_builder
							trait = skilled_tactician
							trait = scholarly_theologian
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						OR = {
							trait = elusive_shadow
							trait = grey_eminence
							trait = midas_touched
							trait = brilliant_strategist
							trait = mastermind_theologian
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			if = {
				limit = {
					FROM = {
						current_heir = {
							trait = lustful
						}
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 2
				}
			}
			if = {
				limit = {
					FROM = {
						current_heir = {
							trait = lustful
						}
					}
					FROMFROMFROMFROM = {
						trait = lustful
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 2
				}
			}
			if = {
				limit = {
					FROM = {
						current_heir = {
							trait = lustful
						}
					}
					FROMFROMFROMFROM = {
						trait = seductress
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 2
				}
			}
			if = {
				limit = {
					FROM = {
						current_heir = {
							trait = chaste
						}
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 0.5
				}
			}
		}
		
		change_variable = {
			which = grace
			which = grace_gain
		}
		set_character_flag = grace_character
		
		sound_effect = china_grace_gain
		
		FROMFROMFROMFROM = {
			any_spouse = {
				remove_spouse = PREV # Should be unnecessary, but...
			}
			any_consort = {
				remove_consort = PREV # Should be unnecessary, but...
			}
			add_trait = sent_to_china # Blocks marriage and disinherits
			
			move_character = FROM
			force_host = FROM
			current_heir = {
				add_consort = PREV
			}
		}
		log = "[From.GetTitledName] accepted [Root.GetTitledName]'s concubine tribute, [FromFromFromFrom.GetBestName], for [From.GetHerHis] heir!"
	}
}

# Concubine accepted but given to a vassal, sender gets less Grace + lowered opinion of the EoC
letter_event = {
	id = grace.21
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_21
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_21
		
		hidden_tooltip = {
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			change_variable = {
				which = grace_gain
				value = 50 # TODO: Concubine Grace gain scaling
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						diplomacy = 8
						NOT = { diplomacy = 12 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 10
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						diplomacy = 12
						NOT = { diplomacy = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						diplomacy = 16
						NOT = { diplomacy = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 38 # Rounded up
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						diplomacy = 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 60
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 8
						NOT = { martial = 12 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 10
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 12
						NOT = { martial = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 16
						NOT = { martial = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 38 # Rounded up
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 60
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						stewardship = 8
						NOT = { stewardship = 12 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 10
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						stewardship = 12
						NOT = { stewardship = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						stewardship = 16
						NOT = { stewardship = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 38 # Rounded up
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						stewardship = 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 60
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						intrigue = 8
						NOT = { intrigue = 12 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 10
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						intrigue = 12
						NOT = { intrigue = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						intrigue = 16
						NOT = { intrigue = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 38 # Rounded up
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						intrigue = 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 60
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 8
						NOT = { learning = 12 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 10
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 12
						NOT = { learning = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 16
						NOT = { learning = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 38 # Rounded up
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 60
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = fair
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = ugly
					}
				}
				change_variable = {
					which = grace_gain
					value = -40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = genius
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = quick
					}
				}
				change_variable = {
					which = grace_gain
					value = 15
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = strong
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = robust
					}
				}
				change_variable = {
					which = grace_gain
					value = 15
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = shrewd
					}
				}
				change_variable = {
					which = grace_gain
					value = 15
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = charitable
					}
				}
				change_variable = {
					which = grace_gain
					value = 15
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = gregarious
					}
				}
				change_variable = {
					which = grace_gain
					value = 15
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = kind
					}
				}
				change_variable = {
					which = grace_gain
					value = 15
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = lunatic
					}
				}
				change_variable = {
					which = grace_gain
					value = -25
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						OR = {
							trait = intricate_webweaver
							trait = charismatic_negotiator
							trait = fortune_builder
							trait = skilled_tactician
							trait = scholarly_theologian
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = 13 # Rounded up
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						OR = {
							trait = elusive_shadow
							trait = grey_eminence
							trait = midas_touched
							trait = brilliant_strategist
							trait = mastermind_theologian
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
		}
		
		change_variable = {
			which = grace
			which = grace_gain
		}
		set_character_flag = grace_character
		
		sound_effect = china_grace_gain
		
		FROMFROMFROMFROM = {
			any_spouse = {
				remove_spouse = PREV # Should be unnecessary, but...
			}
			any_consort = {
				remove_consort = PREV # Should be unnecessary, but...
			}
			add_trait = sent_to_china # Blocks marriage and disinherits
			
			letter_event = { id = grace.901 }
		}
		
		opinion = {
			who = FROM
			modifier = opinion_china_concubine_not_imperial
		}
	}
}

# Concubine refused, sender's opinion of the EoC lowered
letter_event = {
	id = grace.22
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_22
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_22
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_concubine
		}
		log = "[From.GetTitledName] refused [Root.GetTitledName]'s concubine tribute, [FromFromFromFrom.GetBestName]!"
	}
}

### Offer Commander (23-26)

# The EoC gets the offer
narrative_event = {
	id = grace.23
	is_triggered_only = yes
	title = EVTTITLE_GRACE_23
	desc = EVTDESC_GRACE_23
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_accepts_commander_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOR = {
				test_grace_refusal_trigger = yes
				AND = {
					china_hates_fromfromfrom_trigger = yes
					test_grace_acceptance_trigger = no
				}
			}
		}
		name = EVTOPTA_GRACE_23 # Accept the commander
		
		FROMFROM = {
			letter_event = { id = grace.24 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_commander
		}
		
		ai_chance = {
			factor = 10 # TODO: Make more likely for a good commander
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_accepts_commander_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOR = {
				test_grace_refusal_trigger = yes
				AND = {
					china_hates_fromfromfrom_trigger = yes
					test_grace_acceptance_trigger = no
				}
			}
			any_realm_lord = {
				higher_tier_than = baron
				# TODO: Ensure the EoC doesn't hate the vassal
			}
		}
		name = EVTOPTB_GRACE_23 # Accept the commander, but give them to a random vassal
		
		FROMFROM = {
			letter_event = { id = grace.25 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_commander_small
		}
		
		ai_chance = {
			factor = 90 # TODO: Make more likely for a bad commander
		}
	}
	
	option = {
		trigger = {
			OR = {
				china_accepts_commander_tribute_fromfrom_trigger = no
				china_hates_fromfromfrom_trigger = yes
			}
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTC_GRACE_23 # Refuse the commander, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.26 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_accepts_commander_tribute_fromfrom_trigger = yes
			china_hates_fromfromfrom_trigger = no
		}
		name = EVTOPTD_GRACE_23 # Refuse the commander, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.26 }
		}
		
		# TODO: Penalize
	}
}

# Commander accepted, sender gets Grace
letter_event = {
	id = grace.24
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_24
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_24
		
		hidden_tooltip = {
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			change_variable = {
				which = grace_gain
				value = 100
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 12
						NOT = { martial = 14 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 14
						NOT = { martial = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 16
						NOT = { martial = 18 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 60
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 18
						NOT = { martial = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 80
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 20
						NOT = { martial = 22 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 22
						NOT = { martial = 24 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 24
					}
				}
				change_variable = {
					which = grace_gain
					value = 140
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = genius
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = quick
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = strong
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = robust
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = shrewd
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = strategist
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = duelist
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = hunter
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = berserker
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = adventurer
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = patient
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = brave
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = diligent
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = shieldmaiden
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = sapper
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = master_of_flame
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = logistics_expert
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = levy_coordinator
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = light_foot_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = heavy_infantry_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = cavalry_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = inspiring_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = trickster
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = organizer
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = defensive_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = experimenter
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = flanker
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = aggressive_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = siege_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = skilled_tactician
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = brilliant_strategist
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
		}
		
		change_variable = {
			which = grace
			which = grace_gain
		}
		set_character_flag = grace_character
		
		sound_effect = china_grace_gain
		
		FROMFROMFROMFROM = {
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			
			move_character = FROM
			force_host = FROM
		}
		log = "[From.GetTitledName] accepted [Root.GetTitledName]'s commander tribute, [FromFromFromFrom.GetBestName]!"
	}
}

# Commander accepted but sent to a vassal, sender gets less Grace + lowered opinion of the EoC
letter_event = {
	id = grace.25
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_25
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_25
		
		hidden_tooltip = {
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			change_variable = {
				which = grace_gain
				value = 50
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 12
						NOT = { martial = 14 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 10
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 14
						NOT = { martial = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 16
						NOT = { martial = 18 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 18
						NOT = { martial = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 20
						NOT = { martial = 22 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 22
						NOT = { martial = 24 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 60
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						martial = 24
					}
				}
				change_variable = {
					which = grace_gain
					value = 70
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = genius
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = quick
					}
				}
				change_variable = {
					which = grace_gain
					value = 15
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = strong
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = robust
					}
				}
				change_variable = {
					which = grace_gain
					value = 15
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = shrewd
					}
				}
				change_variable = {
					which = grace_gain
					value = 15
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = strategist
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = duelist
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = hunter
					}
				}
				change_variable = {
					which = grace_gain
					value = 10
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = berserker
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = adventurer
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = patient
					}
				}
				change_variable = {
					which = grace_gain
					value = 10
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = brave
					}
				}
				change_variable = {
					which = grace_gain
					value = 10
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = diligent
					}
				}
				change_variable = {
					which = grace_gain
					value = 10
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = shieldmaiden
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = sapper
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = master_of_flame
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = logistics_expert
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = levy_coordinator
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = light_foot_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = heavy_infantry_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = cavalry_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = inspiring_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = trickster
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = organizer
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = defensive_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = experimenter
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = flanker
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = aggressive_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = siege_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = skilled_tactician
					}
				}
				change_variable = {
					which = grace_gain
					value = 13 # Rounded up
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = brilliant_strategist
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
		}
		
		change_variable = {
			which = grace
			which = grace_gain
		}
		set_character_flag = grace_character
		
		sound_effect = china_grace_gain
		
		FROMFROMFROMFROM = {
			add_trait = sent_to_china # Disinherits
			
			letter_event = { id = grace.905 }
		}
		
		opinion = {
			who = FROM
			modifier = opinion_china_commander_not_imperial
		}
	}
}

# Commander refused, sender's opinion of the EoC lowered
letter_event = {
	id = grace.26
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_26
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_26
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_commander
		}
		log = "[From.GetTitledName] refused [Root.GetTitledName]'s commander tribute, [FromFromFromFrom.GetBestName]!"
	}
}

### Offer Physician (27-30)

# The EoC gets the offer
narrative_event = {
	id = grace.27
	is_triggered_only = yes
	title = EVTTITLE_GRACE_27
	desc = EVTDESC_GRACE_27
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_accepts_physician_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOR = {
				test_grace_refusal_trigger = yes
				AND = {
					china_hates_fromfromfrom_trigger = yes
					test_grace_acceptance_trigger = no
				}
			}
		}
		name = EVTOPTA_GRACE_27 # Accept the physician
		
		FROMFROM = {
			letter_event = { id = grace.28 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_physician
		}
		
		ai_chance = {
			factor = 10 # TODO: Make more likely for a good physician
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_accepts_physician_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOR = {
				test_grace_refusal_trigger = yes
				AND = {
					china_hates_fromfromfrom_trigger = yes
					test_grace_acceptance_trigger = no
				}
			}
			any_realm_lord = {
				higher_tier_than = baron
				# TODO: Ensure the EoC doesn't hate the vassal
			}
		}
		name = EVTOPTB_GRACE_27 # Accept the physician, but give them to a random vassal
		
		FROMFROM = {
			letter_event = { id = grace.29 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_physician_small
		}
		
		ai_chance = {
			factor = 90 # TODO: Make more likely for a bad physican
		}
	}
	
	option = {
		trigger = {
			OR = {
				china_accepts_physician_tribute_fromfrom_trigger = no
				china_hates_fromfromfrom_trigger = yes
			}
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTC_GRACE_27 # Refuse the physician, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.30 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_accepts_physician_tribute_fromfrom_trigger = yes
			china_hates_fromfromfrom_trigger = no
		}
		name = EVTOPTD_GRACE_27 # Refuse the physician, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.30 }
		}
		
		# TODO: Penalize
	}
}

# Physician accepted, sender gets Grace
letter_event = {
	id = grace.28
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_28
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_28
		
		hidden_tooltip = {
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			change_variable = {
				which = grace_gain
				value = 100
			}
			
			if = {
				limit = {
					FROMFROMFROMFROM = {
						NOT = { learning = 8 }
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 8
						NOT = { learning = 12 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 12
						NOT = { learning = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 60
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 16
						NOT = { learning = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 20
						NOT = { learning = 24 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 140
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 24
						NOT = { learning = 28 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 180
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 28
						NOT = { learning = 32 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 220
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 32
					}
				}
				change_variable = {
					which = grace_gain
					value = 260
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = genius
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = quick
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = shrewd
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = physician
					}
				}
				change_variable = {
					which = grace_gain
					value = 150
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = mystic
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = scholar
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = scholarly_theologian
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = mastermind_theologian
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = patient
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = diligent
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
		}
		
		change_variable = {
			which = grace
			which = grace_gain
		}
		set_character_flag = grace_character
		
		sound_effect = china_grace_gain
		
		FROMFROMFROMFROM = {
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			
			move_character = FROM
			force_host = FROM
		}
		log = "[From.GetTitledName] accepted [Root.GetTitledName]'s physician tribute, [FromFromFromFrom.GetBestName]!"
	}
}

# Physician accepted but sent to a vassal, sender gets less Grace + lowered opinion of the EoC
letter_event = {
	id = grace.29
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_29
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_29
		
		hidden_tooltip = {
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			change_variable = {
				which = grace_gain
				value = 50
			}
			
			if = {
				limit = {
					FROMFROMFROMFROM = {
						NOT = { learning = 8 }
					}
				}
				change_variable = {
					which = grace_gain
					value = -25
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 8
						NOT = { learning = 12 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 12
						NOT = { learning = 16 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 16
						NOT = { learning = 20 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 20
						NOT = { learning = 24 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 70
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 24
						NOT = { learning = 28 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 90
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 28
						NOT = { learning = 32 }
					}
				}
				change_variable = {
					which = grace_gain
					value = 110
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						learning = 32
					}
				}
				change_variable = {
					which = grace_gain
					value = 130
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = genius
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = quick
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = shrewd
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = physician
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = mystic
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = scholar
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = scholarly_theologian
					}
				}
				change_variable = {
					which = grace_gain
					value = 13 # Rounded up
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = mastermind_theologian
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = patient
					}
				}
				change_variable = {
					which = grace_gain
					value = 13 # Rounded up
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						trait = diligent
					}
				}
				change_variable = {
					which = grace_gain
					value = 13 # Rounded up
				}
			}
		}
		
		change_variable = {
			which = grace
			which = grace_gain
		}
		set_character_flag = grace_character
		
		sound_effect = china_grace_gain
		
		FROMFROMFROMFROM = {
			add_trait = sent_to_china # Disinherits
			
			letter_event = { id = grace.907 }
		}
		
		opinion = {
			who = FROM
			modifier = opinion_china_physician_not_imperial
		}
	}
}

# Physician refused, sender's opinion of the EoC lowered
letter_event = {
	id = grace.30
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_30
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_30
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_physician
		}
		log = "[From.GetTitledName] refused [Root.GetTitledName]'s physician tribute, [FromFromFromFrom.GetBestName]!"
	}
}

### Send Relief (31-33)

# The EoC gets the offer
narrative_event = {
	id = grace.31
	is_triggered_only = yes
	title = EVTTITLE_GRACE_31
	desc = EVTDESC_GRACE_31
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_accepts_relief_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_31 # Accept the tributary
		
		FROMFROM = {
			letter_event = { id = grace.32 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_relief
		}
	}
	
	option = {
		trigger = {
			china_accepts_relief_tribute_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTB_GRACE_31 # Refuse the tributary, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.33 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_accepts_relief_tribute_fromfrom_trigger = yes
		}
		name = EVTOPTC_GRACE_31 # Refuse the tributary, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.33 }
		}
		
		# TODO: Penalize
	}
}

# Relief accepted, sender gets Grace
letter_event = {
	id = grace.32
	is_triggered_only = yes
    border = GFX_event_letter_frame_diplomacy
	
	desc = EVTDESC_GRACE_32
	
	option = {
		name = EVTOPTA_GRACE_32
		
		# TODO: Relief effect
		sound_effect = china_grace_gain
		change_variable = {
			which = grace
			value = 500 # Scale?
		}
		set_character_flag = grace_character
		log = "[From.GetTitledName] accepted [Root.GetTitledName]'s relief tribute!"
	}
}

# Relief refused, sender's opinion of the EoC lowered
letter_event = {
	id = grace.33
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_33
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_33
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_relief
		}
		log = "[From.GetTitledName] refused [Root.GetTitledName]'s relief tribute!"
	}
}

### Send Artifact (34-37)

# The EoC gets the offer
narrative_event = {
	id = grace.34
	is_triggered_only = yes
	title = EVTTITLE_GRACE_34
	desc = EVTDESC_GRACE_34
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_accepts_artifact_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOR = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_34 # Accept the artifact
		
		FROMFROM = {
			letter_event = { id = grace.35 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_artifact
		}
		
		ai_chance = {
			factor = 10 # TODO: Make more likely for a good physician
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_accepts_artifact_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOR = {
				test_grace_refusal_trigger = yes
			}
			any_realm_lord = {
				higher_tier_than = baron
				# TODO: Ensure the EoC doesn't hate the vassal
				NOT = {
					has_artifact = FROMFROMFROM
				}
			}
		}
		name = EVTOPTB_GRACE_34 # Accept the artifact, but give them to a random vassal
		
		FROMFROM = {
			letter_event = { id = grace.36 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_artifact_small
		}
		
		ai_chance = {
			factor = 90 # TODO: Make more likely for a bad artifact
		}
	}
	
	option = {
		trigger = {
			china_accepts_artifact_tribute_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTC_GRACE_34 # Refuse the artifact, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.37 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_accepts_artifact_tribute_fromfrom_trigger = yes
		}
		name = EVTOPTD_GRACE_34 # Refuse the artifact, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.37 }
		}
		
		# TODO: Penalize
	}
}

# Artifact accepted, sender gets Grace
letter_event = {
	id = grace.35
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_35
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_35
		
		hidden_tooltip = {
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			change_variable = {
				which = grace_gain
				value = 500
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						quality == 5
					}
				}
				change_variable = {
					which = grace_gain
					value = 9500
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						quality == 4
					}
				}
				change_variable = {
					which = grace_gain
					value = 4500
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						quality < 4
						has_artifact_flag = lore #Magnum Opus book
						# Avoid devaluing if FROM is a member of the Hermetic Society?
					}
				}
				change_variable = {
					which = grace_gain
					value = -200
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						quality == 4
						has_artifact_flag = lore #Magnum Opus book
						# Avoid devaluing if FROM is a member of the Hermetic Society?
					}
				}
				change_variable = {
					which = grace_gain
					value = -3000
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						quality < 4
						has_artifact_flag = created
					}
				}
				change_variable = {
					which = grace_gain
					value = -250
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						quality == 4
						has_artifact_flag = created
					}
				}
				change_variable = {
					which = grace_gain
					value = -3500
				}
			}
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = grace_gain
							value = 500
						}
					}
				}
				# Ensure that (pre-greed) gain is at least 500
				set_variable = {
					which = grace_gain
					value = 500
				}
			}
			if = {
				limit = {
					FROM = {
						trait = greedy
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			if = {
				limit = {
					FROM = {
						trait = charitable
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 0.5
				}
			}
		}
		
		change_variable = {
			which = grace
			which = grace_gain
		}
		set_character_flag = grace_character
		
		sound_effect = china_grace_gain
		
		FROMFROMFROMFROM = {
			transfer_artifact = {
				to = FROM
				from = ROOT
			}
		}
		log = "[From.GetTitledName] accepted [Root.GetTitledName]'s artifact tribute!"
	}
}

# Artifact accepted but given to a vassal, sender gets less Grace + lowered opinion of the EoC
letter_event = {
	id = grace.36
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_36
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_36
		
		hidden_tooltip = {
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			change_variable = {
				which = grace_gain
				value = 250
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						quality == 5
					}
				}
				change_variable = {
					which = grace_gain
					value = 4750
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						quality == 4
					}
				}
				change_variable = {
					which = grace_gain
					value = 2250
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						quality < 4
						has_artifact_flag = lore #Magnum Opus book
						# Avoid devaluing if FROM is a member of the Hermetic Society?
					}
				}
				change_variable = {
					which = grace_gain
					value = -200
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						quality == 4
						has_artifact_flag = lore #Magnum Opus book
						# Avoid devaluing if FROM is a member of the Hermetic Society?
					}
				}
				change_variable = {
					which = grace_gain
					value = -3000
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						quality < 4
						has_artifact_flag = created
					}
				}
				change_variable = {
					which = grace_gain
					value = -250
				}
			}
			if = {
				limit = {
					FROMFROMFROMFROM = {
						quality == 4
						has_artifact_flag = created
					}
				}
				change_variable = {
					which = grace_gain
					value = -3500
				}
			}
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = grace_gain
							value = 250
						}
					}
				}
				# Ensure that (pre-greed) gain is at least 500
				set_variable = {
					which = grace_gain
					value = 250
				}
			}
			if = {
				limit = {
					FROM = {
						trait = greedy
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			if = {
				limit = {
					FROM = {
						trait = charitable
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 0.5
				}
			}
		}
		
		change_variable = {
			which = grace
			which = grace_gain
		}
		set_character_flag = grace_character
		
		sound_effect = china_grace_gain
		
		FROMFROMFROMFROM = {
			save_event_target_as = tribute_artifact
		}
		
		FROM = {
			letter_event = { id = grace.909 }
		}
		
		opinion = {
			who = FROM
			modifier = opinion_china_artifact_not_imperial
		}
	}
}

# Artifact refused, sender's opinion of the EoC
letter_event = {
	id = grace.37
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_37
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_37
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_artifact
		}
		log = "[From.GetTitledName] refused [Root.GetTitledName]'s artifact tribute!"
	}
}



##### Boons (301-338, reserved ids 301-600)

### Peace Deal (301-303)

# The EoC gets the request
narrative_event = {
	id = grace.301
	is_triggered_only = yes
	title = EVTTITLE_GRACE_301
	desc = EVTDESC_GRACE_301
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_grants_peace_deal_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_301 # Grant the Peace Deal
		
		FROMFROM = {
			add_character_modifier = {
				inherit = yes
				name = peace_deal_with_china
				years = 50
			}
			letter_event = { id = grace.302 }
		}
	}
	
	option = {
		trigger = {
			china_grants_peace_deal_boon_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTB_GRACE_301 # Refuse the Peace Deal, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.303 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_grants_peace_deal_boon_fromfrom_trigger = yes
		}
		name = EVTOPTC_GRACE_301 # Refuse the Peace Deal, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.303 }
		}
		
		# TODO: Penalize
	}
}

# Request accepted, NAP signed, all Chinese vassal wars vs. sender ended
letter_event = {
	id = grace.302
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_302
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_302
		
		add_character_modifier = {
			inherit = yes
			name = peace_deal_with_china
			years = 50
		}
		log = "[Root.GetTitledName] was granted a Peace Deal by [From.GetTitledName]!"
	}
}

# Request denied, sender's opinion of the EoC lowered
letter_event = {
	id = grace.303
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_303
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_303
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_peace_deal
		}
		log = "[Root.GetTitledName] was refused a Peace Deal by [From.GetTitledName]!"
	}
}

### Chinese Physician (304-306)

# The EoC gets the request
narrative_event = {
	id = grace.304
	is_triggered_only = yes
	title = EVTTITLE_GRACE_304
	desc = EVTDESC_GRACE_304
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_grants_physician_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_304 # Grant the Physician
		
		FROMFROM = {
			letter_event = { id = grace.305 }
		}
	}
	
	option = {
		trigger = {
			china_grants_physician_boon_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTB_GRACE_304 # Refuse the Boon, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.306 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_grants_physician_boon_fromfrom_trigger = yes
		}
		name = EVTOPTC_GRACE_304 # Refuse the Boon, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.306 }
		}
		
		# TODO: Penalize
	}
}

# Request accepted, physician arrives
letter_event = {
	id = grace.305
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_305
    border = GFX_event_letter_frame_diplomacy
	
	immediate = {
		random_list = {
			50 = { #Female
				modifier = {
					NOT = {
						has_game_rule = {
							name = gender
							value = all
						}
					}
					factor = 0.05
				}
				create_character = {
					age = 35
					dynasty = actually_culture
					religion = FROM
					culture = FROM
					female = yes
					health = 6
					random_traits = no
					attributes = {
						martial = 2
						diplomacy = 5
						stewardship = 3
						intrigue = 3
						learning = 6
					}
				}
			}
			50 = { #Male
				create_character = {
					age = 35
					dynasty = actually_culture
					religion = FROM
					culture = FROM
					female = no
					health = 6
					random_traits = no
					attributes = {
						martial = 2
						diplomacy = 5
						stewardship = 3
						intrigue = 3
						learning = 6
					}
				}
			}
		}
        new_character = {
			#Education & other basic stuff
			save_event_target_as = chinese_doctor
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = originated_from_chinese_court
			set_character_flag = no_court_invites
			set_character_flag = is_chinese_physician
			random_list = {
				50 = { add_trait = scholarly_theologian }
				25 = { add_trait = mastermind_theologian }
			}
			add_trait = physician
			random_list = {
				20 = { } #Nothing
				30 = { add_trait = erudite }
				30 = { add_trait = shrewd }
				15 = { add_trait = quick }
				5 = { add_trait = genius }
			}
			random_list = {
				80 = { } #Nothing
				2 = { add_trait = clubfooted }
				2 = { add_trait = harelip }
				2 = { add_trait = hunchback }
				4 = { add_trait = lisp }
				4 = { add_trait = stutter }
				2 = { add_trait = ugly }
				2 = { add_trait = dwarf }
				2 = { add_trait = weak }
			}
			random_list = {
				50 = { } #Nothing
				25 = { add_trait = patient }
				25 = { add_trait = diligent }
			}
			random = {
				chance = 10
				add_trait = homosexual
			}
			opinion = {
				who = ROOT
				modifier = opinion_servant
				months = 1200
			}

			#Add archetype 
			random_list = {
				20 = { #Combat medic
					set_character_flag = archetype_decisive
					random_list = {
						50 = { add_trait = duelist }
						50 = { add_trait = scholar }
					}
					add_trait = scarred
					add_trait = robust
					random_list = {
						60 = { } #Nothing
						20 = { 
							trigger = { has_dlc = Reapers }
							add_trait = one_legged 
						}
						20 = { 
							trigger = { has_dlc = Reapers }
							add_trait = one_eyed 
						}
					}
					add_trait = brave
					random_list = {
						30 = { } #Nothing
						50 = { add_trait = cynical }
						10 = {
							add_trait = cynical
							add_trait = depressed
						}
						10 = {
							add_trait = cynical
							add_trait = depressed
							add_trait = drunkard
						}
					}
					random_list = {
						50 = { } #Nothing
						20 = { add_trait = kind }
						30 = { add_trait = honest }
					}
					remove_trait = dwarf
					remove_trait = weak
				}
				#Dr Jerk
				15 = { 
					set_character_flag = archetype_decisive
					add_trait = scholar
					add_trait = wroth
					remove_trait = patient
					random_list = {
						30 = { add_trait = proud }
						30 = { add_trait = envious }
						40 = { } #Nothing
					}
					add_trait = honest
					add_trait = cynical
					random = {
						chance = 30
						add_trait = drunkard
					}
					random_list = {
						60 = { }
						20 = { 
							add_trait = clubfooted
							set_name = Wu #House
						}
						20 = {
							trigger = { has_dlc = Reapers }
							add_trait = one_legged
							set_name = Wu #House
						}
					}
				}
				10 = { #Mad genius 
					set_character_flag = archetype_sociable
					random_list = {
						50 = { add_trait = impaler }
						50 = { add_trait = mystic }
					}
					random_list = {
						33 = { add_trait = drunkard } 
						33 = { add_trait = lunatic }
						33 = { add_trait = possessed }
					}
					add_trait = genius
					remove_trait = quick
					remove_trait = shrewd
					add_trait = paranoid
					random_list = {
						25 = { add_trait = gluttonous } 
						25 = { add_trait = wroth }
						25 = { add_trait = proud }
						25 = { add_trait = greedy }
					}   
				}
				20 = { #Herbalist
					set_character_flag = archetype_supportive
					add_trait = gardener
					add_trait = diligent
					add_trait = humble
					random_list = {
						33 = { add_trait = content } 
						33 = { add_trait = shy }
						33 = { add_trait = poet }
					}
					random = {
						chance = 50
						add_trait = robust
					}
					remove_trait = weak
				}
				20 = { #Health nut
					set_character_flag = archetype_conservative
					add_trait = mystic
					add_trait = celibate
					add_trait = chaste
					add_trait = temperate
					random_list = {
						50 = { add_trait = craven } 
						25 = { add_trait = shy }
						25 = { add_trait = content }
					}
					set_focus = focus_scholarship
				}
				20 = { #Compassionate doctor
					set_character_flag = archetype_supportive
					random_list = {
						50 = { add_trait = socializer }
						50 = { add_trait = scholar }
					}
					add_trait = kind
					add_trait = patient
					random_list = {
						25 = { add_trait = content } 
						25 = { add_trait = humble }
						25 = { add_trait = trusting }
						25 = { add_trait = charitable }
					}
					set_focus = focus_family
				}
				15 = { #McDreamy
					set_character_flag = archetype_sociable
					if = {
						limit = { is_female = yes }
						add_trait = seductress
					}
					if = {
						limit = { is_female = no }
						add_trait = seducer
					}
					random_list = {
						50 = { } #Nothing
						25 = { add_trait = poet }
						25 = { add_trait = falconer }
					}
					random_list = {
						30 = { add_trait = fair }
						50 = { add_trait = strong }
					}
					add_trait = lustful
					random_list = {
						35 = { add_trait = ambitious }
						35 = { add_trait = gregarious }
						30 = { } #Nothing
					}
					set_focus = focus_seduction
					remove_trait = clubfooted
					remove_trait = harelip
					remove_trait =  hunchback 
					remove_trait = lisp
					remove_trait = stutter
					remove_trait = ugly
					remove_trait = dwarf
					remove_trait = weak
				}
			}
		}
		new_character = {
			give_minor_title = title_court_physician
		}
    }
	
	option = {
		name = EVTOPTA_GRACE_305
		log = "[Root.GetTitledName] was granted a physician by [From.GetTitledName]!"
	}
}

# Request denied, sender's opinion of the EoC lowered
letter_event = {
	id = grace.306
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_306
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_306
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_physician_boon
		}
		log = "[Root.GetTitledName] was refused a physician by [From.GetTitledName]!"
	}
}

### Chinese Artifact (307-319)

# The EoC gets the request
narrative_event = {
	id = grace.307
	is_triggered_only = yes
	title = EVTTITLE_GRACE_307
	desc = EVTDESC_GRACE_307
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_grants_artifact_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			FROMFROM = {
				NOT = {
					AND = {
						has_artifact = chinese_painting_of_glitterhoof
						#has_artifact = chinese_prev_emperor_sculpture # TODO
						has_artifact = chinese_arm_protector
						has_artifact = chinese_serpent_spear
						has_artifact = chinese_tapestry
						has_artifact = chinese_artwork
						has_artifact = chinese_calligraphy
						has_artifact = chinese_sculpture
					}
				}
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_307 # Grant tier 1-2 artifact
		
		letter_event = { id = grace.308 }
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_grants_artifact_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
			FROMFROM = {
				NOT = {
					AND = {
						has_artifact = silk_shroud
						has_artifact = chinese_tapestry_grand
						has_artifact = chinese_ji
						has_artifact = chinese_crossbow
						has_artifact = chinese_bronze_sculpture
						has_artifact = chinese_ceremonial_robes
						has_artifact = water_clock
						has_artifact = jian_sword
						has_artifact = chinese_dragon_amulet
					}
				}
			}
		}
		name = EVTOPTB_GRACE_307 # Grant tier 3-4 artifact
		
		letter_event = { id = grace.313	}
		
		ai_chance = {
			factor = 10 # TODO: Various modifiers
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_grants_artifact_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
			FROMFROM = {
				NOT = {
					has_artifact = jade_dragon
				}
			}
		}
		name = EVTOPTC_GRACE_307 # Grant tier 5 artifact (Jade Dragon)
		
		FROMFROM = {
			letter_event = { id = grace.318 }
		}
		
		ai_chance = {
			factor = 1 # TODO: Various modifiers
		}
	}
	option = {
		trigger = {
			china_grants_artifact_boon_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTD_GRACE_307 # Refuse the Boon, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.319 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_grants_artifact_boon_fromfrom_trigger = yes
		}
		name = EVTOPTE_GRACE_307 # Refuse the Boon, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.319 }
		}
		
		# TODO: Penalize
	}
}

# Select tier 1-2
letter_event = {
	id = grace.308
	is_triggered_only = yes
	desc = EVTDESC_GRACE_308
	
	option = {
		trigger = {
			FROMFROMFROM = {
				NOT = {
					AND = {
						has_artifact = chinese_painting_of_glitterhoof
						#has_artifact = chinese_prev_emperor_sculpture # TODO
					}
				}
			}
		}
		
		name = EVTOPTA_GRACE_308 # Tier 1
		
		ai_chance = {
			factor = 70 # TODO: Various modifiers
		}
		
		letter_event = { id = grace.309 }
	}
	
	option = {
		trigger = {
			FROMFROMFROM = {
				NOT = {
					AND = {
						has_artifact = chinese_arm_protector
						has_artifact = chinese_serpent_spear
						has_artifact = chinese_tapestry
						has_artifact = chinese_artwork
						has_artifact = chinese_calligraphy
						has_artifact = chinese_sculpture
					}
				}
			}
		}
		
		name = EVTOPTB_GRACE_308 # Tier 2
		
		letter_event = { id = grace.311 }
		
		ai_chance = {
			factor = 30 # TODO: Various modifiers
		}
	}
}

# Select tier 1 artifact
letter_event = {
	id = grace.309
	is_triggered_only = yes
	desc = EVTDESC_GRACE_309
	
	
	option = {
		trigger = {
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_painting_of_glitterhoof
				}
			}
		}
		
		name = EVTOPTA_GRACE_309
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_painting_of_glitterhoof
			letter_event = { id = grace.310 }
		}
	}
	
	option = {
		trigger = {
			always = no # TODO
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_prev_emperor_sculpture # TODO
				}
			}
		}
		
		name = EVTOPTB_GRACE_309
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_prev_emperor_sculpture
			letter_event = { id = grace.310 }
		}
	}
}

# Sender gets tier 1 artifact
letter_event = {
	id = grace.310
	is_triggered_only = yes
	desc = {
		trigger = {
			has_character_flag = getting_chinese_painting_of_glitterhoof
		}
		text = EVTDESCA_GRACE_310
	}
	desc = {
		trigger = {
			has_character_flag = getting_chinese_prev_emperor_sculpture
		}
		text = EVTDESCB_GRACE_310
	}
	
	immediate = {
		if = {
			limit = {
				has_character_flag = getting_chinese_painting_of_glitterhoof
			}
			add_artifact = chinese_painting_of_glitterhoof
			new_artifact = {
				set_artifact_original_owner = FROM
			}
			clr_character_flag = getting_chinese_painting_of_glitterhoof
		}
		if = {
			limit = {
				has_character_flag = getting_chinese_prev_emperor_sculpture
			}
			add_artifact = chinese_painting_of_glitterhoof
			new_artifact = {
				set_artifact_original_owner = FROM
			}
			clr_character_flag = getting_chinese_prev_emperor_sculpture
		}
	}
	
	option = {
		name = EVTOPTA_GRACE_310
		log = "[Root.GetTitledName] was granted a tier 1 artifact by [From.GetTitledName]!"
	}
}

# Select tier 2 artifact (can repeat)
letter_event = {
	id = grace.311
	is_triggered_only = yes
	desc = EVTDESC_GRACE_311
	
	immediate = {
		clr_character_flag = repeat_artifact_choice_event
	}
	
	option = {
		trigger = {
			NOT = {
				has_character_flag = repeat_artifact_choice_event
			}
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_arm_protector
				}
			}
		}
		
		name = EVTOPTA_GRACE_311
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_arm_protector
			letter_event = { id = grace.312 }
		}
	}
	
	option = {
		trigger = {
			NOT = {
				has_character_flag = repeat_artifact_choice_event
			}
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_serpent_spear
				}
			}
		}
		
		name = EVTOPTB_GRACE_311
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_serpent_spear
			letter_event = { id = grace.312 }
		}
	}
	
	option = {
		trigger = {
			NOT = {
				has_character_flag = repeat_artifact_choice_event
			}
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_tapestry
				}
			}
		}
		
		name = EVTOPTC_GRACE_311
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_tapestry
			letter_event = { id = grace.312 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			NOT = {
				has_character_flag = repeat_artifact_choice_event
			}
		}
		
		name = EVTOPTD_GRACE_311 # More options
		
		set_character_flag = repeat_artifact_choice_event
		
		repeat_event = { id = grace.311 }
	}
	
	option = {
		trigger = {
			OR = {
				ai = yes
				has_character_flag = repeat_artifact_choice_event
			}
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_artwork
				}
			}
		}
		
		name = EVTOPTE_GRACE_311
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_artwork
			letter_event = { id = grace.312 }
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = yes
				has_character_flag = repeat_artifact_choice_event
			}
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_calligraphy
				}
			}
		}
		
		name = EVTOPTF_GRACE_311
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_calligraphy
			letter_event = { id = grace.312 }
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = yes
				has_character_flag = repeat_artifact_choice_event
			}
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_sculpture
				}
			}
		}
		
		name = EVTOPTG_GRACE_311
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_sculpture
			letter_event = { id = grace.312 }
		}
	}
	option = {
		trigger = {
			ai = no
			has_character_flag = repeat_artifact_choice_event
		}
		
		name = EVTOPTD_GRACE_311 # More options
		
		set_character_flag = repeat_artifact_choice_event
		
		repeat_event = { id = grace.311 }
	}
	
}

# Sender gets tier 2 artifact
letter_event = {
	id = grace.312
	is_triggered_only = yes
	desc = {
		trigger = {
			has_character_flag = getting_chinese_arm_protector
		}
		text = EVTDESCA_GRACE_312
	}
	desc = {
		trigger = {
			has_character_flag = getting_chinese_serpent_spear
		}
		text = EVTDESCB_GRACE_312
	}
	desc = {
		trigger = {
			has_character_flag = getting_chinese_tapestry
		}
		text = EVTDESCC_GRACE_312
	}
	desc = {
		trigger = {
			has_character_flag = getting_chinese_artwork
		}
		text = EVTDESCD_GRACE_312
	}
	desc = {
		trigger = {
			has_character_flag = getting_chinese_calligraphy
		}
		text = EVTDESCE_GRACE_312
	}
	desc = {
		trigger = {
			has_character_flag = getting_chinese_sculpture
		}
		text = EVTDESCF_GRACE_312
	}
	
	immediate = {
		if = {
			limit = {
				has_character_flag = getting_chinese_arm_protector
			}
			add_artifact = chinese_arm_protector
			new_artifact = {
				set_artifact_original_owner = FROM
			}
			clr_character_flag = getting_chinese_arm_protector
		}
		if = {
			limit = {
				has_character_flag = getting_chinese_serpent_spear
			}
			add_artifact = chinese_serpent_spear
			new_artifact = {
				set_artifact_original_owner = FROM
			}
			clr_character_flag = getting_chinese_serpent_spear
		}
		if = {
			limit = {
				has_character_flag = getting_chinese_tapestry
			}
			random_independent_ruler = {
				limit = {
					any_realm_province = {
						trade_route = silk_road
					}
				}
				random_realm_province = {
					limit = {
						trade_route = silk_road
					}
					save_event_target_as = tapestry_target
				}
			}
			add_artifact = chinese_tapestry
			new_artifact = {
				set_name="chinese_tapestry_name"
				set_artifact_original_owner = FROM
			}
			clr_character_flag = getting_chinese_tapestry
		}
		if = {
			limit = {
				has_character_flag = getting_chinese_artwork
			}
			add_artifact = chinese_artwork
			new_artifact = {
				set_artifact_original_owner = FROM
			}
			clr_character_flag = getting_chinese_artwork
		}
		if = {
			limit = {
				has_character_flag = getting_chinese_calligraphy
			}
			add_artifact = chinese_calligraphy
			new_artifact = {
				set_artifact_original_owner = FROM
			}
			clr_character_flag = getting_chinese_calligraphy
		}
		if = {
			limit = {
				has_character_flag = getting_chinese_sculpture
			}
			add_artifact = chinese_sculpture
			new_artifact = {
				set_artifact_original_owner = FROM
			}
			clr_character_flag = getting_chinese_sculpture
		}
	}
	
	option = {
		name = EVTOPTA_GRACE_312
		log = "[Root.GetTitledName] was granted a tier 2 artifact by [From.GetTitledName]!"
	}
}

# Select tier 3-4 artifact
letter_event = {
	id = grace.313
	is_triggered_only = yes
	desc = EVTDESC_GRACE_313
	
	option = {
		trigger = {
			FROMFROMFROM = {
				NOT = {
					AND = {
						has_artifact = silk_shroud
						has_artifact = chinese_tapestry_grand
						has_artifact = chinese_ji
						has_artifact = chinese_crossbow
						has_artifact = chinese_bronze_sculpture
						has_artifact = chinese_ceremonial_robes
					}
				}
			}
		}
		
		name = EVTOPTA_GRACE_313 # Tier 3
		
		ai_chance = {
			factor = 85 # TODO: Various modifiers
		}
		
		letter_event = { id = grace.314 }
	}
	
	option = {
		trigger = {
			FROMFROMFROM = {
				NOT = {
					AND = {
						has_artifact = water_clock
						has_artifact = jian_sword
						has_artifact = chinese_dragon_amulet
					}
				}
			}
		}
		
		name = EVTOPTB_GRACE_313 # Tier 4
		
		letter_event = { id = grace.316 }
		
		ai_chance = {
			factor = 15 # TODO: Various modifiers
		}
	}
}

# Select tier 3 artifact (can repeat)
letter_event = {
	id = grace.314
	is_triggered_only = yes
	desc = EVTDESC_GRACE_314
	
	immediate = {
		clr_character_flag = repeat_artifact_choice_event
	}
	
	option = {
		trigger = {
			NOT = {
				has_character_flag = repeat_artifact_choice_event
			}
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = silk_shroud
				}
			}
		}
		
		name = EVTOPTA_GRACE_314
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_silk_shroud
			letter_event = { id = grace.315 }
		}
	}
	
	option = {
		trigger = {
			NOT = {
				has_character_flag = repeat_artifact_choice_event
			}
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_tapestry_grand
				}
			}
		}
		
		name = EVTOPTB_GRACE_314
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_tapestry_grand
			letter_event = { id = grace.315 }
		}
	}
	
	option = {
		trigger = {
			NOT = {
				has_character_flag = repeat_artifact_choice_event
			}
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_ji
				}
			}
		}
		
		name = EVTOPTC_GRACE_314
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_ji
			letter_event = { id = grace.315 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			NOT = {
				has_character_flag = repeat_artifact_choice_event
			}
		}
		
		name = EVTOPTD_GRACE_314 # More options
		
		set_character_flag = repeat_artifact_choice_event
		
		repeat_event = { id = grace.314 }
	}
	
	option = {
		trigger = {
			OR = {
				ai = yes
				has_character_flag = repeat_artifact_choice_event
			}
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_crossbow
				}
			}
		}
		
		name = EVTOPTE_GRACE_314
		
		FROMFROMFROMFROM = {
			set_character_flag = chinese_crossbow
			letter_event = { id = grace.315 }
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = yes
				has_character_flag = repeat_artifact_choice_event
			}
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_bronze_sculpture
				}
			}
		}
		
		name = EVTOPTF_GRACE_314
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_bronze_sculpture
			letter_event = { id = grace.315 }
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = yes
				has_character_flag = repeat_artifact_choice_event
			}
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_ceremonial_robes
				}
			}
		}
		
		name = EVTOPTG_GRACE_314
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_ceremonial_robes
			letter_event = { id = grace.315 }
		}
	}
	option = {
		trigger = {
			ai = no
			has_character_flag = repeat_artifact_choice_event
		}
		
		name = EVTOPTD_GRACE_314 # More options
		
		set_character_flag = repeat_artifact_choice_event
		
		repeat_event = { id = grace.314 }
	}
	
}

# Sender gets tier 3 artifact + small amount of prestige
letter_event = {
	id = grace.315
	is_triggered_only = yes
	desc = {
		trigger = {
			has_character_flag = getting_silk_shroud
		}
		text = EVTDESCA_GRACE_315
	}
	desc = {
		trigger = {
			has_character_flag = getting_chinese_tapestry_grand
		}
		text = EVTDESCB_GRACE_315
	}
	desc = {
		trigger = {
			has_character_flag = getting_chinese_ji
		}
		text = EVTDESCC_GRACE_315
	}
	desc = {
		trigger = {
			has_character_flag = getting_chinese_crossbow
		}
		text = EVTDESCD_GRACE_315
	}
	desc = {
		trigger = {
			has_character_flag = getting_chinese_bronze_sculpture
		}
		text = EVTDESCE_GRACE_315
	}
	desc = {
		trigger = {
			has_character_flag = getting_chinese_ceremonial_robes
		}
		text = EVTDESCF_GRACE_315
	}
	
	immediate = {
		if = {
			limit = {
				has_character_flag = getting_silk_shroud
			}
			add_artifact = silk_shroud
			new_artifact = {
				set_artifact_original_owner = FROM
			}
			clr_character_flag = getting_silk_shroud
		}
		if = {
			limit = {
				has_character_flag = getting_chinese_tapestry_grand
			}
			add_artifact = chinese_tapestry_grand
			new_artifact = {
				set_artifact_original_owner = FROM
			}
			clr_character_flag = getting_chinese_tapestry_grand
		}
		if = {
			limit = {
				has_character_flag = getting_chinese_ji
			}
			add_artifact = chinese_ji
			new_artifact = {
				set_artifact_original_owner = FROM
			}
			clr_character_flag = getting_chinese_ji
		}
		if = {
			limit = {
				has_character_flag = getting_chinese_crossbow
			}
			add_artifact = chinese_crossbow
			new_artifact = {
				set_artifact_original_owner = FROM
			}
			clr_character_flag = getting_chinese_crossbow
		}
		if = {
			limit = {
				has_character_flag = getting_chinese_bronze_sculpture
			}
			add_artifact = chinese_bronze_sculpture
			new_artifact = {
				set_artifact_original_owner = FROM
			}
			clr_character_flag = getting_chinese_bronze_sculpture
		}
		if = {
			limit = {
				has_character_flag = getting_chinese_ceremonial_robes
			}
			add_artifact = chinese_ceremonial_robes
			new_artifact = {
				set_artifact_original_owner = FROM
			}
			clr_character_flag = getting_chinese_ceremonial_robes
		}
	}
	
	option = {
		name = EVTOPTA_GRACE_315
		prestige = 200
		log = "[Root.GetTitledName] was granted a tier 3 artifact by [From.GetTitledName]!"
	}
}

# Select tier 4 artifact
letter_event = {
	id = grace.316
	is_triggered_only = yes
	desc = EVTDESC_GRACE_316
	
	option = {
		trigger = {
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = water_clock
				}
			}
		}
		
		name = EVTOPTA_GRACE_316
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_water_clock
			letter_event = { id = grace.317 }
		}
	}
	
	option = {
		trigger = {
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = jian_sword
				}
			}
		}
		
		name = EVTOPTB_GRACE_316
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_jian_sword
			letter_event = { id = grace.317 }
		}
	}
	
	option = {
		trigger = {
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_dragon_amulet
				}
			}
		}
		
		name = EVTOPTC_GRACE_316
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_dragon_amulet
			letter_event = { id = grace.317 }
		}
	}
}

# Sender gets tier 4 artifact + medium amount of prestige
letter_event = {
	id = grace.317
	is_triggered_only = yes
	desc = {
		trigger = {
			has_character_flag = getting_water_clock
		}
		text = EVTDESCA_GRACE_317
	}
	desc = {
		trigger = {
			has_character_flag = getting_jian_sword
		}
		text = EVTDESCB_GRACE_317
	}
	desc = {
		trigger = {
			has_character_flag = getting_chinese_dragon_amulet
		}
		text = EVTDESCC_GRACE_317
	}
	
	immediate = {
		if = {
			limit = {
				has_character_flag = getting_water_clock
			}
			add_artifact = water_clock
			new_artifact = {
				set_artifact_original_owner = FROM
			}
			clr_character_flag = getting_water_clock
		}
		if = {
			limit = {
				has_character_flag = getting_jian_sword
			}
			add_artifact = jian_sword
			new_artifact = {
				set_artifact_original_owner = FROM
			}
			clr_character_flag = getting_jian_sword
		}
		if = {
			limit = {
				has_character_flag = getting_chinese_dragon_amulet
			}
			add_artifact = chinese_dragon_amulet
			new_artifact = {
				set_artifact_original_owner = FROM
			}
			clr_character_flag = getting_chinese_dragon_amulet
		}
	}
	
	option = {
		name = EVTOPTA_GRACE_317
		prestige = 500
		log = "[Root.GetTitledName] was granted a tier 4 artifact by [From.GetTitledName]!"
	}
}

# Sender gets tier 5 artifact + large amount of prestige
letter_event = {
	id = grace.318
	is_triggered_only = yes
	desc = EVTDESC_GRACE_318
	
	immediate = {
		# Somewhat clunky way to ensure that the EoC doesn't lose his own artifacts and that he keeps the oldest one
		add_artifact = jade_dragon
		new_artifact = {
			set_artifact_original_owner = FROM
		}
	}
	
	option = {
		name = EVTOPTA_GRACE_318
		prestige = 1000
		log = "[Root.GetTitledName] was granted a tier 5 artifact by [From.GetTitledName]!"
	}
}

# Request denied, sender's opinion of the EoC lowered
letter_event = {
	id = grace.319
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_319
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_319
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_artifact_boon
		}
		log = "[Root.GetTitledName] was refused an artifact by [From.GetTitledName]!"
	}
}

### Siege Engineer (320-322)

# The EoC gets the request
narrative_event = {
	id = grace.320
	is_triggered_only = yes
	title = EVTTITLE_GRACE_320
	desc = EVTDESC_GRACE_320
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_grants_siege_engineer_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_320 # Grant the Siege Engineer
		
		FROMFROM = {
			letter_event = { id = grace.321 }
		}
	}
	
	option = {
		trigger = {
			china_grants_siege_engineer_boon_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTB_GRACE_320 # Refuse the Boon, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.322 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_grants_siege_engineer_boon_fromfrom_trigger = yes
		}
		name = EVTOPTC_GRACE_320 # Refuse the Boon, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.322 }
		}
		
		# TODO: Penalize
	}
}

# Request accepted, siege engineer arrives
letter_event = {
	id = grace.321
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_321
    border = GFX_event_letter_frame_diplomacy
	
	immediate = {
		random_list = {
			33 = {
				create_random_soldier = {
					age = 55
					dynasty = actually_culture
					religion = FROM
					culture = FROM
					female = no
					random_traits = yes
					attributes = {
						diplomacy = 2
						learning = 2
						stewardship = 2
						intrigue = 2
						martial = 16
					}
				}
				new_character = {
					save_event_target_as = chinese_siege_engineer
					set_character_flag = ai_flag_refuse_concubinage
					set_character_flag = ai_flag_refuse_marriage
					set_character_flag = originated_from_chinese_court
					set_character_flag = no_court_invites
					set_character_flag = taught_chinese_strategy
					set_character_flag = is_chinese_siege_engineer
					
					remove_trait = weak
					remove_trait = slow
					remove_trait = imbecile
					remove_trait = dull
					
					remove_trait = craven
					remove_trait = mystic
					remove_trait = socializer
					remove_trait = gamer
					remove_trait = hedonist
					remove_trait = duelist
					remove_trait = hunter
					remove_trait = strategist
					remove_trait = administrator
					remove_trait = architect
					remove_trait = gardener
					remove_trait = schemer
					remove_trait = impaler
					remove_trait = seducer
					remove_trait = seductress
					remove_trait = theologian
					remove_trait = scholar
					
					add_trait = sapper
					
					random_list = { # Flavor Randomization
						15 = {
							change_martial = 2
						}
						10 = {
							add_trait = robust
						}
						10 = {
							add_trait = duelist
						}
						10 = {
							add_trait = architect
						}
						5 = {
							add_trait = strategist
						}
						5 = {
							change_martial = 4
						}
						5 = {
							if = {
								limit = {
									has_dlc = "Reapers"
								}
								add_trait = one_eyed
							}
						}
						5 = { 
							add_trait = shrewd
						}
					}
					opinion = {
						who = ROOT
						modifier = opinion_servant
						months = 1200
					}
				}
			}
			33 = {
				create_random_soldier = {
					age = 35
					dynasty = actually_culture
					religion = FROM
					culture = FROM
					female = no
					random_traits = yes
					attributes = {
						diplomacy = 2
						learning = 2
						stewardship = 2
						intrigue = 2
						martial = 8
					}
				}
				new_character = {
					save_event_target_as = chinese_siege_engineer
					set_character_flag = ai_flag_refuse_concubinage
					set_character_flag = ai_flag_refuse_marriage
					set_character_flag = originated_from_chinese_court
					set_character_flag = chinese_courtier_original_court_@PREV
					set_character_flag = no_court_invites
					set_character_flag = taught_chinese_strategy
					set_character_flag = is_chinese_siege_engineer
					
					remove_trait = weak
					remove_trait = slow
					remove_trait = imbecile
					remove_trait = dull
					
					remove_trait = craven
					remove_trait = mystic
					remove_trait = socializer
					remove_trait = gamer
					remove_trait = hedonist
					remove_trait = duelist
					remove_trait = hunter
					remove_trait = strategist
					remove_trait = administrator
					remove_trait = architect
					remove_trait = gardener
					remove_trait = schemer
					remove_trait = impaler
					remove_trait = seducer
					remove_trait = seductress
					remove_trait = theologian
					remove_trait = scholar
					
					add_trait = sapper
					random_list = { # Flavor Randomization
						15 = {
							change_martial = 2
						}
						10 = {
							add_trait = robust
						}
						10 = {
							add_trait = duelist
						}
						10 = {
							add_trait = architect
						}
						5 = {
							add_trait = strategist
						}
						5 = {
							change_martial = 4
						}
						5 = {
							if = {
								limit = {
									has_dlc = "Reapers"
								}
								add_trait = one_eyed
							}
						}
						5 = { 
							add_trait = shrewd
						}
					}
					opinion = {
						who = ROOT
						modifier = opinion_servant
						months = 1200
					}
				}
			}
			33 = {
				create_random_soldier = {
					age = 37
					dynasty = actually_culture
					religion = FROM
					culture = FROM
					female = no
					random_traits = yes
					attributes = {
						diplomacy = 2
						learning = 2
						stewardship = 2
						intrigue = 2
						martial = 8
					}
				}
				new_character = {
					save_event_target_as = chinese_siege_engineer
					set_character_flag = ai_flag_refuse_concubinage
					set_character_flag = ai_flag_refuse_marriage
					set_character_flag = originated_from_chinese_court
					set_character_flag = chinese_courtier_original_court_@PREV
					set_character_flag = no_court_invites
					set_character_flag = taught_chinese_strategy
					set_character_flag = is_chinese_siege_engineer
					
					remove_trait = weak
					remove_trait = slow
					remove_trait = imbecile
					remove_trait = dull
					
					remove_trait = craven
					remove_trait = mystic
					remove_trait = socializer
					remove_trait = gamer
					remove_trait = hedonist
					remove_trait = duelist
					remove_trait = hunter
					remove_trait = strategist
					remove_trait = administrator
					remove_trait = architect
					remove_trait = gardener
					remove_trait = schemer
					remove_trait = impaler
					remove_trait = seducer
					remove_trait = seductress
					remove_trait = theologian
					remove_trait = scholar
					
					add_trait = sapper
					
					random_list = { # Flavor Randomization
						15 = {
							change_martial = 2
						}
						10 = {
							add_trait = robust
						}
						10 = {
							add_trait = duelist
						}
						10 = {
							add_trait = architect
						}
						5 = {
							add_trait = strategist
						}
						5 = {
							change_martial = 4
						}
						5 = {
							if = {
								limit = {
									has_dlc = "Reapers"
								}
								add_trait = one_eyed
							}
						}
						5 = { 
							add_trait = shrewd
						}
					}
					opinion = {
						who = ROOT
						modifier = opinion_servant
						months = 1200
					}
				}
			}
		}
		new_character = {
			give_minor_title = title_commander
		}
    }
	
	option = {
		name = EVTOPTA_GRACE_321
		log = "[Root.GetTitledName] was granted a siege engineer by [From.GetTitledName]!"
	}
}

# Request denied, sender's opinion of the EoC lowered
letter_event = {
	id = grace.322
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_322
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_322
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_siege_engineer_boon
		}
		log = "[Root.GetTitledName] was refused a siege engineer by [From.GetTitledName]!"
	}
}

### Strategist (323-325)

# The EoC gets the request
narrative_event = {
	id = grace.323
	is_triggered_only = yes
	title = EVTTITLE_GRACE_323
	desc = EVTDESC_GRACE_323
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_grants_strategist_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_323 # Grant the Strategist
		
		FROMFROM = {
			letter_event = { id = grace.324 }
		}
	}
	
	option = {
		trigger = {
			china_grants_strategist_boon_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTB_GRACE_323 # Refuse the Boon, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.325 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_grants_strategist_boon_fromfrom_trigger = yes
		}
		name = EVTOPTC_GRACE_323 # Refuse the Boon, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.325 }
		}
		
		# TODO: Penalize
	}
}

# Request accepted, strategist arrives
letter_event = {
	id = grace.324
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_324
    border = GFX_event_letter_frame_diplomacy
	
	immediate = {
		random_list = {
			50 = { #Female
				modifier = {
					NOT = {
						has_game_rule = {
							name = gender
							value = all
						}
					}
					factor = 0
				}
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = FROM
					culture = FROM
					female = yes
					health = 7
					random_traits = no
					attributes = {
						martial = 6
						diplomacy = 2
						stewardship = 3
						intrigue = 4
						learning = 2
					}
				}
			}
			50 = { #Male
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = FROM
					culture = FROM
					female = no
					health = 7
					random_traits = no
					attributes = {
						martial = 6
						diplomacy = 2
						stewardship = 3
						intrigue = 4
						learning = 2
					}
				}
			}
		}
		new_character = {
			#Education & other basic stuff
			save_event_target_as = chinese_strategist
			add_character_modifier = {
				name = jd_strategist
				duration = -1
			}
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = originated_from_chinese_court
			set_character_flag = chinese_courtier_original_court_@PREV
			set_character_flag = no_court_invites
			set_character_flag = is_chinese_strategist
			random_list = {
				80 = { add_trait = skilled_tactician }
				20 = { add_trait = brilliant_strategist }
			}
			random_list = {
				20 = { add_trait = brave } 
				20 = { add_trait = strong }
				20 = { add_trait = shrewd }
				40 = { add_trait = robust }
			}
			random_list = {
				71 = { } #Nothing
				20 = { add_trait = scarred }
				5 = { 
					trigger = { has_dlc = Reapers }
					add_trait = one_eyed 
					change_martial = 1
				}
				2 = { 
					trigger = { has_dlc = Reapers }
					add_trait = one_handed
					change_martial = 1
				}
				2 = { add_trait = ugly }
			}
			random = {
				chance = 10
				add_trait = homosexual
			}
			opinion = {
				who = ROOT
				modifier = opinion_servant
				months = 1200
			}

			#Add archetype 
			random_list = {
				#Conservative 
				25 = {
					set_character_flag = archetype_conservative
					if = {
						limit = { has_dlc = "Way of Life" }
						add_trait = strategist
					}
					add_trait = logistics_expert
					random = {
						chance = 50
						add_trait = zealous
					}
					add_trait = stubborn
					add_trait = temperate
					random_list = {
						20 = { add_trait = greedy }
						20 = { add_trait = wroth }
						20 = { add_trait = deceitful }
						20 = { add_trait = shy }
						20 = { add_trait = cruel }
					}
					random_list = {
						25 = { add_trait = poet }
						25 = { add_trait = chaste }
						25 = { 
							add_trait = patient
							remove_trait = wroth
						}
						25 = { add_trait = just }
					}
				}
				#Supportive
				25 = {
					set_character_flag = archetype_supportive
					if = {
						limit = { has_dlc = "Way of Life" }    
						random_list = {
							50 = { add_trait = hunter }
							50 = { add_trait = strategist }
						}
					}
					add_trait = sapper 
					add_trait = humble
					add_trait = patient
					random_list = {
						30 = { add_trait = slothful }
						70 = { add_trait = shy }
					}
					random_list = {
						25 = { add_trait = content }
						25 = { add_trait = charitable }
						25 = { add_trait = kind }
						25 = { add_trait = trusting }
					}      
				}
				#Decisive
				25 = {
					set_character_flag = archetype_decisive
					if = {
						limit = { has_dlc = "Way of Life" }
						random_list = {
							50 = { add_trait = strategist }
							50 = { add_trait = duelist }
						}
					}
					add_trait = master_of_flame 
					add_trait = ambitious
					add_trait = cynical
					random_list = {
						20 = { add_trait = cruel }
						20 = { add_trait = stubborn }
						20 = { add_trait = greedy }
						20 = { add_trait = wroth }
						20 = { add_trait = proud }
					}
					random_list = {
						20 = { add_trait = falconer }
						20 = { add_trait = diligent }
						20 = { add_trait = brave }
						20 = { add_trait = honest }
						20 = { add_trait = gregarious }
					}    
				}
				#Sociable
				25 = {
					set_character_flag = archetype_sociable
					if = {
						limit = { has_dlc = "Way of Life" }
						random_list = {
							20 = { add_trait = duelist }
							40 = { add_trait = hunter }
							40 = { add_trait = gamer }
						}
					}
					add_trait = levy_coordinator 
					add_trait = gregarious
					add_trait = charitable
					random_list = {
						33 = { add_trait = envious }
						33 = { add_trait = gluttonous }
						33 = { add_trait = proud }
					}
					random_list = {
						25 = { add_trait = falconer }
						25 = { add_trait = kind }
						25 = { add_trait = honest }
						25 = { add_trait = lustful }
					}   
				}
			}

			#Add second commander trait
			random_list = {
				10 = {
					trigger = { NOT = {trait = master_of_flame } }
					add_trait = master_of_flame
				}
				10 = {
					trigger = { NOT = {trait = logistics_expert } }
					add_trait = logistics_expert
				}
				10 = {
					trigger = { NOT = {trait = levy_coordinator } }
					add_trait = levy_coordinator
				}
				10 = {
					trigger = { NOT = {trait = sapper } }
					add_trait = sapper
				}
				60 = {}
			}
		}
		new_character = {
			give_minor_title = title_commander
		}
    }
	
	option = {
		name = EVTOPTA_GRACE_324
		log = "[Root.GetTitledName] was granted a strategist by [From.GetTitledName]!"
	}
}

# Request denied, sender's opinion of the EoC lowered
letter_event = {
	id = grace.325
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_325
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_325
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_strategist_boon
		}
		log = "[Root.GetTitledName] was refused a strategist by [From.GetTitledName]!"
	}
}

### Scholar-Bureaucrat (326-328)

# The EoC gets the request
narrative_event = {
	id = grace.326
	is_triggered_only = yes
	title = EVTTITLE_GRACE_326
	desc = EVTDESC_GRACE_326
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_grants_administrator_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_326 # Grant the Scholar-Bureaucrat
		
		FROMFROM = {
			letter_event = { id = grace.327 }
		}
	}
	
	option = {
		trigger = {
			china_grants_administrator_boon_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTB_GRACE_326 # Refuse the Boon, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.328 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_grants_administrator_boon_fromfrom_trigger = yes
		}
		name = EVTOPTC_GRACE_326 # Refuse the Boon, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.328 }
		}
		
		# TODO: Penalize
	}
}

# Request accepted, scholar-bureaucrat arrives
letter_event = {
	id = grace.327
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_327
    border = GFX_event_letter_frame_diplomacy
	
	immediate = {
		random_list = {
			50 = { #Female
				modifier = {
					NOT = {
						has_game_rule = {
							name = gender
							value = all
						}
					}
					factor = 0.05
				}
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = FROM
					culture = FROM
					female = yes
					health = 6
					random_traits = no
					attributes = {
						martial = 2
						diplomacy = 4
						stewardship = 6
						intrigue = 2
						learning = 5
					}
				}
			}
			50 = { #Male
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = FROM
					culture = FROM
					female = no
					health = 6
					random_traits = no
					attributes = {
						martial = 2
						diplomacy = 4
						stewardship = 6
						intrigue = 2
						learning = 5
					}
				}
			}
		}
		new_character = {
			#Education & other basic stuff
			save_event_target_as = chinese_administrator
			add_character_modifier = {
				name = jd_administrator
				duration = -1
			}
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = originated_from_chinese_court
			set_character_flag = no_court_invites
			set_character_flag = is_chinese_administrator
			random_list = {
				30 = { add_trait = thrifty_clerk }
				15 = { add_trait = fortune_builder }
				5 = { add_trait = midas_touched }
				30 = { add_trait = martial_cleric }
				15 = { add_trait = scholarly_theologian }
				5 = { add_trait = mastermind_theologian }
			}
			random_list = {
				20 = { } #Nothing
				30 = { add_trait = erudite }
				25 = { add_trait = shrewd }
				15 = { add_trait = quick }
				5 = { add_trait = genius }
				5 = { add_trait = fair }
			}
			random_list = {
				85 = { } #Nothing
				1 = { add_trait = clubfooted }
				2 = { add_trait = harelip }
				2 = { add_trait = hunchback }
				3 = { add_trait = lisp }
				3 = { add_trait = stutter }
				2 = { 
					add_trait = ugly 
					remove_trait = fair 
				}
				1 = { add_trait = dwarf }
				1 = {  add_trait = weak }
			}
			random = {
				chance = 10
				add_trait = homosexual
			}
			opinion = {
				who = ROOT
				modifier = opinion_servant
				months = 1200
			}

			#Add archetype 
			random_list = {
				#Conservative 
				25 = {
					set_character_flag = archetype_conservative
					if = {
						limit = { has_dlc = "Way of Life" }
						random_list = {
							50 = { add_trait = scholar }
							50 = { add_trait = administrator }
						}
					}
					random = {
						chance = 50
						add_trait = zealous
					}
					add_trait = stubborn
					add_trait = temperate
					random_list = {
						20 = { add_trait = greedy }
						20 = { add_trait = wroth }
						20 = { add_trait = deceitful }
						20 = { add_trait = shy }
						20 = { add_trait = cruel }
					}
					random_list = {
						25 = { add_trait = poet }
						25 = { add_trait = chaste }
						25 = { 
							add_trait = patient
							remove_trait = wroth
						}
						25 = { add_trait = just }
					}
				}
				#Supportive
				25 = {
					set_character_flag = archetype_supportive
					if = {
						limit = { has_dlc = "Way of Life" }    
						random_list = {
							50 = { add_trait = administrator }
							25 = { add_trait = scholar }
							25 = { add_trait = gardener }
						}
					}
					add_trait = humble
					add_trait = patient
					random_list = {
						33 = { add_trait = slothful }
						33 = { add_trait = craven }
						33 = { add_trait = shy }
					}
					random_list = {
						25 = { add_trait = content }
						25 = { add_trait = charitable }
						25 = { add_trait = kind }
						25 = { add_trait = trusting }
					}      
				}
				#Decisive
				25 = {
					set_character_flag = archetype_decisive
					if = {
						limit = { has_dlc = "Way of Life" }
						random_list = {
							75 = { add_trait = administrator }
							25 = { add_trait = architect }
						}
					}
					add_trait = ambitious
					add_trait = cynical
					random_list = {
						20 = { add_trait = cruel }
						20 = { add_trait = stubborn }
						20 = { add_trait = greedy }
						20 = { add_trait = wroth }
						20 = { add_trait = proud }
					}
					random_list = {
						20 = { add_trait = falconer }
						20 = { add_trait = diligent }
						20 = { add_trait = brave }
						20 = { add_trait = honest }
						20 = { add_trait = gregarious }
					}    
				}
				#Sociable
				25 = {
					set_character_flag = archetype_sociable
					if = {
						limit = { has_dlc = "Way of Life" }
						random_list = {
							25 = { add_trait = administrator }
							30 = { add_trait = socializer }
							25 = { add_trait = hedonist}
							20 = {
								trigger = { is_female = yes }
								add_trait = seductress
								add_trait = lustful
							}
							20 = {
								trigger = { is_female = no }
								add_trait = seducer
								add_trait = lustful
							}
						}
					}
					add_trait = gregarious
					add_trait = charitable
					random_list = {
						25 = { add_trait = craven }
						25 = { add_trait = envious }
						25 = { add_trait = gluttonous }
						25 = { add_trait = proud }
					}
					random_list = {
						25 = { add_trait = poet }
						25 = { add_trait = kind }
						25 = { add_trait = honest }
						25 = { add_trait = lustful }
					}   
				}
			}
		}
    }
	
	option = {
		name = EVTOPTA_GRACE_327
		add_character_modifier = {
			name = employing_jd_administrator
			duration = -1
		}
		# TODO: Remove modifier on administrator's death
		log = "[Root.GetTitledName] was granted a Scholar-Bureaucrat by [From.GetTitledName]!"
	}
}

# Request denied, sender's opinion of the EoC lowered
letter_event = {
	id = grace.328
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_328
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_328
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_administrator_boon
		}
		log = "[Root.GetTitledName] was refused a Scholar-Bureaucrat by [From.GetTitledName]!"
	}
}

### Master Engineer (329-331)

# The EoC gets the request
narrative_event = {
	id = grace.329
	is_triggered_only = yes
	title = EVTTITLE_GRACE_329
	desc = EVTDESC_GRACE_329
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_grants_master_engineer_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_329 # Grant the Master Engineer
		
		FROMFROM = {
			letter_event = { id = grace.330 }
		}
	}
	
	option = {
		trigger = {
			china_grants_master_engineer_boon_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTB_GRACE_329 # Refuse the Boon, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.331 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_grants_master_engineer_boon_fromfrom_trigger = yes
		}
		name = EVTOPTC_GRACE_329 # Refuse the Boon, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.331 }
		}
		
		# TODO: Penalize
	}
}

# Request accepted, master engineer arrives
letter_event = {
	id = grace.330
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_330
    border = GFX_event_letter_frame_diplomacy
	
	immediate = {
		random_list = {
			50 = { #Female
				modifier = {
					NOT = {
						has_game_rule = {
							name = gender
							value = all
						}
					}
					factor = 0.05
				}
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = FROM
					culture = FROM
					female = yes
					health = 6
					random_traits = no
					attributes = {
						martial = 5
						diplomacy = 2
						stewardship = 6
						intrigue = 3
						learning = 3
					}
				}
			}
			50 = { #Male
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = FROM
					culture = FROM
					female = no
					health = 6
					random_traits = no
					attributes = {
						martial = 5
						diplomacy = 2
						stewardship = 6
						intrigue = 3
						learning = 3
					}
				}
			}
		}
		new_character = {
			#Education & other basic stuff
			save_event_target_as = chinese_master_engineer
			add_character_modifier = {
				name = jd_master_engineer
				duration = -1
			}
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = originated_from_chinese_court
			set_character_flag = no_court_invites
			set_character_flag = is_chinese_master_engineer
			random_list = {
				30 = { add_trait = thrifty_clerk }
				15 = { add_trait = fortune_builder }
				5 = { add_trait = midas_touched }
				30 = { add_trait = tough_soldier }
				15 = { add_trait = skilled_tactician }
				5 = { add_trait = brilliant_strategist }
			}
			random_list = {
				20 = { } #Nothing
				20 = { add_trait = erudite }
				20 = { add_trait = shrewd }
				15 = { add_trait = quick }
				5 = { add_trait = genius }
				10 = { add_trait = robust }
				5 = { add_trait = strong }
				5 = { add_trait = fair }
			}
			random_list = {
				85 = { } #Nothing
				1 = { add_trait = clubfooted }
				2 = { add_trait = harelip }
				2 = { add_trait = hunchback }
				3 = { add_trait = lisp }
				3 = { add_trait = stutter }
				2 = { 
					add_trait = ugly 
					remove_trait = fair 
				}
				1 = { add_trait = dwarf }
				1 = { 
					add_trait = weak 
					remove_trait = strong 
					remove_trait = robust
				}
			}
			random = {
				chance = 10
				add_trait = homosexual
			}
			opinion = {
				who = ROOT
				modifier = opinion_servant
				months = 1200
			}

			#Add archetype 
			random_list = {
				#Conservative
				25 = {
					set_character_flag = archetype_conservative
					if = {
						limit = { has_dlc = "Way of Life" }
						random_list = {
							75 = { add_trait = architect }
							25 = { add_trait = theologian }
						}
					}
					random = {
						chance = 50
						add_trait = zealous
					}
					add_trait = stubborn
					add_trait = temperate
					random_list = {
						20 = { add_trait = greedy }
						20 = { add_trait = wroth }
						20 = { add_trait = deceitful }
						20 = { add_trait = shy }
						20 = { add_trait = cruel }
					}
					random_list = {
						25 = { add_trait = poet }
						25 = { add_trait = chaste }
						25 = { 
							add_trait = patient
							remove_trait = wroth
						}
						25 = { add_trait = just }
					}
				}
				#Supportive
				25 = {
					set_character_flag = archetype_supportive
					if = {
						limit = { has_dlc = "Way of Life" }    
						random_list = {
							50 = { add_trait = architect }
							25 = { add_trait = socializer }
							25 = { add_trait = gardener }
						}
					}
					add_trait = humble
					add_trait = patient
					random_list = {
						33 = { add_trait = slothful }
						33 = { add_trait = craven }
						33 = { add_trait = shy }
					}
					random_list = {
						25 = { add_trait = content }
						25 = { add_trait = charitable }
						25 = { add_trait = kind }
						25 = { add_trait = trusting }
					}      
				}
				#Decisive
				25 = {
					set_character_flag = archetype_decisive
					if = {
						limit = { has_dlc = "Way of Life" }
						random_list = {
							50 = { add_trait = architect }
							50 = { add_trait = strategist }
						}
					}
					add_trait = ambitious
					add_trait = cynical
					random_list = {
						20 = { add_trait = cruel }
						20 = { add_trait = stubborn }
						20 = { add_trait = greedy }
						20 = { add_trait = wroth }
						20 = { add_trait = proud }
					}
					random_list = {
						20 = { add_trait = falconer }
						20 = { add_trait = diligent }
						20 = { add_trait = brave }
						20 = { add_trait = honest }
						20 = { add_trait = gregarious }
					}    
				}
				#Sociable
				25 = {
					set_character_flag = archetype_sociable
					if = {
						limit = { has_dlc = "Way of Life" }
						random_list = {
							25 = { add_trait = architect }
							30 = { add_trait = socializer }
							25 = { add_trait = hedonist}
							20 = {
								trigger = { is_female = yes }
								add_trait = seductress
								add_trait = lustful
							}
							20 = {
								trigger = { is_female = no }
								add_trait = seducer
								add_trait = lustful
							}
						}
					}
					add_trait = gregarious
					add_trait = charitable
					random_list = {
						25 = { add_trait = craven }
						25 = { add_trait = envious }
						25 = { add_trait = gluttonous }
						25 = { add_trait = proud }
					}
					random_list = {
						25 = { add_trait = poet }
						25 = { add_trait = kind }
						25 = { add_trait = honest }
						25 = { add_trait = lustful }
					}
				}
			}
		}
		new_character = {
			give_minor_title = title_master_engineer
		}
    }
	
	option = {
		name = EVTOPTA_GRACE_330
		log = "[Root.GetTitledName] was granted a master engineer by [From.GetTitledName]!"
	}
}

# Request denied, sender's opinion of the EoC lowered
letter_event = {
	id = grace.331
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_331
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_331
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_master_engineer_boon
		}
		log = "[Root.GetTitledName] was refused a master engineer by [From.GetTitledName]!"
	}
}

### Trade Contract (332-334)

# The EoC gets the request
narrative_event = {
	id = grace.332
	is_triggered_only = yes
	title = EVTTITLE_GRACE_332
	desc = EVTDESC_GRACE_332
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_grants_trade_contract_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_332 # Grant the Trade Contract
		
		FROMFROM = {
			add_character_modifier = {
				modifier = chinese_imperial_trade_contract
				inherit = yes
				years = 25
			}
			letter_event = { id = grace.333 }
		}
	}
	
	option = {
		trigger = {
			china_grants_trade_contract_boon_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTB_GRACE_332 # Refuse the Boon, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.334 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_grants_trade_contract_boon_fromfrom_trigger = yes
		}
		name = EVTOPTC_GRACE_332 # Refuse the Boon, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.334 }
		}
		
		# TODO: Penalize
	}
}

# Request accepted, trade contract signed
letter_event = {
	id = grace.333
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_333
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_333
		
		add_character_modifier = {
			inherit = yes
			name = chinese_imperial_trade_contract
			years = 25
		}
		log = "[Root.GetTitledName] was granted a Trade Contract by [From.GetTitledName]!"
	}
}

# Request denied, sender's opinion of the EoC lowered
letter_event = {
	id = grace.334
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_334
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_334
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_trade_contract_boon
		}
		log = "[Root.GetTitledName] was refused a Trade Contract by [From.GetTitledName]!"
	}
}

### Imperial marriage (335-338)

# The EoC gets the request
narrative_event = {
	id = grace.335
	is_triggered_only = yes
	title = EVTTITLE_GRACE_335
	desc = EVTDESC_GRACE_335
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		# Clear previously generated event targets
		clear_event_target = dragon_bride_1
		clear_event_target = dragon_bride_2
		clear_event_target = dragon_bride_3
		# If possible, generate three candidates for the EoC to choose from
		random_realm_character = {
			limit = {
				is_valid_dragon_bride_candidate = yes
				NOR = {
					any_lover = {
						character = ROOT # If they are the lover of the EoC, don't send them!
					}
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_seducing # If the EoC is seducing someone, don't send them!
					}
				}
			}
			save_event_target_as = dragon_bride_1
		}
		random_realm_character = {
			limit = {
				is_valid_dragon_bride_candidate = yes
				NOR = {
					any_lover = {
						character = ROOT # If they are the lover of the EoC, don't send them!
					}
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_seducing # If the EoC is seducing someone, don't send them!
					}
					event_target:dragon_bride_1 = {
						character = PREV # Pick a different candidate!
					}
				}
			}
			save_event_target_as = dragon_bride_2
		}
		random_realm_character = {
			limit = {
				is_valid_dragon_bride_candidate = yes
				NOR = {
					any_lover = {
						character = ROOT # If they are the lover of the EoC, don't send them!
					}
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_seducing # If the EoC is seducing someone, don't send them!
					}
					event_target:dragon_bride_1 = {
						character = PREV # Pick a different candidate
					}
					event_target:dragon_bride_2 = {
						character = PREV # Pick a different candidate
					}
				}
			}
			save_event_target_as = dragon_bride_3
		}
	}
	
	option = {
		trigger = {
			event_target:dragon_bride_1 = {
				always = yes
			}
			OR = {
				ai = no
				china_grants_imperial_marriage_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_335 # Candidate 1 shall be FROMFROMFROM's bride!
		
		event_target:dragon_bride_3 = {
			save_event_target_as = dragon_bride
		}
		
		FROMFROM = {
			add_character_modifier = {
				inherit = yes
				name = peace_deal_with_china
				years = 50
			}
			letter_event = { id = grace.336 }
		}
	}
	
	option = {
		trigger = {
			event_target:dragon_bride_2 = {
				always = yes
			}
			OR = {
				ai = no
				china_grants_imperial_marriage_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
		}
		
		name = EVTOPTB_GRACE_335 # Candidate 2 shall be FROMFROMFROM's bride!
		
		event_target:dragon_bride_2 = {
			save_event_target_as = dragon_bride
		}
		
		FROMFROM = {
			add_character_modifier = {
				inherit = yes
				name = peace_deal_with_china
				years = 50
			}
			letter_event = { id = grace.336 }
		}
	}
	
	option = {
		trigger = {
			event_target:dragon_bride_3 = {
				always = yes
			}
			OR = {
				ai = no
				china_grants_imperial_marriage_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
		}
		
		name = EVTOPTC_GRACE_335 # Candidate 3 shall be FROMFROMFROM's bride!
		
		event_target:dragon_bride_3 = {
			save_event_target_as = dragon_bride
		}
		
		FROMFROM = {
			add_character_modifier = {
				inherit = yes
				name = peace_deal_with_china
				years = 50
			}
			letter_event = { id = grace.336 }
		}
	}
	
	option = {
		trigger = {
			china_grants_imperial_marriage_boon_fromfrom_trigger = yes
			event_target:dragon_bride_1 = {
				always = no
			}
		}
		name = EVTOPTD_GRACE_335 # No valid candidate!
		
		FROMFROM = {
			letter_event = { id = grace.337 }
		}
	}
	
	option = {
		trigger = {
			china_grants_imperial_marriage_boon_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTE_GRACE_335 # Refuse the Imperial Marriage, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.338 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_grants_imperial_marriage_boon_fromfrom_trigger = yes
		}
		name = EVTOPTF_GRACE_335 # Refuse the Imperial Marriage, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.338 }
		}
		
		# TODO: Penalize
	}
}

# Request accepted, Chinese princess arrives, NAP signed
letter_event = {
	id = grace.336
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_336
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_336
		
		FROM = {
			event_target:dragon_bride = {
				hidden_tooltip = {
					remove_trait = dragon_bride_unmarried # Remove marriage blocker
					add_trait = dragon_bride_married # Add inheritance blocker
				}
				move_character = ROOT
				force_host = ROOT
				add_spouse = ROOT
			}
		}
		add_character_modifier = {
			inherit = yes
			name = peace_deal_with_china
			years = 50
		}
		log = "[Root.GetTitledName] was granted an Imperial Marriage by [From.GetTitledName]!"
	}
}

# Request refused, no suitable candidate (all available princesses are pregnant, lovers of the EoC, or otherwise non-ideal candidates), Grace refunded
letter_event = {
	id = grace.337
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_337
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_337 # Fair enough!
		
		sound_effect = china_grace_gain
		if = {
			limit = { has_character_modifier = peace_deal_with_china }
			change_variable = {
				which = grace
				value = 750
			}
		}
		else = {
			change_variable = {
				which = grace
				value = 1000
			}
			custom_tooltip = { text = chinese_imperial_marriage_peace_deal_tt }	
		}
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_imperial_marriage_good
			# One year long - should keep the AI (and the player) from spamming the EoC if there's no good candidate (though different AI rulers can still try...)
		}
		log = "[Root.GetTitledName] was refused an Imperial Marriage by [From.GetTitledName] due to no valid candidate!"
	}
}

# Request refused, sender's opinion of the EoC lowered
letter_event = {
	id = grace.338
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_338
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_338
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_imperial_marriage
		}
		log = "[Root.GetTitledName] was refused an Imperial Marriage by [From.GetTitledName]!"
	}
}



##### Requests from the EoC (---; reserved ids 601-900)



##### Missing events (901-910, reserved ids 901-949)

### Concubines

# Ping concubine to be given to a random vassal
letter_event = {
	id = grace.901
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		FROMFROM = {
			random_realm_lord = {
				limit = {
					higher_tier_than = baron
					# TODO: Ensure the EoC doesn't hate the vassal
					is_female = no
					has_concubinage = yes
					NOT = {
						num_of_consorts = 3 # Can't take additional concubines
					}
					is_adult = yes
					NOR = {
						trait = celibate
						trait = eunuch
						trait = incapable
					}
					prisoner = no
					is_inaccessible_trigger = no
				}
				narrative_event = { id = grace.902 }
			}
		}
	}
}

# Inform the vassal
narrative_event = {
	id = grace.902
	is_triggered_only = yes
	title = EVTTITLE_GRACE_902
	desc = EVTDESC_GRACE_902
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_GRACE_902
		
		opinion = {
			who = FROM
			modifier = opinion_given_concubine
		}
		
		FROM = {
			move_character = ROOT
			force_host = ROOT
			add_consort = ROOT
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
		}
		log = "[Root.GetTitledName] was given [FromFrom.GetTitledName]'s concubine tribute, [From.GetBestName], by [FromFromFrom.GetTitledName]!"
	}
}

### Eunuchs

# Ping eunuch to be given to a random vassal
letter_event = {
	id = grace.903
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		FROMFROM = {
			random_realm_lord = {
				limit = {
					higher_tier_than = baron
					# TODO: Ensure the EoC doesn't hate the vassal
				}
				narrative_event = { id = grace.904 }
			}
		}
	}
}

# Inform the vassal
narrative_event = {
	id = grace.904
	is_triggered_only = yes
	title = EVTTITLE_GRACE_904
	desc = EVTDESC_GRACE_904
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_GRACE_904
		
		opinion = {
			who = FROM
			modifier = opinion_given_eunuch
		}
		
		FROM = {
			move_character = ROOT
			force_host = ROOT
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
		}
		log = "[Root.GetTitledName] was given [FromFrom.GetTitledName]'s eunuch tribute, [From.GetBestName], by [FromFromFrom.GetTitledName]!"
	}
}

### Commanders

# Ping commander to be given to a random vassal
letter_event = {
	id = grace.905
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		FROMFROM = {
			random_realm_lord = {
				limit = {
					higher_tier_than = baron
					# TODO: Ensure the EoC doesn't hate the vassal
				}
				narrative_event = { id = grace.906 }
			}
		}
	}
}

# Inform the vassal
narrative_event = {
	id = grace.906
	is_triggered_only = yes
	title = EVTTITLE_GRACE_906
	desc = EVTDESC_GRACE_906
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_GRACE_906
		
		opinion = {
			who = FROM
			modifier = opinion_given_commander
		}
		
		FROM = {
			move_character = ROOT
			force_host = ROOT
			give_minor_title = title_commander
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
		}
		log = "[Root.GetTitledName] was given [FromFrom.GetTitledName]'s commander tribute, [From.GetBestName], by [FromFromFrom.GetTitledName]!"
	}
}

### Physicians

# Ping commander to be given to a random vassal
letter_event = {
	id = grace.907
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		FROMFROM = {
			random_realm_lord = {
				limit = {
					higher_tier_than = baron
					# TODO: Ensure the EoC doesn't hate the vassal
				}
				narrative_event = { id = grace.908 }
			}
		}
	}
}

# Inform the vassal
narrative_event = {
	id = grace.908
	is_triggered_only = yes
	title = EVTTITLE_GRACE_908
	desc = EVTDESC_GRACE_908
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_GRACE_908
		
		opinion = {
			who = FROM
			modifier = opinion_given_physician
		}
		
		FROM = {
			move_character = ROOT
			force_host = ROOT
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
		}
		log = "[Root.GetTitledName] was given [FromFrom.GetTitledName]'s physician tribute, [From.GetBestName], by [FromFromFrom.GetTitledName]!"
	}
}

### Artifact

# Ping the EoC
letter_event = {
	id = grace.909
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		random_realm_lord = {
			limit = {
				higher_tier_than = baron
				# TODO: Ensure the EoC doesn't hate the vassal
				FROM = {
					event_target:tribute_artifact = {
						PREVPREV = {
							NOT = {
								has_artifact = PREV # Might need to split this up...
							}
						}
					}
				}
			}
			narrative_event = { id = grace.910 }
		}
	}
}

# Inform the vassal
narrative_event = {
	id = grace.910
	is_triggered_only = yes
	title = EVTTITLE_GRACE_910
	desc = EVTDESC_GRACE_910
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		FROMFROM = {
			event_target:tribute_artifact = {
				clear_event_target = tribute_artifact
				transfer_artifact = {
					from = PREV
					to = ROOT
				}
			}
		}
		log = "[Root.GetTitledName] was given [FromFrom.GetTitledName]'s artifact tribute by [From.GetTitledName]!"
	}
	
	option = {
		name = EVTOPTA_GRACE_910
		
		opinion = {
			who = FROM
			modifier = opinion_given_artifact
		}
	}
}



##### Misc (995-999, reserved ids 950-999)

# on_war_started event removing the "Chinese Trade Contract" modifier if you end up being the primary participant in a war against China
character_event = {
	id = grace.995
	is_triggered_only = yes
	hide_window = yes
	
	has_dlc = "Jade Dragon"
	
	trigger = {
		OR = {
			# Attacker is EoC, defender has trade contract
			AND = {
				ROOT = {
					has_character_modifier = chinese_imperial_trade_contract
				}
				FROM = {
					is_chinese_emperor_trigger = yes
				}
			}
			# Defender is EoC (or a Chinese tributary, if the attacker isn't one), attacker has trade contract
			AND = {
				FROM = {
					has_character_modifier = chinese_imperial_trade_contract
				}
				ROOT = {
					OR = {
						is_chinese_emperor_trigger = yes
						AND = {
							suzerain = {
								is_chinese_emperor_trigger = yes
							}
							FROM = {
								suzerain = {
									is_chinese_emperor_trigger = no
								}
							}
						}
					}
				}
			}
		}
	}
	
	immediate = {
		if = {
			limit = {
				ROOT = {
					has_character_modifier = chinese_imperial_trade_contract
				}
				FROM = {
					is_chinese_emperor_trigger = yes
				}
			}
			remove_character_modifier = chinese_imperial_trade_contract
			log = "[From.GetTitledName] no longer has a Chinese Trade Contract due to war!"
		}
		if = {
			limit = {
				FROM = {
					has_character_modifier = chinese_imperial_trade_contract
				}
				ROOT = {
					OR = {
						is_chinese_emperor_trigger = yes
						AND = {
							suzerain = {
								is_chinese_emperor_trigger = yes
							}
							FROM = {
								suzerain = {
									is_chinese_emperor_trigger = no
								}
							}
						}
					}
				}
			}
			FROM = {
				remove_character_modifier = chinese_imperial_trade_contract
			}
			log = "[From.GetTitledName] no longer has a Chinese Trade Contract due to war!"
		}
	}
}

# on_war_started event cancelling "Supply Horses" if China and the sender end up being the primary participants in a war against one another
character_event = {
	id = grace.996
	is_triggered_only = yes
	hide_window = yes
	
	has_dlc = "Jade Dragon"
	
	trigger = {
		OR = {
			# Attacker is EoC, defender is supplying horses
			AND = {
				ROOT = {
					has_character_modifier = china_supply_horses
				}
				FROM = {
					is_chinese_emperor_trigger = yes
				}
			}
			# Defender is EoC (or a Chinese tributary, if the attacker isn't one), attacker is supplying horses
			AND = {
				FROM = {
					has_character_modifier = china_supply_horses
				}
				ROOT = {
					OR = {
						is_chinese_emperor_trigger = yes
						AND = {
							suzerain = {
								is_chinese_emperor_trigger = yes
							}
							FROM = {
								suzerain = {
									is_chinese_emperor_trigger = no
								}
							}
						}
					}
				}
			}
		}
	}
	
	immediate = {
		if = {
			limit = {
				ROOT = {
					has_character_modifier = china_supply_horses
				}
				FROM = {
					is_chinese_emperor_trigger = yes
				}
			}
			remove_character_modifier = china_supply_horses
			log = "[Root.GetTitledName] is no longer supplying horses due to war!"
		}
		if = {
			limit = {
				FROM = {
					has_character_modifier = china_supply_horses
				}
				ROOT = {
					OR = {
						is_chinese_emperor_trigger = yes
						AND = {
							suzerain = {
								is_chinese_emperor_trigger = yes
							}
							FROM = {
								suzerain = {
									is_chinese_emperor_trigger = no
								}
							}
						}
					}
				}
			}
			FROM = {
				remove_character_modifier = china_supply_horses
			}
			log = "[From.GetTitledName] is no longer supplying horses due to war!"
		}
		# TODO: Remove bonus from EoC
	}
}

# Show current Grace
letter_event = {
	id = grace.997
	is_triggered_only = yes
	desc = EVTDESC_GRACE_997
	
	option = {
		name = EVTOPTA_GRACE_997
	}
}

# on_death event handling Grace inheritance
character_event = {
	id = grace.998
	hide_window = yes
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	
	trigger = {
		has_character_flag = grace_character
	}
	
	immediate = {
		# Gives the primary heir
		current_heir = {
			set_character_flag = grace_character
			change_variable = {
				which = grace
				which = ROOT
			}
			log = "[This.GetTitledName] has inherited the Grace of [Root.GetTitledName]!"
		}
		clr_character_flag = grace_character
		if = { 
			limit = {
				suzerain = { is_chinese_emperor_trigger = yes }
			}
			current_heir = {
				character_event = { id = grace.7 days = 30 } # Keep tributary Grace gain
			}
		}
	}
}

# on_new_holder (of any type) event clearing out all Grace if the holder of e_china changes dynasty - TODO: Add trigger
character_event = {
	id = grace.999
	hide_window = yes
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	
	trigger = {
		FROM = {
			title = e_china
		}
		ROOT = {
			NOT = {
				dynasty = FROMFROM
			}
		}
	}
	
	immediate = {
		log = "The [Root.GetDynastyName] dynasty now sits on the Dragon Throne!"
		# We are forced to use any_character here to account for deposed rulers, even though the scope is performance-intensive
		# This event should hopefully only fire rarely, though, so it should be fine
		
		# Clear out Imperial Princesses for the old dynasty
		any_character = {
			limit = {
				dynasty = FROMFROM
				is_female = yes
			}
			remove_trait = dragon_bride_unmarried
			remove_trait = dragon_bride_married
		}
		log = "Chinsee princesses of the [FromFrom.GetDynasty] dynasty have lost their traits!"
		
		# If the new EoC uses Grace, give the relevant characters the dragon_bride_unmarried/dragon_bride_married traits
		if = {
			limit = {
				ROOT = {
					religion = taoist # TODO: Proper check for Grace mechanics
				}
			}
			any_character = {
				limit = {
					dynasty = ROOT
					is_female = yes
				}
				if = {
					limit = {
						is_married = yes
						# TODO: Check for same realm!
					}
					add_trait = dragon_bride_married
				}
				if = {
					limit = {
						is_married = no
						#is_consort = no # Do we want this?
						is_landed = no
						# TODO: Check for same realm!
					}
					add_trait = dragon_bride_unmarried
				}
			}
			log = "Female family members of the EoC have gained the relevant traits!"
		}
		
		# Clear all Grace and stop tracking Grace characters
		any_character = {
			limit = {
				has_character_flag = grace_character
			}
			set_variable = {
				which = grace
				value = 0
			}
			clr_character_flag = grace_character
		}
		
		log = "All Grace has been removed from all characters!"
		
		# Terminate all "Supply Horses" agreements
		any_character = {
			limit = {
				has_character_modifier = china_supply_horses
			}
			remove_character_modifier = china_supply_horses
		}
		
		log = "All agreements to supply horses have been ended!"
		
		# Revoke all Chinese Trade Contracts
		any_character = {
			limit = {
				has_character_modifier = chinese_imperial_trade_contract
			}
			remove_character_modifier = chinese_imperial_trade_contract
		}
		
		log = "All Chinese Trade Contracts have been ended!"
		
		# Remove all Chinese Peace Deals
		any_character = {
			limit = {
				has_character_modifier = peace_deal_with_china
			}
			remove_character_modifier = peace_deal_with_china
		}
		
		log = "All Chinese Peace Deals have been ended!"
	}
}