# Miscellaneous Japanese events (usually for Shinto rulers or Japonic Buddhists).
# by Silverswee(e)per

namespace = japan

# Should probably be reorganized in the future since e.g. the government/regency/shogunate stuff could be separated

#####

# Regnal names for Emperors of Japan
# Go-[Name] is just [Name] II
# Name reuse should be relatively rare
# Names before the history for k_chrysanthemum_throne (and k_japan) are not usable, to prevent numbering conflicts

# on_new_holder event for k_chrysanthemum_throne

character_event = {
	id = japan.1
	desc = EVTDESC_JAPAN_1
	picture = GFX_evt_china_golden_age # Needs better picture!
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	only_playable = yes
	
	trigger = {
		NOT = {
			has_character_flag = temporarily_japanese_imperial
		}
	}
	
	# 0
	
	option = {
		trigger = {
			NOT = {
				has_character_flag = emperor_of_japan_namelist_1
			}
		}
		
		name = KEITAI
		
		set_name = Keitai
		
		set_character_flag = emperor_keitai_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_keitai_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_keitai # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_keitai_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_keitai_used # Very few names reused historically
				}
			}
		}
	}
	
	option = {
		trigger = {
			NOT = {
				has_character_flag = emperor_of_japan_namelist_1
			}
		}
		
		name = ANKAN
		
		set_name = Ankan
		
		set_character_flag = emperor_ankan_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_ankan_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_ankan # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_ankan_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_ankan_used # Very few names reused historically
				}
			}
		}
	}
	
	option = {
		trigger = {
			NOT = {
				has_character_flag = emperor_of_japan_namelist_1
			}
		}
		
		name = SENKA
		
		set_name = Senka
		
		set_character_flag = emperor_senka_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_senka_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_senka # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_senka_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_senka_used # Very few names reused historically
				}
			}
		}
	}
	
	# 1
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_1
					NOT = {
						has_character_flag = emperor_of_japan_namelist_2
					}
				}
				ai = yes
			}
		}
		
		name = KINMEI
		
		set_name = Kinmei
		
		set_character_flag = emperor_kinmei_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_kinmei_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_kinmei # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_kinmei_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_kinmei_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_1
					NOT = {
						has_character_flag = emperor_of_japan_namelist_2
					}
				}
				ai = yes
			}
		}
		
		name = BIDATSU
		
		set_name = Bidatsu
		
		set_character_flag = emperor_bidatsu_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_bidatsu_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_bidatsu # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_bidatsu_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_bidatsu_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_1
					NOT = {
						has_character_flag = emperor_of_japan_namelist_2
					}
				}
				ai = yes
			}
		}
		
		name = YOMEI
		
		set_name = Yomei
		
		set_character_flag = emperor_yomei_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_yomei_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_yomei # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_yomei_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_yomei_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
	}
	
	# 2
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_2
					NOT = {
						has_character_flag = emperor_of_japan_namelist_3
					}
				}
				ai = yes
			}
		}
		
		name = SUSHUN
		
		set_name = Sushun
		
		set_character_flag = emperor_sushun_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_sushun_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_sushun # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_sushun_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_sushun_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_2
					NOT = {
						has_character_flag = emperor_of_japan_namelist_3
					}
				}
				ai = yes
			}
		}
		
		name = SUIKO
		
		set_name = Suiko
		
		set_character_flag = emperor_suiko_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_suiko_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_suiko # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_suiko_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = yes # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_suiko_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_2
					NOT = {
						has_character_flag = emperor_of_japan_namelist_3
					}
				}
				ai = yes
			}
		}
		
		name = JOMEI
		
		set_name = Jomei
		
		set_character_flag = emperor_jomei_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_jomei_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_jomei # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_jomei_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_jomei_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
	}
	
	# 4
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_3
					NOT = {
						has_character_flag = emperor_of_japan_namelist_4
					}
				}
				ai = yes
			}
		}
		
		name = KOGYOKU
		
		set_name = Kogyoku
		
		set_character_flag = emperor_kogyoku_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_kogyoku_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_kogyoku # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_kogyoku_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = yes # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_kogyoku_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_3
					NOT = {
						has_character_flag = emperor_of_japan_namelist_4
					}
				}
				ai = yes
			}
		}
		
		name = KOTOKU
		
		set_name = Kotoku
		
		set_character_flag = emperor_kotoku_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_kotoku_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_kotoku # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_kotoku_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_kotoku_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_3
					NOT = {
						has_character_flag = emperor_of_japan_namelist_4
					}
				}
				ai = yes
			}
		}
		
		name = SAIMEI
		
		set_name = Saimei
		
		set_character_flag = emperor_saimei_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_saimei_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_saimei # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_saimei_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = yes # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_saimei_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
	}
	
	# 5
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_4
					NOT = {
						has_character_flag = emperor_of_japan_namelist_5
					}
				}
				ai = yes
			}
		}
		
		name = TENCHI
		
		set_name = Tenchi
		
		set_character_flag = emperor_tenchi_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_tenchi_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_tenchi # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_tenchi_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_tenchi_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_4
					NOT = {
						has_character_flag = emperor_of_japan_namelist_5
					}
				}
				ai = yes
			}
		}
		
		name = KOBUN
		
		set_name = Kobun
		
		set_character_flag = emperor_kobun_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_kobun_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_kobun # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_kobun_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_kobun_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_4
					NOT = {
						has_character_flag = emperor_of_japan_namelist_5
					}
				}
				ai = yes
			}
		}
		
		name = TENMU
		
		set_name = Tenmu
		
		set_character_flag = emperor_tenmu_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_tenmu_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_tenmu # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_tenmu_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_tenmu_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
	}
	
	# 6
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_5
					NOT = {
						has_character_flag = emperor_of_japan_namelist_6
					}
				}
				ai = yes
			}
		}
		
		name = JITO
		
		set_name = Jito
		
		set_character_flag = emperor_jito_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_jito_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_jito # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_jito_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = yes # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_jito_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_5
					NOT = {
						has_character_flag = emperor_of_japan_namelist_6
					}
				}
				ai = yes
			}
		}
		
		name = MONMU
		
		set_name = Monmu
		
		set_character_flag = emperor_monmu_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_monmu_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_monmu # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_monmu_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_monmu_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_5
					NOT = {
						has_character_flag = emperor_of_japan_namelist_6
					}
				}
				ai = yes
			}
		}
		
		name = GENMEI
		
		set_name = Genmei
		
		set_character_flag = emperor_genmei_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_genmei_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_genmei # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_genmei_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = yes # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_genmei_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
	}
	
	# 7
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_6
					NOT = {
						has_character_flag = emperor_of_japan_namelist_7
					}
				}
				ai = yes
			}
		}
		
		name = GENSHO
		
		set_name = Gensho
		
		set_character_flag = emperor_gensho_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_gensho_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_gensho # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_gensho_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = yes # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_gensho_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_6
					NOT = {
						has_character_flag = emperor_of_japan_namelist_7
					}
				}
				ai = yes
			}
		}
		
		name = SHOMU
		
		set_name = Shomu
		
		set_character_flag = emperor_shomu_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_shomu_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_shomu # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_shomu_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_shomu_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_6
					NOT = {
						has_character_flag = emperor_of_japan_namelist_7
					}
				}
				ai = yes
			}
		}
		
		name = KOKEN
		
		set_name = Koken
		
		set_character_flag = emperor_koken_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_koken_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_koken # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_koken_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = yes # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_koken_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
	}
	
	# 8
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_7
					NOT = {
						has_character_flag = emperor_of_japan_namelist_8
					}
				}
				ai = yes
			}
		}
		
		name = JUNNIN
		
		set_name = Junnin
		
		set_character_flag = emperor_junnin_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_junnin_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_junnin # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_junnin_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_junnin_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_7
					NOT = {
						has_character_flag = emperor_of_japan_namelist_8
					}
				}
				ai = yes
			}
		}
		
		name = SHOTOKU
		
		set_name = Shotoku
		
		set_character_flag = emperor_yomei_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_yomei_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_shotoku # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_shotoku_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = yes # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_shotoku_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_7
					NOT = {
						has_character_flag = emperor_of_japan_namelist_8
					}
				}
				ai = yes
			}
		}
		
		name = KONIN
		
		set_name = Konin
		
		set_character_flag = emperor_konin_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_konin_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_konin # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_konin_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_konin_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
	}
	
	# 9
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_8
					NOT = {
						has_character_flag = emperor_of_japan_namelist_9
					}
				}
				ai = yes
			}
		}
		
		name = KANMU
		
		set_name = Kanmu
		
		set_character_flag = emperor_kanmu_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_kanmu_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_kanmu # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_kanmu_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_kanmu_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_8
					NOT = {
						has_character_flag = emperor_of_japan_namelist_9
					}
				}
				ai = yes
			}
		}
		
		name = HEIZEI
		
		set_name = Heizei
		
		set_character_flag = emperor_heizei_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_heizei_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_heizei # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_heizei_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_heizei_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_8
					NOT = {
						has_character_flag = emperor_of_japan_namelist_9
					}
				}
				ai = yes
			}
		}
		
		name = SAGA
		
		set_name = Saga
		
		set_character_flag = emperor_saga_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_saga_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_saga # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_saga_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_saga_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
	}
	
	# 10
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_9
					NOT = {
						has_character_flag = emperor_of_japan_namelist_10
					}
				}
				ai = yes
			}
		}
		
		name = JUNNA
		
		set_name = Junna
		
		set_character_flag = emperor_junna_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_junna_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_junna # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_junna_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_junna_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_9
					NOT = {
						has_character_flag = emperor_of_japan_namelist_10
					}
				}
				ai = yes
			}
		}
		
		name = NINMYO
		
		set_name = Ninmyo
		
		set_character_flag = emperor_ninmyo_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_ninmyo_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_ninmyo # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_ninmyo_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_ninmyo_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_9
					NOT = {
						has_character_flag = emperor_of_japan_namelist_10
					}
				}
				ai = yes
			}
		}
		
		name = MONTOKU
		
		set_name = Montoku
		
		set_character_flag = emperor_montoku_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_montoku_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_montoku # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_montoku_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_montoku_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
	}
	
	# 11
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_10
					NOT = {
						has_character_flag = emperor_of_japan_namelist_11
					}
				}
				ai = yes
			}
		}
		
		name = SEIWA
		
		set_name = Seiwa
		
		set_character_flag = emperor_seiwa_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_seiwa_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_seiwa # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_seiwa_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_seiwa_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_10
					NOT = {
						has_character_flag = emperor_of_japan_namelist_11
					}
				}
				ai = yes
			}
		}
		
		name = YOZEI
		
		set_name = Yozei
		
		set_character_flag = emperor_yozei_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_yozei_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_yozei # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_yozei_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_yozei_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_10
					NOT = {
						has_character_flag = emperor_of_japan_namelist_11
					}
				}
				ai = yes
			}
		}
		
		name = KOKO
		
		set_name = Koko
		
		set_character_flag = emperor_koko_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_koko_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_koko # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_koko_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_koko_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
	}
	
	# 12
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_11
					NOT = {
						has_character_flag = emperor_of_japan_namelist_12
					}
				}
				ai = yes
			}
		}
		
		name = UDA
		
		set_name = Uda
		
		set_character_flag = emperor_uda_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_uda_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_uda # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_uda_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_uda_used # Very few names reused historically
				}
			}
		} 
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
		clr_character_flag = emperor_of_japan_namelist_11
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_11
					NOT = {
						has_character_flag = emperor_of_japan_namelist_12
					}
				}
				ai = yes
			}
		}
		
		name = DAIGO
		
		set_name = Daigo
		
		set_character_flag = emperor_daigo_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_daigo_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_daigo # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_daigo_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_daigo_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
		clr_character_flag = emperor_of_japan_namelist_11
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_11
					NOT = {
						has_character_flag = emperor_of_japan_namelist_12
					}
				}
				ai = yes
			}
		}
		
		name = SUZAKU
		
		set_name = Suzaku
		
		set_character_flag = emperor_suzaku_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_suzaku_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_suzaku # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_suzaku_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_suzaku_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
		clr_character_flag = emperor_of_japan_namelist_11
		clr_character_flag = emperor_of_japan_namelist_12
	}
	
	# 13
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_12
					NOT = {
						has_character_flag = emperor_of_japan_namelist_13
					}
				}
				ai = yes
			}
		}
		
		name = MURAKAMI
		
		set_name = Murakami
		
		set_character_flag = emperor_murakami_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_murakami_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_murakami # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_murakami_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_murakami_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
		clr_character_flag = emperor_of_japan_namelist_11
		clr_character_flag = emperor_of_japan_namelist_12
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_12
					NOT = {
						has_character_flag = emperor_of_japan_namelist_13
					}
				}
				ai = yes
			}
		}
		
		name = REZEI
		
		set_name = Rezei
		
		set_character_flag = emperor_rezei_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_rezei_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_rezei # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_rezei_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_rezei_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
		clr_character_flag = emperor_of_japan_namelist_11
		clr_character_flag = emperor_of_japan_namelist_12
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_12
					NOT = {
						has_character_flag = emperor_of_japan_namelist_13
					}
				}
				ai = yes
			}
		}
		
		name = ENYU
		
		set_name = Enyu
		
		set_character_flag = emperor_enyu_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_enyu_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_enyu # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_enyu_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_enyu_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
		clr_character_flag = emperor_of_japan_namelist_11
		clr_character_flag = emperor_of_japan_namelist_12
	}
	
	# 14
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_13
					NOT = {
						has_character_flag = emperor_of_japan_namelist_14
					}
				}
				ai = yes
			}
		}
		
		name = KAZAN
		
		set_name = Kazan
		
		set_character_flag = emperor_kazan_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_kazan_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_kazan # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_kazan_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_kazan_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
		clr_character_flag = emperor_of_japan_namelist_11
		clr_character_flag = emperor_of_japan_namelist_12
		clr_character_flag = emperor_of_japan_namelist_13
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_13
					NOT = {
						has_character_flag = emperor_of_japan_namelist_14
					}
				}
				ai = yes
			}
		}
		
		name = ICHIJO
		
		set_name = Ichijo
		
		set_character_flag = emperor_ichijo_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_ichijo_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_ichijo # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_ichijo_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_ichijo_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
		clr_character_flag = emperor_of_japan_namelist_11
		clr_character_flag = emperor_of_japan_namelist_12
		clr_character_flag = emperor_of_japan_namelist_13
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_13
					NOT = {
						has_character_flag = emperor_of_japan_namelist_14
					}
				}
				ai = yes
			}
		}
		
		name = SANJO
		
		set_name = Sanjo
		
		set_character_flag = emperor_sanjo_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_sanjo_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_sanjo # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_sanjo_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_sanjo_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
		clr_character_flag = emperor_of_japan_namelist_11
		clr_character_flag = emperor_of_japan_namelist_12
		clr_character_flag = emperor_of_japan_namelist_13
	}
	
	# 15
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_14
					NOT = {
						has_character_flag = emperor_of_japan_namelist_15
					}
				}
				ai = yes
			}
		}
		
		name = SHIRAKAWA
		
		set_name = Shirakawa
		
		set_character_flag = emperor_shirakawa_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_shirakawa_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_shirakawa # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_shirakawa_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_shirakawa_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
		clr_character_flag = emperor_of_japan_namelist_11
		clr_character_flag = emperor_of_japan_namelist_12
		clr_character_flag = emperor_of_japan_namelist_13
		clr_character_flag = emperor_of_japan_namelist_14
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_14
					NOT = {
						has_character_flag = emperor_of_japan_namelist_15
					}
				}
				ai = yes
			}
		}
		
		name = HORIKAWA
		
		set_name = Horikawa
		
		set_character_flag = emperor_horikawa_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_horikawa_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_horikawa # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_horikawa_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_horikawa_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
		clr_character_flag = emperor_of_japan_namelist_11
		clr_character_flag = emperor_of_japan_namelist_12
		clr_character_flag = emperor_of_japan_namelist_13
		clr_character_flag = emperor_of_japan_namelist_14
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_14
					NOT = {
						has_character_flag = emperor_of_japan_namelist_15
					}
				}
				ai = yes
			}
		}
		
		name = TOBA
		
		set_name = Toba
		
		set_character_flag = emperor_toba_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_toba_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_toba # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_toba_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_toba_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
		clr_character_flag = emperor_of_japan_namelist_11
		clr_character_flag = emperor_of_japan_namelist_12
		clr_character_flag = emperor_of_japan_namelist_13
		clr_character_flag = emperor_of_japan_namelist_14
	}
	
	# 16
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_15
					NOT = {
						has_character_flag = emperor_of_japan_namelist_16
					}
				}
				ai = yes
			}
		}
		
		name = SUTOKU
		
		set_name = Sutoku
		
		set_character_flag = emperor_sutoku_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_sutoku_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_sutoku # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_sutoku_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_sutoku_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
		clr_character_flag = emperor_of_japan_namelist_11
		clr_character_flag = emperor_of_japan_namelist_12
		clr_character_flag = emperor_of_japan_namelist_13
		clr_character_flag = emperor_of_japan_namelist_14
		clr_character_flag = emperor_of_japan_namelist_15
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_15
					NOT = {
						has_character_flag = emperor_of_japan_namelist_16
					}
				}
				ai = yes
			}
		}
		
		name = KONOE
		
		set_name = Konoe
		
		set_character_flag = emperor_konoe_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_konoe_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_konoe # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_konoe_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_konoe_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
		clr_character_flag = emperor_of_japan_namelist_11
		clr_character_flag = emperor_of_japan_namelist_12
		clr_character_flag = emperor_of_japan_namelist_13
		clr_character_flag = emperor_of_japan_namelist_14
		clr_character_flag = emperor_of_japan_namelist_15
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_15
					NOT = {
						has_character_flag = emperor_of_japan_namelist_16
					}
				}
				ai = yes
			}
		}
		
		name = NIJO
		
		set_name = Nijo
		
		set_character_flag = emperor_nijo_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_nijo_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_nijo # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_nijo_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_nijo_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
		clr_character_flag = emperor_of_japan_namelist_11
		clr_character_flag = emperor_of_japan_namelist_12
		clr_character_flag = emperor_of_japan_namelist_13
		clr_character_flag = emperor_of_japan_namelist_14
		clr_character_flag = emperor_of_japan_namelist_15
	}
	
	# 17
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_16
					NOT = {
						has_character_flag = emperor_of_japan_namelist_17
					}
				}
				ai = yes
			}
		}
		
		name = ROKUJO
		
		set_name = Rokujo
		
		set_character_flag = emperor_rokujo_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_rokujo_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_rokujo # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_rokujo_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_rokujo_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
		clr_character_flag = emperor_of_japan_namelist_11
		clr_character_flag = emperor_of_japan_namelist_12
		clr_character_flag = emperor_of_japan_namelist_13
		clr_character_flag = emperor_of_japan_namelist_14
		clr_character_flag = emperor_of_japan_namelist_15
		clr_character_flag = emperor_of_japan_namelist_16
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_16
					NOT = {
						has_character_flag = emperor_of_japan_namelist_17
					}
				}
				ai = yes
			}
		}
		
		name = TAKAKURA
		
		set_name = Takakura
		
		set_character_flag = emperor_takakura_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_takakura_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_takakura # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_takakura_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_takakura_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
		clr_character_flag = emperor_of_japan_namelist_11
		clr_character_flag = emperor_of_japan_namelist_12
		clr_character_flag = emperor_of_japan_namelist_13
		clr_character_flag = emperor_of_japan_namelist_14
		clr_character_flag = emperor_of_japan_namelist_15
		clr_character_flag = emperor_of_japan_namelist_16
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_16
					NOT = {
						has_character_flag = emperor_of_japan_namelist_17
					}
				}
				ai = yes
			}
		}
		
		name = ANTOKU
		
		set_name = Antoku
		
		set_character_flag = emperor_antoku_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_antoku_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_antoku # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_antoku_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_antoku_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
		clr_character_flag = emperor_of_japan_namelist_11
		clr_character_flag = emperor_of_japan_namelist_12
		clr_character_flag = emperor_of_japan_namelist_13
		clr_character_flag = emperor_of_japan_namelist_14
		clr_character_flag = emperor_of_japan_namelist_15
		clr_character_flag = emperor_of_japan_namelist_16
	}
	
	# 18
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_17
					NOT = {
						has_character_flag = emperor_of_japan_namelist_18
					}
				}
				ai = yes
			}
		}
		
		name = TSUCHIMIKADO
		
		set_name = Tsuchimikado
		
		set_character_flag = emperor_tsuchimikado_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_tsuchimikado_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_tsuchimikado # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_tsuchimikado_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_tsuchimikado_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
		clr_character_flag = emperor_of_japan_namelist_11
		clr_character_flag = emperor_of_japan_namelist_12
		clr_character_flag = emperor_of_japan_namelist_13
		clr_character_flag = emperor_of_japan_namelist_14
		clr_character_flag = emperor_of_japan_namelist_15
		clr_character_flag = emperor_of_japan_namelist_16
		clr_character_flag = emperor_of_japan_namelist_17
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_17
					NOT = {
						has_character_flag = emperor_of_japan_namelist_18
					}
				}
				ai = yes
			}
		}
		
		name = JUNTOKU
		
		set_name = Juntoku
		
		set_character_flag = emperor_juntoku_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_juntoku_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_juntoku # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_juntoku_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_juntoku_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
		clr_character_flag = emperor_of_japan_namelist_11
		clr_character_flag = emperor_of_japan_namelist_12
		clr_character_flag = emperor_of_japan_namelist_13
		clr_character_flag = emperor_of_japan_namelist_14
		clr_character_flag = emperor_of_japan_namelist_15
		clr_character_flag = emperor_of_japan_namelist_16
		clr_character_flag = emperor_of_japan_namelist_17
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_17
					NOT = {
						has_character_flag = emperor_of_japan_namelist_18
					}
				}
				ai = yes
			}
		}
		
		name = SHUKYO
		
		set_name = Shukyo
		
		set_character_flag = emperor_shukyo_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_shukyo_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_shukyo # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_shukyo_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_shukyo_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
		clr_character_flag = emperor_of_japan_namelist_11
		clr_character_flag = emperor_of_japan_namelist_12
		clr_character_flag = emperor_of_japan_namelist_13
		clr_character_flag = emperor_of_japan_namelist_14
		clr_character_flag = emperor_of_japan_namelist_15
		clr_character_flag = emperor_of_japan_namelist_16
		clr_character_flag = emperor_of_japan_namelist_17
	}
	
	# 19
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_18
					NOT = {
						has_character_flag = emperor_of_japan_namelist_19
					}
				}
				ai = yes
			}
		}
		
		name = SHIJO
		
		set_name = Shijo
		
		set_character_flag = emperor_shijo_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_shijo_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_shijo # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_shijo_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_shijo_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
		clr_character_flag = emperor_of_japan_namelist_11
		clr_character_flag = emperor_of_japan_namelist_12
		clr_character_flag = emperor_of_japan_namelist_13
		clr_character_flag = emperor_of_japan_namelist_14
		clr_character_flag = emperor_of_japan_namelist_15
		clr_character_flag = emperor_of_japan_namelist_16
		clr_character_flag = emperor_of_japan_namelist_17
		clr_character_flag = emperor_of_japan_namelist_18
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_18
					NOT = {
						has_character_flag = emperor_of_japan_namelist_19
					}
				}
				ai = yes
			}
		}
		
		name = FUKAKUSA
		
		set_name = Fukakusa
		
		set_character_flag = emperor_fukakusa_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_fukakusa_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_fukakusa # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_fukakusa_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_fukakusa_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
		clr_character_flag = emperor_of_japan_namelist_11
		clr_character_flag = emperor_of_japan_namelist_12
		clr_character_flag = emperor_of_japan_namelist_13
		clr_character_flag = emperor_of_japan_namelist_14
		clr_character_flag = emperor_of_japan_namelist_15
		clr_character_flag = emperor_of_japan_namelist_16
		clr_character_flag = emperor_of_japan_namelist_17
		clr_character_flag = emperor_of_japan_namelist_18
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					has_character_flag = emperor_of_japan_namelist_18
					NOT = {
						has_character_flag = emperor_of_japan_namelist_19
					}
				}
				ai = yes
			}
		}
		
		name = KAMEYAMA
		
		set_name = Kameyeama
		
		set_character_flag = emperor_kameyama_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_kameyama_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_kameyama # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_kameyama_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_kameyama_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
		clr_character_flag = emperor_of_japan_namelist_11
		clr_character_flag = emperor_of_japan_namelist_12
		clr_character_flag = emperor_of_japan_namelist_13
		clr_character_flag = emperor_of_japan_namelist_14
		clr_character_flag = emperor_of_japan_namelist_15
		clr_character_flag = emperor_of_japan_namelist_16
		clr_character_flag = emperor_of_japan_namelist_17
		clr_character_flag = emperor_of_japan_namelist_18
	}
	
	# 20
	
	option = {
		trigger = {
			OR = {
				has_character_flag = emperor_of_japan_namelist_19
				ai = yes
			}
		}
		
		name = FUSHIMI
		
		set_name = Fushimi
		
		set_character_flag = emperor_fushimi_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_fushimi_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_fushimi # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_fushimi_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_fushimi_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
		clr_character_flag = emperor_of_japan_namelist_11
		clr_character_flag = emperor_of_japan_namelist_12
		clr_character_flag = emperor_of_japan_namelist_13
		clr_character_flag = emperor_of_japan_namelist_14
		clr_character_flag = emperor_of_japan_namelist_15
		clr_character_flag = emperor_of_japan_namelist_16
		clr_character_flag = emperor_of_japan_namelist_17
		clr_character_flag = emperor_of_japan_namelist_18
		clr_character_flag = emperor_of_japan_namelist_19
	}
	
	option = {
		trigger = {
			OR = {
				has_character_flag = emperor_of_japan_namelist_19
				ai = yes
			}
		}
		
		name = HANAZONO
		
		set_name = Hanazono
		
		set_character_flag = emperor_hanazono_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_hanazono_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_hanazono # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_hanazono_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_hanazono_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
		clr_character_flag = emperor_of_japan_namelist_11
		clr_character_flag = emperor_of_japan_namelist_12
		clr_character_flag = emperor_of_japan_namelist_13
		clr_character_flag = emperor_of_japan_namelist_14
		clr_character_flag = emperor_of_japan_namelist_15
		clr_character_flag = emperor_of_japan_namelist_16
		clr_character_flag = emperor_of_japan_namelist_17
		clr_character_flag = emperor_of_japan_namelist_18
		clr_character_flag = emperor_of_japan_namelist_19
	}
	
	option = {
		trigger = {
			OR = {
				has_character_flag = emperor_of_japan_namelist_19
				ai = yes
			}
		}
		
		name = KOGON
		
		set_name = Kogon
		
		set_character_flag = emperor_kogon_used
		
		k_chrysanthemum_throne = {
			set_title_flag = emperor_kogon_used
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				has_character_flag = emperor_kogon # Historical names are generally picked
			}
			modifier = {
				factor = 0.001
				has_character_flag = emperor_kogon_used # Pick a new regnal name, if possible
			}
			modifier = {
				factor = 10
				is_female = no # Favours same gender as historical emperors with that name
			}
			modifier = {
				factor = 0.1
				k_chrysanthemum_throne = {
					has_title_flag = emperor_kogon_used # Very few names reused historically
				}
			}
		}
		
		clr_character_flag = emperor_of_japan_namelist_1
		clr_character_flag = emperor_of_japan_namelist_2
		clr_character_flag = emperor_of_japan_namelist_3
		clr_character_flag = emperor_of_japan_namelist_4
		clr_character_flag = emperor_of_japan_namelist_5
		clr_character_flag = emperor_of_japan_namelist_6
		clr_character_flag = emperor_of_japan_namelist_7
		clr_character_flag = emperor_of_japan_namelist_8
		clr_character_flag = emperor_of_japan_namelist_9
		clr_character_flag = emperor_of_japan_namelist_10
		clr_character_flag = emperor_of_japan_namelist_11
		clr_character_flag = emperor_of_japan_namelist_12
		clr_character_flag = emperor_of_japan_namelist_13
		clr_character_flag = emperor_of_japan_namelist_14
		clr_character_flag = emperor_of_japan_namelist_15
		clr_character_flag = emperor_of_japan_namelist_16
		clr_character_flag = emperor_of_japan_namelist_17
		clr_character_flag = emperor_of_japan_namelist_18
		clr_character_flag = emperor_of_japan_namelist_19
	}
	
	# Repeat
	
	option = {
		trigger = {
			ai = no
		}
		
		name = EVTOPTA_JAPAN_1
		
		if = {
			limit = {
				has_character_flag = emperor_of_japan_namelist_19
			}
			clr_character_flag = emperor_of_japan_namelist_19
			clr_character_flag = emperor_of_japan_namelist_18
			clr_character_flag = emperor_of_japan_namelist_17
			clr_character_flag = emperor_of_japan_namelist_16
			clr_character_flag = emperor_of_japan_namelist_15
			clr_character_flag = emperor_of_japan_namelist_14
			clr_character_flag = emperor_of_japan_namelist_13
			clr_character_flag = emperor_of_japan_namelist_12
			clr_character_flag = emperor_of_japan_namelist_11
			clr_character_flag = emperor_of_japan_namelist_10
			clr_character_flag = emperor_of_japan_namelist_9
			clr_character_flag = emperor_of_japan_namelist_8
			clr_character_flag = emperor_of_japan_namelist_7
			clr_character_flag = emperor_of_japan_namelist_6
			clr_character_flag = emperor_of_japan_namelist_5
			clr_character_flag = emperor_of_japan_namelist_4
			clr_character_flag = emperor_of_japan_namelist_3
			clr_character_flag = emperor_of_japan_namelist_2
			clr_character_flag = emperor_of_japan_namelist_1
			repeat_event = { id = japan.1 }
		}
		else_if = {
			limit = {
				has_character_flag = emperor_of_japan_namelist_18
			}
			set_character_flag = emperor_of_japan_namelist_19
			repeat_event = { id = japan.1 }
		}
		else_if = {
			limit = {
				has_character_flag = emperor_of_japan_namelist_17
			}
			set_character_flag = emperor_of_japan_namelist_18
			repeat_event = { id = japan.1 }
		}
		else_if = {
			limit = {
				has_character_flag = emperor_of_japan_namelist_16
			}
			set_character_flag = emperor_of_japan_namelist_17
			repeat_event = { id = japan.1 }
		}
		else_if = {
			limit = {
				has_character_flag = emperor_of_japan_namelist_15
			}
			set_character_flag = emperor_of_japan_namelist_16
			repeat_event = { id = japan.1 }
		}
		else_if = {
			limit = {
				has_character_flag = emperor_of_japan_namelist_14
			}
			set_character_flag = emperor_of_japan_namelist_15
			repeat_event = { id = japan.1 }
		}
		else_if = {
			limit = {
				has_character_flag = emperor_of_japan_namelist_13
			}
			set_character_flag = emperor_of_japan_namelist_14
			repeat_event = { id = japan.1 }
		}
		else_if = {
			limit = {
				has_character_flag = emperor_of_japan_namelist_12
			}
			set_character_flag = emperor_of_japan_namelist_13
			repeat_event = { id = japan.1 }
		}
		else_if = {
			limit = {
				has_character_flag = emperor_of_japan_namelist_11
			}
			set_character_flag = emperor_of_japan_namelist_12
			repeat_event = { id = japan.1 }
		}
		else_if = {
			limit = {
				has_character_flag = emperor_of_japan_namelist_10
			}
			set_character_flag = emperor_of_japan_namelist_11
			repeat_event = { id = japan.1 }
		}
		else_if = {
			limit = {
				has_character_flag = emperor_of_japan_namelist_9
			}
			set_character_flag = emperor_of_japan_namelist_10
			repeat_event = { id = japan.1 }
		}
		else_if = {
			limit = {
				has_character_flag = emperor_of_japan_namelist_8
			}
			set_character_flag = emperor_of_japan_namelist_9
			repeat_event = { id = japan.1 }
		}
		else_if = {
			limit = {
				has_character_flag = emperor_of_japan_namelist_7
			}
			set_character_flag = emperor_of_japan_namelist_8
			repeat_event = { id = japan.1 }
		}
		else_if = {
			limit = {
				has_character_flag = emperor_of_japan_namelist_6
			}
			set_character_flag = emperor_of_japan_namelist_7
			repeat_event = { id = japan.1 }
		}
		else_if = {
			limit = {
				has_character_flag = emperor_of_japan_namelist_5
			}
			set_character_flag = emperor_of_japan_namelist_6
			repeat_event = { id = japan.1 }
		}
		else_if = {
			limit = {
				has_character_flag = emperor_of_japan_namelist_4
			}
			set_character_flag = emperor_of_japan_namelist_5
			repeat_event = { id = japan.1 }
		}
		else_if = {
			limit = {
				has_character_flag = emperor_of_japan_namelist_3
			}
			set_character_flag = emperor_of_japan_namelist_4
			repeat_event = { id = japan.1 }
		}
		else_if = {
			limit = {
				has_character_flag = emperor_of_japan_namelist_2
			}
			set_character_flag = emperor_of_japan_namelist_3
			repeat_event = { id = japan.1 }
		}
		else_if = {
			limit = {
				has_character_flag = emperor_of_japan_namelist_1
			}
			set_character_flag = emperor_of_japan_namelist_2
			repeat_event = { id = japan.1 }
		}
		else = {
			set_character_flag = emperor_of_japan_namelist_1
			repeat_event = { id = japan.1 }
		}
	}
}

# Buddhism appears from "nowhere"
province_event = {
	id = japan.2
	desc = EVTDESC_JAPAN_2
	picture = GFX_evt_burning_house
	border = GFX_event_normal_frame_religion
	
	trigger = {
		religion = shinto
	}
	
	mean_time_to_happen = {
		months = 1200
		modifier = {
			factor = 2.0
			religion_authority = 0.6
		}
		modifier = {
			factor = 2.0
			religion_authority = 0.8
		}
		modifier = {
			factor = 2
			has_game_rule = {
				name = religious_conversion
				value = slower
			}
		}
		modifier = {
			factor = 0.75
			NOT = { religion_authority = 0.2 }
		}
		modifier = {
			factor = 0.75
			NOT = { religion_authority = 0.4 }
		}
	}
	
	immediate = {
		religion = buddhist
		add_province_modifier = {
			name = religious_unrest
			duration = 730
		}
	}
	
	option = {
		name = {
			text = EVTOPTA_JAPAN_2
			trigger = {
				owner = {
					NOR = {
						religion = shinto
						religion = ROOT
					}
				}
			}
		}
		name = {
			text = EVTOPTB_JAPAN_2
			trigger = { owner = { religion = ROOT } }
		}
		name = {
			text = EVTOPTC_JAPAN_2
			trigger = { owner = { religion = shinto } }
		}
		if = {
			limit = { 
				ruler = { religion = shinto }
			}
			ruler = { piety = -10 }
		}
		# News spread
		hidden_tooltip = {
			owner = {
				top_liege = {
					if = {
						limit = {
							NOT = { character = PREV }
						}
						character_event = { id = japan.3 days = 2 }
					}
					any_vassal = {
						limit = {
							OR = {
								is_parent_religion = ROOT
								religion = ROOT
							}
						}
						character_event = { id = japan.3 days = 2 }
					}
				}
			}
		}
	}
}

# News spread in realm
character_event = {
	id = japan.3
	desc = EVTDESC_JAPAN_3
	picture = GFX_evt_heretic
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_3
		trigger = {
			NOR = {
				religion = shinto
				religion = FROM
			}
		}
	}
	option = {
		name = EVTOPTB_JAPAN_3
		trigger = {
			religion = FROM
		}
	}
	option = {
		name = EVTOPTC_JAPAN_3
		trigger = {
			religion = shinto
		}
	}
}

# Random religion appears from "nowehere"
province_event = {
	id = japan.4
	desc = EVTDESC_JAPAN_4
	picture = GFX_evt_burning_house
	border = GFX_event_normal_frame_religion
		
	trigger = {
		religion = shinto
		any_neighbor_province = {
			OR = {
				AND = {
					has_owner = yes
					NOR = {
						religion = shinto
						religion_group = pagan_group
						religion = jain # Shouldn't spread to silly places!
						religion = buddhist # Has its own event
					}
				}
				AND = {
					is_land = no
					any_neighbor_province = {
						OR = {
							AND = {
								has_owner = yes
								NOR = {
									religion = shinto
									religion_group = pagan_group
									religion = jain # Shouldn't spread to silly places!
									religion = buddhist # Has its own event
								}
							}
							AND = {
								is_land = no
								any_neighbor_province = {
									NOR = {
										religion = shinto
										religion_group = pagan_group
										religion = jain # Shouldn't spread to silly places!
										religion = buddhist # Has its own event
									}
								}
							}
						}
					}
				}
			}
		}
	}
	
	mean_time_to_happen = {
		months = 9600
		modifier = {
			factor = 2.0
			religion_authority = 0.6
		}
		modifier = {
			factor = 2.0
			religion_authority = 0.8
		}
		modifier = {
			factor = 2
			has_game_rule = {
				name = religious_conversion
				value = slower
			}
		}
		modifier = {
			factor = 0.75
			NOT = { religion_authority = 0.2 }
		}
		modifier = {
			factor = 0.75
			NOT = { religion_authority = 0.4 }
		}
	}
	
	immediate = {
		random_list = {
			34 = {
				modifier = {
					factor = 0
					NOT = {
						any_neighbor_province = {
							has_owner = yes
							NOR = {
								religion = shinto
								religion_group = pagan_group
								religion = jain # Shouldn't spread to silly places!
								religion = buddhist # Has its own event
							}
						}
					}
				}
				random_neighbor_province = {
					limit = {
						has_owner = yes
						NOR = {
							religion = shinto
							religion_group = pagan_group
							religion = jain # Shouldn't spread to silly places!
							religion = buddhist # Has its own event
						}
					}
					ROOT = {
						religion = PREV
					}
				}
			}
			33 = {
				modifier = {
					factor = 0
					NOT = {
						any_neighbor_province = {
							is_land = no
							any_neighbor_province = {
								has_owner = yes
								NOR = {
									religion = shinto
									religion_group = pagan_group
									religion = jain # Shouldn't spread to silly places!
									religion = buddhist # Has its own event
								}
							}
						}
					}
				}
				random_neighbor_province = {
					limit = {
						is_land = no
					}
					random_neighbor_province = {
						limit = {
							has_owner = yes
							NOR = {
								religion = shinto
								religion_group = pagan_group
								religion = jain # Shouldn't spread to silly places!
								religion = buddhist # Has its own event
							}
						}
						ROOT = {
							religion = PREV
						}
					}
				}
			}
			33 = {
				modifier = {
					factor = 0
					NOT = {
						any_neighbor_province = {
							is_land = no
							any_neighbor_province = {
								is_land = no
								any_neighbor_province = {
									has_owner = yes
									NOR = {
										religion = shinto
										religion_group = pagan_group
										religion = jain # Shouldn't spread to silly places!
										religion = buddhist # Has its own event
									}
								}
							}
						}
					}
				}
				random_neighbor_province = {
					limit = {
						is_land = no
					}
					random_neighbor_province = {
						limit = {
							is_land = no
						}
						random_neighbor_province = {
							limit = {
								has_owner = yes
								NOR = {
									religion = shinto
									religion_group = pagan_group
									religion = jain # Shouldn't spread to silly places!
									religion = buddhist # Has its own event
								}
							}
							ROOT = {
								religion = PREV
							}
						}
					}
				}
			}
		}
		add_province_modifier = {
			name = religious_unrest
			duration = 730
		}
	}
	
	option = {
		name = {
			text = EVTOPTA_JAPAN_4
			trigger = {
				owner = {
					NOR = {
						religion = shinto
						religion = ROOT
					}
				}
			}
		}
		name = {
			text = EVTOPTB_JAPAN_4
			trigger = { owner = { religion = ROOT } }
		}
		name = {
			text = EVTOPTC_JAPAN_4
			trigger = { owner = { religion = shinto } }
		}
		if = {
			limit = { 
				ruler = { religion = shinto }
			}
			ruler = { piety = -10 }
		}
		# News spread
		hidden_tooltip = {
			owner = {
				top_liege = {
					if = {
						limit = {
							NOT = { character = PREV }
						}
						character_event = { id = japan.5 days = 2 }
					}
					any_vassal = {
						limit = {
							OR = {
								is_parent_religion = ROOT
								religion = ROOT
							}
						}
						character_event = { id = japan.5 days = 2 }
					}
				}
			}
		}
	}
}

# News spread in realm
character_event = {
	id = japan.5
	desc = EVTDESC_JAPAN_5
	picture = GFX_evt_heretic
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_5
		trigger = {
			NOR = {
				religion = shinto
				religion = FROM
			}
		}
	}
	option = {
		name = EVTOPTB_JAPAN_5
		trigger = {
			religion = FROM
		}
	}
	option = {
		name = EVTOPTC_JAPAN_5
		trigger = {
			religion = shinto
		}
	}
}

# Actual on_action trigger for regnal names
character_event = {
	id = japan.6
	hide_window = yes
	is_triggered_only = yes
	
	only_playable = yes
	
	trigger = {
		FROM = {
			title = k_chrysanthemum_throne
		}
		NOT = {
			has_character_flag = temporarily_japanese_imperial
		}
	}
	
	immediate = {
		character_event = { id = japan.1 days = 1 }
	}
}

# Government warning - no longer used!
character_event = {
	id = japan.7
	is_triggered_only = yes
	picture = GFX_evt_china_golden_age # Needs better picture!
	desc = {
		trigger = {
			trait = japanese_feudal_trait
		}
		text = EVTDESCA_JAPAN_7
	}
	desc = {
		trigger = {
			trait = japanese_monastic_trait
		}
		text = EVTDESCB_JAPAN_7
	}
	
	ai = no
	
	trigger = {
		OR = {
			religion = shinto
			AND = {
				culture_group = japonic
				religion = buddhist
			}
		}
		controls_religion = no
		OR = {
			trait = japanese_feudal_trait
			trait = japanese_monastic_trait
		}
		NOT = {
			has_global_flag = japanese_government_warning_disbled
		}
		NOT = {
			has_character_flag = temporarily_japanese_imperial
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_7 # Ok
	}
	
	option = {
		name = EVTOPTB_JAPAN_7 # Don't tell me again
		set_global_flag = japanese_government_warning_disbled
	}
	
	option = {
		name = EVTOPTC_JAPAN_7 # Change my government type
		hidden_tooltip = {
			remove_trait = japanese_feudal_trait
			remove_trait = japanese_monastic_trait
		}
		set_government_type = chinese_vassal_government
		character_event = { id = japan.8 }
	}
}

# Government change
character_event = {
	id = japan.8
	hide_window = yes
	is_triggered_only = yes
	
	only_playable = yes
	
	trigger = {
		OR = {
			religion = shinto
			AND = {
				religion = buddhist
				culture_group = japonic
			}
		}
		controls_religion = no
		is_feudal = yes
		primary_title = {
			holy_order = no
		}
		NOT = {
			is_government_potential = chinese_imperial_government
		}
		NOT = {
			has_character_flag = temporarily_japanese_imperial
		}
	}
	
	immediate = {
		log = "Government change in Japan!"
		# Change government
		if = {
			limit = {
				trait = japanese_monastic_trait
			}
			set_government_type = japanese_monastic_feudal_government
		}
		else_if = {
			limit = {
				trait = japanese_feudal_trait
			}
			set_government_type = japanese_feudal_government
		}
		else = {
			set_government_type = chinese_vassal_government
		}
	}
}

# Inheritance of government trait
character_event = {
	id = japan.9
	hide_window = yes
	is_triggered_only = yes
	
	only_playable = yes
	
	trigger = {
		OR = {
			religion = shinto
			AND = {
				religion = buddhist
				culture_group = japonic
			}
		}
		controls_religion = no
		NOT = {
			has_character_flag = temporarily_japanese_imperial
		}
	}
	
	immediate = {
		log = "Government trait inheritance in Japan!"
		if = {
			limit = {
				primary_title = {
					is_vice_royalty = yes
				}
			}
			current_heir = {
				save_event_target_as = true_heir
			}
			log = "[Root.GetBestName]'s current heir is [true_heir.GetName]"
			any_demesne_title = {
				limit = {
					is_vice_royalty = yes
				}
				event_target:true_heir = {
					grant_title_no_opinion = {
						target = PREV
						type = inheritance
					}
				}
			}
			recalc_succession = yes
			log = "[Root.GetBestName]'s current heir is [true_heir.GetName]"
			current_heir = {
				save_event_target_as = true_heir
			}
		}
		else = {
			current_heir = {
				save_event_target_as = true_heir
			}
		}
		if = {
			limit = {
				event_target:true_heir = {
					AND = {
						OR = {
							religion = shinto
							AND = {
								religion = buddhist
								culture_group = japonic
							}
						}
						controls_religion = no
						NOT = {
							has_character_flag = temporarily_japanese_imperial
						}
					}
					NOR = {
						trait = japanese_feudal_trait
						trait = japanese_monastic_trait
					}
					NOT = {
						is_liege_or_above_of = ROOT
					}
					NOR = {
						government = chinese_imperial_government
						government = japanese_imperial_government
					}
				}
			}
			if = {
				limit = {
					trait = japanese_feudal_trait
				}
				event_target:true_heir = {
					add_trait = japanese_feudal_trait
				}
			}
			else_if = {
				limit = {
					trait = japanese_monastic_trait
				}
				event_target:true_heir = {
					add_trait = japanese_monastic_trait
				}
			}
		}
		
		if = {
			limit = {
				trait = japanese_regent
				event_target:true_heir = {
					NAND = {
						religion = shinto
						OR = {
							controls_religion = yes
							has_character_flag = temporarily_japanese_imperial
						}
					}
				}
			}
			event_target:true_heir = {
				add_trait = japanese_regent
				if = {
					limit = {
						liege = {
							religion = shinto
							OR = {
								controls_religion = yes
								has_character_flag = temporarily_japanese_imperial
							}
						}
						has_job_title = job_spymaster
					}
					remove_title = job_spymaster # It would cause issues for the player if the spymaster couldn't be swapped...
				}
			}
			log = "[true_heir.GetBestName] is now the regent!"
		}
	}
}

# Make sure that the Tenno never holds multiple empires - we don't want k_chrysanthemum_throne and e_japan to separate outside of a shogunate
character_event = {
	id = japan.10
	is_triggered_only = yes
	hide_window = yes
	
	religion = shinto
	
	only_playable = yes
	
	trigger = {
		OR = {
			controls_religion = yes
			has_character_flag = temporarily_japanese_imperial
		}
		FROM = {
			tier = emperor
		}
		NOT = {
			has_character_flag = restoring_japan
		}
		num_of_emperor_titles = 2
	}
	
	immediate = {
		if = {
			limit = {
				any_demesne_title = {
					title = e_japan
				}
			}
			any_demesne_title = {
				limit = {
					tier = emperor
					NOT = {
						title = e_japan
					}
				}
				unsafe_destroy_landed_title = THIS
			}
		}
		else = {
			primary_title = {
				set_title_flag = keep_this_title
			}
			any_demesne_title = {
				limit = {
					tier = emperor
					NOT = {
						has_title_flag = keep_this_title
					}
				}
				unsafe_destroy_landed_title = THIS
			}
			primary_title = {
				clr_title_flag = keep_this_title
			}
		}
	}
}

### Regency stuff

# on_startup regency setup
character_event = {
	id = japan.11
	hide_window = yes
	is_triggered_only = yes
	
	religion = shinto
	
	only_playable = yes
	
	trigger = {
		OR = {
			controls_religion = yes
			has_character_flag = temporarily_japanese_imperial
		}
		trait = under_regency
	}
	
	immediate = {
		log = "Setting up the Regent for [Root.GetBestName]!"
		random_vassal = {
			limit = {
				trait = japanese_regent
			}
			liege = {
				regent = {
					log = "[This.GetBestName] is the initial Regent!"
					remove_title = title_regent
				}
			}
			log = "[This.GetBestName] is the new Regent!"
			give_minor_title = title_regent
			give_minor_title = title_appointed_regent
		}
		primary_title = {
			save_event_target_as = regency_loyalist_title
		}
		regent = {
			if = {
				limit = {
					higher_tier_than = baron
				}
				start_faction = {
					faction = faction_regent_loyalists
					title = event_target:regency_loyalist_title
				}
				save_event_target_as = regent_to_be_loyal_to
				if = {
					limit = {
						NOT = {
							dynasty = ROOT
						}
					}
					any_dynasty_member = {
						limit = {
							is_landed = yes
							higher_tier_than = baron
							liege = {
								character = ROOT
							}
							NOT = {
								has_non_aggression_pact_with = ROOT
							}
						}
						join_faction = {
							faction = faction_regent_loyalists
							faction_leader = event_target:regent_to_be_loyal_to
							ignore_requirements = yes
						}
					}
				}
			}
		}
	}
}

# on_new_holder event making sure the under_regency trait is passed on properly
character_event = {
	id = japan.12
	hide_window = yes
	is_triggered_only = yes
	
	religion = shinto
	
	only_playable = yes
	
	trigger = {
		FROM = {
			title = k_chrysanthemum_throne
		}
		#has_global_flag = japanese_regency
	}
	
	immediate = {
		if = {
			limit = {
				FROMFROM = {
					trait = under_regency
				}
			}
			FROMFROM = {
				remove_trait = under_regency
			}
			add_trait = under_regency
		}
		if = {
			limit = {
				trait = under_regency2
			}
			remove_trait = under_regency2
			if = {
				limit = {
					any_vassal = {
						trait = japanese_regent2
					}
				}
				any_vassal = {
					limit = {
						trait = japanese_regent
					}
					remove_trait = japanese_regent
				}
				random_vassal = {
					limit = {
						trait = japanese_regent2
					}
					remove_trait = japanese_regent2
					add_trait = japanese_regent
					liege = {
						regent = {
							remove_title = title_regent
						}
					}
					give_minor_title = title_regent
					give_minor_title = title_appointed_regent
				}
			}
		}
	}
}

# on_yearly_pulse event clearing out the japanese_regent trait if we shouldn't have it
character_event = {
	id = japan.13
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		trait = japanese_regent
		NOR = {
			liege = {
				religion = shinto
				OR = {
					controls_religion = yes
					has_character_flag = temporarily_japanese_imperial
				}
			}
			top_liege = {
				liege_before_war = {
					religion = shinto
					OR = {
						controls_religion = yes
						has_character_flag = temporarily_japanese_imperial
					}
				}
			}
			liege_before_war = {
				religion = shinto
				OR = {
					controls_religion = yes
					has_character_flag = temporarily_japanese_imperial
				}
			}
		}
	}
	
	immediate = {
		remove_trait = japanese_regent
	}
}

# on_new_holder event making sure that we become the regent if we should be
character_event = {
	id = japan.14
	hide_window = yes
	is_triggered_only = yes
	
	only_playable = yes
	
	trigger = {
		trait = japanese_regent
		liege = {
			religion = shinto
			OR = {
				controls_religion = yes
				has_character_flag = temporarily_japanese_imperial
			}
		}
		FROMFROM = {
			is_alive = no
		}
		has_regent = no
	}
	
	immediate = {
		liege = {
			regent = {
				remove_title = title_regent
			}
		}
		give_minor_title = title_regent
		give_minor_title = title_appointed_regent
	}
}


# on_new_holder_usurpation event passing on the japanese_regent trait if the former character no longer should have it
character_event = {
	id = japan.15
	hide_window = yes
	is_triggered_only = yes
	
	only_playable = yes
	
	trigger = {
		FROMFROM = {
			trait = japanese_regent
			OR = {
				is_ruler = no
				NOR = {
					liege = {
						religion = shinto
						OR = {
							controls_religion = yes
							has_character_flag = temporarily_japanese_imperial
						}
					}
					top_liege = {
						liege_before_war = {
							religion = shinto
							OR = {
								controls_religion = yes
								has_character_flag = temporarily_japanese_imperial
							}
						}
					}
					liege_before_war = {
						religion = shinto
						OR = {
							controls_religion = yes
							has_character_flag = temporarily_japanese_imperial
						}
					}
				}
			}
		}
	}
	
	immediate = {
		FROMFROM = {
			remove_trait = japanese_regent
		}
		if = {
			limit = {
				NAND = {
					religion = shinto
					OR = {
						controls_religion = yes
						has_character_flag = temporarily_japanese_imperial
					}
				}
			}
			add_trait = japanese_regent
			liege = {
				regent = {
					remove_title = title_regent
				}
			}
			give_minor_title = title_regent
			give_minor_title = title_appointed_regent
			if = {
				limit = {
					liege = {
						religion = shinto
						OR = {
							controls_religion = yes
							has_character_flag = temporarily_japanese_imperial
						}
					}
					has_job_title = job_spymaster
				}
				remove_title = job_spymaster # It would cause issues for the player if the spymaster couldn't be swapped...
			}
		}
	}
}

# on_adulthood and on_yearly_pulse regent switching if necessary
character_event = {
	id = japan.16
	hide_window = yes
	is_triggered_only = yes
	
	only_playable = yes
	
	trigger = {
		trait = japanese_regent
		liege = {
			religion = shinto
			OR = {
				controls_religion = yes
				has_character_flag = temporarily_japanese_imperial
			}
		}
		liege = {
			has_actual_regency_trigger = yes
			regent = {
				NOT = {
					trait = japanese_regent
				}
			}
		}
		has_regent = no
	}
	
	immediate = {
		liege = {
			regent = {
				remove_title = title_regent
			}
		}
		give_minor_title = title_regent
		give_minor_title = title_appointed_regent
	}
}

# on_new_holder event clearing out the japanese_regent trait if you are the Tenno, since being your own regent is weird!
character_event = {
	id = japan.17
	hide_window = yes
	is_triggered_only = yes
	
	only_playable = yes
	
	trigger = {
		religion = shinto
		OR = {
			controls_religion = yes
			has_character_flag = temporarily_japanese_imperial
		}
	}
	
	immediate = {
		remove_trait = japanese_regent
	}
}

### Plot to end the regency (deprecated, but saved in case anything is of interest elsewhere)

# Ultimatum - end the regency
letter_event = {
	id = japan.18
	desc = EVTDESC_JAPAN_18
	
	is_triggered_only = yes
	
	immediate = {
		FROM = {
			any_plot_backer = {
				set_defacto_liege = FROM
				reverse_opinion = {
					who = ROOT
					modifier = opinion_seeks_to_overthrow_me
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_18 # I guess that's fair...
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0
				FROM = { NOT = { plot_power = 1.0 } }
			}				
			modifier = {
				factor = 1.25
				is_weak_trigger = yes
			}
			modifier = {
				factor = 1.25
				trait = craven
			}
			modifier = {
				factor = 1.25
				trait = humble
			}
			modifier = {
				factor = 1.25
				trait = kind
			}
			modifier = {
				factor = 1.25
				trait = charitable
			}
			modifier = {
				factor = 1.25
				trait = patient
			}
			modifier = {
				factor = 1.25
				trait = content
			}
			modifier = {
				factor = 0
				relative_power_to_liege = 1 # Given that the liege will lose levies, this should mean we'll win
			}
			modifier = {
				factor = 0.8
				relative_power_to_liege = 0.5 # An even fight
			}
		}
		hidden_tooltip = {
			FROM = {
				letter_event = { id = japan.19 }
				any_plot_backer = {
					letter_event = { id = japan.20 }
				}
			}
		}
		remove_trait = japanese_regent
		FROM = {
			remove_trait = under_regency
		}
	}
	option = {
		name = EVTOPTB_JAPAN_18
		ai_chance = {
			factor = 90
			modifier = {
				factor = 1.25
				is_strong_trigger = yes
			}
			modifier = {
				factor = 1.25
				trait = brave
			}
			modifier = {
				factor = 1.25
				trait = proud
			}
			modifier = {
				factor = 1.25
				trait = envious
			}
			modifier = {
				factor = 1.25
				trait = greedy
			}
			modifier = {
				factor = 1.25
				trait = wroth
			}
			modifier = {
				factor = 1.25
				trait = ambitious
			}
			modifier = {
				factor = 0.75
				FROM = { plot_power = 1.5 }
			}
			modifier = {
				factor = 0.5
				FROM = { plot_power = 2.0 }
			}
			modifier = {
				factor = 0.5
				FROM = { plot_power = 3.0 }
			}
			modifier = {
				factor = 0.5
				FROM = { plot_power = 4.0 }
			}
			# We don't have the numbers to win easily...
			modifier = {
				factor = 0.8
				NOT = {
					relative_power_to_liege = 0.4
				}
			}
			modifier = {
				factor = 0.8
				NOT = {
					relative_power_to_liege = 0.3
				}
			}
			modifier = {
				factor = 0.1
				NOT = {
					relative_power_to_liege = 0.2
				}
			}
			modifier = {
				factor = 0.1
				NOT = {
					relative_power_to_liege = 0.1
				}
			}
		}
		FROM = {
			remove_trait = under_regency
		}
		FROM = {
			letter_event = { id = japan.21 }
			any_plot_backer = {
				letter_event = { id = japan.22 }
			}
		}
	}
}

# Demand accepted - end the regency
letter_event = {
	id = japan.19
	desc = EVTDESC_JAPAN_19
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_19 # Assuming direct control!
	}	
}

# Inform backers that the demand was accepted - end the regency
letter_event = {
	id = japan.20
	desc = EVTDESC_JAPAN_20
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_20 # Good to hear!
	}
}

# Demand refused - start the war
letter_event = {
	id = japan.21
	desc = EVTDESC_JAPAN_21
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_21 # Then face me in battle!
		FROM = {
			reverse_war = {
				target = ROOT
				casus_belli = end_regency_war
				plot_backers = yes
			}
		}
	}
}

# Demand refused - backers
letter_event = {
	id = japan.22
	desc = EVTDESC_JAPAN_22
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_22 # Let's hope FROMFROM prevails!
	}
}

# Check to see troop ratio and maybe fire the plot - needs to happen as an event because the plot is weird
letter_event = {
	id = japan.23
	desc = EVTDESC_JAPAN_23
	
	is_triggered_only = yes
	
#	immediate = {
#		export_to_variable = {
#			which = levy_comparison_variable
#			value = realm_levies
#		}
#		set_variable = {
#			which = current_realm_levies
#			which = levy_comparison_variable
#		}
#		regent = {
#			ROOT = {
#				export_to_variable = {
#					which = regent_levies
#					value = realm_levies
#					who = PREV
#				}
#				export_to_variable = {
#					which = regent_power_comparison
#					value = relative_power_to_liege
#					who = PREV
#				}
#			}
#		}
#		set_variable = {
#			which = regent_levies_with_backers
#			which = regent_levies
#		}
#		multiply_variable = {
#			which = regent_power_comparison
#			value = 100
#		}
#		
#		set_variable = {
#			which = plotter_levies
#			value = 0
#		}
#		any_plot_backer = {
#			limit = {
#				ROOT = {
#					regent = {
#						any_vassal = {
#							character = PREVPREV
#						}
#					}
#				}
#			}
#			export_to_variable = {
#				which = plotter_levies
#				value = realm_levies
#			}
#			ROOT = {
#				change_variable = {
#					which = plotter_levies
#					value = plotter_levies
#					who = PREV
#				}
#			}
#		}
#		subtract_variable = {
#			which = regent_levies
#			which = plotter_levies
#		}
#		subtract_variable = {
#			which = levy_comparison_variable
#			which = regent_levies
#		}
#		divide_variable = {
#			which = levy_comparison_variable
#			which = regent_levies
#		}
#	}
	
	option = {
		name = EVTOPTA_JAPAN_23 # This is the time!
		
		plot_target_char = {
			letter_event = { id = japan.18 }
		}
		hidden_tooltip = {
			set_character_flag = plot_overthrow_my_regent_taken
			activate_plot = yes
		}
		
#		ai_chance = {
#			factor = 1
#			modifier = {
#				factor = 0
#				NOR = {
#					check_variable = {
#						which = levy_comparison_variable
#						value = 1
#					}
#					NOT = {
#						regent = {
#							relative_power_to_liege = 0.5
#						}
#					}
#				}
#			}
#			modifier = {
#				factor = 0
#				trait = craven
#				NOR = {
#					check_variable = {
#						which = levy_comparison_variable
#						value = 2
#					}
#					NOT = {
#						regent = {
#							relative_power_to_liege = 0.25
#						}
#					}
#				}
#			}
#		}
	}
	option = {
		name = EVTOPTB_JAPAN_23 # I need to wait...
		
#		ai_chance = {
#			factor = 1
#			modifier = {
#				factor = 0
#				NOT = {
#					trait = craven
#				}
#				check_variable = {
#					which = levy_comparison_variable
#					value = 1
#				}
#			}
#			modifier = {
#				factor = 0
#				check_variable = {
#					which = levy_comparison_variable
#					value = 2
#				}
#			}
#		}
	}
}

### Ask the regent to step aside (no plot)

# Regent asked nicely
letter_event = {
	id = japan.24
	desc = EVTDESC_JAPAN_24
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_24 # Sure!
		
		remove_trait = japanese_regent
		FROM = {
			remove_trait = under_regency
			letter_event = { id = japan.25 } # Inform FROM
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				NOR = {
					dynasty = FROM
					any_friend = {
						character = FROM
					}
					any_lover = {
						character = FROM
					}
					opinion = {
						who = FROM
						value = 50
					}
					AND = {
						opinion = {
							who = FROM
							value = 25
						}
						OR = {
							trait = kind
							trait = content
							trait = humble
						}
					}
				}
			}
			modifier = {
				factor = 0
				OR = {
					trait = ambitious
					trait = envious
					trait = proud
				}
			}
			modifier = {
				factor = 2
				trait = slothful
			}
			modifier = {
				factor = 5
				is_dumb_trigger = yes
			}
			modifier = {
				factor = 0
				FROM = {
					primary_title = {
						has_law = regent_succession_control_1
					}
				}
			}
			modifier = {
				factor = 0
				in_faction = faction_regent_loyalists
				faction_power = {
					faction = faction_regent_loyalists
					power >= 5
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_24 # Not happening!
		
		FROM = {
			letter_event = { id = japan.26 } # Inform FROM
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				OR = {
					dynasty = FROM
					any_friend = {
						character = FROM
					}
					any_lover = {
						character = FROM
					}
					opinion = {
						who = FROM
						value = 50
					}
					AND = {
						opinion = {
							who = FROM
							value = 25
						}
						OR = {
							trait = kind
							trait = content
							trait = humble
						}
					}
				}
				NOR = {
					trait = ambitious
					trait = envious
					trait = proud
				}
			}
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 10
				is_smart_trigger = yes
			}
			modifier = {
				factor = 2
				FROM = {
					primary_title = {
						has_law = regent_marriage_control_1
					}
				}
			}
			modifier = {
				factor = 2
				FROM = {
					primary_title = {
						has_law = regent_vassal_control_1
					}
				}
			}
			modifier = {
				factor = 2
				FROM = {
					primary_title = {
						has_law = regent_prisoner_control_1
					}
				}
			}
			modifier = {
				factor = 2
				FROM = {
					primary_title = {
						has_law = regent_treasury_control_1
					}
				}
			}
			modifier = {
				factor = 2
				FROM = {
					primary_title = {
						has_law = regent_execution_control_1
					}
				}
			}
			modifier = {
				factor = 2
				FROM = {
					primary_title = {
						has_law = regent_title_control_1
					}
				}
			}
			modifier = {
				factor = 2
				in_faction = faction_regent_loyalists
				faction_power = {
					faction = faction_regent_loyalists
					power >= 1
				}
			}
			modifier = {
				factor = 2
				in_faction = faction_regent_loyalists
				faction_power = {
					faction = faction_regent_loyalists
					power >= 2
				}
			}
			modifier = {
				factor = 2
				any_owned_bloodline = {
					has_bloodline_flag = regency_bloodline
				}
			}
		}
	}
}

# Reply positive
letter_event = {
	id = japan.25
	desc = EVTDESC_JAPAN_25
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_25 # Good to hear!
	}
}

# Reply negative
letter_event = {
	id = japan.26
	desc = EVTDESC_JAPAN_26
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_26 # Curses!
	}
}

### Ask nicely to become the regent

# Liege asked nicely
letter_event = {
	id = japan.27
	desc = EVTDESC_JAPAN_27
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_27 # Sure!
		
		add_trait = under_regency
		regency_setup_nice_effect = yes
		FROM = {
			add_trait = japanese_regent
			liege = {
				regent = {
					remove_title = title_regent
				}
			}
			give_minor_title = title_regent
			give_minor_title = title_appointed_regent
			if = {
				limit = {
					has_job_title = job_spymaster
				}
				remove_title = job_spymaster # It would cause issues for the player if the spymaster couldn't be swapped...
			}
			letter_event = { id = japan.28 } # Inform FROM
		}
		
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0
				NOR = {
					dynasty = FROM
					any_friend = {
						character = FROM
					}
					any_lover = {
						character = FROM
					}
					opinion = {
						who = FROM
						value = 50
					}
					AND = {
						opinion = {
							who = FROM
							value = 25
						}
						OR = {
							trait = kind
							trait = content
							trait = humble
						}
					}
					AND = {
						opinion = {
							who = FROM
							value = 25
						}
						FROM = {
							any_owned_bloodline = {
								has_bloodline_flag = regency_bloodline
								bloodline_is_active_for = PREV
							}
						}
					}
				}
			}
			modifier = {
				factor = 0
				OR = {
					trait = ambitious
					trait = envious
					trait = proud
				}
			}
			modifier = {
				factor = 2
				trait = slothful
			}
			modifier = {
				factor = 5
				is_dumb_trigger = yes
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_27 # Not happening!
		
		FROM = {
			letter_event = { id = japan.29 } # Inform FROM
		}
		
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0.1
				OR = {
					dynasty = FROM
					any_friend = {
						character = FROM
					}
					any_lover = {
						character = FROM
					}
					opinion = {
						who = FROM
						value = 50
					}
					AND = {
						opinion = {
							who = FROM
							value = 25
						}
						OR = {
							trait = kind
							trait = content
							trait = humble
						}
					}
					AND = {
						opinion = {
							who = FROM
							value = 25
						}
						FROM = {
							any_owned_bloodline = {
								has_bloodline_flag = regency_bloodline
								bloodline_is_active_for = PREV
							}
						}
					}
				}
				NOR = {
					trait = ambitious
					trait = envious
					trait = proud
				}
			}
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 10
				is_smart_trigger = yes
			}
		}
	}
}

# Reply positive
letter_event = {
	id = japan.28
	desc = EVTDESC_JAPAN_28
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_28 # Good to hear!
	}
}

# Reply negative
letter_event = {
	id = japan.29
	desc = EVTDESC_JAPAN_29
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_29 # Curses!
	}
}

### Plot to become permanent regent fires

# Inform the liege
letter_event = {
	id = japan.30
	desc = EVTDESC_JAPAN_30
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_30 # I can't do anything about this...
		regency_setup_not_nice_effect = yes
		
		if = {
			limit = {
				FROM = {
					has_dlc = "Jade Dragon"
					is_chinese_emperor_trigger = no
				}
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
				}
			}
			else_if = {
				limit = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_major_effect = yes
				}
			}
		}
		
		add_trait = under_regency
		FROM = {
			add_trait = japanese_regent
			liege = {
				regent = {
					remove_title = title_regent
				}
			}
			give_minor_title = title_regent
			give_minor_title = title_appointed_regent
			if = {
				limit = {
					has_job_title = job_spymaster
				}
				remove_title = job_spymaster # It would cause issues for the player if the spymaster couldn't be swapped...
			}
		}
	}
}

# Inform co-conspirators
letter_event = {
	id = japan.31
	desc = EVTDESC_JAPAN_31
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_31 # Good to hear!
		opinion = {
			modifier = opinion_supported_as_regent
			who = FROM
			years = 10
		}
	}
}

# Inform all vassals
letter_event = {
	id = japan.32
	desc = EVTDESC_JAPAN_32
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_32 # I see...
	}
}

### Regency faction

# Liege gets ultimatum
letter_event = {
	id = japan.33
	desc = EVTDESC_JAPAN_33
	
	is_triggered_only = yes
	
	trigger = {
		FROM = { in_faction = faction_regent }
	}
	
	immediate = {
		FROM = { 
			diplomatic_immunity = yes 
			any_faction_backer = {
				faction = faction_regent
				diplomatic_immunity = yes
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_33 # I suppose I have to accept this...
		regency_setup_not_nice_effect = yes
		
		if = {
			limit = {
				has_dlc = "Jade Dragon"
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
					any_faction_backer = {
						faction = faction_regent
						detract_grace_super_huge_effect = yes
					}
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
					any_faction_backer = {
						faction = faction_regent
						detract_grace_massive_effect = yes
					}
				}
			}
			else_if = {
				limit = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_major_effect = yes
					any_faction_backer = {
						faction = faction_regent
						detract_grace_major_effect = yes
					}
				}
			}
		}
		ai_chance = {
			factor = 5
			modifier = {
				factor = 0			
				NOT = {
					FROM = {
						faction_power = {
							faction = faction_regent
							power = 1.0
						}
					}
				}
			}		
			modifier = {
				factor = 1.25
				is_weak_trigger = yes
			}
			modifier = {
				factor = 1.25
				trait = craven
			}
			modifier = {
				factor = 1.25
				trait = humble
			}
			modifier = {
				factor = 1.25
				trait = kind
			}
			modifier = {
				factor = 1.25
				trait = charitable
			}
			modifier = {
				factor = 1.25
				trait = patient
			}
			modifier = {
				factor = 1.25
				trait = content
			}
		}
		
		add_trait = under_regency
		FROM = {
			add_trait = japanese_regent
			liege = {
				regent = {
					remove_title = title_regent
				}
			}
			give_minor_title = title_regent
			give_minor_title = title_appointed_regent
			if = {
				limit = {
					has_job_title = job_spymaster
				}
				remove_title = job_spymaster # It would cause issues for the player if the spymaster couldn't be swapped...
			}
		}
		
		hidden_tooltip = {
			FROM = {
				any_faction_backer = {
					faction = faction_regent
					letter_event = { id = japan.34 }
					diplomatic_immunity = no
				}
				letter_event = { id = japan.35 }
				diplomatic_immunity = no
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_33 # Never!
		if = {
			limit = {
				has_dlc = "Jade Dragon"
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
					any_faction_backer = {
						faction = faction_regent
						detract_grace_super_huge_effect = yes
					}
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
					any_faction_backer = {
						faction = faction_regent
						detract_grace_massive_effect = yes
					}
				}
			}
			else_if = {
				limit = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_major_effect = yes
					any_faction_backer = {
						faction = faction_regent
						detract_grace_major_effect = yes
					}
				}
			}
		}
		ai_chance = {
			factor = 95
			modifier = {
				factor = 1.25
				is_strong_trigger = yes
			}
			modifier = {
				factor = 1.25
				trait = brave
			}
			modifier = {
				factor = 1.25
				trait = proud
			}
			modifier = {
				factor = 1.25
				trait = envious
			}
			modifier = {
				factor = 1.25
				trait = greedy
			}
			modifier = {
				factor = 1.25
				trait = wroth
			}
			modifier = {
				factor = 1.25
				trait = ambitious
			}
			modifier = {
				factor = 0.75
				FROM = {
					faction_power = {
						faction = faction_regent
						power = 1.5
					}
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					faction_power = {
						faction = faction_regent
						power = 1.0
					}
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					faction_power = {
						faction = faction_regent
						power = 2.0
					}
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					faction_power = {
						faction = faction_regent
						power = 3.0
					}
				}
			}	
			modifier = {
				factor = 0.5
				FROM = {
					faction_power = {
						faction = faction_regent
						power = 4.0
					}
				}
			}
		}
		hidden_tooltip = {
			if = {
				limit = {
					FROM = { faction_power = { faction = faction_regent power = 1.0 } }
				}
				random = {
					chance = 25
					character_event = { id = 45002 days = 120 } # Loyalists flock to the liege's banner
				}
			}
		}
		FROM = {
			letter_event = { id = japan.36 }
			hidden_tooltip = {
				if = {
					limit = {
						NOT = { faction_power = { faction = faction_regent power = 0.75 } }
					}
					random_list = {
						50 = {
						}
						30 = {
							character_event = { id = 45000 days = 17 } # A great number of rebels flock to the revolter's banner
						}
						20 = {
							character_event = { id = 45004 days = 17 } # Rebels flock to the revolter's banner
						}
					}
				}
				if = {
					limit = {
						faction_power = { faction = faction_regent power = 0.75 }
						NOT = { faction_power = { faction = faction_regent power = 1.5 } }
					}
					random_list = {
						75 = {
						}
						5 = {
							character_event = { id = 45000 days = 17 } # A great number of rebels flock to the revolter's banner
						}
						20 = {
							character_event = { id = 45004 days = 17 } # Rebels flock to the revolter's banner
						}
					}
				}
			}
		}
	}
}

# Faction members are informed that the liege folded
letter_event = {
	id = japan.34
	desc = EVTDESC_JAPAN_34
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_34 # Good to hear!
		opinion = {
			modifier = opinion_supported_as_regent
			who = FROMFROM
			years = 10
		}
	}
}

# The regent is informed that the liege folded
letter_event = {
	id = japan.35
	desc = EVTDESC_JAPAN_35
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_35 # Assuming indirect control!
		if = {
			limit = {
				NOT = {
					any_owned_bloodline = {
						has_bloodline_flag = regency_bloodline
						bloodline_is_active_for = ROOT
					}
				}
			}
			if = {
				limit = {
					is_female = no
				}
				create_bloodline = {
					type = regency_bloodline
				}
			}
			else = {
				create_bloodline = {
					type = regency_bloodline
					inheritance = matrilineal
				}
			}
		}
	}
}

# The prospective regent is informed that the liege isn't folding
letter_event = {
	id = japan.36
	desc = EVTDESC_JAPAN_36
	
	is_triggered_only = yes
	
	immediate = {
		any_faction_backer = {
			faction = faction_regent
			reverse_opinion = {
				modifier = opinion_fought_for_regent
				who = ROOT
				years = 20
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_36 # Then war it is!
		
		faction_regent = { # The target (title) of the faction
			reverse_war = {
				target = ROOT
				casus_belli = regency_faction_war
				faction = faction_regent
			}
		}
		clr_character_flag = faction_regent_ultimatum_taken
	}
}

### Plot to replace the regent

# Target informed
letter_event = {
	id = japan.37
	desc = EVTDESC_JAPAN_37
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_37 # Curses!
		FROM = {
			add_trait = japanese_regent
			liege = {
				regent = {
					remove_title = title_regent
				}
			}
			give_minor_title = title_regent
			give_minor_title = title_appointed_regent
			if = {
				limit = {
					has_job_title = job_spymaster
				}
				remove_title = job_spymaster # It would cause issues for the player if the spymaster couldn't be swapped...
			}
		}
		opinion = {
			who = FROM
			modifier = opinion_stole_the_regency
		}
		remove_trait = japanese_regent
		
		if = {
			limit = {
				FROM = {
					has_dlc = "Jade Dragon"
					is_chinese_emperor_trigger = no
				}
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
				}
			}
			else_if = {
				limit = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_major_effect = yes
				}
			}
		}
	}
}

# Backers informed
letter_event = {
	id = japan.38
	desc = EVTDESC_JAPAN_38
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_38 # Good to hear!
		opinion = {
			modifier = opinion_supported_as_regent
			who = FROM
			years = 10
		}
	}
}

# Liege informed
letter_event = {
	id = japan.39
	desc = EVTDESC_JAPAN_39
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_39 # I see...
	}
}

### Special regent decisions

# Transfer vassal - liege
letter_event = {
	id = japan.40
	desc = EVTDESC_JAPAN_40
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_40 # I can't oppose this...
		
		if = {
			limit = {
				FROM = {
					has_dlc = "Jade Dragon"
					is_chinese_emperor_trigger = no
				}
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_major_effect = yes
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_medium_effect = yes
				}
			}
			else_if = {
				limit = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_minor_effect = yes
				}
			}
		}
		
		opinion = {
			who = FROMFROM
			modifier = took_a_vassal
		}
	}
}

# Transfer vassal - vassal
letter_event = {
	id = japan.41
	desc = EVTDESC_JAPAN_41
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			FROMFROM = {
				NOR = {
					root_has_imprisonment_reason_opinion_trigger = yes
					any_rival = {
						character = ROOT
					}
				}
			}
		}
		name = EVTOPTA_JAPAN_41 # I suppose that happened...
	}
	
	option = {
		trigger = {
			FROMFROM = {
				OR = {
					root_has_imprisonment_reason_opinion_trigger = yes
					any_rival = {
						character = ROOT
					}
				}
			}
		}
		name = EVTOPTB_JAPAN_41 # I have a bad feeling about this
	}
}

# Change liege's spouse
letter_event = {
	id = japan.42
	desc = EVTDESC_JAPAN_42
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	immediate = {
		spouse = {
			save_event_target_as = old_spouse
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_42 # I can't oppose this...
		if = {
			limit = {
				FROM = {
					has_dlc = "Jade Dragon"
					is_chinese_emperor_trigger = no
				}
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_major_effect = yes
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_medium_effect = yes
				}
			}
			else_if = {
				limit = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_minor_effect = yes
				}
			}
		}
		
		opinion = {
			who = FROMFROM
			modifier = changed_my_spouse
		}
		remove_spouse = event_target:old_spouse
		add_consort = event_target:old_spouse
		add_spouse = FROMFROMFROM
	}
}

# Take liege's title
letter_event = {
	id = japan.43
	desc = EVTDESC_JAPAN_43
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_43 # I can't oppose this...
		if = {
			limit = {
				FROM = {
					has_dlc = "Jade Dragon"
					is_chinese_emperor_trigger = no
				}
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_major_effect = yes
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_medium_effect = yes
				}
			}
			else_if = {
				limit = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_minor_effect = yes
				}
			}
		}
		
		opinion = {
			who = FROMFROM
			modifier = took_a_title
		}
		FROM = {
			add_weak_pressed_claim = ROOT
		}
	}
}

### Shogunate factions

# Ultimatum - become Shogun
letter_event = {
	id = japan.44
	desc = EVTDESC_JAPAN_44
	
	is_triggered_only = yes
	
	trigger = {
		FROM = { in_faction = faction_shogun }
	}
	
	immediate = {
		FROM = { 
			diplomatic_immunity = yes 
			any_faction_backer = {
				faction = faction_shogun
				diplomatic_immunity = yes
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_44 # I suppose I can't refuse...
		set_global_flag = first_shogunate
		if = {
			limit = {
				has_dlc = "Jade Dragon"
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
					any_faction_backer = {
						faction = faction_shogun
						detract_grace_super_huge_effect = yes
					}
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
					any_faction_backer = {
						faction = faction_shogun
						detract_grace_massive_effect = yes
					}
				}
			}
			else_if = {
				limit = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_major_effect = yes
					any_faction_backer = {
						faction = faction_shogun
						detract_grace_major_effect = yes
					}
				}
			}
		}
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0	
				NOT = {
					FROM = {
						faction_power = 
						{
							faction = faction_shogun
							power = 1.0
						}
					}
				}
			}			
			modifier = {
				factor = 1.25
				is_weak_trigger = yes
			}
			modifier = {
				factor = 1.25
				trait = craven
			}
			modifier = {
				factor = 1.25
				trait = humble
			}
			modifier = {
				factor = 1.25
				trait = kind
			}
			modifier = {
				factor = 1.25
				trait = charitable
			}
			modifier = {
				factor = 1.25
				trait = patient
			}
			modifier = {
				factor = 1.25
				trait = content
			}
		}
		
		hidden_tooltip = {
			any_vassal = {
				limit = {
					ai = no
					NOT = { in_faction = faction_shogun }
				}
				character_event = { id = japan.46 }
			}
			FROM = {
				letter_event = { id = japan.47 }
				any_faction_backer = {
					faction = faction_shogun
					letter_event = { id = japan.45 }
					diplomatic_immunity = no
				}
				diplomatic_immunity = no
			}
		}
		avoid_chrysanthemum_throne_usurpation_effect = yes
		FROM = {
			if = { # No usurping the Tenno!
				limit = {
					has_claim = k_chrysanthemum_throne
				}
				remove_claim = k_chrysanthemum_throne
			}
			# Usurp title
			faction_shogun = { # The target (title) of the faction
				holder_scope = {
					FROM = {
						usurp_title = {
							target = PREVPREV
							type = faction_demand
						}
					}
				}
				# Transfer all vassals that aren't the Regent or the Tenno's relatives
				ROOT = {
					# If the Regent ended up under the Shogun due to being a king, fix that
					if = {
						limit = {
							any_vassal = {
								tier = king
								trait = japanese_regent
							}
						}
						any_vassal = {
							limit = {
								tier = king
								trait = japanese_regent
							}
							any_demesne_title = {
								limit = {
									tier = king
									NOT = {
										title = k_chrysanthemum_throne # To prevent weirdness
									}
								}
								unsafe_destroy_landed_title = THIS
								add_pressed_claim = PREV # The Regent might prefer to regain the title even if it means not being the Regent...
							}
						}
					}
					any_vassal = {
						limit = {
							higher_tier_than = baron
							NOR = {
								trait = japanese_regent
								dynasty = ROOT
							}
						}
						set_defacto_liege = FROM
					}
				}
				
				# Set the proper laws
				if = {
					limit = {
						has_dlc = "Zeus"
					}
					add_law_w_cooldown = ze_administration_laws_1 # Late Feudal
					add_law_w_cooldown = out_of_realm_inheritance_law_1 # No external inheritance (should already be in place, but...)
					add_law_w_cooldown = vassal_wars_law_0 # Unrestricted vassal wars
					succession = primogeniture # You get a get-out-of-Gavelkind/-Elective free card!
				}
				else = {
					add_law_w_cooldown = crown_authority_1 # Unrestricted vassal wars; unfortunately, this won't give the rest of the necessary laws
					add_law_w_cooldown = feudal_administration
				}
				if = {
					limit = {
						has_dlc = "Charlemagne"
					}
					add_law_w_cooldown = vice_royalty_0
				}
				# Make FROM Japanese Feudal, if possible
				if = {
					limit = {
						FROM = {
							NOR = {
								trait = japanese_monastic_trait
								has_character_flag = restore_japanese_monastic_feudal
							}
						}
					}
					FROM = {
						add_trait = japanese_feudal_trait
						set_government_type = japanese_feudal_government
					}
				}
				# Destroy kingdoms held by the Tenno that aren't k_chrysanthemum_throne
				ROOT = {
					any_demesne_title = {
						limit = {
							tier = king
							NOT = {
								title = k_chrysanthemum_throne
							}
						}
						unsafe_destroy_landed_title = THIS
						add_pressed_claim = PREV
					}
				}
			}
		}
		restore_chrysanthemum_throne_and_regent_effect = yes
		set_defacto_liege = FROM
	}
	option = {
		name = EVTOPTB_JAPAN_44 # Never!
		if = {
			limit = {
				has_dlc = "Jade Dragon"
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
					any_faction_backer = {
						faction = faction_shogun
						detract_grace_super_huge_effect = yes
					}
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
					any_faction_backer = {
						faction = faction_shogun
						detract_grace_massive_effect = yes
					}
				}
			}
			else_if = {
				limit = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_major_effect = yes
					any_faction_backer = {
						faction = faction_shogun
						detract_grace_major_effect = yes
					}
				}
			}
		}
		ai_chance = {
			factor = 90
			modifier = {
				factor = 1.25
				is_strong_trigger = yes
			}
			modifier = {
				factor = 1.25
				trait = brave
			}
			modifier = {
				factor = 1.25
				trait = proud
			}
			modifier = {
				factor = 1.25
				trait = envious
			}
			modifier = {
				factor = 1.25
				trait = greedy
			}
			modifier = {
				factor = 1.25
				trait = wroth
			}
			modifier = {
				factor = 1.25
				trait = ambitious
			}
			modifier = {
				factor = 1.25
				trait = stubborn
			}
			modifier = {
				factor = 0.75
				FROM = {
					faction_power = 
					{
						faction = faction_shogun
						power = 1.5
					}
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					faction_power = 
					{
						faction = faction_shogun
						power = 1.0
					}
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					faction_power = 
					{
						faction = faction_shogun
						power = 2.0
					}
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					faction_power = 
					{
						faction = faction_shogun
						power = 3.0
					}
				}
			}	
			modifier = {
				factor = 0.5
				FROM = {
					faction_power = 
					{
						faction = faction_shogun
						power = 4.0
					}
				}
			}	
		}
		hidden_tooltip = {
			if = {
				limit = {
					FROM = { faction_power = { faction = faction_shogun power = 1.0 } }
				}
				random = {
					chance = 25
					character_event = { id = 45002 days = 120 } # Loyalists flock to the liege's banner
				}
			}
		}
		FROM = {
			letter_event = { id = japan.48 days = 3 tooltip = "EVTTOOLTIP8100" }
			tooltip = {
				any_faction_backer = {
					faction = faction_shogun
				}
			}
			hidden_tooltip = {
				if = {
					limit = {
						NOT = { faction_power = { faction = faction_shogun power = 0.75 } }
					}
					random_list = {
						50 = {
						}
						30 = {
							character_event = { id = 45000 days = 17 } # A great number of rebels flock to the revolter's banner
						}
						20 = {
							character_event = { id = 45004 days = 17 } # Rebels flock to the revolter's banner
						}
					}
				}
				if = {
					limit = {
						faction_power = { faction = faction_shogun power = 0.75 }
						NOT = { faction_power = { faction = faction_shogun power = 1.5 } }
					}
					random_list = {
						75 = {
						}
						5 = {
							character_event = { id = 45000 days = 17 } # A great number of rebels flock to the revolter's banner
						}
						20 = {
							character_event = { id = 45004 days = 17 } # Rebels flock to the revolter's banner
						}
					}
				}
			}
		}
	}
}

# Inform faction backer - Become Shogun
letter_event = {
	id = japan.45
	desc = EVTDESC_JAPAN_45
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = "GOOD"
		reverse_opinion = {
			modifier = opinion_grateful
			who = FROMFROM
			years = 5
		}
		opinion = {
			modifier = opinion_installed_as_shogun
			who = FROMFROM
			years = 10
		}
		add_character_modifier = {
			name = faction_shogun_timer
			hidden = yes
			duration = 3650
		}
	}
}

# Inform other vassals - Become Shogun
character_event = {
	id = japan.46
	desc = EVTDESC_JAPAN_46
	
	notification = yes
	
	picture = GFX_evt_council
	border = GFX_event_normal_frame_intrigue
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = "I_SEE"
	}
}

# Demand accepted - Become Shogun
letter_event = {
	id = japan.47
	desc = EVTDESC_JAPAN_47
	
	is_triggered_only = yes
	
	option = {
		name = "EXCELLENT"
		clr_character_flag = faction_shogun_ultimatum_taken
		
		add_character_modifier = {
			name = faction_shogun_timer
			hidden = yes
			duration = 3650
		}
		
		if = {
			limit = {
				NOT = {
					any_owned_bloodline = {
						has_bloodline_flag = shogunate_bloodline
						bloodline_is_active_for = ROOT
					}
				}
			}
			if = {
				limit = {
					is_female = no
				}
				create_bloodline = {
					type = shogunate_bloodline
				}
			}
			else = {
				create_bloodline = {
					type = shogunate_bloodline
					inheritance = matrilineal
				}
			}
		}
	}
}

# Demand rejected - Become Shogun
letter_event = {
	id = japan.48
	desc = EVTDESC_JAPAN_48
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTA8100"
		
		clr_character_flag = faction_shogun_ultimatum_taken
		
		faction_shogun = { # The target (title) of the faction
			reverse_war = {
				target = ROOT
				casus_belli = shogunate_war
				faction = faction_shogun
			}
		}
	}
}

# Ultimatum - oust Shogun
letter_event = {
	id = japan.49
	desc = EVTDESC_JAPAN_49
	
	is_triggered_only = yes
	
	trigger = {
		FROM = { in_faction = faction_oust_shogun }
	}
	
	immediate = {
		FROM = { 
			diplomatic_immunity = yes 
			any_faction_backer = {
				faction = faction_oust_shogun
				diplomatic_immunity = yes
			}
		}
		k_chrysanthemum_throne = {
			holder_scope = {
				save_event_target_as = the_tenno
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_49
		if = {
			limit = {
				has_dlc = "Jade Dragon"
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
					any_faction_backer = {
						faction = faction_oust_shogun
						detract_grace_super_huge_effect = yes
					}
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
					any_faction_backer = {
						faction = faction_oust_shogun
						detract_grace_massive_effect = yes
					}
				}
			}
			else_if = {
				limit = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_major_effect = yes
					any_faction_backer = {
						faction = faction_oust_shogun
						detract_grace_major_effect = yes
					}
				}
			}
		}
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0	
				NOT = {
					FROM = {
						faction_power = 
						{
							faction = faction_oust_shogun
							power = 1.0
						}
					}
				}
			}			
			modifier = {
				factor = 1.25
				is_weak_trigger = yes
			}
			modifier = {
				factor = 1.25
				trait = craven
			}
			modifier = {
				factor = 1.25
				trait = humble
			}
			modifier = {
				factor = 1.25
				trait = kind
			}
			modifier = {
				factor = 1.25
				trait = charitable
			}
			modifier = {
				factor = 1.25
				trait = patient
			}
			modifier = {
				factor = 1.25
				trait = content
			}
		}
		
		hidden_tooltip = {
			any_vassal = {
				limit = {
					ai = no
					NOT = { in_faction = faction_oust_shogun }
				}
				character_event = { id = japan.51 }
			}
			FROM = {
				letter_event = { id = japan.52 }
				any_faction_backer = {
					faction = faction_oust_shogun
					letter_event = { id = japan.50 }
					diplomatic_immunity = no
				}
				diplomatic_immunity = no
			}
		}
		FROM = {
			opinion = {
				modifier = opinion_abdicated
				who = ROOT
				months = 12
			}
		}
		FROM = {
			# Secondary empires are forfeit, to prevent the ex-Shogun from somehow walking away with e_japan
			any_demesne_title = {
				limit = {
					tier = emperor
					is_primary_holder_title = no
				}
				unsafe_destroy_landed_title = THIS
				add_pressed_claim = PREV
			}
			faction_oust_shogun = { # The target (title) of the faction
				holder_scope = {
					event_target:the_tenno = {
						usurp_title = {
							target = PREVPREV
							type = faction_demand
						}
						# If the Tenno takes back control, the Tenno's Permanent Regency ends
						remove_trait = under_regency
						any_vassal = {
							remove_trait = japanese_regent
						}
					}
				}
				# Transfer all vassals
				ROOT = {
					any_vassal = {
						limit = {
							higher_tier_than = baron
							NOR = {
								trait = japanese_regent
								dynasty = ROOT
							}
						}
						set_defacto_liege = event_target:the_tenno
					}
					any_vassal = {
						limit = {
							trait = japanese_regent2
						}
						remove_trait = japanese_regent2
						set_defacto_liege = event_target:the_tenno
					}
					remove_trait = under_regency2
				}
				
				# Set the proper laws
				if = {
					limit = {
						has_dlc = "Zeus"
					}
					add_law_w_cooldown = ze_administration_laws_2 # Imperial
					add_law_w_cooldown = out_of_realm_inheritance_law_1 # No external inheritance
					add_law_w_cooldown = vassal_wars_law_0 # Unrestricted vassal wars; you'll have to work on blocking them again
					add_law_w_cooldown = tenno
				}
				else = {
					add_law_w_cooldown = crown_authority_1 # Unrestricted vassal wars; unfortunately, this won't give the rest of the necessary laws
					add_law_w_cooldown = imperial_administration
				}
				if = {
					limit = {
						has_dlc = "Charlemagne"
					}
					add_law_w_cooldown = vice_royalty_2
				}
				# Destroy extra kingdoms held by the ex-Shogun
				ROOT = {
					any_demesne_title = {
						limit = {
							tier = king
							NOT = {
								is_primary_holder_title = yes
							}
						}
						unsafe_destroy_landed_title = THIS
						add_pressed_claim = PREV
					}
				}
			}
		}
	}
	option = {
		name = EVTOPTB_JAPAN_49
		if = {
			limit = {
				has_dlc = "Jade Dragon"
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
					any_faction_backer = {
						faction = faction_oust_shogun
						detract_grace_super_huge_effect = yes
					}
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
					any_faction_backer = {
						faction = faction_oust_shogun
						detract_grace_massive_effect = yes
					}
				}
			}
			else_if = {
				limit = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_major_effect = yes
					any_faction_backer = {
						faction = faction_oust_shogun
						detract_grace_major_effect = yes
					}
				}
			}
		}
		ai_chance = {
			factor = 90
			modifier = {
				factor = 1.25
				is_strong_trigger = yes
			}
			modifier = {
				factor = 1.25
				trait = brave
			}
			modifier = {
				factor = 1.25
				trait = proud
			}
			modifier = {
				factor = 1.25
				trait = envious
			}
			modifier = {
				factor = 1.25
				trait = greedy
			}
			modifier = {
				factor = 1.25
				trait = wroth
			}
			modifier = {
				factor = 1.25
				trait = ambitious
			}
			modifier = {
				factor = 1.25
				trait = stubborn
			}
			modifier = {
				factor = 0.75
				FROM = {
					faction_power = 
					{
						faction = faction_oust_shogun
						power = 1.5
					}
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					faction_power = 
					{
						faction = faction_oust_shogun
						power = 1.0
					}
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					faction_power = 
					{
						faction = faction_oust_shogun
						power = 2.0
					}
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					faction_power = 
					{
						faction = faction_oust_shogun
						power = 3.0
					}
				}
			}	
			modifier = {
				factor = 0.5
				FROM = {
					faction_power = 
					{
						faction = faction_oust_shogun
						power = 4.0
					}
				}
			}	
		}
		hidden_tooltip = {
			if = {
				limit = {
					FROM = { faction_power = { faction = faction_oust_shogun power = 1.0 } }
				}
				random = {
					chance = 25
					character_event = { id = 45002 days = 120 } # Loyalists flock to the liege's banner
				}
			}
		}
		FROM = {
			letter_event = { id = japan.53 days = 3 tooltip = "EVTTOOLTIP8100" }
			tooltip = {
				any_faction_backer = {
					faction = faction_oust_shogun
				}
			}
			hidden_tooltip = {
				if = {
					limit = {
						NOT = { faction_power = { faction = faction_oust_shogun power = 0.75 } }
					}
					random_list = {
						50 = {
						}
						30 = {
							character_event = { id = 45000 days = 17 } # A great number of rebels flock to the revolter's banner
						}
						20 = {
							character_event = { id = 45004 days = 17 } # Rebels flock to the revolter's banner
						}
					}
				}
				if = {
					limit = {
						faction_power = { faction = faction_oust_shogun power = 0.75 }
						NOT = { faction_power = { faction = faction_oust_shogun power = 1.5 } }
					}
					random_list = {
						75 = {
						}
						5 = {
							character_event = { id = 45000 days = 17 } # A great number of rebels flock to the revolter's banner
						}
						20 = {
							character_event = { id = 45004 days = 17 } # Rebels flock to the revolter's banner
						}
					}
				}
			}
		}
	}
}

# Inform faction backer - Oust Shogun
letter_event = {
	id = japan.50
	desc = EVTDESC_JAPAN_50
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = "GOOD"
		reverse_opinion = {
			modifier = opinion_grateful
			who = FROMFROM
			years = 5
		}
		opinion = {
			modifier = opinion_supported_against_shogun
			who = FROMFROM
			years = 10
		}
		add_character_modifier = {
			name = faction_shogun_timer # Should actually be this modifier; these people are not permitted to try to install a new Shogun!
			hidden = yes
			duration = 3650
		}
	}
}

# Inform other vassals - Oust Shogun
character_event = {
	id = japan.51
	desc = EVTDESC_JAPAN_51
	
	notification = yes
	
	picture = GFX_evt_council
	border = GFX_event_normal_frame_intrigue
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = "I_SEE"
	}
}

# Demand accepted - Oust Shogun
letter_event = {
	id = japan.52
	desc = EVTDESC_JAPAN_52
	
	is_triggered_only = yes
	
	option = {
		name = "EXCELLENT"
		clr_character_flag = faction_shogun_ultimatum_taken
		
		add_character_modifier = {
			name = faction_shogun_timer # Actually this modifier; they're not permitted to create a new Shogun for a while!
			hidden = yes
			duration = 3650
		}
	}
}

# Demand rejected - Oust Shogun
letter_event = {
	id = japan.53
	desc = EVTDESC_JAPAN_53
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTA8100"
		
		clr_character_flag = faction_oust_shogun_ultimatum_taken
		
		faction_oust_shogun = { # The target (title) of the faction
			reverse_war = {
				target = ROOT
				casus_belli = end_shogunate_war
				faction = faction_oust_shogun
			}
		}
	}
}

### Proper Regent setup when title_regent changes hands

# Fired when someone without the japanese_regent trait becomes the regent
character_event = {
	id = japan.54
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		log = "[Root.GetBestName] is the Regent but shouldn't be!"
		if = {
			limit= {
				liege = {
					any_vassal = {
						trait = japanese_regent
						has_regent = no
					}
				}
			}
			liege = {
				character_event = { id = japan.55 }
			}
		}
	}
}

# Ensures that the proper regent gets the title
character_event = {
	id = japan.55
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		log = "[Root.GetBestName] is now getting a proper Regent!"
		random_vassal = {
			limit = {
				trait = japanese_regent
			}
			liege = {
				regent = {
					log = "[This.GetBestName] is the improper regent!"
					remove_title = title_regent
				}
			}
			log = "[This.GetBestName] should be the Regent!"
			give_minor_title = title_regent # Fires japan.56 automatically
			give_minor_title = title_appointed_regent
		}
	}
}

# Fired when someone with the the japanese_regent trait becomes the regent
character_event = {
	id = japan.56
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		log = "[Root.GetBestName] is the proper Regent!"
		if = {
			limit = {
				higher_tier_than = baron
			}
			liege = {
				character_event = { id = japan.57 }
			}
		}
	}
}

# Sets up the Regency Loyalist faction; should hopefully prevent "Kill the Regent and instantly issue an ultimatum" exploits
character_event = {
	id = japan.57
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		log = "The Regency Loyalists are being set up!"
		primary_title = {
			save_event_target_as = regency_loyalist_title
		}
		regent = {
			start_faction = {
				faction = faction_regent_loyalists
				title = event_target:regency_loyalist_title
			}
			log = "[This.GetBestName] is leading the Regency Loyalists!"
			save_event_target_as = regent_to_be_loyal_to
			if = {
				limit = {
					NOT = {
						dynasty = ROOT
					}
				}
				any_dynasty_member = {
					limit = {
						is_landed = yes
						higher_tier_than = baron
						liege = {
							character = ROOT
						}
						NOT = {
							has_non_aggression_pact_with = ROOT
						}
					}
					log = "[This.GetBestName] is joining the Regency Loyalists!"
					join_faction = {
						faction = faction_regent_loyalists
						faction_leader = event_target:regent_to_be_loyal_to
						ignore_requirements = yes
					}
				}
			}
		}
	}
}

### Overthrow the Regency - no Regency Loyalist faction

# Regent gets ultimatum
letter_event = {
	id = japan.58
	desc = EVTDESC_JAPAN_58
	
	is_triggered_only = yes
	
	immediate = {
		diplomatic_immunity = yes 
	}
	
	option = {
		name = EVTOPTA_JAPAN_58 # I suppose I have to accept this...
		if = {
			limit = {
				has_dlc = "Jade Dragon"
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
				}
			}
			else_if = {
				limit = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_major_effect = yes
				}
			}
		}
		ai_chance = {
			factor = 5
			modifier = {
				factor = 0.75
				relative_power_to_liege = 0.75
			}
			modifier = {
				factor = 0
				relative_power_to_liege = 1.0
			}
			modifier = {
				factor = 1.25
				is_weak_trigger = yes
			}
			modifier = {
				factor = 1.25
				trait = craven
			}
			modifier = {
				factor = 1.25
				trait = humble
			}
			modifier = {
				factor = 1.25
				trait = kind
			}
			modifier = {
				factor = 1.25
				trait = charitable
			}
			modifier = {
				factor = 1.25
				trait = patient
			}
			modifier = {
				factor = 1.25
				trait = content
			}
		}
		
		remove_trait = japanese_regent
		FROM = {
			remove_trait = under_regency
		}
		
		hidden_tooltip = {
			diplomatic_immunity = no
			FROM = {
				letter_event = { id = japan.59 }
				diplomatic_immunity = no
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_58 # Never!
		if = {
			limit = {
				has_dlc = "Jade Dragon"
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
				}
			}
			else_if = {
				limit = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_major_effect = yes
				}
			}
		}
		ai_chance = {
			factor = 95
			modifier = {
				factor = 1.25
				is_strong_trigger = yes
			}
			modifier = {
				factor = 1.25
				trait = brave
			}
			modifier = {
				factor = 1.25
				trait = proud
			}
			modifier = {
				factor = 1.25
				trait = envious
			}
			modifier = {
				factor = 1.25
				trait = greedy
			}
			modifier = {
				factor = 1.25
				trait = wroth
			}
			modifier = {
				factor = 1.25
				trait = ambitious
			}
			modifier = {
				factor = 0.75
				NOT = {
					relative_power_to_liege = 1.5
				}
			}
		}
		hidden_tooltip = {
			if = {
				limit = {
					NOT = {
						relative_power_to_liege = 1.0
					}
				}
				random = {
					chance = 25
					character_event = { id = 45002 days = 120 } # Loyalists flock to the regent's banner
				}
			}
		}
		FROM = {
			letter_event = { id = japan.60 }
			hidden_tooltip = {
				if = {
					limit = {
						ROOT = {
							relative_power_to_liege = 1.5
						}
					}
					random_list = {
						50 = {
						}
						30 = {
							character_event = { id = 45000 days = 17 } # A great number of rebels flock to the liege's banner
						}
						20 = {
							character_event = { id = 45004 days = 17 } # Rebels flock to the liege's banner
						}
					}
				}
				if = {
					limit = {
						ROOT = {
							relative_power_to_liege = 1.0
							NOT = {
								relative_power_to_liege = 1.5
							}
						}
					}
					random_list = {
						75 = {
						}
						5 = {
							character_event = { id = 45000 days = 17 } # A great number of rebels flock to the liege's banner
						}
						20 = {
							character_event = { id = 45004 days = 17 } # Rebels flock to the liege's banner
						}
					}
				}
			}
		}
	}
}

# The liege is informed that the regent folded
letter_event = {
	id = japan.59
	desc = EVTDESC_JAPAN_59
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_59 # Assuming direct control!
		clr_character_flag = overthrow_my_regent_decision_taken
	}
}

# The liege is informed that the regent isn't folding
letter_event = {
	id = japan.60
	desc = EVTDESC_JAPAN_60
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_60 # Then face me in battle!
		FROM = {
			reverse_war = {
				target = ROOT
				casus_belli = end_regency_war
			}
		}
		
		clr_character_flag = overthrow_my_regent_decision_taken
	}
}

### Overthrow the Regency - Regency Loyalist faction exists

# Regent gets ultimatum
letter_event = {
	id = japan.61
	desc = EVTDESC_JAPAN_61
	
	is_triggered_only = yes
	
	
	immediate = {
		diplomatic_immunity = yes 
		any_faction_backer = {
			faction = faction_regent_loyalists
			diplomatic_immunity = yes
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_61 # I suppose I have to accept this...
		if = {
			limit = {
				has_dlc = "Jade Dragon"
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
				}
			}
			else_if = {
				limit = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_major_effect = yes
				}
			}
		}
		ai_chance = {
			factor = 5
			modifier = {
				factor = 0.5
				faction_power = {
					faction = faction_regent_loyalists
					power = 1.0
				}
			}	
			modifier = {
				factor = 0
				faction_power = {
					faction = faction_regent_loyalists
					power = 1.5
				}
			}		
			modifier = {
				factor = 1.25
				is_weak_trigger = yes
			}
			modifier = {
				factor = 1.25
				trait = craven
			}
			modifier = {
				factor = 1.25
				trait = humble
			}
			modifier = {
				factor = 1.25
				trait = kind
			}
			modifier = {
				factor = 1.25
				trait = charitable
			}
			modifier = {
				factor = 1.25
				trait = patient
			}
			modifier = {
				factor = 1.25
				trait = content
			}
		}
		
		remove_trait = japanese_regent
		FROM = {
			remove_trait = under_regency
		}
		
		hidden_tooltip = {
			any_faction_backer = {
				faction = faction_regent_loyalists
				letter_event = { id = japan.62 }
				diplomatic_immunity = no
			}
			letter_event = { id = japan.63 }
			diplomatic_immunity = no
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_61 # Never!
		if = {
			limit = {
				has_dlc = "Jade Dragon"
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
				}
			}
			else_if = {
				limit = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_major_effect = yes
				}
			}
		}
		ai_chance = {
			factor = 95
			modifier = {
				factor = 1.25
				is_strong_trigger = yes
			}
			modifier = {
				factor = 1.25
				trait = brave
			}
			modifier = {
				factor = 1.25
				trait = proud
			}
			modifier = {
				factor = 1.25
				trait = envious
			}
			modifier = {
				factor = 1.25
				trait = greedy
			}
			modifier = {
				factor = 1.25
				trait = wroth
			}
			modifier = {
				factor = 1.25
				trait = ambitious
			}
			modifier = {
				factor = 2
				faction_power = {
					faction = faction_regent_loyalists
					power = 1.5
				}
			}
			modifier = {
				factor = 2
				faction_power = {
					faction = faction_regent_loyalists
					power = 1.0
				}
			}
			modifier = {
				factor = 2
				faction_power = {
					faction = faction_regent_loyalists
					power = 2.0
				}
			}
			modifier = {
				factor = 2
				faction_power = {
					faction = faction_regent_loyalists
					power = 3.0
				}
			}	
			modifier = {
				factor = 2
				faction_power = {
					faction = faction_regent_loyalists
					power = 4.0
				}
			}
		}
		hidden_tooltip = {
			if = {
				limit = {
					faction_power = { faction = faction_regent_loyalists power = 1.0 }
				}
				random = {
					chance = 25
					character_event = { id = 45002 days = 120 } # Loyalists flock to the regent's banner
				}
			}
		}
		FROM = {
			letter_event = { id = japan.64 }
			hidden_tooltip = {
				if = {
					limit = {
						ROOT = {
							faction_power = { faction = faction_regent_loyalists power = 1.5 }
						}
					}
					random_list = {
						50 = {
						}
						30 = {
							character_event = { id = 45000 days = 17 } # A great number of rebels flock to the liege's banner
						}
						20 = {
							character_event = { id = 45004 days = 17 } # Rebels flock to the liege's banner
						}
					}
				}
				if = {
					limit = {
						ROOT = {
							faction_power = { faction = faction_regent_loyalists power = 0.75 }
							NOT = {
								faction_power = { faction = faction_regent_loyalists power = 1.5 }
							}
						}
					}
					random_list = {
						75 = {
						}
						5 = {
							character_event = { id = 45000 days = 17 } # A great number of rebels flock to the liege's banner
						}
						20 = {
							character_event = { id = 45004 days = 17 } # Rebels flock to the liege's banner
						}
					}
				}
			}
		}
	}
}

# Faction members are informed that the regent folded
letter_event = {
	id = japan.62
	desc = EVTDESC_JAPAN_62
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_62 # Really? We had your back!
	}
}

# The liege is informed that the regent folded
letter_event = {
	id = japan.63
	desc = EVTDESC_JAPAN_63
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_63 # Assuming direct control!
		clr_character_flag = overthrow_my_regent_decision_taken
	}
}

# The liege is informed that the regent isn't folding
letter_event = {
	id = japan.64
	desc = EVTDESC_JAPAN_64
	
	is_triggered_only = yes
	
	immediate = {
		FROM = {
			any_faction_backer = {
				faction = faction_regent_loyalists
				reverse_opinion = {
					modifier = opinion_fought_for_regent
					who = FROM
					years = 20
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_64 # Then face me in battle!
		
		FROM = {
			faction_regent_loyalists = { # The target (title) of the faction
				reverse_war = {
					target = FROM
					casus_belli = end_regency_war_faction
					faction = faction_regent_loyalists
				}
			}
		}
		
		clr_character_flag = overthrow_my_regent_decision_taken
	}
}

# on_startup regency setup (the first event sometimes gets... weird)
character_event = {
	id = japan.65
	hide_window = yes
	is_triggered_only = yes
	
	only_playable = yes
	
	trigger = {
		trait = japanese_regent
		liege = {
			trait = under_regency
		}
	}
	
	immediate = {
		liege = {
			random_vassal = {
				limit = {
					trait = japanese_regent
				}
				liege = {
					regent = {
						remove_title = title_regent
					}
				}
				give_minor_title = title_regent
				give_minor_title = title_appointed_regent
			}
			primary_title = {
				save_event_target_as = regency_loyalist_title
			}
			regent = {
				if = {
					limit = {
						higher_tier_than = baron
					}
					start_faction = {
						faction = faction_regent_loyalists
						title = event_target:regency_loyalist_title
					}
					save_event_target_as = regent_to_be_loyal_to
					if = {
						limit = {
							NOT = {
								dynasty = ROOT
							}
						}
						any_dynasty_member = {
							limit = {
								is_landed = yes
								higher_tier_than = baron
								liege = {
									character = ROOT
								}
								NOT = {
									has_non_aggression_pact_with = ROOT
								}
							}
							join_faction = {
								faction = faction_regent_loyalists
								faction_leader = event_target:regent_to_be_loyal_to
								ignore_requirements = yes
							}
						}
					}
				}
			}
		}
	}
}

### Special Shogun decisions

# Transfer vassal - the Shogun
letter_event = {
	id = japan.66
	desc = EVTDESC_JAPAN_66
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_66 # I can't oppose this...
		if = {
			limit = {
				FROM = {
					has_dlc = "Jade Dragon"
					is_chinese_emperor_trigger = no
				}
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_major_effect = yes
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_medium_effect = yes
				}
			}
			else_if = {
				limit = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_minor_effect = yes
				}
			}
		}
		
		opinion = {
			who = FROMFROM
			modifier = took_a_vassal
		}
	}
}

# Transfer vassal - vassal
letter_event = {
	id = japan.67
	desc = EVTDESC_JAPAN_67
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			FROMFROM = {
				NOR = {
					root_has_imprisonment_reason_opinion_trigger = yes
					any_rival = {
						character = ROOT
					}
				}
			}
		}
		name = EVTOPTA_JAPAN_67 # I suppose that happened...
	}
	
	option = {
		trigger = {
			FROMFROM = {
				OR = {
					root_has_imprisonment_reason_opinion_trigger = yes
					any_rival = {
						character = ROOT
					}
				}
			}
		}
		name = EVTOPTB_JAPAN_67 # I have a bad feeling about this
	}
}

# Change the Tenno's spouse - deprecated for the Shogun!
letter_event = {
	id = japan.68
	desc = EVTDESC_JAPAN_68
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	immediate = {
		spouse = {
			save_event_target_as = old_spouse
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_68 # I can't oppose this...
		if = {
			limit = {
				FROM = {
					has_dlc = "Jade Dragon"
					is_chinese_emperor_trigger = no
				}
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_major_effect = yes
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_medium_effect = yes
				}
			}
			else_if = {
				limit = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_minor_effect = yes
				}
			}
		}
		
		opinion = {
			who = FROMFROM
			modifier = changed_my_spouse
		}
		remove_spouse = event_target:old_spouse
		add_consort = event_target:old_spouse
		add_spouse = FROMFROMFROM
	}
}

# Take the Shogun's title
letter_event = {
	id = japan.69
	desc = EVTDESC_JAPAN_69
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_69 # I can't oppose this...
		if = {
			limit = {
				FROM = {
					has_dlc = "Jade Dragon"
					is_chinese_emperor_trigger = no
				}
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_major_effect = yes
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_medium_effect = yes
				}
			}
			else_if = {
				limit = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_minor_effect = yes
				}
			}
		}
		
		opinion = {
			who = FROMFROM
			modifier = took_a_title
		}
		FROM = {
			add_weak_pressed_claim = ROOT
		}
	}
}

### Regency stuff for the Shogun(s)

# on_startup regency setup
character_event = {
	id = japan.70
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		trait = under_regency2
	}
	
	immediate = {
		random_vassal = {
			limit = {
				trait = japanese_regent2
			}
			liege = {
				regent = {
					remove_title = title_regent
				}
			}
			give_minor_title = title_regent
			give_minor_title = title_appointed_regent
		}
		primary_title = {
			save_event_target_as = regency_loyalist_title
		}
		regent = {
			if = {
				limit = {
					higher_tier_than = baron
				}
				start_faction = {
					faction = faction_regent_loyalists2
					title = event_target:regency_loyalist_title
				}
				save_event_target_as = regent_to_be_loyal_to
				if = {
					limit = {
						NOT = {
							dynasty = ROOT
						}
					}
					any_dynasty_member = {
						limit = {
							is_landed = yes
							higher_tier_than = baron
							liege = {
								character = ROOT
							}
							NOT = {
								has_non_aggression_pact_with = ROOT
							}
						}
						join_faction = {
							faction = faction_regent_loyalists2
							faction_leader = event_target:regent_to_be_loyal_to
							ignore_requirements = yes
						}
					}
				}
			}
		}
	}
}

# on_new_holder event making sure the under_regency2 trait is passed on properly
character_event = {
	id = japan.71
	hide_window = yes
	is_triggered_only = yes
	
	only_playable = yes
	
	trigger = {
		FROM = {
			tier = emperor
		}
	}
	
	immediate = {
		if = {
			limit = {
				FROMFROM = {
					NAND = {
						tier = emperor
						OR = {
							religion = shinto
							AND = {
								culture_group = japonic
								religion = buddhist
							}
						}
						NOT = {
							government = chinese_imperial_government
						}
					}
					trait = under_regency2
				}
			}
			FROMFROM = {
				remove_trait = under_regency2
			}
			if = {
				limit = {
					OR = {
						AND = {
							religion = shinto
							NOR = {
								controls_religion = yes
								has_character_flag = temporarily_japanese_imperial
							}
						}
						AND = {
							religion = buddhist
							culture_group = japonic
						}
						NOT = {
							government = chinese_imperial_government
						}
					}
				}
				add_trait = under_regency2
			}
			# If the Tenno inherited from the Shogun, the Shogun's old regent becomes the Tenno's regent
			else_if = {
				limit = {
					religion = shinto
					OR = {
						controls_religion = yes
						has_character_flag = temporarily_japanese_imperial
					}
				}
				add_trait = under_regency
				if = {
					limit = {
						any_vassal = {
							trait = japanese_regent2
						}
					}
					any_vassal = {
						limit = {
							trait = japanese_regent
						}
						remove_trait = japanese_regent
					}
					random_vassal = {
						limit = {
							trait = japanese_regent2
						}
						remove_trait = japanese_regent2
						add_trait = japanese_regent
						liege = {
							regent = {
								remove_title = title_regent
							}
						}
						give_minor_title = title_regent
						give_minor_title = title_appointed_regent
					}
				}
			}
		}
	}
}

# on_yearly_pulse event clearing out the japanese_regent trait if we shouldn't have it
character_event = {
	id = japan.72
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		trait = japanese_regent2
		OR = {
			NOR = {
				liege = {
					OR = {
						AND = {
							religion = shinto
							NOR = {
								controls_religion = yes
								has_character_flag = temporarily_japanese_imperial
							}
						}
						AND = {
							religion = buddhist
							culture_group = japonic
						}
					}
					NOT = {
						government = chinese_imperial_government
					}
				}
				top_liege = {
					liege_before_war = {
						OR = {
							AND = {
								religion = shinto
								NOR = {
									controls_religion = yes
									has_character_flag = temporarily_japanese_imperial
								}
							}
							AND = {
								religion = buddhist
								culture_group = japonic
							}
						}
						NOT = {
							government = chinese_imperial_government
						}
					}
				}
				liege_before_war = {
					OR = {
						AND = {
							religion = shinto
							NOR = {
								controls_religion = yes
								has_character_flag = temporarily_japanese_imperial
							}
						}
						AND = {
							religion = buddhist
							culture_group = japonic
						}
					}
					NOT = {
						government = chinese_imperial_government
					}
				}
			}
			# The Tenno can't serve as the Regent for the Shogun
			AND = {
				religion = shinto
				NOR = {
					controls_religion = yes
					has_character_flag = temporarily_japanese_imperial
				}
			}
		}
	}
	
	immediate = {
		remove_trait = japanese_regent2
	}
}

# on_new_holder event making sure that we become the regent if we should be
character_event = {
	id = japan.73
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		trait = japanese_regent2
		liege = {
			OR = {
				AND = {
					religion = shinto
					NOR = {
						controls_religion = yes
						has_character_flag = temporarily_japanese_imperial
					}
				}
				AND = {
					religion = buddhist
					culture_group = japonic
				}
			}
			NOT = {
				government = chinese_imperial_government
			}
		}
		FROMFROM = {
			is_alive = no
		}
		has_regent = no
	}
	
	immediate = {
		liege = {
			regent = {
				remove_title = title_regent
			}
		}
		give_minor_title = title_regent
		give_minor_title = title_appointed_regent
	}
}


# on_new_holder_usurpation event passing on the japanese_regent2 trait if the former character no longer should have it
character_event = {
	id = japan.74
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		FROMFROM = {
			trait = japanese_regent2
			OR = {
				is_ruler = no
				NOR = {
					liege = {
						OR = {
							AND = {
								religion = shinto
								NOR = {
									controls_religion = yes
									has_character_flag = temporarily_japanese_imperial
								}
							}
							AND = {
								religion = buddhist
								culture_group = japonic
							}
						}
						NOT = {
							government = chinese_imperial_government
						}
					}
					top_liege = {
						liege_before_war = {
							OR = {
								AND = {
									religion = shinto
									NOR = {
										controls_religion = yes
										has_character_flag = temporarily_japanese_imperial
									}
								}
								AND = {
									religion = buddhist
									culture_group = japonic
								}
							}
							NOT = {
								government = chinese_imperial_government
							}
						}
					}
					liege_before_war = {
						OR = {
							AND = {
								religion = shinto
								NOR = {
									controls_religion = yes
									has_character_flag = temporarily_japanese_imperial
								}
							}
							AND = {
								religion = buddhist
								culture_group = japonic
							}
						}
						NOT = {
							government = chinese_imperial_government
						}
					}
				}
			}
		}
	}
	
	immediate = {
		FROMFROM = {
			remove_trait = japanese_regent2
		}
		if = {
			limit = {
				# The Tenno can't be the Regent
				NAND = {
					religion = shinto
					OR = {
						controls_religion = yes
						has_character_flag = temporarily_japanese_imperial
					}
				}
			}
			add_trait = japanese_regent2
			liege = {
				regent = {
					remove_title = title_regent
				}
			}
			give_minor_title = title_regent
			give_minor_title = title_appointed_regent
			if = {
				limit = {
					liege = {
						OR = {
							AND = {
								religion = shinto
								NOR = {
									controls_religion = yes
									has_character_flag = temporarily_japanese_imperial
								}
							}
							AND = {
								religion = buddhist
								culture_group = japonic
							}
						}
						NOT = {
							government = chinese_imperial_government
						}
					}
					has_job_title = job_spymaster
				}
				remove_title = job_spymaster # It would cause issues for the player if the spymaster couldn't be swapped...
			}
		}
	}
}

# on_adulthood and on_yearly_pulse regent switching if necessary
character_event = {
	id = japan.75
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		trait = japanese_regent2
		liege = {
			OR = {
				AND = {
					religion = shinto
					NOR = {
						controls_religion = yes
						has_character_flag = temporarily_japanese_imperial
					}
				}
				AND = {
					religion = buddhist
					culture_group = japonic
				}
			}
			NOT = {
				government = chinese_imperial_government
			}
		}
		liege = {
			has_actual_regency_trigger = yes
			regent = {
				NOT = {
					trait = japanese_regent2
				}
			}
		}
		has_regent = no
	}
	
	immediate = {
		liege = {
			regent = {
				remove_title = title_regent
			}
		}
		give_minor_title = title_regent
		give_minor_title = title_appointed_regent
	}
}

# on_new_holder event clearing out the japanese_regent2 trait if you are the Tenno or the Shogun
character_event = {
	id = japan.76
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		OR = {
			AND = {
				religion = shinto
				OR = {
					controls_religion = yes
					has_character_flag = temporarily_japanese_imperial
				}
			}
			real_tier = emperor
		}
	}
	
	immediate = {
		remove_trait = japanese_regent2
	}
}

### Ask the regent to step aside (no plot)

# Regent asked nicely
letter_event = {
	id = japan.77
	desc = EVTDESC_JAPAN_77
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_77 # Sure!
		
		remove_trait = japanese_regent2
		FROM = {
			remove_trait = under_regency2
			letter_event = { id = japan.78 } # Inform FROM
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				NOR = {
					dynasty = FROM
					any_friend = {
						character = FROM
					}
					any_lover = {
						character = FROM
					}
					opinion = {
						who = FROM
						value = 50
					}
					AND = {
						opinion = {
							who = FROM
							value = 25
						}
						OR = {
							trait = kind
							trait = content
							trait = humble
						}
					}
				}
			}
			modifier = {
				factor = 0
				OR = {
					trait = ambitious
					trait = envious
					trait = proud
				}
			}
			modifier = {
				factor = 2
				trait = slothful
			}
			modifier = {
				factor = 5
				is_dumb_trigger = yes
			}
			modifier = {
				factor = 0
				FROM = {
					primary_title = {
						has_law = regent_succession_control_1
					}
				}
			}
			modifier = {
				factor = 0
				in_faction = faction_regent_loyalists2
				faction_power = {
					faction = faction_regent_loyalists2
					power >= 5
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_77 # Not happening!
		
		FROM = {
			letter_event = { id = japan.79 } # Inform FROM
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				OR = {
					dynasty = FROM
					any_friend = {
						character = FROM
					}
					any_lover = {
						character = FROM
					}
					opinion = {
						who = FROM
						value = 50
					}
					AND = {
						opinion = {
							who = FROM
							value = 25
						}
						OR = {
							trait = kind
							trait = content
							trait = humble
						}
					}
				}
				NOR = {
					trait = ambitious
					trait = envious
					trait = proud
				}
			}
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 10
				is_smart_trigger = yes
			}
			modifier = {
				factor = 2
				FROM = {
					primary_title = {
						has_law = regent_marriage_control_1
					}
				}
			}
			modifier = {
				factor = 2
				FROM = {
					primary_title = {
						has_law = regent_vassal_control_1
					}
				}
			}
			modifier = {
				factor = 2
				FROM = {
					primary_title = {
						has_law = regent_prisoner_control_1
					}
				}
			}
			modifier = {
				factor = 2
				FROM = {
					primary_title = {
						has_law = regent_treasury_control_1
					}
				}
			}
			modifier = {
				factor = 2
				FROM = {
					primary_title = {
						has_law = regent_execution_control_1
					}
				}
			}
			modifier = {
				factor = 2
				FROM = {
					primary_title = {
						has_law = regent_title_control_1
					}
				}
			}
			modifier = {
				factor = 2
				in_faction = faction_regent_loyalists2
				faction_power = {
					faction = faction_regent_loyalists2
					power >= 1
				}
			}
			modifier = {
				factor = 2
				in_faction = faction_regent_loyalists2
				faction_power = {
					faction = faction_regent_loyalists2
					power >= 2
				}
			}
			modifier = {
				factor = 2
				any_owned_bloodline = {
					has_bloodline_flag = regency_bloodline
				}
			}
		}
	}
}

# Reply positive
letter_event = {
	id = japan.78
	desc = EVTDESC_JAPAN_78
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_78 # Good to hear!
	}
}

# Reply negative
letter_event = {
	id = japan.79
	desc = EVTDESC_JAPAN_79
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_79 # Curses!
	}
}

### Ask nicely to become the regent

# Liege asked nicely
letter_event = {
	id = japan.80
	desc = EVTDESC_JAPAN_80
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_80 # Sure!
		
		add_trait = under_regency2
		regency_setup_nice_effect = yes
		FROM = {
			add_trait = japanese_regent2
			liege = {
				regent = {
					remove_title = title_regent
				}
			}
			give_minor_title = title_regent
			give_minor_title = title_appointed_regent
			if = {
				limit = {
					has_job_title = job_spymaster
				}
				remove_title = job_spymaster # It would cause issues for the player if the spymaster couldn't be swapped...
			}
			letter_event = { id = japan.81 } # Inform FROM
		}
		
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0
				NOR = {
					dynasty = FROM
					any_friend = {
						character = FROM
					}
					any_lover = {
						character = FROM
					}
					opinion = {
						who = FROM
						value = 50
					}
					AND = {
						opinion = {
							who = FROM
							value = 25
						}
						OR = {
							trait = kind
							trait = content
							trait = humble
						}
					}
					AND = {
						opinion = {
							who = FROM
							value = 25
						}
						FROM = {
							any_owned_bloodline = {
								has_bloodline_flag = regency_bloodline
								bloodline_is_active_for = PREV
							}
						}
					}
				}
			}
			modifier = {
				factor = 0
				OR = {
					trait = ambitious
					trait = envious
					trait = proud
				}
			}
			modifier = {
				factor = 2
				trait = slothful
			}
			modifier = {
				factor = 5
				is_dumb_trigger = yes
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_80 # Not happening!
		
		FROM = {
			letter_event = { id = japan.82 } # Inform FROM
		}
		
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0.1
				OR = {
					dynasty = FROM
					any_friend = {
						character = FROM
					}
					any_lover = {
						character = FROM
					}
					opinion = {
						who = FROM
						value = 50
					}
					AND = {
						opinion = {
							who = FROM
							value = 25
						}
						OR = {
							trait = kind
							trait = content
							trait = humble
						}
					}
					AND = {
						opinion = {
							who = FROM
							value = 25
						}
						FROM = {
							any_owned_bloodline = {
								has_bloodline_flag = regency_bloodline
								bloodline_is_active_for = PREV
							}
						}
					}
				}
				NOR = {
					trait = ambitious
					trait = envious
					trait = proud
				}
			}
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 10
				is_smart_trigger = yes
			}
		}
	}
}

# Reply positive
letter_event = {
	id = japan.81
	desc = EVTDESC_JAPAN_81
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_81 # Good to hear!
	}
}

# Reply negative
letter_event = {
	id = japan.82
	desc = EVTDESC_JAPAN_82
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_82 # Curses!
	}
}

### Plot to become permanent regent fires

# Inform the liege
letter_event = {
	id = japan.83
	desc = EVTDESC_JAPAN_83
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_83 # I can't do anything about this...
		regency_setup_not_nice_effect = yes
		
		if = {
			limit = {
				FROM = {
					has_dlc = "Jade Dragon"
					is_chinese_emperor_trigger = no
				}
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
				}
			}
			else_if = {
				limit = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_major_effect = yes
				}
			}
		}
		
		add_trait = under_regency2
		FROM = {
			add_trait = japanese_regent2
			liege = {
				regent = {
					remove_title = title_regent
				}
			}
			give_minor_title = title_regent
			give_minor_title = title_appointed_regent
			if = {
				limit = {
					has_job_title = job_spymaster
				}
				remove_title = job_spymaster # It would cause issues for the player if the spymaster couldn't be swapped...
			}
		}
	}
}

# Inform co-conspirators
letter_event = {
	id = japan.84
	desc = EVTDESC_JAPAN_84
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_84 # Good to hear!
		opinion = {
			modifier = opinion_supported_as_regent
			who = FROM
			years = 10
		}
	}
}

# Inform all vassals
letter_event = {
	id = japan.85
	desc = EVTDESC_JAPAN_85
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_85 # I see...
	}
}

### Regency faction

# Liege gets ultimatum
letter_event = {
	id = japan.86
	desc = EVTDESC_JAPAN_86
	
	is_triggered_only = yes
	
	trigger = {
		FROM = { in_faction = faction_regent2 }
	}
	
	immediate = {
		FROM = { 
			diplomatic_immunity = yes 
			any_faction_backer = {
				faction = faction_regent2
				diplomatic_immunity = yes
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_86 # I suppose I have to accept this...
		regency_setup_not_nice_effect = yes
		if = {
			limit = {
				has_dlc = "Jade Dragon"
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
					any_faction_backer = {
						faction = faction_regent2
						detract_grace_super_huge_effect = yes
					}
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
					any_faction_backer = {
						faction = faction_regent2
						detract_grace_massive_effect = yes
					}
				}
			}
			else_if = {
				limit = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_major_effect = yes
					any_faction_backer = {
						faction = faction_regent2
						detract_grace_major_effect = yes
					}
				}
			}
		}
		ai_chance = {
			factor = 5
			modifier = {
				factor = 0			
				NOT = {
					FROM = {
						faction_power = {
							faction = faction_regent2
							power = 1.0
						}
					}
				}
			}		
			modifier = {
				factor = 1.25
				is_weak_trigger = yes
			}
			modifier = {
				factor = 1.25
				trait = craven
			}
			modifier = {
				factor = 1.25
				trait = humble
			}
			modifier = {
				factor = 1.25
				trait = kind
			}
			modifier = {
				factor = 1.25
				trait = charitable
			}
			modifier = {
				factor = 1.25
				trait = patient
			}
			modifier = {
				factor = 1.25
				trait = content
			}
		}
		
		add_trait = under_regency2
		FROM = {
			add_trait = japanese_regent2
			liege = {
				regent = {
					remove_title = title_regent
				}
			}
			give_minor_title = title_regent
			give_minor_title = title_appointed_regent
			if = {
				limit = {
					has_job_title = job_spymaster
				}
				remove_title = job_spymaster # It would cause issues for the player if the spymaster couldn't be swapped...
			}
		}
		
		hidden_tooltip = {
			FROM = {
				any_faction_backer = {
					faction = faction_regent2
					letter_event = { id = japan.87 }
					diplomatic_immunity = no
				}
				letter_event = { id = japan.88 }
				diplomatic_immunity = no
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_86 # Never!
		if = {
			limit = {
				has_dlc = "Jade Dragon"
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
					any_faction_backer = {
						faction = faction_regent2
						detract_grace_super_huge_effect = yes
					}
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
					any_faction_backer = {
						faction = faction_regent2
						detract_grace_massive_effect = yes
					}
				}
			}
			else_if = {
				limit = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_major_effect = yes
					any_faction_backer = {
						faction = faction_regent2
						detract_grace_major_effect = yes
					}
				}
			}
		}
		ai_chance = {
			factor = 95
			modifier = {
				factor = 1.25
				is_strong_trigger = yes
			}
			modifier = {
				factor = 1.25
				trait = brave
			}
			modifier = {
				factor = 1.25
				trait = proud
			}
			modifier = {
				factor = 1.25
				trait = envious
			}
			modifier = {
				factor = 1.25
				trait = greedy
			}
			modifier = {
				factor = 1.25
				trait = wroth
			}
			modifier = {
				factor = 1.25
				trait = ambitious
			}
			modifier = {
				factor = 0.75
				FROM = {
					faction_power = {
						faction = faction_regent2
						power = 1.5
					}
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					faction_power = {
						faction = faction_regent2
						power = 1.0
					}
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					faction_power = {
						faction = faction_regent2
						power = 2.0
					}
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					faction_power = {
						faction = faction_regent2
						power = 3.0
					}
				}
			}	
			modifier = {
				factor = 0.5
				FROM = {
					faction_power = {
						faction = faction_regent2
						power = 4.0
					}
				}
			}
		}
		hidden_tooltip = {
			if = {
				limit = {
					FROM = { faction_power = { faction = faction_regent2 power = 1.0 } }
				}
				random = {
					chance = 25
					character_event = { id = 45002 days = 120 } # Loyalists flock to the liege's banner
				}
			}
		}
		FROM = {
			letter_event = { id = japan.89 }
			hidden_tooltip = {
				if = {
					limit = {
						NOT = { faction_power = { faction = faction_regent2 power = 0.75 } }
					}
					random_list = {
						50 = {
						}
						30 = {
							character_event = { id = 45000 days = 17 } # A great number of rebels flock to the revolter's banner
						}
						20 = {
							character_event = { id = 45004 days = 17 } # Rebels flock to the revolter's banner
						}
					}
				}
				if = {
					limit = {
						faction_power = { faction = faction_regent2 power = 0.75 }
						NOT = { faction_power = { faction = faction_regent2 power = 1.5 } }
					}
					random_list = {
						75 = {
						}
						5 = {
							character_event = { id = 45000 days = 17 } # A great number of rebels flock to the revolter's banner
						}
						20 = {
							character_event = { id = 45004 days = 17 } # Rebels flock to the revolter's banner
						}
					}
				}
			}
		}
	}
}

# Faction members are informed that the liege folded
letter_event = {
	id = japan.87
	desc = EVTDESC_JAPAN_87
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_87 # Good to hear!
		opinion = {
			modifier = opinion_supported_as_regent
			who = FROMFROM
			years = 10
		}
	}
}

# The regent is informed that the liege folded
letter_event = {
	id = japan.88
	desc = EVTDESC_JAPAN_88
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_88 # Assuming indirect control!
		if = {
			limit = {
				NOT = {
					any_owned_bloodline = {
						has_bloodline_flag = regency_bloodline
						bloodline_is_active_for = ROOT
					}
				}
			}
			if = {
				limit = {
					is_female = no
				}
				create_bloodline = {
					type = regency_bloodline
				}
			}
			else = {
				create_bloodline = {
					type = regency_bloodline
					inheritance = matrilineal
				}
			}
		}
	}
}

# The prospective regent is informed that the liege isn't folding
letter_event = {
	id = japan.89
	desc = EVTDESC_JAPAN_89
	
	is_triggered_only = yes
	
	immediate = {
		any_faction_backer = {
			faction = faction_regent2
			reverse_opinion = {
				modifier = opinion_fought_for_regent
				who = ROOT
				years = 20
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_89 # Then war it is!
		
		faction_regent2 = { # The target (title) of the faction
			reverse_war = {
				target = ROOT
				casus_belli = regency_faction_war2
				faction = faction_regent
			}
		}
		clr_character_flag = faction_regent_ultimatum_taken
	}
}

### Plot to replace the regent

# Target informed
letter_event = {
	id = japan.90
	desc = EVTDESC_JAPAN_90
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_90 # Curses!
		FROM = {
			add_trait = japanese_regent2
			liege = {
				regent = {
					remove_title = title_regent
				}
			}
			give_minor_title = title_regent
			give_minor_title = title_appointed_regent
			if = {
				limit = {
					has_job_title = job_spymaster
				}
				remove_title = job_spymaster # It would cause issues for the player if the spymaster couldn't be swapped...
			}
		}
		opinion = {
			who = FROM
			modifier = opinion_stole_the_regency
		}
		remove_trait = japanese_regent2
		
		if = {
			limit = {
				FROM = {
					has_dlc = "Jade Dragon"
					is_chinese_emperor_trigger = no
				}
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
				}
			}
			else_if = {
				limit = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_major_effect = yes
				}
			}
		}
	}
}

# Backers informed
letter_event = {
	id = japan.91
	desc = EVTDESC_JAPAN_91
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_91 # Good to hear!
		opinion = {
			modifier = opinion_supported_as_regent
			who = FROM
			years = 10
		}
	}
}

# Liege informed
letter_event = {
	id = japan.92
	desc = EVTDESC_JAPAN_92
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_92 # I see...
	}
}

### Proper Regent setup when title_regent changes hands

# Fired when someone without the japanese_regent trait becomes the regent
character_event = {
	id = japan.93
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit= {
				liege = {
					any_vassal = {
						trait = japanese_regent2
						has_regent = no
					}
				}
			}
			liege = {
				character_event = { id = japan.94 }
			}
		}
	}
}

# Ensures that the proper regent gets the title
character_event = {
	id = japan.94
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_vassal = {
			limit = {
				trait = japanese_regent2
			}
			liege = {
				regent = {
					remove_title = title_regent
				}
			}
			give_minor_title = title_regent # Fires japan.56 automatically
			give_minor_title = title_appointed_regent
		}
	}
}

# Fired when someone with the the japanese_regent trait becomes the regent
character_event = {
	id = japan.95
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				higher_tier_than = baron
			}
			liege = {
				character_event = { id = japan.96 }
			}
		}
	}
}

# Sets up the Regency Loyalist faction; should hopefully prevent "Kill the Regent and instantly issue an ultimatum" exploits
character_event = {
	id = japan.96
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		primary_title = {
			save_event_target_as = regency_loyalist_title
		}
		regent = {
			start_faction = {
				faction = faction_regent_loyalists2
				title = event_target:regency_loyalist_title
			}
			save_event_target_as = regent_to_be_loyal_to
			if = {
				limit = {
					NOT = {
						dynasty = ROOT
					}
				}
				any_dynasty_member = {
					limit = {
						is_landed = yes
						higher_tier_than = baron
						liege = {
							character = ROOT
						}
						NOT = {
							has_non_aggression_pact_with = ROOT
						}
					}
					join_faction = {
						faction = faction_regent_loyalists2
						faction_leader = event_target:regent_to_be_loyal_to
						ignore_requirements = yes
					}
				}
			}
		}
	}
}

### Overthrow the Regency - no Regency Loyalist faction

# Regent gets ultimatum
letter_event = {
	id = japan.97
	desc = EVTDESC_JAPAN_97
	
	is_triggered_only = yes
	
	immediate = {
		diplomatic_immunity = yes 
	}
	
	option = {
		name = EVTOPTA_JAPAN_97 # I suppose I have to accept this...
		if = {
			limit = {
				has_dlc = "Jade Dragon"
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
				}
			}
			else_if = {
				limit = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_major_effect = yes
				}
			}
		}
		ai_chance = {
			factor = 5
			modifier = {
				factor = 0.75
				relative_power_to_liege = 0.75
			}
			modifier = {
				factor = 0
				relative_power_to_liege = 1.0
			}
			modifier = {
				factor = 1.25
				is_weak_trigger = yes
			}
			modifier = {
				factor = 1.25
				trait = craven
			}
			modifier = {
				factor = 1.25
				trait = humble
			}
			modifier = {
				factor = 1.25
				trait = kind
			}
			modifier = {
				factor = 1.25
				trait = charitable
			}
			modifier = {
				factor = 1.25
				trait = patient
			}
			modifier = {
				factor = 1.25
				trait = content
			}
		}
		
		remove_trait = japanese_regent2
		FROM = {
			remove_trait = under_regency2
		}
		
		hidden_tooltip = {
			diplomatic_immunity = no
			FROM = {
				letter_event = { id = japan.98 }
				diplomatic_immunity = no
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_97 # Never!
		if = {
			limit = {
				has_dlc = "Jade Dragon"
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
				}
			}
			else_if = {
				limit = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_major_effect = yes
				}
			}
		}
		ai_chance = {
			factor = 95
			modifier = {
				factor = 1.25
				is_strong_trigger = yes
			}
			modifier = {
				factor = 1.25
				trait = brave
			}
			modifier = {
				factor = 1.25
				trait = proud
			}
			modifier = {
				factor = 1.25
				trait = envious
			}
			modifier = {
				factor = 1.25
				trait = greedy
			}
			modifier = {
				factor = 1.25
				trait = wroth
			}
			modifier = {
				factor = 1.25
				trait = ambitious
			}
			modifier = {
				factor = 0.75
				NOT = {
					relative_power_to_liege = 1.5
				}
			}
		}
		hidden_tooltip = {
			if = {
				limit = {
					NOT = {
						relative_power_to_liege = 1.0
					}
				}
				random = {
					chance = 25
					character_event = { id = 45002 days = 120 } # Loyalists flock to the regent's banner
				}
			}
		}
		FROM = {
			letter_event = { id = japan.99 }
			hidden_tooltip = {
				if = {
					limit = {
						ROOT = {
							relative_power_to_liege = 1.5
						}
					}
					random_list = {
						50 = {
						}
						30 = {
							character_event = { id = 45000 days = 17 } # A great number of rebels flock to the liege's banner
						}
						20 = {
							character_event = { id = 45004 days = 17 } # Rebels flock to the liege's banner
						}
					}
				}
				if = {
					limit = {
						ROOT = {
							relative_power_to_liege = 1.0
							NOT = {
								relative_power_to_liege = 1.5
							}
						}
					}
					random_list = {
						75 = {
						}
						5 = {
							character_event = { id = 45000 days = 17 } # A great number of rebels flock to the liege's banner
						}
						20 = {
							character_event = { id = 45004 days = 17 } # Rebels flock to the liege's banner
						}
					}
				}
			}
		}
	}
}

# The liege is informed that the regent folded
letter_event = {
	id = japan.98
	desc = EVTDESC_JAPAN_98
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_98 # Assuming direct control!
		clr_character_flag = overthrow_my_regent_decision_taken
	}
}

# The liege is informed that the regent isn't folding
letter_event = {
	id = japan.99
	desc = EVTDESC_JAPAN_99
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_99 # Then face me in battle!
		FROM = {
			reverse_war = {
				target = ROOT
				casus_belli = end_regency_war2
			}
		}
		
		clr_character_flag = overthrow_my_regent_decision_taken
	}
}

### japan.101-400 are reserved for the Hanami events

### Overthrow the Regency - Regency Loyalist faction exists

# Regent gets ultimatum
letter_event = {
	id = japan.100
	desc = EVTDESC_JAPAN_100
	
	is_triggered_only = yes
	
	immediate = {
		diplomatic_immunity = yes 
		any_faction_backer = {
			faction = faction_regent_loyalists2
			diplomatic_immunity = yes
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_100 # I suppose I have to accept this...
		if = {
			limit = {
				has_dlc = "Jade Dragon"
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
				}
			}
			else_if = {
				limit = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_major_effect = yes
				}
			}
		}
		ai_chance = {
			factor = 5
			modifier = {
				factor = 0.5
				faction_power = {
					faction = faction_regent_loyalists2
					power = 1.0
				}
			}	
			modifier = {
				factor = 0
				faction_power = {
					faction = faction_regent_loyalists2
					power = 1.5
				}
			}	
			modifier = {
				factor = 1.25
				is_weak_trigger = yes
			}
			modifier = {
				factor = 1.25
				trait = craven
			}
			modifier = {
				factor = 1.25
				trait = humble
			}
			modifier = {
				factor = 1.25
				trait = kind
			}
			modifier = {
				factor = 1.25
				trait = charitable
			}
			modifier = {
				factor = 1.25
				trait = patient
			}
			modifier = {
				factor = 1.25
				trait = content
			}
		}
		
		remove_trait = japanese_regent2
		FROM = {
			remove_trait = under_regency2
		}
		
		hidden_tooltip = {
			any_faction_backer = {
				faction = faction_regent_loyalists2
				letter_event = { id = japan.401 }
				diplomatic_immunity = no
			}
			letter_event = { id = japan.402 }
			diplomatic_immunity = no
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_100 # Never!
		if = {
			limit = {
				has_dlc = "Jade Dragon"
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
				}
			}
			else_if = {
				limit = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_major_effect = yes
				}
			}
		}
		ai_chance = {
			factor = 95
			modifier = {
				factor = 1.25
				is_strong_trigger = yes
			}
			modifier = {
				factor = 1.25
				trait = brave
			}
			modifier = {
				factor = 1.25
				trait = proud
			}
			modifier = {
				factor = 1.25
				trait = envious
			}
			modifier = {
				factor = 1.25
				trait = greedy
			}
			modifier = {
				factor = 1.25
				trait = wroth
			}
			modifier = {
				factor = 1.25
				trait = ambitious
			}
			modifier = {
				factor = 2
				faction_power = {
					faction = faction_regent_loyalists2
					power = 1.5
				}
			}
			modifier = {
				factor = 2
				faction_power = {
					faction = faction_regent_loyalists2
					power = 1.0
				}
			}
			modifier = {
				factor = 2
				faction_power = {
					faction = faction_regent_loyalists2
					power = 2.0
				}
			}
			modifier = {
				factor = 2
				faction_power = {
					faction = faction_regent_loyalists
					power = 3.0
				}
			}	
			modifier = {
				factor = 2
				faction_power = {
					faction = faction_regent_loyalists2
					power = 4.0
				}
			}
		}
		hidden_tooltip = {
			if = {
				limit = {
					faction_power = { faction = faction_regent_loyalists2 power = 1.0 }
				}
				random = {
					chance = 25
					character_event = { id = 45002 days = 120 } # Loyalists flock to the regent's banner
				}
			}
		}
		FROM = {
			letter_event = { id = japan.403 }
			hidden_tooltip = {
				if = {
					limit = {
						ROOT = {
							faction_power = { faction = faction_regent_loyalists2 power = 1.5 }
						}
					}
					random_list = {
						50 = {
						}
						30 = {
							character_event = { id = 45000 days = 17 } # A great number of rebels flock to the liege's banner
						}
						20 = {
							character_event = { id = 45004 days = 17 } # Rebels flock to the liege's banner
						}
					}
				}
				if = {
					limit = {
						ROOT = {
							faction_power = { faction = faction_regent_loyalists2 power = 0.75 }
							NOT = {
								faction_power = { faction = faction_regent_loyalists2 power = 1.5 }
							}
						}
					}
					random_list = {
						75 = {
						}
						5 = {
							character_event = { id = 45000 days = 17 } # A great number of rebels flock to the liege's banner
						}
						20 = {
							character_event = { id = 45004 days = 17 } # Rebels flock to the liege's banner
						}
					}
				}
			}
		}
	}
}

# Faction members are informed that the regent folded
letter_event = {
	id = japan.401
	desc = EVTDESC_JAPAN_401
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_401 # Really? We had your back!
	}
}

# The liege is informed that the regent folded
letter_event = {
	id = japan.402
	desc = EVTDESC_JAPAN_402
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_402 # Assuming direct control!
		clr_character_flag = overthrow_my_regent_decision_taken
	}
}

# The liege is informed that the regent isn't folding
letter_event = {
	id = japan.403
	desc = EVTDESC_JAPAN_403
	
	is_triggered_only = yes
	
	immediate = {
		FROM = {
			any_faction_backer = {
				faction = faction_regent_loyalists2
				reverse_opinion = {
					modifier = opinion_fought_for_regent
					who = FROM
					years = 20
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_403 # Then face me in battle!
		
		FROM = {
			faction_regent_loyalists2 = { # The target (title) of the faction
				reverse_war = {
					target = FROM
					casus_belli = end_regency_war_faction2
					faction = faction_regent_loyalists
				}
			}
		}
		
		clr_character_flag = overthrow_my_regent_decision_taken
	}
}

# on_startup regency setup (the first event sometimes gets... weird)
character_event = {
	id = japan.404
	hide_window = yes
	is_triggered_only = yes
	
	only_playable = yes
	
	trigger = {
		trait = japanese_regent2
		liege = {
			trait = under_regency2
		}
	}
	
	immediate = {
		liege = {
			random_vassal = {
				limit = {
					trait = japanese_regent2
				}
				liege = {
					regent = {
						remove_title = title_regent
					}
				}
				give_minor_title = title_regent
				give_minor_title = title_appointed_regent
			}
			primary_title = {
				save_event_target_as = regency_loyalist_title
			}
			regent = {
				if = {
					limit = {
						higher_tier_than = baron
					}
					start_faction = {
						faction = faction_regent_loyalists2
						title = event_target:regency_loyalist_title
					}
					save_event_target_as = regent_to_be_loyal_to
					if = {
						limit = {
							NOT = {
								dynasty = ROOT
							}
						}
						any_dynasty_member = {
							limit = {
								is_landed = yes
								higher_tier_than = baron
								liege = {
									character = ROOT
								}
								NOT = {
									has_non_aggression_pact_with = ROOT
								}
							}
							join_faction = {
								faction = faction_regent_loyalists2
								faction_leader = event_target:regent_to_be_loyal_to
								ignore_requirements = yes
							}
						}
					}
				}
			}
		}
	}
}

##### Anti-Minamoto/-Taira takeover

# If the Imperial Family loses the Chrysanthemum Throne, enable factioning
character_event = {
	id = japan.405
	is_triggered_only = yes
	hide_window = yes
	
	only_playable = yes
	
	trigger = {
		FROM = {
			title = k_chrysanthemum_throne
		}
		NOT = {
			dynasty = 1000027000 # The Imperial Family
		}
		NOT = {
			has_global_flag = imperial_family_deposed
		}
	}
	
	immediate = {
		set_global_flag = imperial_family_deposed
	}
}

##### Wako (Wokou) events - add cultural buildings + game rule + localization

# Low chance of a Yamato or Japanese island or coastal province swapping to Wako culture
province_event = {
	id = japan.406
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	desc = EVTDESC_JAPAN_406
	
	trigger = {
		port = yes
		OR = {
			# In Japan or Korea
			region = world_japan
			region = custom_yezo
			region = world_japan_islands
			region = world_korea
		}
		OR = {
			culture = japanese
			culture = yamato
		}
		OR = {
			religion = shinto
			religion = buddhist
		}
	}
	
	mean_time_to_happen = {
		months = 1000
		
		# Is not an island or "island"
		modifier = {
			factor = 5
			any_neighbor_province = {
				count = 2
				is_land = yes
			}
		}
		
		# Is really not an island
		modifier = {
			factor = 10
			any_neighbor_province = {
				is_land = yes
				port = no
			}
		}
		modifier = {
			factor = 0.9
			any_neighbor_province = {
				culture = wako # More common if adjacent
			}
		}
	}
	
	option = {
		trigger = {
			owner = {
				NOT = {
					culture = wako
				}
			}
		}
		name = EVTOPTA_JAPAN_406 # Let's hope they behave...
		culture = wako
	}
	
	option = {
		trigger = {
			owner = {
				culture = wako
			}
		}
		name = EVTOPTB_JAPAN_406 # That's... good?
		culture = wako
	}
}

# Low chance of a Pirate Haven spawning in a Wako province
province_event = {
	id = japan.407
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	desc = EVTDESC_JAPAN_407
	
	trigger = {
		port = yes
		OR = {
			# In Japan or Korea
			region = world_japan
			region = custom_yezo
			region = world_japan_islands
			region = world_korea
		}
		culture = wako
		OR = {
			religion = shinto
			religion = buddhist
		}
		NOT = {
			has_province_modifier = pirate_haven
		}
		owner = {
			NOR = {
				AND = {
					culture = wako
					independent = yes
				}
				top_liege = {
					culture = wako
				}
			}
		}
	}
	
	mean_time_to_happen = {
		months = 120
		
		# Is not an island or "island"
		modifier = {
			factor = 5
			any_neighbor_province = {
				count = 2
				is_land = yes
			}
		}
		
		# Is really not an island
		modifier = {
			factor = 10
			any_neighbor_province = {
				is_land = yes
				port = no
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_407 # Let's hope they know not to raid my coasts!
		add_province_modifier = {
			modifier = pirate_haven
			duration = -1
		}
	}
}

# Pirate Haven modifier removed
province_event = {
	id = japan.408
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	desc = EVTDESC_JAPAN_408
	
	trigger = {
		port = yes
		has_province_modifier = pirate_haven
	}
	
	mean_time_to_happen = {
		months = 240
		
		# Isn't a Wako province
		modifier = {
			factor = 0.1
			NAND = {
				culture = wako
				OR = {
					religion = shinto
					religion = buddhist
				}
			}
		}
		
		# Owner or liege is Wako
		modifier = {
			factor = 0.1
			owner = {
				OR = {
					culture = wako
					any_liege = {
						culture = wako
					}
				}
			}
		}
		
		# Owner has high stewardship
		modifier = {
			factor = 0.8
			owner = {
				stewardship = 12
			}
		}
		modifier = {
			factor = 0.8
			owner = {
				stewardship = 16
			}
		}
		modifier = {
			factor = 0.8
			owner = {
				stewardship = 20
			}
		}
		modifier = {
			factor = 0.8
			owner = {
				stewardship = 24
			}
		}
	}
	
	option = {
		trigger = {
			owner = {
				NOT = {
					culture = wako
				}
			}
		}
		name = EVTOPTA_JAPAN_408 # Good riddance!
		remove_province_modifier = pirate_haven
	}
	
	option = {
		trigger = {
			owner = {
				culture = wako
			}
		}
		name = EVTOPTB_JAPAN_408 # I can organize my own raids!
		remove_province_modifier = pirate_haven
	}
}

# Low chance of a Wako raid spawning in a province with a Pirate Haven
character_event = {
	id = japan.409
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	desc = EVTDESC_JAPAN_409
	
	only_playable = yes
	
	has_dlc = "Horse Lords" # Raiding adventurers
		
	trigger = {
		always = no # Not working well
		any_demesne_province = {
			culture = wako
			has_province_modifier = pirate_haven
		}
	}
	
	mean_time_to_happen = {
		months = 120
	}
	
	immediate = {
		random_demesne_province = {
			limit = {
				culture = wako
				has_province_modifier = pirate_haven
			}
			save_event_target_as = wako_province
			random_list = {
				95 = {
					create_character = {
						random_traits = yes
						age = 25
						female = no
						dynasty = none
						culture = wako
						religion = shinto
						attributes = {
							martial = 5
						}
						trait = tough_soldier
					}
				}
				5 = {
					create_character = {
						random_traits = yes
						age = 25
						female = yes
						dynasty = none
						culture = wako
						religion = shinto
						trait = pirate
						attributes = {
							martial = 5
						}
						trait = tough_soldier
					}
				}
			}
			new_character = {
				if = {
					limit = {
						has_dlc = "Holy Fury"
					}
					add_trait = pirate
				}
				add_trait = adventurer
				# Pirate flavour
				random_list = {
					5 = {
						add_trait = one_legged
					}
					5 = {
						add_trait = one_eyed
					}
					5 = {
						add_trait = one_handed
					}
					5 = {
						add_trait = duelist
					}
					5 = {
						add_trait = scurvy
					}
					5 = {
						add_trait = drunkard
					}
					5 = {
						add_trait = hedonist
					}
					5 = {
						if = {
							limit = {
								is_female = yes
							}
							add_trait = seductress
						}
						else = {
							add_trait = seducer
						}
					}
					5 = {
						add_trait = falconer
					}
					5 = {
						add_trait = lustful
					}
					5 = {
						add_trait = greedy
					}
					5 = {
						add_trait = arbitrary
					}
					5 = {
						add_trait = deceitful
					}
					5 = {
						add_trait = envious
					}
					5 = {
						add_trait = brave
					}
					5 = {
						add_trait = cruel
					}
					5 = {
						add_trait = craven
					}
					5 = {
						add_trait = aggressive_leader
					}
					5 = {
						add_trait = inspiring_leader
					}
					5 = {
						add_trait = trickster
					}
				}
				random_list = {
					5 = {
						add_trait = one_legged
					}
					5 = {
						add_trait = one_eyed
					}
					5 = {
						add_trait = one_handed
					}
					5 = {
						add_trait = duelist
					}
					5 = {
						add_trait = scurvy
					}
					5 = {
						add_trait = drunkard
					}
					5 = {
						add_trait = hedonist
					}
					5 = {
						if = {
							limit = {
								is_female = yes
							}
							add_trait = seductress
						}
						else = {
							add_trait = seducer
						}
					}
					5 = {
						add_trait = falconer
					}
					5 = {
						add_trait = lustful
					}
					5 = {
						add_trait = greedy
					}
					5 = {
						add_trait = arbitrary
					}
					5 = {
						add_trait = deceitful
					}
					5 = {
						add_trait = envious
					}
					5 = {
						add_trait = brave
					}
					5 = {
						add_trait = cruel
					}
					5 = {
						add_trait = craven
					}
					5 = {
						add_trait = aggressive_leader
					}
					5 = {
						add_trait = inspiring_leader
					}
					5 = {
						add_trait = trickster
					}
				}
				random_list = {
					5 = {
						add_trait = one_legged
					}
					5 = {
						add_trait = one_eyed
					}
					5 = {
						add_trait = one_handed
					}
					5 = {
						add_trait = duelist
					}
					5 = {
						add_trait = scurvy
					}
					5 = {
						add_trait = drunkard
					}
					5 = {
						add_trait = hedonist
					}
					5 = {
						if = {
							limit = {
								is_female = yes
							}
							add_trait = seductress
						}
						else = {
							add_trait = seducer
						}
					}
					5 = {
						add_trait = falconer
					}
					5 = {
						add_trait = lustful
					}
					5 = {
						add_trait = greedy
					}
					5 = {
						add_trait = arbitrary
					}
					5 = {
						add_trait = deceitful
					}
					5 = {
						add_trait = envious
					}
					5 = {
						add_trait = brave
					}
					5 = {
						add_trait = cruel
					}
					5 = {
						add_trait = craven
					}
					5 = {
						add_trait = aggressive_leader
					}
					5 = {
						add_trait = inspiring_leader
					}
					5 = {
						add_trait = trickster
					}
				}
				save_event_target_as = wako_raider
				set_character_flag = raiding_adventurer
				set_defacto_liege = THIS
				create_title = {
					tier = DUKE
					landless = yes
					adventurer = yes
					culture = ROOT
					name = "PIRATE_RAIDERS"
					holder = THIS
					base_title = THIS
				}
				# Create a fleet
				spawn_unit = {
					province = event_target:wako_province
					home = event_target:wako_province
					owner = event_target:wako_raider
					troops = {
						light_infantry = { 250 250 }
						archers = { 250 250 }
						heavy_infantry = { 50 50 }
						pikemen = { 50 50 }
					}
					attrition = 0
					disband_on_peace = yes
					reinforces = yes
					is_looter = yes
					can_toggle_looting = no
					cannot_inherit = yes
					earmark = wako_raiders
				}
				spawn_fleet = {
					province = closest # closest sea zone
					owner = event_target:wako_raider
					troops = {
						galleys = { 10 10 }
					}
					cannot_inherit = yes
					earmark = wako_raiders
				}
				random = {
					chance = 25
					modifier = {
						factor = 2
						year = 1000
					}
					spawn_unit = {
						province = event_target:wako_province
						owner = event_target:wako_raider
						troops = {
							light_infantry = { 250 250 }
							archers = { 250 250 }
							heavy_infantry = { 50 50 }
							pikemen = { 50 50 }
						}
						attrition = 0
						disband_on_peace = yes
						reinforces = yes
						is_looter = yes
						can_toggle_looting = no
						cannot_inherit = yes
						earmark = wako_raiders
					}
					spawn_fleet = {
						province = closest # closest sea zone
						owner = event_target:wako_raider
						troops = {
							galleys = { 10 10 }
						}
						cannot_inherit = yes
						earmark = wako_raiders
					}
				}
				random = {
					chance = 5
					modifier = {
						factor = 2
						year = 1200
					}
					spawn_unit = {
						province = event_target:wako_province
						owner = event_target:wako_raider
						troops = {
							light_infantry = { 250 250 }
							archers = { 250 250 }
							heavy_infantry = { 50 50 }
							pikemen = { 50 50 }
						}
						attrition = 0
						disband_on_peace = yes
						reinforces = yes
						is_looter = yes
						can_toggle_looting = no
						cannot_inherit = yes
						earmark = wako_raiders
					}
					spawn_fleet = {
						province = closest # closest sea zone
						owner = event_target:wako_raider
						troops = {
							galleys = { 10 10 }
						}
						cannot_inherit = yes
						earmark = wako_raiders
					}
				}
				ROOT = {
					reverse_opinion = {
						who = event_target:wako_raider
						modifier = forbidden_raid_target
					}
					any_liege = {
						reverse_opinion = {
							who = event_target:wako_raider
							modifier = forbidden_raid_target
						}
					}
				}
				character_event = { id = japan.410 months = 120 random = 60 } # Stand down
			}
		}
	}
	
	option = {
		trigger = {
			NOT = {
				culture = wako
			}
		}
		name = EVTOPTA_JAPAN_409 # Be gone!
	}
	
	option = {
		trigger = {
			culture = wako
		}
		name = EVTOPTB_JAPAN_409 # I don't need them!
	}
}

# Raiders disband
character_event = {
	id = japan.410
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	desc = EVTDESC_JAPAN_410
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_410 # I don't need them!
		
		any_demesne_title = {
			limit = {
				adventurer = yes
			}
			unsafe_destroy_landed_title = THIS
		}
	}
}

##### Succession meddling and nullifying - AI only since the player handles it with decisions

# Meddle - on_yearly_pulse
character_event = {
	id = japan.411
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	
	trigger = {
		trait = japanese_regent
		has_minor_title = title_regent
		liege = {
			religion = shinto
			OR = {
				controls_religion = yes
				has_character_flag = temporarily_japanese_imperial
			}
			primary_title = {
				has_law = regent_succession_control_1
			}
		}
		prestige = 500
		has_regent = no
		ai = yes
	}
	
	immediate = {
		log = "[Root.GetBestName] might meddle in the Tenno's succession!"
		
		if = {
			limit = {
				NOT = {
					has_character_modifier = meddled_in_succession
				}
			}
			log = "[Root.GetBestName] has not already meddled!"
			set_character_flag = new_meddling
			
			# Try to figure out if we want to meddle
			
			set_variable = {
				which = meddling_desire
				value = 0
			}
			
			k_chrysanthemum_throne = {
				holder_scope = {
					current_heir = {
						save_event_target_as = current_chrysanthemum_throne_heir
						log = "The current heir to the Chrysanthemum Throne is [current_chrysanthemum_throne_heir.GetBestName]"
					}
					ROOT = {
						save_event_target_as = regent_or_tenno
					}
					any_dynasty_member = {
						limit = {
							religion = shinto # Vanilla is strict when it comes to religion and rel head succession, so we should probably be as strict in case there are issues...;;;;;;;;;;;;;x
							NOT = {
								trait = bastard
							}
							OR = { #Candidate should not be a landless Courtier that is about to inherit a Theocracy or Republic
								AND = {
									is_ruler = yes
									is_landed = yes
									is_republic = no
									is_merchant_republic = no
									is_theocracy = no
								}
								NOR = {
									any_heir_title = {
										is_republic = yes
									}
									any_heir_title = {
										is_merchant_republic = yes
									}
									any_heir_title = {
										is_theocracy = yes
									}
								}
							}
							NOR = {
								trait = cat
								trait = disinherited
								trait = horse
								trait = eunuch
								AND = { 
									trait = bastard 
									is_ruler = no
								}
								is_ascetic_trigger = yes
								is_theocracy = yes
								is_republic = yes
								is_merchant_republic = yes
							}
						}
						score_value = {
							value = 1
							tenno_succession_candidate_weight = yes # Find our preferred heir
						}
						save_event_target_as = preferred_chrysanthemum_throne_heir
						log = "The preferred heir to the Chrysanthemum Throne is [current_chrysanthemum_throne_heir.GetBestName]"
					}
				}
			}
			
			score_current_chrysanthemum_throne_heir_effect = yes
			log = "The current heir's score is [current_heir_score.GetValue]"

			##########################   Ruler's traits   ##########################
			# Only includes the negative ones; the Regent doesn't care for a great ruler
			# Ruler is lunatic, vote against his pick
			if = {
				limit = {
					NOT = { character = event_target:current_chrysanthemum_throne_heir } #But not if it's me.
					NOR = {
						trait = lunatic #Don't care
						trait = possessed #Don't care
						trait = arbitrary #Don't care
						trait = zealous #Might be the gods speaking
					}
					k_chrysanthemum_throne = {
						holder_scope = {
							trait = lunatic
						} 
					}
				}
				change_variable = {
					which = current_heir_score
					value = -100
				}
			}
			#Ruler is possessed, vote against his pick
			if = {
				limit = {
					NOT = { character = event_target:current_chrysanthemum_throne_heir } #But not if it's me.
					trait = zealous
					NOR = {
						trait = lunatic #Don't care
						trait = possessed #Don't care
						trait = arbitrary #Don't care
					}
					k_chrysanthemum_throne = {
						holder_scope = {
							trait = possessed
						} 
					}
				}
				change_variable = {
					which = current_heir_score
					value = -100
				}
			}
			#Ruler is a Tyrant (Opinion), vote against his pick
			if = {
				limit = {
					NOT = { character = event_target:current_chrysanthemum_throne_heir } #But not if it's me.
					NOR = {
						trait = lunatic #Don't care
						trait = possessed #Don't care
						trait = arbitrary #Don't care
					}
					k_chrysanthemum_throne = {
						holder_scope = {
							ROOT = {
								has_opinion_modifier = {
									modifier = opinion_tyrant
									who = PREV
								} 
							} 
						} 
					}
				}
				change_variable = {
					which = current_heir_score
					value = -1000
				}
			}
			##########################   Raw Opinion bonus towards Ruler   ##########################
			if = {
				limit = {
					NOT = { character = event_target:current_chrysanthemum_throne_heir } #But not if it's me.
					k_chrysanthemum_throne = {
						holder_scope = {
							NOT = { character = ROOT } #Of course you trust your own opinion of your candidate...
							NOT = { 
								reverse_opinion = { who = ROOT value = -75 } 
							} 
						} 
					}
				}
				change_variable = { #Vassal hates ruler, therefore votes against the ruler's candidate
					which = current_heir_score
					value = -30
				}
			}
			if = {
				limit = {
					NOT = { character = event_target:current_chrysanthemum_throne_heir } #But not if it's me.
					k_chrysanthemum_throne = {
						holder_scope = {
							NOT = { character = ROOT } #Of course you trust your own opinion of your candidate...
							NOT = { 
								reverse_opinion = { who = ROOT value = -50 } 
							} 
							reverse_opinion = { who = ROOT value = -75 } 
						} 
					}
				}
				change_variable = { #Vassal hates ruler, therefore votes against the ruler's candidate
					which = current_heir_score
					value = -20
				}
			}
			if = {
				limit = {
					NOT = { character = event_target:current_chrysanthemum_throne_heir } #But not if it's me.
					k_chrysanthemum_throne = {
						holder_scope = {
							NOT = { character = ROOT } #Of course you trust your own opinion of your candidate...
							NOT = { 
								reverse_opinion = { who = ROOT value = -25 } 
							} 
							reverse_opinion = { who = ROOT value = -50 } 
						} 
					}
				}
				change_variable = { #Vassal hates ruler, therefore votes against the ruler's candidate (FROMFROMFROM)
					which = current_heir_score
					value = -10
				}
			}
			if = {
				limit = {
					NOT = { character = event_target:current_chrysanthemum_throne_heir } #But not if it's me.
					k_chrysanthemum_throne = {
						holder_scope = {
							NOT = { character = ROOT } #Of course you trust your own opinion of your candidate...
							NOT = { 
								reverse_opinion = { who = ROOT value = 0 } 
							} 
							reverse_opinion = { who = ROOT value = -25 } 
						} 
					}
				}
				change_variable = { #Vassal hates ruler, therefore votes against the ruler's candidate
					which = current_heir_score
					value = -5
				}
			}
			if = {
				limit = {
					NOT = { character = event_target:current_chrysanthemum_throne_heir } #But not if it's me.
					k_chrysanthemum_throne = {
						holder_scope = {
							NOT = { character = ROOT } #Of course you trust your own opinion of your candidate...
							reverse_opinion = { who = ROOT value = 0 } 
							NOT = { 
								reverse_opinion = { who = ROOT value = 25 } 
							} 
						} 
					}
				}
				change_variable = { #Vassal loves ruler, therefore votes for the ruler's candidate
					which = current_heir_score
					value = 10
				}
			}
			if = {
				limit = {
					NOT = { character = event_target:current_chrysanthemum_throne_heir } #But not if it's me.
					k_chrysanthemum_throne = {
						holder_scope = {
							NOT = { character = ROOT } #Of course you trust your own opinion of your candidate...
							reverse_opinion = { who = ROOT value = 25 } 
							NOT = { 
								reverse_opinion = { who = ROOT value = 50 } 
							} 
						} 
					}
				}
				change_variable = { #Vassal loves ruler, therefore votes for the ruler's candidate
					which = current_heir_score
					value = 20
				}
			}
			if = {
				limit = {
					NOT = { character = event_target:current_chrysanthemum_throne_heir } #But not if it's me.
					k_chrysanthemum_throne = {
						holder_scope = {
							NOT = { character = ROOT } #Of course you trust your own opinion of your candidate...
							reverse_opinion = { who = ROOT value = 50 } 
							NOT = { 
								reverse_opinion = { who = ROOT value = 75 } 
							} 
						} 
					}
				}
				change_variable = { #Vassal loves ruler, therefore votes for the ruler's candidate
					which = current_heir_score
					value = 40
				}
			}
			if = {
				limit = {
					NOT = { character = event_target:current_chrysanthemum_throne_heir } #But not if it's me.
					k_chrysanthemum_throne = {
						holder_scope = {
							NOT = { character = ROOT } #Of course you trust your own opinion of your candidate...
							reverse_opinion = { who = ROOT value = 75 } 
						} 
					}
				}
				change_variable = { #Vassal loves ruler, therefore votes for the ruler's candidate
					which = current_heir_score
					value = 60
				}
			}
			
			score_preferred_chrysanthemum_throne_heir_effect = yes
			log = "The preferred heir's score is"
			
			set_variable = {
				which = meddling_desire
				which = preferred_heir_score
			}
			subtract_variable = {
				which = meddling_desire
				which = current_heir_score
			}
			
			# Increase/decrease meddling willingness based on traits
			if = {
				limit = {
					trait = ambitious
				}
				change_variable = {
					which = meddling_desire
					value = 500
				}
			}
			if = {
				limit = {
					trait = proud
				}
				change_variable = {
					which = meddling_desire
					value = 250
				}
			}
			if = {
				limit = {
					trait = envious
				}
				change_variable = {
					which = meddling_desire
					value = 250
				}
			}
			if = {
				limit = {
					trait = deceitful
				}
				change_variable = {
					which = meddling_desire
					value = 250
				}
			}
			if = {
				limit = {
					trait = arbitrary
				}
				change_variable = {
					which = meddling_desire
					value = 250
				}
			}
			if = {
				limit = {
					trait = content
				}
				change_variable = {
					which = meddling_desire
					value = -250 # Not -500; you could be content with the current state of affairs!
				}
			}
			if = {
				limit = {
					trait = humble
				}
				change_variable = {
					which = meddling_desire
					value = -250
				}
			}
			if = {
				limit = {
					trait = kind
				}
				change_variable = {
					which = meddling_desire
					value = -250
				}
			}
			if = {
				limit = {
					trait = honest
				}
				change_variable = {
					which = meddling_desire
					value = -250
				}
			}
			if = {
				limit = {
					trait = just
				}
				change_variable = {
					which = meddling_desire
					value = -250
				}
			}
			
			# Rivalry/etc. with the Tenno
			if = {
				limit = {
					k_chrysanthemum_throne = {
						holder_scope = {
							any_rival = {
								character = ROOT
							}
						}
					}
				}
				change_variable = {
					which = meddling_desire
					value = 1000
				}
			}
			if = {
				limit = {
					k_chrysanthemum_throne = {
						holder_scope = {
							any_friend = {
								character = ROOT
							}
						}
					}
				}
				change_variable = {
					which = meddling_desire
					value = -500
				}
			}
			if = {
				limit = {
					k_chrysanthemum_throne = {
						holder_scope = {
							any_lover = {
								character = ROOT
							}
						}
					}
				}
				change_variable = {
					which = meddling_desire
					value = -500
				}
			}
			
			log = "Meddling desire is [meddling_desire.GetValue]"
		}
		
		else = {
			log = "[Root.GetBestName] has already meddled!"
			
			# Determine if we wish to continue meddling; based on ROOT's traits
			
			set_variable = {
				which = meddling_desire
				value = 0
			}
			
			# Increase/decrease meddling willingness based on traits
			if = {
				limit = {
					trait = ambitious
				}
				change_variable = {
					which = meddling_desire
					value = 500
				}
			}
			if = {
				limit = {
					trait = proud
				}
				change_variable = {
					which = meddling_desire
					value = 250
				}
			}
			if = {
				limit = {
					trait = envious
				}
				change_variable = {
					which = meddling_desire
					value = 250
				}
			}
			if = {
				limit = {
					trait = deceitful
				}
				change_variable = {
					which = meddling_desire
					value = 250
				}
			}
			if = {
				limit = {
					trait = arbitrary
				}
				change_variable = {
					which = meddling_desire
					value = 250
				}
			}
			if = {
				limit = {
					trait = content
				}
				change_variable = {
					which = meddling_desire
					value = -250 # Not -500; you could be content with the current state of affairs!
				}
			}
			if = {
				limit = {
					trait = humble
				}
				change_variable = {
					which = meddling_desire
					value = -250
				}
			}
			if = {
				limit = {
					trait = kind
				}
				change_variable = {
					which = meddling_desire
					value = -250
				}
			}
			if = {
				limit = {
					trait = honest
				}
				change_variable = {
					which = meddling_desire
					value = -250
				}
			}
			if = {
				limit = {
					trait = just
				}
				change_variable = {
					which = meddling_desire
					value = -250
				}
			}

			##########################   Ruler's traits   ##########################
			# Only includes the negative ones; the Regent doesn't care for a great ruler
			# Ruler is lunatic, vote against his pick
			if = {
				limit = {
					NOT = { character = event_target:current_chrysanthemum_throne_heir } #But not if it's me.
					NOR = {
						trait = lunatic #Don't care
						trait = possessed #Don't care
						trait = arbitrary #Don't care
						trait = zealous #Might be the gods speaking
					}
					k_chrysanthemum_throne = {
						holder_scope = {
							trait = lunatic
						} 
					}
				}
				change_variable = {
					which = meddling_desire
					value = 100
				}
			}
			#Ruler is possessed, vote against his pick
			if = {
				limit = {
					NOT = { character = event_target:current_chrysanthemum_throne_heir } #But not if it's me.
					trait = zealous
					NOR = {
						trait = lunatic #Don't care
						trait = possessed #Don't care
						trait = arbitrary #Don't care
					}
					k_chrysanthemum_throne = {
						holder_scope = {
							trait = possessed
						} 
					}
				}
				change_variable = {
					which = meddling_desire
					value = 100
				}
			}
			#Ruler is a Tyrant (Opinion), vote against his pick
			if = {
				limit = {
					NOT = { character = event_target:current_chrysanthemum_throne_heir } #But not if it's me.
					NOR = {
						trait = lunatic #Don't care
						trait = possessed #Don't care
						trait = arbitrary #Don't care
					}
					k_chrysanthemum_throne = {
						holder_scope = {
							ROOT = {
								has_opinion_modifier = {
									modifier = opinion_tyrant
									who = PREV
								} 
							} 
						} 
					}
				}
				change_variable = {
					which = meddling_desire
					value = 1000
				}
			}
			##########################   Raw Opinion bonus towards Ruler   ##########################
			if = {
				limit = {
					NOT = { character = event_target:current_chrysanthemum_throne_heir } #But not if it's me.
					k_chrysanthemum_throne = {
						holder_scope = {
							NOT = { character = ROOT } #Of course you trust your own opinion of your candidate...
							NOT = { 
								reverse_opinion = { who = ROOT value = -75 } 
							} 
						} 
					}
				}
				change_variable = { #Vassal hates ruler, therefore votes against the ruler's candidate
					which = meddling_desire
					value = 30
				}
			}
			if = {
				limit = {
					NOT = { character = event_target:current_chrysanthemum_throne_heir } #But not if it's me.
					k_chrysanthemum_throne = {
						holder_scope = {
							NOT = { character = ROOT } #Of course you trust your own opinion of your candidate...
							NOT = { 
								reverse_opinion = { who = ROOT value = -50 } 
							} 
							reverse_opinion = { who = ROOT value = -75 } 
						} 
					}
				}
				change_variable = { #Vassal hates ruler, therefore votes against the ruler's candidate
					which = meddling_desire
					value = 20
				}
			}
			if = {
				limit = {
					NOT = { character = event_target:current_chrysanthemum_throne_heir } #But not if it's me.
					k_chrysanthemum_throne = {
						holder_scope = {
							NOT = { character = ROOT } #Of course you trust your own opinion of your candidate...
							NOT = { 
								reverse_opinion = { who = ROOT value = -25 } 
							} 
							reverse_opinion = { who = ROOT value = -50 } 
						} 
					}
				}
				change_variable = { #Vassal hates ruler, therefore votes against the ruler's candidate (FROMFROMFROM)
					which = meddling_desire
					value = 10
				}
			}
			if = {
				limit = {
					NOT = { character = event_target:current_chrysanthemum_throne_heir } #But not if it's me.
					k_chrysanthemum_throne = {
						holder_scope = {
							NOT = { character = ROOT } #Of course you trust your own opinion of your candidate...
							NOT = { 
								reverse_opinion = { who = ROOT value = 0 } 
							} 
							reverse_opinion = { who = ROOT value = -25 } 
						} 
					}
				}
				change_variable = { #Vassal hates ruler, therefore votes against the ruler's candidate
					which = meddling_desire
					value = 5
				}
			}
			if = {
				limit = {
					NOT = { character = event_target:current_chrysanthemum_throne_heir } #But not if it's me.
					k_chrysanthemum_throne = {
						holder_scope = {
							NOT = { character = ROOT } #Of course you trust your own opinion of your candidate...
							reverse_opinion = { who = ROOT value = 0 } 
							NOT = { 
								reverse_opinion = { who = ROOT value = 25 } 
							} 
						} 
					}
				}
				change_variable = { #Vassal loves ruler, therefore votes for the ruler's candidate
					which = meddling_desire
					value = -10
				}
			}
			if = {
				limit = {
					NOT = { character = event_target:current_chrysanthemum_throne_heir } #But not if it's me.
					k_chrysanthemum_throne = {
						holder_scope = {
							NOT = { character = ROOT } #Of course you trust your own opinion of your candidate...
							reverse_opinion = { who = ROOT value = 25 } 
							NOT = { 
								reverse_opinion = { who = ROOT value = 50 } 
							} 
						} 
					}
				}
				change_variable = { #Vassal loves ruler, therefore votes for the ruler's candidate
					which = meddling_desire
					value = -20
				}
			}
			if = {
				limit = {
					NOT = { character = event_target:current_chrysanthemum_throne_heir } #But not if it's me.
					k_chrysanthemum_throne = {
						holder_scope = {
							NOT = { character = ROOT } #Of course you trust your own opinion of your candidate...
							reverse_opinion = { who = ROOT value = 50 } 
							NOT = { 
								reverse_opinion = { who = ROOT value = 75 } 
							} 
						} 
					}
				}
				change_variable = { #Vassal loves ruler, therefore votes for the ruler's candidate
					which = meddling_desire
					value = -40
				}
			}
			if = {
				limit = {
					NOT = { character = event_target:current_chrysanthemum_throne_heir } #But not if it's me.
					k_chrysanthemum_throne = {
						holder_scope = {
							NOT = { character = ROOT } #Of course you trust your own opinion of your candidate...
							reverse_opinion = { who = ROOT value = 75 } 
						} 
					}
				}
				change_variable = { #Vassal loves ruler, therefore votes for the ruler's candidate
					which = meddling_desire
					value = -60
				}
			}
			
			# Rivalry/etc. with the Tenno
			if = {
				limit = {
					k_chrysanthemum_throne = {
						holder_scope = {
							any_rival = {
								character = ROOT
							}
						}
					}
				}
				change_variable = {
					which = meddling_desire
					value = 1000
				}
			}
			if = {
				limit = {
					k_chrysanthemum_throne = {
						holder_scope = {
							any_friend = {
								character = ROOT
							}
						}
					}
				}
				change_variable = {
					which = meddling_desire
					value = -500
				}
			}
			if = {
				limit = {
					k_chrysanthemum_throne = {
						holder_scope = {
							any_lover = {
								character = ROOT
							}
						}
					}
				}
				change_variable = {
					which = meddling_desire
					value = -500
				}
			}
			
			log = "Meddling desire is [meddling_desire.GetValue]"
		}
		
		# And determine if there is meddling
		if = {
			limit = {
				check_variable = {
					which = meddling_desire
					value = 1000
				}
			}
			remove_character_modifier = meddled_in_succession
			if = {
				limit = {
					has_character_flag = new_meddling
				}
				event_target:current_chrysanthemum_throne_heir = {
					opinion = {
						who = ROOT
						modifier = opinion_opposing_my_claim
					}
				}
				event_target:preferred_chrysanthemum_throne_heir = {
					opinion = {
						who = ROOT
						modifier = opinion_backing_my_claim
					}
				}
				liege = {
					opinion = {
						who = ROOT
						modifier = opinion_opposing_my_preferred_heir
					}
				}
			}
			add_character_modifier = {
				modifier = meddled_in_succession
				days = 730
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = meddling_desire
					value = 900
				}
			}
			random_list = {
				90 = {
					remove_character_modifier = meddled_in_succession
					if = {
						limit = {
							has_character_flag = new_meddling
						}
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						liege = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
					}
					add_character_modifier = {
						modifier = meddled_in_succession
						days = 730
					}
				}
				10 = {
					modifier = {
						factor = 0
						trait = ambitious
					}
					remove_character_modifier = meddled_in_succession
				}
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = meddling_desire
					value = 800
				}
			}
			random_list = {
				80 = {
					remove_character_modifier = meddled_in_succession
					if = {
						limit = {
							has_character_flag = new_meddling
						}
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						liege = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
					}
					add_character_modifier = {
						modifier = meddled_in_succession
						days = 730
					}
				}
				20 = {
					modifier = {
						factor = 0
						trait = ambitious
					}
					remove_character_modifier = meddled_in_succession
				}
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = meddling_desire
					value = 700
				}
			}
			random_list = {
				70 = {
					remove_character_modifier = meddled_in_succession
					if = {
						limit = {
							has_character_flag = new_meddling
						}
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						liege = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
					}
					add_character_modifier = {
						modifier = meddled_in_succession
						days = 730
					}
				}
				30 = {
					modifier = {
						factor = 0
						trait = ambitious
					}
					remove_character_modifier = meddled_in_succession
				}
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = meddling_desire
					value = 600
				}
			}
			random_list = {
				60 = {
					remove_character_modifier = meddled_in_succession
					if = {
						limit = {
							has_character_flag = new_meddling
						}
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						liege = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
					}
					add_character_modifier = {
						modifier = meddled_in_succession
						days = 730
					}
				}
				40 = {
					modifier = {
						factor = 0
						trait = ambitious
					}
					remove_character_modifier = meddled_in_succession
				}
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = meddling_desire
					value = 500
				}
			}
			random_list = {
				50 = {
					remove_character_modifier = meddled_in_succession
					if = {
						limit = {
							has_character_flag = new_meddling
						}
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						liege = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
					}
					add_character_modifier = {
						modifier = meddled_in_succession
						days = 730
					}
				}
				50 = {
					modifier = {
						factor = 0
						trait = ambitious
					}
					remove_character_modifier = meddled_in_succession
				}
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = meddling_desire
					value = 400
				}
			}
			random_list = {
				40 = {
					modifier = {
						factor = 2
						trait = ambitious
					}
					remove_character_modifier = meddled_in_succession
					if = {
						limit = {
							has_character_flag = new_meddling
						}
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						liege = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
					}
					add_character_modifier = {
						modifier = meddled_in_succession
						days = 730
					}
				}
				60 = {
					modifier = {
						factor = 0.35
						trait = ambitious
					}
					remove_character_modifier = meddled_in_succession
				}
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = meddling_desire
					value = 300
				}
			}
			random_list = {
				30 = {
					modifier = {
						factor = 2
						trait = ambitious
					}
					remove_character_modifier = meddled_in_succession
					if = {
						limit = {
							has_character_flag = new_meddling
						}
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						liege = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
					}
					add_character_modifier = {
						modifier = meddled_in_succession
						days = 730
					}
				}
				70 = {
					modifier = {
						factor = 0.6
						trait = ambitious
					}
					remove_character_modifier = meddled_in_succession
				}
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = meddling_desire
					value = 200
				}
			}
			random_list = {
				20 = {
					modifier = {
						factor = 2.5
						trait = ambitious
					}
					remove_character_modifier = meddled_in_succession
					if = {
						limit = {
							has_character_flag = new_meddling
						}
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						liege = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
					}
					add_character_modifier = {
						modifier = meddled_in_succession
						days = 730
					}
				}
				80 = {
					modifier = {
						factor = 0.625
						trait = ambitious
					}
					remove_character_modifier = meddled_in_succession
				}
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = meddling_desire
					value = 100
				}
			}
			random_list = {
				10 = {
					modifier = {
						factor = 4
						trait = ambitious
					}
					remove_character_modifier = meddled_in_succession
					if = {
						limit = {
							has_character_flag = new_meddling
						}
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						liege = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
					}
					add_character_modifier = {
						modifier = meddled_in_succession
						days = 730
					}
				}
				90 = {
					modifier = {
						factor = 0.6
						trait = ambitious
					}
					remove_character_modifier = meddled_in_succession
				}
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = meddling_desire
					value = 0
				}
			}
			random_list = {
				30 = {
					modifier = {
						factor = 0
						NOT = {
							trait = ambitious
						}
					}
					remove_character_modifier = meddled_in_succession
					if = {
						limit = {
							has_character_flag = new_meddling
						}
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						liege = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
					}
					add_character_modifier = {
						modifier = meddled_in_succession
						days = 730
					}
				}
				70 = {
					remove_character_modifier = meddled_in_succession
				}
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = meddling_desire
					value = -250
				}
			}
			random_list = {
				20 = {
					modifier = {
						factor = 0
						NOT = {
							trait = ambitious
						}
					}
					remove_character_modifier = meddled_in_succession
					if = {
						limit = {
							has_character_flag = new_meddling
						}
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						liege = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
					}
					add_character_modifier = {
						modifier = meddled_in_succession
						days = 730
					}
				}
				80 = {
					remove_character_modifier = meddled_in_succession
				}
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = meddling_desire
					value = -500
				}
			}
			random_list = {
				10 = {
					modifier = {
						factor = 0
						NOT = {
							trait = ambitious
						}
					}
					remove_character_modifier = meddled_in_succession
					if = {
						limit = {
							has_character_flag = new_meddling
						}
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						liege = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
					}
					add_character_modifier = {
						modifier = meddled_in_succession
						days = 730
					}
				}
				90 = {
					remove_character_modifier = meddled_in_succession
				}
			}
		}
		else = {
			remove_character_modifier = meddled_in_succession
		}
		
		if = {
			limit = {
				has_character_modifier = meddled_in_succession
			}
			log = "There's meddling!"
			if = {
				limit = {
					has_character_flag = new_meddling
				}
				prestige = -500
				clr_character_flag = new_meddling
			}
			else = {
				prestige = -100
			}
			k_chrysanthemum_throne = {
				holder_scope = {
					recalc_succession = yes
					character_event = { id = japan.412 } # Inform the Tenno!
				}
			}
		}
		else = {
			log = "There's no meddling!"
		}
		clr_character_flag = new_meddling
	}
}

# Meddled - inform the Tenno!
character_event = {
	id = japan.412
	desc = EVTDESC_JAPAN_412
	picture = GFX_evt_china_golden_age # Needs better picture!
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_412 # FROM dares?
		
		if = {
			limit = {
				FROM = {
					has_dlc = "Jade Dragon"
					is_chinese_emperor_trigger = no
				}
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
				}
			}
			else_if = {
				limit = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_major_effect = yes
				}
			}
		}
	}
}

# Nullify - on_yearly_pulse
character_event = {
	id = japan.413
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	religion = shinto
	
	trigger = {
		OR = {
			controls_religion = yes
			has_character_flag = temporarily_japanese_imperial
		}
		prestige = 500
		has_actual_regency_trigger = no
		trait = under_regency
		regent = {
			trait = japanese_regent
		}
		primary_title = {
			has_law = regent_succession_control_1
		}
		ai = yes
	}
	
	immediate = {
		if = {
			limit = {
				regent = {
					trait = japanese_regent
					has_character_modifier = meddled_in_succession
				}
			}
			
			log = "The Tenno, [Root.GetBestName], might try to nullify meddling!"
			
			# Try to figure out if we want to nullify
			
			set_variable = {
				which = meddling_desire
				value = 0
			}
			
			k_chrysanthemum_throne = {
				holder_scope = {
					current_heir = {
						save_event_target_as = current_chrysanthemum_throne_heir
						log = "The current heir to the Chrysanthemum Throne is [current_chrysanthemum_throne_heir.GetBestName]"
					}
					ROOT = {
						save_event_target_as = regent_or_tenno
					}
					any_dynasty_member = {
						limit = {
							religion = shinto # Vanilla is strict when it comes to religion and rel head succession, so we should probably be as strict in case there are issues...;;;;;;;;;;;;;x
							NOT = {
								trait = bastard
							}
							OR = { #Candidate should not be a landless Courtier that is about to inherit a Theocracy or Republic
								AND = {
									is_ruler = yes
									is_landed = yes
									is_republic = no
									is_merchant_republic = no
									is_theocracy = no
								}
								NOR = {
									any_heir_title = {
										is_republic = yes
									}
									any_heir_title = {
										is_merchant_republic = yes
									}
									any_heir_title = {
										is_theocracy = yes
									}
								}
							}
							NOR = {
								trait = cat
								trait = disinherited
								trait = horse
								trait = eunuch
								AND = { 
									trait = bastard 
									is_ruler = no
								}
								is_ascetic_trigger = yes
								is_theocracy = yes
								is_republic = yes
								is_merchant_republic = yes
							}
						}
						score_value = {
							value = 1
							tenno_succession_candidate_weight = yes # Find our preferred heir
						}
						save_event_target_as = preferred_chrysanthemum_throne_heir
						log = "The preferred heir to the Chrysanthemum Throne is [current_chrysanthemum_throne_heir.GetBestName]"
					}
				}
			}
			
			score_current_chrysanthemum_throne_heir_effect = yes
			log = "The current heir's score is [current_heir_score.GetValue]"
			
			# No need to check what you think of the Tenno; you ARE the Tenno!
			
			score_preferred_chrysanthemum_throne_heir_effect = yes
			log = "The preferred heir's score is [current_heir_score.GetValue]"
			
			set_variable = {
				which = meddling_desire
				which = preferred_heir_score
			}
			subtract_variable = {
				which = meddling_desire
				which = current_heir_score
			}
			
			# Increase/decrease meddling willingness based on traits
			if = {
				limit = {
					trait = ambitious
				}
				change_variable = {
					which = meddling_desire
					value = 500
				}
			}
			if = {
				limit = {
					trait = proud
				}
				change_variable = {
					which = meddling_desire
					value = 250
				}
			}
			if = {
				limit = {
					trait = envious
				}
				change_variable = {
					which = meddling_desire
					value = 250
				}
			}
			if = {
				limit = {
					trait = deceitful
				}
				change_variable = {
					which = meddling_desire
					value = 250
				}
			}
			if = {
				limit = {
					trait = arbitrary
				}
				change_variable = {
					which = meddling_desire
					value = 250
				}
			}
			if = {
				limit = {
					trait = content
				}
				change_variable = {
					which = meddling_desire
					value = -250 # Not -500; you could be content with the current state of affairs!
				}
			}
			if = {
				limit = {
					trait = humble
				}
				change_variable = {
					which = meddling_desire
					value = -250
				}
			}
			if = {
				limit = {
					trait = kind
				}
				change_variable = {
					which = meddling_desire
					value = -250
				}
			}
			if = {
				limit = {
					trait = honest
				}
				change_variable = {
					which = meddling_desire
					value = -250
				}
			}
			if = {
				limit = {
					trait = just
				}
				change_variable = {
					which = meddling_desire
					value = -250
				}
			}
			
			# Rivalry with the Regent
			if = {
				limit = {
					regent = {
						any_rival = {
							character = ROOT
						}
					}
				}
				change_variable = {
					which = meddling_desire
					value = 1000
				}
			}
			
			log = "Meddling desire is [meddling_desire.GetValue]"
		
			# And determine if there is meddling
			if = {
				limit = {
					check_variable = {
						which = meddling_desire
						value = 1000
					}
				}
				event_target:current_chrysanthemum_throne_heir = {
					opinion = {
						who = ROOT
						modifier = opinion_opposing_my_claim
					}
				}
				event_target:preferred_chrysanthemum_throne_heir = {
					opinion = {
						who = ROOT
						modifier = opinion_backing_my_claim
					}
				}
				regent = {
					opinion = {
						who = ROOT
						modifier = opinion_opposing_my_preferred_heir
					}
				}
				regent = {
					remove_character_modifier = meddled_in_succession
				}
				set_character_flag = nullifed_meddling
			}
			else_if = {
				limit = {
					check_variable = {
						which = meddling_desire
						value = 900
					}
				}
				random_list = {
					90 = {
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						regent = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
						regent = {
							remove_character_modifier = meddled_in_succession
						}
						set_character_flag = nullifed_meddling
					}
					10 = {
						modifier = {
							factor = 0
							trait = ambitious
						}
					}
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = meddling_desire
						value = 800
					}
				}
				random_list = {
					80 = {
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						regent = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
						regent = {
							remove_character_modifier = meddled_in_succession
						}
						set_character_flag = nullifed_meddling
					}
					20 = {
						modifier = {
							factor = 0
							trait = ambitious
						}
					}
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = meddling_desire
						value = 700
					}
				}
				random_list = {
					70 = {
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						regent = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
						regent = {
							remove_character_modifier = meddled_in_succession
						}
						set_character_flag = nullifed_meddling
					}
					30 = {
						modifier = {
							factor = 0
							trait = ambitious
						}
					}
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = meddling_desire
						value = 600
					}
				}
				random_list = {
					60 = {
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						regent = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
						regent = {
							remove_character_modifier = meddled_in_succession
						}
						set_character_flag = nullifed_meddling
					}
					40 = {
						modifier = {
							factor = 0
							trait = ambitious
						}
					}
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = meddling_desire
						value = 500
					}
				}
				random_list = {
					50 = {
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						regent = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
						regent = {
							remove_character_modifier = meddled_in_succession
						}
						set_character_flag = nullifed_meddling
					}
					50 = {
						modifier = {
							factor = 0
							trait = ambitious
						}
					}
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = meddling_desire
						value = 400
					}
				}
				random_list = {
					40 = {
						modifier = {
							factor = 2
							trait = ambitious
						}
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						regent = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
						regent = {
							remove_character_modifier = meddled_in_succession
						}
						set_character_flag = nullifed_meddling
					}
					60 = {
						modifier = {
							factor = 0.35
							trait = ambitious
						}
					}
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = meddling_desire
						value = 300
					}
				}
				random_list = {
					30 = {
						modifier = {
							factor = 2
							trait = ambitious
						}
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						regent = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
						regent = {
							remove_character_modifier = meddled_in_succession
						}
						set_character_flag = nullifed_meddling
					}
					70 = {
						modifier = {
							factor = 0.6
							trait = ambitious
						}
					}
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = meddling_desire
						value = 200
					}
				}
				random_list = {
					20 = {
						modifier = {
							factor = 2.5
							trait = ambitious
						}
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						regent = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
						regent = {
							remove_character_modifier = meddled_in_succession
						}
						set_character_flag = nullifed_meddling
					}
					80 = {
						modifier = {
							factor = 0.625
							trait = ambitious
						}
					}
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = meddling_desire
						value = 100
					}
				}
				random_list = {
					10 = {
						modifier = {
							factor = 4
							trait = ambitious
						}
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						regent = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
						regent = {
							remove_character_modifier = meddled_in_succession
						}
						set_character_flag = nullifed_meddling
					}
					90 = {
						modifier = {
							factor = 0.6
							trait = ambitious
						}
					}
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = meddling_desire
						value = 0
					}
				}
				random_list = {
					30 = {
						modifier = {
							factor = 0
							NOT = {
								trait = ambitious
							}
						}
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						regent = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
						regent = {
							remove_character_modifier = meddled_in_succession
						}
						set_character_flag = nullifed_meddling
					}
					70 = {
					}
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = meddling_desire
						value = -250
					}
				}
				random_list = {
					20 = {
						modifier = {
							factor = 0
							NOT = {
								trait = ambitious
							}
						}
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						regent = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
						regent = {
							remove_character_modifier = meddled_in_succession
						}
						set_character_flag = nullifed_meddling
					}
					80 = {
					}
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = meddling_desire
						value = -500
					}
				}
				random_list = {
					10 = {
						modifier = {
							factor = 0
							NOT = {
								trait = ambitious
							}
						}
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						regent = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
						regent = {
							remove_character_modifier = meddled_in_succession
						}
						set_character_flag = nullifed_meddling
					}
					90 = {
					}
				}
			}
			
			if = {
				limit = {
					has_character_flag = nullifed_meddling
				}
				clr_character_flag = nullifed_meddling
				log = "There's nullifying!"
				prestige = -500
				recalc_succession = yes
				regent = {
					character_event = { id = japan.414 } # Inform the regent!
				}
			}
			else = {
				log = "There's no nullifying!"
			}
		}
	}
}

# Nullified - inform the Regent!
character_event = {
	id = japan.414
	desc = EVTDESC_JAPAN_414
	picture = GFX_evt_china_golden_age # Needs better picture!
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_414 # FROM dares?
	}
}

# Nullify - on_death (also fires for the player to set up trait inheritance, but the player doesn't automatically counter-meddle)
character_event = {
	id = japan.415
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	religion = shinto
	
	trigger = {
		OR = {
			controls_religion = yes
			has_character_flag = temporarily_japanese_imperial
		}
		trait = under_regency
	}
	
	immediate = {
		if = {
			limit = {
				ai = yes
				regent = {
					trait = japanese_regent
					has_character_modifier = meddled_in_succession
				}
				primary_title = {
					has_law = regent_succession_control_1
				}
				regent = {
					trait = japanese_regent
				}
				prestige = 500
				has_actual_regency_trigger = no
			}
			
			log = "The Tenno, [Root.GetBestName], might try to nullify meddling!"
			
			# Try to figure out if we want to nullify
			
			set_variable = {
				which = meddling_desire
				value = 0
			}
			
			k_chrysanthemum_throne = {
				holder_scope = {
					current_heir = {
						save_event_target_as = current_chrysanthemum_throne_heir
						log = "The current heir to the Chrysanthemum Throne is [current_chrysanthemum_throne_heir.GetBestName]"
					}
					ROOT = {
						save_event_target_as = regent_or_tenno
					}
					any_dynasty_member = {
						limit = {
							religion = shinto # Vanilla is strict when it comes to religion and rel head succession, so we should probably be as strict in case there are issues...;;;;;;;;;;;;;x
							NOT = {
								trait = bastard
							}
							OR = { #Candidate should not be a landless Courtier that is about to inherit a Theocracy or Republic
								AND = {
									is_ruler = yes
									is_landed = yes
									is_republic = no
									is_merchant_republic = no
									is_theocracy = no
								}
								NOR = {
									any_heir_title = {
										is_republic = yes
									}
									any_heir_title = {
										is_merchant_republic = yes
									}
									any_heir_title = {
										is_theocracy = yes
									}
								}
							}
							NOR = {
								trait = cat
								trait = disinherited
								trait = horse
								trait = eunuch
								AND = { 
									trait = bastard 
									is_ruler = no
								}
								is_ascetic_trigger = yes
								is_theocracy = yes
								is_republic = yes
								is_merchant_republic = yes
							}
						}
						score_value = {
							value = 1
							tenno_succession_candidate_weight = yes # Find our preferred heir
						}
						save_event_target_as = preferred_chrysanthemum_throne_heir
						log = "The preferred heir to the Chrysanthemum Throne is [current_chrysanthemum_throne_heir.GetBestName]"
					}
				}
			}
			
			score_current_chrysanthemum_throne_heir_effect = yes
			log = "The current heir's score is [current_heir_score.GetValue]"
			
			# No need to check what you think of the Tenno; you ARE the Tenno!
			
			score_preferred_chrysanthemum_throne_heir_effect = yes
			log = "The preferred heir's score is [current_heir_score.GetValue]"
			
			set_variable = {
				which = meddling_desire
				which = preferred_heir_score
			}
			subtract_variable = {
				which = meddling_desire
				which = current_heir_score
			}
			
			# Increase/decrease meddling willingness based on traits
			if = {
				limit = {
					trait = ambitious
				}
				change_variable = {
					which = meddling_desire
					value = 500
				}
			}
			if = {
				limit = {
					trait = proud
				}
				change_variable = {
					which = meddling_desire
					value = 250
				}
			}
			if = {
				limit = {
					trait = envious
				}
				change_variable = {
					which = meddling_desire
					value = 250
				}
			}
			if = {
				limit = {
					trait = deceitful
				}
				change_variable = {
					which = meddling_desire
					value = 250
				}
			}
			if = {
				limit = {
					trait = arbitrary
				}
				change_variable = {
					which = meddling_desire
					value = 250
				}
			}
			if = {
				limit = {
					trait = content
				}
				change_variable = {
					which = meddling_desire
					value = -250 # Not -500; you could be content with the current state of affairs!
				}
			}
			if = {
				limit = {
					trait = humble
				}
				change_variable = {
					which = meddling_desire
					value = -250
				}
			}
			if = {
				limit = {
					trait = kind
				}
				change_variable = {
					which = meddling_desire
					value = -250
				}
			}
			if = {
				limit = {
					trait = honest
				}
				change_variable = {
					which = meddling_desire
					value = -250
				}
			}
			if = {
				limit = {
					trait = just
				}
				change_variable = {
					which = meddling_desire
					value = -250
				}
			}
			
			# Rivalry with the Regent
			if = {
				limit = {
					regent = {
						any_rival = {
							character = ROOT
						}
					}
				}
				change_variable = {
					which = meddling_desire
					value = 1000
				}
			}
			
			log = "Meddling desire is [meddling_desire.GetValue]"
		
			# And determine if there is meddling
			if = {
				limit = {
					check_variable = {
						which = meddling_desire
						value = 1000
					}
				}
				event_target:current_chrysanthemum_throne_heir = {
					opinion = {
						who = ROOT
						modifier = opinion_opposing_my_claim
					}
				}
				event_target:preferred_chrysanthemum_throne_heir = {
					opinion = {
						who = ROOT
						modifier = opinion_backing_my_claim
					}
				}
				regent = {
					opinion = {
						who = ROOT
						modifier = opinion_opposing_my_preferred_heir
					}
				}
				regent = {
					remove_character_modifier = meddled_in_succession
				}
				set_character_flag = nullifed_meddling
			}
			else_if = {
				limit = {
					check_variable = {
						which = meddling_desire
						value = 900
					}
				}
				random_list = {
					90 = {
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						regent = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
						regent = {
							remove_character_modifier = meddled_in_succession
						}
						set_character_flag = nullifed_meddling
					}
					10 = {
						modifier = {
							factor = 0
							trait = ambitious
						}
					}
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = meddling_desire
						value = 800
					}
				}
				random_list = {
					80 = {
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						regent = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
						regent = {
							remove_character_modifier = meddled_in_succession
						}
						set_character_flag = nullifed_meddling
					}
					20 = {
						modifier = {
							factor = 0
							trait = ambitious
						}
					}
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = meddling_desire
						value = 700
					}
				}
				random_list = {
					70 = {
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						regent = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
						regent = {
							remove_character_modifier = meddled_in_succession
						}
						set_character_flag = nullifed_meddling
					}
					30 = {
						modifier = {
							factor = 0
							trait = ambitious
						}
					}
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = meddling_desire
						value = 600
					}
				}
				random_list = {
					60 = {
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						regent = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
						regent = {
							remove_character_modifier = meddled_in_succession
						}
						set_character_flag = nullifed_meddling
					}
					40 = {
						modifier = {
							factor = 0
							trait = ambitious
						}
					}
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = meddling_desire
						value = 500
					}
				}
				random_list = {
					50 = {
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						regent = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
						regent = {
							remove_character_modifier = meddled_in_succession
						}
						set_character_flag = nullifed_meddling
					}
					50 = {
						modifier = {
							factor = 0
							trait = ambitious
						}
					}
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = meddling_desire
						value = 400
					}
				}
				random_list = {
					40 = {
						modifier = {
							factor = 2
							trait = ambitious
						}
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						regent = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
						regent = {
							remove_character_modifier = meddled_in_succession
						}
						set_character_flag = nullifed_meddling
					}
					60 = {
						modifier = {
							factor = 0.35
							trait = ambitious
						}
					}
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = meddling_desire
						value = 300
					}
				}
				random_list = {
					30 = {
						modifier = {
							factor = 2
							trait = ambitious
						}
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						regent = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
						regent = {
							remove_character_modifier = meddled_in_succession
						}
						set_character_flag = nullifed_meddling
					}
					70 = {
						modifier = {
							factor = 0.6
							trait = ambitious
						}
					}
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = meddling_desire
						value = 200
					}
				}
				random_list = {
					20 = {
						modifier = {
							factor = 2.5
							trait = ambitious
						}
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						regent = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
						regent = {
							remove_character_modifier = meddled_in_succession
						}
						set_character_flag = nullifed_meddling
					}
					80 = {
						modifier = {
							factor = 0.625
							trait = ambitious
						}
					}
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = meddling_desire
						value = 100
					}
				}
				random_list = {
					10 = {
						modifier = {
							factor = 4
							trait = ambitious
						}
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						regent = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
						regent = {
							remove_character_modifier = meddled_in_succession
						}
						set_character_flag = nullifed_meddling
					}
					90 = {
						modifier = {
							factor = 0.6
							trait = ambitious
						}
					}
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = meddling_desire
						value = 0
					}
				}
				random_list = {
					30 = {
						modifier = {
							factor = 0
							NOT = {
								trait = ambitious
							}
						}
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						regent = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
						regent = {
							remove_character_modifier = meddled_in_succession
						}
						set_character_flag = nullifed_meddling
					}
					70 = {
					}
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = meddling_desire
						value = -250
					}
				}
				random_list = {
					20 = {
						modifier = {
							factor = 0
							NOT = {
								trait = ambitious
							}
						}
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						regent = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
						regent = {
							remove_character_modifier = meddled_in_succession
						}
						set_character_flag = nullifed_meddling
					}
					80 = {
					}
				}
			}
			else_if = {
				limit = {
					check_variable = {
						which = meddling_desire
						value = -500
					}
				}
				random_list = {
					10 = {
						modifier = {
							factor = 0
							NOT = {
								trait = ambitious
							}
						}
						event_target:current_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_claim
							}
						}
						event_target:preferred_chrysanthemum_throne_heir = {
							opinion = {
								who = ROOT
								modifier = opinion_backing_my_claim
							}
						}
						regent = {
							opinion = {
								who = ROOT
								modifier = opinion_opposing_my_preferred_heir
							}
						}
						regent = {
							remove_character_modifier = meddled_in_succession
						}
						set_character_flag = nullifed_meddling
					}
					90 = {
					}
				}
			}
			
			if = {
				limit = {
					has_character_flag = nullifed_meddling
				}
				clr_character_flag = nullifed_meddling
				log = "There's nullifying!"
				prestige = -500
				recalc_succession = yes
				regent = {
					character_event = { id = japan.414 } # Inform the regent!
				}
			}
			else = {
				log = "There's no nullifying!"
			}
		}
		
		current_heir = {
			add_trait = under_regency
		}
	}
}

# Inheritance of under_regency2
character_event = {
	id = japan.416
	hide_window = yes
	
	is_triggered_only = yes
	only_playable = yes
	
	trigger = {
		tier = emperor
		trait = under_regency2
	}
	
	immediate = {
		current_heir = {
			if = {
				limit = {
					NAND = {
						religion = shinto
						OR = {
							controls_religion = yes
							has_character_flag = temporarily_japanese_imperial
						}
					}
				}
				add_trait = under_regency2
			}
		}
	}
}

# Inheritance of japanese_regent
character_event = {
	id = japan.417
	hide_window = yes
	
	is_triggered_only = yes
	only_playable = yes
	
	trigger = {
		trait = japanese_regent
	}
	
	immediate = {
		log = "Regency inheritance: [Root.GetBestName] is the dying Regent"
		current_heir = {
			if = {
				limit = {
					NAND = {
						religion = shinto
						OR = {
							controls_religion = yes
							has_character_flag = temporarily_japanese_imperial
						}
					}
				}
				log = "Regency inheritance: [This.GetBestName] is the new Regent"
				add_trait = japanese_regent
				set_character_flag = i_am_japanese_regent
			}
		}
	}
}

# Inheritance of japanese_regent2
character_event = {
	id = japan.418
	hide_window = yes
	
	is_triggered_only = yes
	only_playable = yes
	
	trigger = {
		trait = japanese_regent2
	}
	
	immediate = {
		log = "Regency inheritance: [Root.GetBestName] is the dying Regent"
		current_heir = {
			if = {
				limit = {
					NAND = {
						religion = shinto
						OR = {
							controls_religion = yes
							has_character_flag = temporarily_japanese_imperial
						}
					}
				}
				log = "Regency inheritance: [This.GetBestName] is the new Regent"
				add_trait = japanese_regent2
				set_character_flag = i_am_japanese_regent2
			}
			# Else: Execute Order 66?
		}
	}
}

### Regency power increase/decrease

# Increase - inform the liege
character_event = {
	id = japan.419
	desc = EVTDESC_JAPAN_419
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_419 # FROM dares?
	}
}

# Decrease - inform the Regent
character_event = {
	id = japan.420
	desc = EVTDESC_JAPAN_420
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_420 # FROM dares?
	}
}

### Regent prisoner release

# Inform the liege that a prisoner was released
character_event = {
	id = japan.421
	desc = EVTDESC_JAPAN_421
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_421 # FROMFROM dares?
		opinion = {
			who = FROMFROM
			modifier = released_a_prisoner
		}
	}
}

# Ping the Regent, then release the prisoner
character_event = {
	id = japan.422
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		FROM = {
			character_event = { id = 153 } # Release the prisoner!
		}
	}
}

### Regent prisoner execution

# Inform the liege that a prisoner was executed
character_event = {
	id = japan.423
	desc = EVTDESC_JAPAN_423
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_423 # FROMFROM dares?
		opinion = {
			who = FROMFROM
			modifier = executed_a_prisoner
		}
	}
}

# Ping the Regent, then execute the prisoner
character_event = {
	id = japan.424
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		FROM = {
			character_event = { id = 154 } # Execute the prisoner!
		}
	}
}


### Regent money transfer

# Inform the liege
character_event = {
	id = japan.425
	desc = EVTDESC_JAPAN_425
	picture = GFX_evt_china_golden_age # Needs better picture!
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_425 # FROM dares?
		opinion = {
			who = FROM
			modifier = took_money
		}
	}
}

### Shinto-Buddhist conversion

# Shinto -> Buddhist
character_event = {
	id = japan.426
	hide_window = yes
	
	only_rulers = yes
	
	is_triggered_only = yes
	
	trigger = {
		any_courtier = {
			is_landed = no
			is_adult = yes
			is_inaccessible_or_incapable_trigger = no
			religion = shinto
			OR = {
				culture = japanese
				culture = yamato
				culture = wako
			}
			NOT = {
				any_dynasty_member = {
					religion = shinto
					OR = {
						controls_religion = yes
						has_character_flag = temporarily_japanese_imperial
					}
				}
			}
			NOR = {
				trait = zealous
				trait = proud
			}
			NOT = {
				has_character_flag = japanese_religion_switch
			}
			NOT = {
				trait = japanese_monastic_trait
			}
			NOT = {
				top_liege = {
					government = chinese_imperial_government
				}
			}
		}
	}
	
	immediate = {
		random_courtier = {
			limit = {
				is_landed = no
				is_adult = yes
				is_inaccessible_or_incapable_trigger = no
				religion = shinto
				OR = {
					culture = japanese
					culture = yamato
					culture = wako
				}
				NOT = {
					any_dynasty_member = {
						religion = shinto
						OR = {
							controls_religion = yes
							has_character_flag = temporarily_japanese_imperial
						}
					}
				}
				NOR = {
					trait = zealous
					trait = proud
				}
				NOT = {
					has_character_flag = japanese_religion_switch
				}
				NOT = {
					trait = japanese_monastic_trait
				}
				NOT = {
					top_liege = {
						government = chinese_imperial_government
					}
				}
			}
			preferred_limit = {
				OR = {
					trait = cynical
					trait = humble
					true_religion = shinto
				}
			}
			religion = buddhist
			set_character_flag = japanese_religion_switch
		}
	}
}

# Buddhist -> Shinto
character_event = {
	id = japan.427
	hide_window = yes
	
	only_rulers = yes
	
	is_triggered_only = yes
	
	trigger = {
		any_courtier = {
			is_landed = no
			is_adult = yes
			is_inaccessible_or_incapable_trigger = no
			religion = buddhist
			OR = {
				culture = japanese
				culture = yamato
				culture = wako
			}
			NOR = {
				trait = zealous
				trait = proud
			}
			NOT = {
				has_character_flag = japanese_religion_switch
			}
			NOT = {
				trait = japanese_monastic_trait
			}
			NOT = {
				top_liege = {
					government = chinese_imperial_government
				}
			}
			NOR = {
				trait = bhikkhu
				trait = bhikkhuni
			}
		}
	}
	
	immediate = {
		random_courtier = {
			limit = {
				is_landed = no
				is_adult = yes
				is_inaccessible_or_incapable_trigger = no
				religion = buddhist
				OR = {
					culture = japanese
					culture = yamato
					culture = wako
				}
				NOR = {
					trait = zealous
					trait = proud
				}
				NOT = {
					has_character_flag = japanese_religion_switch
				}
				NOT = {
					trait = japanese_monastic_trait
				}
				NOT = {
					top_liege = {
						government = chinese_imperial_government
					}
				}
				NOR = {
					trait = bhikkhu
					trait = bhikkhuni
				}
			}
	
			preferred_limit = {
				OR = {
					trait = cynical
					trait = humble
					true_religion = shinto
				}
			}
			religion = shinto
			set_character_flag = japanese_religion_switch
		}
	}
}

##### Kitsune events

### Start + side events for "fakes" + event selection

# Approached by a beautiful woman at night - do you let her stay at your court?
character_event = {
	id = japan.428
	desc = EVTDESC_JAPAN_428
	picture = GFX_evt_sleeping_town_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	only_playable = yes
	
	min_age = 16
	only_capable = yes
	
	trigger = {
		# Would be attracted to her
		OR = {
			AND = {
				is_female = no
				NOT = {
					trait = homosexual
				}
			}
			AND = {
				is_female = yes
				trait = homosexual
			}
		}
		# We are in Japan, are Japonic, or are Shinto
		OR = {
			any_realm_province = {
				OR = {
					region = world_japan # Initial de jure
					region = world_japan_islands # Ryukyu
					region = custom_yezo # Hokkaido
				}
			}
			culture_group = japonic
			religion = shinto
		}
		NOT = {
			any_opinion_modifier_target = {
				has_opinion_modifier = {
					who = Root
					modifier = kitsune_opinion
				}
			}
		}
	}
	
	immediate = {
		if = {
			limit = {
				culture_group = japonic
			}
			create_character = {
				age = 16
				female = yes
				dynasty = none
				culture = ROOT
				religion = shinto
				health = 6
				fertility = 0.8
				attributes = {
					diplomacy = 6
					martial = 2
					stewardship = 1
					intrigue = 6 # Elusive shadow + Shinto add a lot...
					learning = 3
				}
				trait = elusive_shadow
				trait = fair
				trait = lustful
				trait = deceitful
				trait = shrewd
				trait = gregarious
				random_traits = no
			}
		}
		else = {
			create_character = {
				age = 16
				female = yes
				dynasty = none
				culture = japanese
				religion = shinto
				health = 6
				fertility = 0.8
				attributes = {
					diplomacy = 6
					martial = 2
					stewardship = 1
					intrigue = 6 # Elusive shadow + Shinto add a lot...
					learning = 3
				}
				trait = elusive_shadow
				trait = fair
				trait = lustful
				trait = deceitful
				trait = shrewd
				trait = gregarious
				random_traits = no
			}
		}
		new_character = {
			save_event_target_as = new_kitsune_or_not
			set_immune_to_pruning = yes
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = ai_flag_refuse_conversion
			set_character_flag = no_court_invites
			
			# Initial setup of character type
			random_list = {
				1 = {
					modifier = {
						factor = 0
						has_game_rule = {
							name = supernatural_events
							value = off
						}
					}
					modifier = {
						factor = 0
						has_game_rule = {
							name = supernatural_events
							value = on
						}
						ai = yes
					}
					set_character_flag = kitsune_actual_kitsune
					random_list = {
						1 = {
							set_character_flag = kitsune_one_tail
							change_diplomacy = 1
							change_intrigue = 1
						}
						1 = {
							set_character_flag = kitsune_five_tails
							change_diplomacy = 5
							change_intrigue = 5
						}
						1 = {
							set_character_flag = kitsune_seven_tails
							change_diplomacy = 7
							change_intrigue = 7
						}
						1 = {
							set_character_flag = kitsune_nine_tails
							give_nickname = nick_of_the_nine_tails
							change_diplomacy = 9
							change_intrigue = 9
						}
					}
					add_trait = kitsune
					random_list = {
						1 = {
							add_trait = seductress
						}
						1 = {
							add_trait = schemer
						}
						1 = {
							add_trait = mystic
						}
						1 = {
							add_trait = socializer
						}
						1 = {
							add_trait = hedonist
						}
					}						
				}
				1 = {
					set_character_flag = kitsune_chastey_mcchasteface
					remove_trait = lustful
					add_trait = chaste
					random_list = {
						1 = {
							# Nothing
						}
						1 = {
							remove_trait = elusive_shadow
							add_trait = intricate_webweaver
						}
						1 = {
							remove_trait = elusive_shadow
							add_trait = flamboyant_schemer
						}
						1 = {
							remove_trait = elusive_shadow
							add_trait = amateurish_plotter
						}
					}
				}
				1 = {
					set_character_flag = kitsune_thief
					add_trait = greedy
				}
				1 = {
					set_character_flag = kitsune_yandere
					add_trait = wroth
					add_trait = lunatic
				}
				1 = {
					set_character_flag = kitsune_future_nun
					change_learning = 4
					change_diplomacy = -1
					change_intrigue = -2
				}
				1 = {
					set_character_flag = kitsune_ill_girl
					health = -3
				}
				1 = {
					set_character_flag = kitsune_generic_non_kitsune
				}
			}
			
			# Stat randomization
			random_list = {
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_actual_kitsune
					}
					random_list = {
						1 = {
							change_diplomacy = 2
							change_intrigue = 2
						}
						1 = {
							change_diplomacy = 1
							change_intrigue = 1
						}
					}
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_chastey_mcchasteface
					}
					random_list = {
						1 = {
							change_diplomacy = -2
							change_intrigue = 2
						}
						1 = {
							change_diplomacy = -1
							change_intrigue = 1
						}
					}
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_thief
					}
					random_list = {
						1 = {
							change_diplomacy = 2
							change_intrigue = -2
						}
						1 = {
							change_diplomacy = 1
							change_intrigue = -1
						}
					}
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_yandere
					}
					random_list = {
						1 = {
							change_learning = 2
							change_martial = -2
						}
						1 = {
							change_learning = 1
							change_martial = -1
						}
					}
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_future_nun
					}
					random_list = {
						1 = {
							change_learning = -2
							change_martial = 2
						}
						1 = {
							change_learning = -1
							change_martial = 1
						}
					}
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_ill_girl
					}
					random_list = {
						1 = {
							health = 2
						}
						1 = {
							health = 1
						}
						1 = {
							health = -1
						}
						1 = {
							health = -2
						}
					}
				}
				1 = {
					change_stewardship = 2
				}
			}
			
			# Trait randomization
			random_list = {
				1 = {
					add_trait = lunatic
				}
				1 = {
					add_trait = possessed
				}
				1 = {
					add_trait = physician
				}
				1 = {
					add_trait = genius
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_ill_girl
					}
					add_trait = strong
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_actual_kitsune
					}
					add_trait = genius
					remove_trait = shrewd
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_actual_kitsune
					}
					add_trait = quick
					remove_trait = shrewd
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_actual_kitsune
					}
					add_trait = groomed
					remove_trait = fair
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_actual_kitsune
					}
					add_trait = hedonist
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_actual_kitsune
					}
					add_trait = schemer
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_actual_kitsune
					}
					add_trait = seductress
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_actual_kitsune
					}
					add_trait = mystic
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_actual_kitsune
					}
					add_trait = socializer
				}
				1 = {
					add_trait = poet
				}
				1 = {
					add_trait = temperate
				}
				1 = {
					add_trait = diligent
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_yandere
					}
					add_trait = kind
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_yandere
					}
					modifier = {
						factor = 0
						has_character_flag = kitsune_actual_kitsune
					}
					modifier = {
						factor = 0
						has_character_flag = kitsune_thief
					}
					add_trait = humble
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_future_nun
					}
					add_trait = envious
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_future_nun
					}
					modifier = {
						factor = 0
						has_character_flag = kitsune_ill_girl
					}
					add_trait = wroth
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_future_nun
					}
					add_trait = proud
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_future_nun
					}
					add_trait = ambitious
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_future_nun
					}
					add_trait = arbitrary
				}
				1 = {
					add_trait = brave
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_yandere
					}
					modifier = {
						factor = 0
						has_character_flag = kitsune_actual_kitsune
					}
					modifier = {
						factor = 0
						has_character_flag = kitsune_thief
					}
					add_trait = content
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_yandere
					}
					add_trait = craven
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_future_nun
					}
					modifier = {
						factor = 0
						has_character_flag = kitsune_ill_girl
					}
					add_trait = cruel
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_future_nun
					}
					add_trait = cynical
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_actual_kitsune
					}
					modifier = {
						factor = 0
						has_character_flag = kitsune_thief
					}
					add_trait = honest
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_actual_kitsune
					}
					modifier = {
						factor = 0
						has_character_flag = kitsune_thief
					}
					add_trait = just
				}
				1 = {
					add_trait = paranoid
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_actual_kitsune
					}
					modifier = {
						factor = 0
						has_character_flag = kitsune_yandere
					}
					add_trait = shy
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_actual_kitsune
					}
					modifier = {
						factor = 0
						has_character_flag = kitsune_thief
					}
					modifier = {
						factor = 0
						has_character_flag = kitsune_yandere
					}
					add_trait = trusting
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = kitsune_future_nun
					}
					add_trait = zealous # Will convert religion...
				}
				1 = {
					add_trait = sympathy_pagans
				}
			}
			
			# Ensure attraction
			if = {
				limit = {
					ROOT = {
						is_female = yes
					}
				}
				add_trait = homosexual
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_428 # Of course you can stay at my court!
		
		piety = 5
		
		event_target:new_kitsune_or_not = {
			opinion = {
				who = ROOT
				modifier = kitsune_opinion
				years = 1000
			}
			
			character_event = { id = japan.429 days = 30 random = 60 } # Time to become lovers
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_428 # Begone!
		
		piety = -5
		
		event_target:new_kitsune_or_not = {
			leave_court_and_die_effect = yes
		}
		
		ai_chance = {
			factor = 0
		}
	}
}

# Hidden event to check if she's become a wife or concubine; if so, become lovers right away if possible or skip this step otherwise
character_event = {
	id = japan.429
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				FROM = {
					is_alive = yes
				}
			}
			if = {
				limit = {
					is_inaccessible_or_incapable_trigger = no
					FROM = {
						is_inaccessible_or_incapable_trigger = no
					}
				}
				if = {
					limit = {
						ai = yes
						is_landed = no
					}
					if = {
						limit = {
							is_married = no
							is_consort = no
							FROM = {
								reverse_has_opinion_modifier = {
									who = ROOT
									modifier = kitsune_opinion
								}
								# Is attracted to her
								OR = {
									AND = {
										is_female = no
										NOT = {
											trait = homosexual
										}
									}
									AND = {
										is_female = yes
										trait = homosexual
									}
								}
								NOT = {
									any_lover = {
										character = ROOT
									}
								}
							}
						}
						FROM = {
							character_event = { id = japan.430 } # Pretty kitsune - become lovers?
						}
					}
					else_if = {
						limit = {
							OR = {
								any_spouse = {
									character = FROM
									# Is attracted to her
									OR = {
										AND = {
											is_female = no
											NOT = {
												trait = homosexual
											}
										}
										AND = {
											is_female = yes
											trait = homosexual
										}
									}
									NOT = {
										any_lover = {
											character = ROOT
										}
									}
								}
								any_consort = {
									character = FROM
									# Is attracted to her
									OR = {
										AND = {
											is_female = no
											NOT = {
												trait = homosexual
											}
										}
										AND = {
											is_female = yes
											trait = homosexual
										}
									}
									NOT = {
										any_lover = {
											character = ROOT
										}
									}
								}
							}
						}
						FROM = {
							character_event = { id = japan.434 } # Become lovers
						}
					}
					else = {
						character_event = { id = japan.437 } # Next event
					}
				}
			}
			else = {
				repeat_event = { id = japan.429 days = 30 random = 30 }
			}
		}
	}
}

# Possible kitsune really is pretty - take her as a lover?
character_event = {
	id = japan.430
	desc = EVTDESC_JAPAN_430
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_430 # Oh, yes!
		
		piety = -10
		
		if = {
			limit = {
				trait = celibate
			}
			remove_trait = celibate
		}
		if = {
			limit = {
				trait = chaste
			}
			remove_trait = chaste
		}
		
		if = {
			limit = {
				FROM = {
					has_character_flag = kitsune_chastey_mcchasteface
					NOT = {
						trait = lustful
					}
				}
			}
			character_event = { id = japan.431 days = 1 } # Chaste person leaves your court
		}
		else_if = {
			limit = {
				FROM = {
					NOR = {
						has_character_flag = kitsune_actual_kitsune
						has_character_flag = kitsune_thief
						has_character_flag = kitsune_yandere
					}
				}
				ROOT = {
					is_unattractive_trigger = yes
				}
			}
			character_event = { id = japan.431 days = 1 } # If they don't want to sleep with you for some other reason, attractiveness is a factor...
		}
		else = {
			hidden_tooltip = {
				FROM = {
					remove_trait = chaste
				}
			}
			if = {
				limit = {
					ROOT = {
						is_female = yes
					}
				}
				character_event = { id = japan.432 days = 1 } # Lovers
			}
			else = {
				character_event = { id = japan.433 days = 1 } # Lovers and possibly more
			}
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				OR = {
					trait = chaste
					trait = celibate
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_430 # Nope!
		
		piety = 10
		
		if = {
			limit = {
				trait = lustful
			}
			remove_trait = lustful
		}
		
		FROM = {
			character_event = { id = japan.435 days = 7 random = 7 } # Kitsune/other leaves court
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				NOR = {
					trait = chaste
					trait = celibate
				}
			}
		}
	}
}

# Not a kitsune - refused seduction and left
character_event = {
	id = japan.431
	desc = EVTDESC_JAPAN_431
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_431 # Really?
		
		prestige = -10
		
		FROMFROM = {
			leave_court_effect = yes
			clr_character_flag = ai_flag_refuse_concubinage
			clr_character_flag = ai_flag_refuse_marriage
			clr_character_flag = ai_flag_refuse_conversion
			clr_character_flag = no_court_invites
			remove_opinion = {
				who = ROOT
				modifier = kitsune_opinion
			}
		}
	}
}

# Lovers - you are a woman and thus you can't get further options
character_event = {
	id = japan.432
	desc = EVTDESC_JAPAN_432
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		FROMFROM = {
			character_event = { id = japan.437 days = 30 random = 60 } # Next event
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_432 # That's great!
		
		add_lover = FROMFROM
		FROMFROM = {
			save_event_target_as = sex_partner
		}
		unprotected_sex_effect_event_target = yes
	}
}

# Lovers - become more?
character_event = {
	id = japan.433
	desc = EVTDESC_JAPAN_433
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		FROMFROM = {
			character_event = { id = japan.437 days = 30 random = 60 } # Next event
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_433 # We'll just be lovers...
		
		add_lover = FROMFROM
		FROMFROM = {
			save_event_target_as = sex_partner
		}
		unprotected_sex_effect_event_target = yes
	}
	
	option = {
		trigger = {
			NOT = {
				has_religion_feature = religion_matriarchal
			}
			OR = {
				NOR = {
					religion_group = muslim
					has_religion_feature = religion_harems
					has_religion_feature = religion_feature_zun
					has_religion_feature = religion_feature_tengri
				}
				is_tribal = yes
				is_nomadic = yes
			}
			OR = {
				NOT = {
					num_of_consorts = 3
				}
				government = chinese_imperial_government # We'll assume you don't have the full 1000 consorts...
				government = japanese_imperial_government # We'll assume you don't have the full 1000 consorts...
			}
		}
		name = EVTOPTB_JAPAN_433 # I'l make her a concubine
		
		add_lover = FROMFROM
		FROMFROM = {
			save_event_target_as = sex_partner
		}
		unprotected_sex_effect_event_target = yes
		add_consort = FROMFROM
	}
	
	option = {
		trigger = {
			NOT = {
				has_religion_feature = religion_matriarchal
			}
			OR = {
				AND = {
					OR = {
						religion_group = muslim
						has_religion_feature = religion_harems
						has_religion_feature = religion_feature_zun
						has_religion_feature = religion_feature_tengri
					}
					is_tribal = no
					is_nomadic = no
					NOT = {
						num_of_spouses = 4
					}
				}
				is_married = no
			}
		}
		name = EVTOPTB_JAPAN_433 # I'l make her a concubine
		
		if = {
			limit = {
				is_betrothed = yes
			}
			break_betrothal = yes # Just to be sure...
		}
		add_lover = FROMFROM
		FROMFROM = {
			save_event_target_as = sex_partner
		}
		unprotected_sex_effect_event_target = yes
		add_spouse = FROMFROM
	}
}

# Already your spouse/concubine - become lovers
character_event = {
	id = japan.434
	desc = EVTDESC_JAPAN_434
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		FROM = {
			character_event = { id = japan.437 days = 30 random = 60 } # Next event
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_434 # This must be love!
		
		add_lover = FROM
		FROMFROM = {
			save_event_target_as = sex_partner
		}
		unprotected_sex_effect_event_target = yes
	}
}

# Ping in case kitsune has become landed/married/etc.
character_event = {
	id = japan.435
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				ai = yes
				is_landed = no
				is_married = no
				is_consort = no
				NOT = {
					any_lover = {
						character = FROM
					}
				}
			}
			FROM = {
				character_event = { id = japan.436 } # Kitsune/other leaves court
			}
		}
	}
}

# Kitsune/other leaves court if not in some kind of intimate relationship
character_event = {
	id = japan.436
	desc = EVTDESC_JAPAN_436
	picture = GFX_evt_upsetting_letter
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_436 # I see...
		
		FROM = {
			leave_court_and_die_effect = yes
		}
	}
}

# See if the advice event needs to be fired
character_event = {
	id = japan.437
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				ai = yes
				is_landed = no
			}
			if = {
				limit = {
					any_opinion_modifier_target = {
						reverse_has_opinion_modifier = {
							who = ROOT
							modifier = kitsune_opinion
						}
						is_alive = yes
					}
				}
				if = {
					limit = {
						is_inaccessible_or_incapable_trigger = no
						any_opinion_modifier_target = {
							reverse_has_opinion_modifier = {
								who = ROOT
								modifier = kitsune_opinion
							}
							is_inaccessible_or_incapable_trigger = no
						}
					}
					random_list = {
						1 = {
							any_opinion_modifier_target = {
								limit = {
									reverse_has_opinion_modifier = {
										who = ROOT
										modifier = kitsune_opinion
									}
								}
								character_event = { id = japan.438 } # Advice
							}
						}
						1 = {
							modifier = {
								factor = 0
								has_character_flag = kitsune_thief
							}
							character_event = { id = japan.442 } # Next event
						}
					}
				}
				else = {
					repeat_event = { id = japan.437 days = 30 random = 30 }
				}
			}
		}
	}
}

# Possible kitsune really is smart - take her advice into consideration?
character_event = {
	id = japan.438
	desc = EVTDESC_JAPAN_438
	picture = GFX_evt_throne_room
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_438 # That seems like a good idea!
		
		if = {
			limit = {
				FROM = {
					has_character_flag = kitsune_thief
				}
			}
			character_event = { id = japan.439 days = 7 random = 7 } # Thief steals money and leaves
		}
		else = {
			character_event = { id = japan.440 days = 7 random = 7 } # Random thief caugt
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = paranoid
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_438 # I don't think so!
		
		if = {
			limit = {
				FROM = {
					has_character_flag = kitsune_thief
					is_married = no
					is_consort = no
				}
			}
			character_event = { id = japan.441 days = 1 } # Would-be thief leaves
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = trusting
			}
		}
	}
}

# Not a kitsune - thief
character_event = {
	id = japan.439
	desc = EVTDESC_JAPAN_439
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_439 # It was a setup!
		
		prestige = -25
		
		transfer_scaled_wealth = {
			from = ROOT
			to = FROMFROM
			value = 1
			min = 25
			max = 1000
		}
		
		FROMFROM = {
			if = {
				limit = {
					any_lover = {
						character = ROOT
					}
				}
				remove_lover = ROOT
			}
			leave_court_effect = yes
			clr_character_flag = ai_flag_refuse_concubinage
			clr_character_flag = ai_flag_refuse_marriage
			clr_character_flag = ai_flag_refuse_conversion
			clr_character_flag = no_court_invites
			remove_opinion = {
				who = ROOT
				modifier = kitsune_opinion
			}
			add_rival = ROOT
			reverse_opinion = {
				who = ROOT
				modifier = opinion_thief
			}
		}
	}
}

# Advice was good - random thief caught
character_event = {
	id = japan.440
	desc = EVTDESC_JAPAN_440
	picture = GFX_evt_catching_heretic
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		FROMFROM = {
			character_event = { id = japan.442 days = 30 random = 60 } # Next event
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_440 # Her advice was good!
		
		prestige = 10
		
		FROMFROM = {
			prestige = 25
		}
	}
}

# Did not take advice into consideration - would-be thief leaves court and ends relationship if not married or a consort
character_event = {
	id = japan.441
	desc = EVTDESC_JAPAN_441
	picture = GFX_evt_upsetting_letter
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_441 # Really?
		
		prestige = -10
		
		FROMFROM = {
			if = {
				limit = {
					any_lover = {
						character = ROOT
					}
				}
				remove_lover = ROOT
			}
			leave_court_effect = yes
			clr_character_flag = ai_flag_refuse_concubinage
			clr_character_flag = ai_flag_refuse_marriage
			clr_character_flag = ai_flag_refuse_conversion
			clr_character_flag = no_court_invites
			remove_opinion = {
				who = ROOT
				modifier = kitsune_opinion
			}
		}
	}
}

# Ping to see if there's a possible yandere target; if not, skip to the next step
character_event = {
	id = japan.442
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				ai = yes
				is_landed = no
			}
			if = {
				limit = {
					any_opinion_modifier_target = {
						reverse_has_opinion_modifier = {
							who = ROOT
							modifier = kitsune_opinion
						}
						is_alive = yes
					}
				}
				if = {
					limit = {
						is_inaccessible_or_incapable_trigger = no
						any_opinion_modifier_target = {
							reverse_has_opinion_modifier = {
								who = ROOT
								modifier = kitsune_opinion
							}
							is_inaccessible_or_incapable_trigger = no
						}
					}
					random_list = {
						1 = {
							modifier = {
								factor = 0
								NOT = {
									has_character_flag = kitsune_yandere
								}
							}
							modifier = {
								factor = 0
								NOT = {
									any_opinion_modifier_target = {
										reverse_has_opinion_modifier = {
											who = ROOT
											modifier = kitsune_opinion
										}
										OR = {
											any_spouse = {
												NOT = {
													character = ROOT
												}
											}
											any_consort = {
												NOT = {
													character = ROOT
												}
											}
											any_lover = {
												NOT = {
													character = ROOT
												}
											}
										}
									}
								}
							}
							any_opinion_modifier_target = {
								limit = {
									reverse_has_opinion_modifier = {
										who = ROOT
										modifier = kitsune_opinion
									}
								}
								save_event_target_as = yandere_obsession
								character_event = { id = japan.443 } # Yandere does her thing
								any_spouse = {
									limit = {
										NOT = {
											character = ROOT
										}
									}
									character_event = { id = japan.444 } # Yandere does her thing
								}
								any_consort = {
									limit = {
										NOT = {
											character = ROOT
										}
									}
									character_event = { id = japan.444 } # Yandere does her thing
								}
								any_lover = {
									limit = {
										NOT = {
											character = ROOT
										}
									}
									character_event = { id = japan.444 } # Yandere does her thing
								}
							}
						}
						1 = {
							modifier = {
								factor = 0
								has_character_flag = kitsune_yandere
							}
							modifier = {
								factor = 0
								NOT = {
									any_opinion_modifier_target = {
										reverse_has_opinion_modifier = {
											who = ROOT
											modifier = kitsune_opinion
										}
										OR = {
											any_spouse = {
												NOT = {
													character = ROOT
												}
											}
											any_consort = {
												NOT = {
													character = ROOT
												}
											}
											any_lover = {
												NOT = {
													character = ROOT
												}
											}
										}
									}
								}
							}
							any_opinion_modifier_target = {
								limit = {
									reverse_has_opinion_modifier = {
										who = ROOT
										modifier = kitsune_opinion
									}
								}
								character_event = { id = japan.445 } # Rivalry
							}
						}
						1 = {
							modifier = {
								factor = 0
								has_character_flag = kitsune_yandere
							}
							character_event = { id = japan.447 } # Next event
						}
						1 = {
							modifier = {
								factor = 0
								NOT = {
									has_character_flag = kitsune_yandere
								}
							}
							repeat_event = { id = japan.442 days = 365 random = 365 } # Keep on yandere-ing!
						}
					}
				}
				else = {
					repeat_event = { id = japan.442 days = 30 random = 30 }
				}
			}
		}
	}
}

# Not a kitsune - yandere
character_event = {
	id = japan.443
	desc = EVTDESC_JAPAN_443
	picture = GFX_evt_staked_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_443 # Off with her head!
		
		remove_lover = FROM
		FROM = {
			death = {
				death_reason = death_execution
				killer = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = arbitrary
			}
			modifier = {
				factor = 0.01
				trait = kind
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_443 # Throw her in a cell!
		
		remove_lover = FROM
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = arbitrary
			}
			modifier = {
				factor = 0.01
				trait = cruel
			}
		}
	}
	
	option = {
		name = EVTOPTC_JAPAN_443 # She's the only one for me!
	
		FROM = {
			if = {
				limit = {
					NOT = {
						any_lover = {
							character = ROOT
						}
					}
				}
				add_lover = ROOT
			}
			ROOT = {
				save_event_target_as = sex_partner
			}
			unprotected_sex_effect_event_target = yes
			character_event = { id = japan.442 days = 365 random = 365 } # Yandere must keep on yandere-ing!
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = just
			}
		}
	}
}

# Inform anyone killed by yandere
character_event = {
	id = japan.444
	desc = EVTDESC_JAPAN_444
	picture = GFX_evt_staked_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_444 # No! Get away from me!
		
		hidden_tooltip = {
			save_event_target_as = target_victim
			FROM = { character_event = { id = 10 } } # Consequences of discovery
			clear_event_target = target_victim
		}
		death = {
			death_reason = death_murder
			killer = FROM
		}
	}
}

# Rivalry with your spouse/concubine/lover
character_event = {
	id = japan.445
	desc = EVTDESC_JAPAN_445
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			1 = {
				modifier = {
					factor = 0
					NOT = {
						any_spouse = {
							NOT = {
								character = FROM
							}
						}
					}
				}
				random_spouse = {
					limit = {
						NOT = {
							character = FROM
						}
					}
					save_event_target_as = kitsune_rival
					character_event = { id = japan.446 }
				}
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						any_consort = {
							NOT = {
								character = FROM
							}
						}
					}
				}
				random_consort = {
					limit = {
						NOT = {
							character = FROM
						}
					}
					save_event_target_as = kitsune_rival
					character_event = { id = japan.446 }
				}
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						any_lover = {
							NOT = {
								character = FROM
							}
						}
					}
				}
				random_lover = {
					limit = {
						NOT = {
							character = FROM
						}
					}
					save_event_target_as = kitsune_rival
					character_event = { id = japan.446 }
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_445 # I see...
	}
}

# Inform rival
character_event = {
	id = japan.446
	desc = EVTDESC_JAPAN_446
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_446 # I hate you too!
		
		add_rival = FROMFROM
	}
}

# Ping to see if Buddhist nun or ill girl option is on the table
character_event = {
	id = japan.447
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				ai = yes
				is_landed = no
			}
			if = {
				limit = {
					any_opinion_modifier_target = {
						reverse_has_opinion_modifier = {
							who = ROOT
							modifier = kitsune_opinion
						}
						is_alive = yes
					}
				}
				if = {
					limit = {
						is_inaccessible_or_incapable_trigger = no
						any_opinion_modifier_target = {
							reverse_has_opinion_modifier = {
								who = ROOT
								modifier = kitsune_opinion
							}
							is_inaccessible_or_incapable_trigger = no
						}
					}
					if = {
						limit = {
							has_character_flag = kitsune_future_nun
							NAND = {
								NOT = {
									true_religion = buddhist
								}
								trait = zealous
							}
						}
						any_opinion_modifier_target = {
							limit = {
								reverse_has_opinion_modifier = {
									who = ROOT
									modifier = kitsune_opinion
								}
							}
							character_event = { id = japan.448 } # Ask to become a nun
						}
					}
					else_if = {
						limit = {
							has_character_flag = kitsune_ill_girl
						}
						any_opinion_modifier_target = {
							limit = {
								reverse_has_opinion_modifier = {
									who = ROOT
									modifier = kitsune_opinion
								}
							}
							character_event = { id = japan.451 } # Ill girl is ill
						}
					}
					else = {
						character_event = { id = japan.453 }
					}
				}
				else = {
					repeat_event = { id = japan.447 days = 30 random = 30 }
				}
			}
		}
	}
}

# Not a kitsune - asks to become a Buddhist nun
character_event = {
	id = japan.448
	desc = EVTDESC_JAPAN_448
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_448 # If that is your wish...
		
		if = {
			limit = {
				any_lover = {
					character = FROM
				}
			}
			remove_lover = FROM
		}
		
		FROM = {
			if = {
				limit = {
					is_married = yes
				}
				any_spouse = {
					remove_spouse = FROM
				}
			}
			if = {
				limit = {
					is_consort = yes
				}
				any_consort = {
					remove_consort = FROM
				}
			}
			if = {
				limit = {
					is_betrothed = yes
				}
				break_betrothal = yes
			}
			religion = buddhist
			add_trait = bhikkhuni
			clr_character_flag = ai_flag_refuse_concubinage
			clr_character_flag = ai_flag_refuse_marriage
			clr_character_flag = ai_flag_refuse_conversion
			clr_character_flag = no_court_invites
			remove_opinion = {
				who = ROOT
				modifier = kitsune_opinion
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = zealous
				NOT = {
					true_religion = buddhist
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_448 # I forbid it!
		
		if = {
			limit = {
				religion = buddhist
			}
			piety = -10
		}
		
		if = {
			limit = {
				FROM = {
					OR = {
						is_married = yes
						is_consort = yes
					}
				}
			}
			character_event = { id = japan.449 days = 7 random = 7 }
		}
		else = {
			character_event = { id = japan.450 days = 1 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				true_religion = buddhist
			}
			modifier = {
				factor = 0
				true_religion = buddhist
				trait = zealous
			}
		}
	}
}

# Refused to let her become a nun - stop being lovers
character_event = {
	id = japan.449
	desc = EVTDESC_JAPAN_449
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_449 # I see...
		
		remove_lover = FROMFROM
	}
}

# Refused to let her become a nun - would-be nun leaves court and ends relationship if not married or a consort
character_event = {
	id = japan.450
	desc = EVTDESC_JAPAN_450
	picture = GFX_evt_upsetting_letter
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_450 # I see...
		
		remove_lover = FROMFROM
		
		FROMFROM = {
			religion = buddhist
			add_trait = bhikkhuni
			leave_court_effect = yes
			clr_character_flag = ai_flag_refuse_concubinage
			clr_character_flag = ai_flag_refuse_marriage
			clr_character_flag = ai_flag_refuse_conversion
			clr_character_flag = no_court_invites
			remove_opinion = {
				who = ROOT
				modifier = kitsune_opinion
			}
		}
	}
}

# Not a kitsune - ill girl is ill
character_event = {
	id = japan.451
	desc = EVTDESC_JAPAN_451
	picture = GFX_evt_illness
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_451 # Poor thing!
		
		FROM = {
			if = {
				limit = {
					has_dlc = "Reapers"
				}
				random_list = {
					1 = {
						give_pneumonic_effect = yes
					}
					1 = {
						give_flu_effect = yes
					}
					1 = {
						give_food_poisoning_effect = yes
					}
				}
			}
			else = {
				add_trait = ill
			}
		}
		
		FROM = {
			character_event = { id = japan.452 days = 180 random = 180 }
		}
	}
}

# Hidden event for ill girl to become ill again
character_event = {
	id = japan.452
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				ai = yes
				is_landed = no
				is_ill = no
			}
			if = {
				limit = {
					FROM = {
						is_alive = yes
					}
				}
				if = {
					limit = {
						is_inaccessible_or_incapable_trigger = no
						FROM = {
							is_inaccessible_or_incapable_trigger = no
						}
					}
					FROM = {
						character_event = { id = japan.451 } # Ill girl is ill
					}
				}
				else = {
					repeat_event = { id = japan.452 days = 180 random = 180 }
				}
			}
		}
	}
}

# Let's see if we've actually got a kitsune and go to event selection if so
character_event = {
	id = japan.453
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				has_any_opinion_modifier = kitsune_opinion
				has_character_flag = kitsune_actual_kitsune
			}
			any_opinion_modifier_target = {
				limit = {
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = kitsune_opinion
					}
				}
				save_event_target_as = kitsune_target
			}
			character_event = { id = japan.454 } # Actual kitsune events
		}
	}
}

### Actual kitsune events

# Kitsune event selection
character_event = {
	id = japan.454
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			1 = {
				modifier = {
					factor = 0
					has_character_flag = kitsune_nine_tails
				}
				character_event = { id = japan.455 } # Kitsune gets another tail
			}
			10 = {
				modifier = {
					factor = 0
					NAND = {
						trait = elusive_shadow
						trait = fair
						NOT = {
							trait = celibate
						}
						trait = lustful
						trait = deceitful
						trait = shrewd
						trait = gregarious
					}
				}
				character_event = { id = japan.456 } # Kitsune's traits change back
			}
			10 = {
				modifier = {
					factor = 0
					NOT = {
						any_lover = {
							event_target:kitsune_target = {
								NOT = {
									character = PREV
								}
							}
						}
					}
				}
				modifier = {
					factor = 0
					event_target:kitsune_target = {
						is_alive = no
					}
				}
				character_event = { id = japan.457 } # Kitsune discards irrlevant lovers
			}
			10 = {
				modifier = {
					factor = 0
					NOT = {
						event_target:kitsune_target = {
							is_inaccessible_or_incapable_trigger = no
							any_rival = {
								character = ROOT
							}
						}
					}
				}
				modifier = {
					factor = 0
					event_target:kitsune_target = {
						is_alive = no
					}
				}
				character_event = { id = japan.459 } # Kitsune stops being a rival of her target
			}
			10 = {
				modifier = {
					factor = 0
					NAND = {
						event_target:kitsune_target = {
							is_inaccessible_or_incapable_trigger = no
							NOT = {
								any_lover = {
									character = ROOT
								}
							}
							OR = {
								NOT = {
									trait = homosexual
								}
								is_female = yes
							}
						}
						ROOT = {
							OR = {
								NOT = {
									trait = homosexual
								}
								event_target:kitsune_target = {
									is_female = yes
								}
							}
						}
					}
				}
				modifier = {
					factor = 0
					event_target:kitsune_target = {
						is_alive = no
					}
				}
				character_event = { id = japan.461 } # Kitsune and target fall in love again
			}
			10 = {
				modifier = {
					factor = 0
					NOT = {
						event_target:kitsune_target = {
							OR = {
								any_spouse = {
									is_inaccessible_or_incapable_trigger = no
									NOT = {
										character = ROOT
									}
								}
								any_consort = {
									is_inaccessible_or_incapable_trigger = no
									NOT = {
										character = ROOT
									}
								}
								any_lover = {
									is_inaccessible_or_incapable_trigger = no
									NOT = {
										character = ROOT
									}
								}
							}
						}
					}
				}
				modifier = {
					factor = 0
					event_target:kitsune_target = {
						is_alive = no
					}
				}
				character_event = { id = japan.463 } # Kitsune removes "obstacles"
			}
			10 = {
				modifier = {
					factor = 0
					NOT = {
						event_target:kitsune_target = {
							is_inaccessible_or_incapable_trigger = no
							is_landed = yes
						}
					}
				}
				modifier = {
					factor = 0
					event_target:kitsune_target = {
						is_alive = no
					}
				}
				character_event = { id = japan.466 } # Kitsune impresses courtier
			}
			10 = {
				modifier = {
					factor = 0
					NOT = {
						event_target:kitsune_target = {
							is_inaccessible_or_incapable_trigger = no
							is_landed = yes
						}
					}
				}
				modifier = {
					factor = 0
					event_target:kitsune_target = {
						is_alive = no
					}
				}
				character_event = { id = japan.469 } # Kitsune slips up
			}
			10 = {
				modifier = {
					factor = 0
					NOT = {
						event_target:kitsune_target = {
							is_inaccessible_or_incapable_trigger = no
							is_landed = yes
						}
					}
				}
				modifier = {
					factor = 0
					NOT = {
						age = 40
					}
				}
				modifier = {
					factor = 10
					age = 80
				}
				modifier = {
					factor = 0
					event_target:kitsune_target = {
						is_alive = no
					}
				}
				event_target:kitsune_target = {
					character_event = { id = japan.482 } # Kitsune looks far too young
				}
			}
			10 = {
				modifier = {
					factor = 0
					NOT = {
						event_target:kitsune_target = {
							is_alive = yes
							is_inaccessible_or_incapable_trigger = no
						}
					}
				}
				modifier = {
					factor = 0
					event_target:kitsune_target = {
						is_alive = no
					}
				}
				character_event = { id = japan.489 } # Kitsune makes target ill
			}
			10 = {
				modifier = {
					factor = 0
					NOT = {
						any_child = {
							is_inaccessible_or_incapable_trigger = yes
							is_alive = yes
							is_adult = no
							NOT = {
								has_character_flag = kitsune_lesson
							}
						}
					}
				}
				character_event = { id = japan.491 } # Kitsune gives her child a lesson
			}
			10 = {
				character_event = { id = japan.493 } # Kitsune is visited by foxes
			}
			10 = {
				character_event = { id = japan.495 } # Kitsune visits someone's dreams
			}
			10 = {
				modifier = {
					factor = 0
					NOT = {
						event_target:kitsune_target = {
							is_alive = yes
							is_inaccessible_or_incapable_trigger = no
						}
					}
				}
				modifier = {
					factor = 0
					trait = celibate
				}
				modifier = {
					factor = 0
					event_target:kitsune_target = {
						is_alive = no
					}
				}
				character_event = { id = japan.497 } # Kitsune feeds on sex
			}
			10 = {
				modifier = {
					factor = 0
					NOT = {
						top_liege = {
							any_realm_lord = {
								is_theocracy = yes
								NOT = {
									any_rival = {
										character = ROOT
									}
								}
							}
						}
					}
				}
				character_event = { id = japan.499 } # Kitsune disliks priest
			}
			10 = {
				modifier = {
					factor = 0
					NOT = {
						top_liege = {
							any_realm_lord = {
								is_theocracy = yes
								any_rival = {
									character = ROOT
								}
							}
						}
					}
				}
				character_event = { id = japan.501 } # Kitsune kills priest
			}
			100 = {
				modifier = {
					factor = 0
					NOT = {
						prisoner = yes
					}
				}
				character_event = { id = japan.503 } # Kitsune escapes prison
			}
			100 = {}
		}
		repeat_event = { id = japan.454 days = 365 random = 365 }
	}
}

# Kitsune gets another tail
character_event = {
	id = japan.455
	desc = EVTDESC_JAPAN_455
	picture = GFX_evt_religious_exultation
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_455 # My power grows!
		
		if = {
			limit = {
				has_character_flag = kitsune_eight_tails
			}
			clr_character_flag = kitsune_eight_tails
			set_character_flag = kitsune_nine_tails
			if = {
				limit = {
					this_has_super_cool_nickname_trigger = no
				}
				give_nickname = nick_of_the_nine_tails
			}
		}
		else_if = {
			limit = {
				has_character_flag = kitsune_seven_tails
			}
			clr_character_flag = kitsune_seven_tails
			set_character_flag = kitsune_eight_tails
		}
		else_if = {
			limit = {
				has_character_flag = kitsune_six_tails
			}
			clr_character_flag = kitsune_six_tails
			set_character_flag = kitsune_seven_tails
		}
		else_if = {
			limit = {
				has_character_flag = kitsune_five_tails
			}
			clr_character_flag = kitsune_five_tails
			set_character_flag = kitsune_six_tails
		}
		else_if = {
			limit = {
				has_character_flag = kitsune_four_tails
			}
			clr_character_flag = kitsune_four_tails
			set_character_flag = kitsune_five_tails
		}
		else_if = {
			limit = {
				has_character_flag = kitsune_three_tails
			}
			clr_character_flag = kitsune_three_tails
			set_character_flag = kitsune_four_tails
		}
		else_if = {
			limit = {
				has_character_flag = kitsune_two_tails
			}
			clr_character_flag = kitsune_two_tails
			set_character_flag = kitsune_three_tails
		}
		else = {
			clr_character_flag = kitsune_one_tail
			set_character_flag = kitsune_two_tails
		}
		
		change_diplomacy = 1
		change_intrigue = 1
	}
}

# Kitsune becomes more kitsune-like if her traits have changed too much
character_event = {
	id = japan.456
	desc = EVTDESC_JAPAN_456
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_456 # My true nature cannot remain hidden!
		
		if = {
			limit = {
				NOT = {
					trait = elusive_shadow
				}
			}
			remove_education_effect = yes
			add_trait = elusive_shadow
		}
		
		remove_all_negative_congenital_traits_effect = yes
		
		if = {
			limit = {
				NOT = {
					trait = fair
				}
			}
			add_trait = fair
		}
		if = {
			limit = {
				NOT = {
					trait = celibate
				}
			}
			remove_trait = celibate
		}
		if = {
			limit = {
				NOT = {
					trait = lustful
				}
			}
			add_trait = lustful
		}
		if = {
			limit = {
				NOT = {
					trait = deceitful
				}
			}
			add_trait = deceitful
		}
		if = {
			limit = {
				NOT = {
					trait = shrewd
				}
			}
			add_trait = shrewd
		}
		if = {
			limit = {
				NOT = {
					trait = gregarious
				}
			}
			add_trait = gregarious
		}
	}
}

# Kitsune discards lovers that aren't her target
character_event = {
	id = japan.457
	desc = EVTDESC_JAPAN_457
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_457 # I need to remain focused!
		
		any_lover = {
			limit = {
				NOT = {
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = kitsune_opinion
					}
				}
			}
			remove_lover = ROOT
			character_event = { id = japan.458 }
		}
	}
}

# Lovers notified
character_event = {
	id = japan.458
	desc = EVTDESC_JAPAN_458
	picture = GFX_evt_upsetting_letter
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_458 # I see...
		
		remove_lover = FROM
	}
}

# If a rival with your target, lose that
character_event = {
	id = japan.459
	desc = EVTDESC_JAPAN_459
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_459 # I need to remain focused!
		
		any_rival = {
			limit = {
				reverse_has_opinion_modifier = {
					who = ROOT
					modifier = kitsune_opinion
				}
			}
			remove_rival = ROOT
			character_event = { id = japan.460 }
		}
	}
}

# Target notified
character_event = {
	id = japan.460
	desc = EVTDESC_JAPAN_460
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_460 # It was just a misunderstanding!
		
		remove_rival = FROM
	}
}

# If possible, become lovers with your target again
character_event = {
	id = japan.461
	desc = EVTDESC_JAPAN_461
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_461 # I need to remain focused!
		
		event_target:kitsune_target = {
			add_lover = ROOT
			character_event = { id = japan.462 }
		}
	}
}

# Target notified
character_event = {
	id = japan.462
	desc = EVTDESC_JAPAN_462
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_462 # It was just a misunderstanding!
		
		add_lover = FROM
	}
}

# Kitsune might arrange for an accident for a spouse/concubine/lover of their target
character_event = {
	id = japan.463
	desc = EVTDESC_JAPAN_463
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		event_target:kitsune_target = {
			random_list = {
				1 = {
					modifier = {
						factor = 0
						NOT = {
							any_spouse = {
								NOT = {
									character = ROOT
								}
							}
						}
					}
					random_spouse = {
						limit = {
							NOT = {
								character = ROOT
							}
						}
						save_event_target_as = kitsune_rival
					}
				}
				1 = {
					modifier = {
						factor = 0
						NOT = {
							any_consort = {
								NOT = {
									character = ROOT
								}
							}
						}
					}
					random_consort = {
						limit = {
							NOT = {
								character = ROOT
							}
						}
						save_event_target_as = kitsune_rival
					}
				}
				1 = {
					modifier = {
						factor = 0
						NOT = {
							any_lover = {
								NOT = {
									character = ROOT
								}
							}
						}
					}
					random_lover = {
						limit = {
							NOT = {
								character = ROOT
							}
						}
						save_event_target_as = kitsune_rival
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_463 # Yes!
		
		event_target:kitsune_rival = {
			character_event = { id = japan.464 } # Inform victim
		}
		
		event_target:kitsune_target = {
			character_event = { id = japan.465 } # Inform target
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_463 # No!
		
		ai_chance = {
			factor = 0
		}
	}
}

# Victim dies
character_event = {
	id = japan.464
	desc = EVTDESC_JAPAN_464
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_464 # You? No!
		
		death = {
			death_reason = death_murder_unknown
			killer = FROM
		}
	}
}

# Target notified
character_event = {
	id = japan.465
	desc = EVTDESC_JAPAN_465
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_465 # Who could have done this...?
	}
}

# Kitsune impresses courtier
character_event = {
	id = japan.466
	desc = EVTDESC_JAPAN_466
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		event_target:kitsune_target = {
			random_courtier_or_vassal = {
				limit = {
					is_inaccessible_or_incapable_trigger = no
				}
				save_event_target_as = kitsune_courtier
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_466 # Great!
		
		prestige = 25
		
		event_target:kitsune_courtier = {
			character_event = { id = japan.467 }
		}
	}
}

# Courtier notified
character_event = {
	id = japan.467
	desc = EVTDESC_JAPAN_467
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_467 # She sure is well-spoken!
		
		event_target:kitsune_target = {
			character_event = { id = japan.468 }
		}
	}
}

# Target notified
character_event = {
	id = japan.468
	desc = EVTDESC_JAPAN_468
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_468 # That's good to hear!
	}
}

# Kitsune makes courtier suspicious
character_event = {
	id = japan.469
	desc = EVTDESC_JAPAN_469
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		event_target:kitsune_target = {
			random_courtier_or_vassal = {
				limit = {
					is_inaccessible_or_incapable_trigger = no
					NOR = {
						any_spouse = {
							character = ROOT
						}
						any_consort = {
							character = ROOT
						}
						any_lover = {
							character = ROOT
						}
					}
				}
				preferred_limit = {
					intrigue = 20
				}
				preferred_limit = {
					trait = mystic
				}
				preferred_limit = {
					is_smart_trigger = yes
				}
				save_event_target_as = kitsune_courtier
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_469 # I was perhaps a bit careless...
		
		prestige = -10
		
		event_target:kitsune_courtier = {
			character_event = { id = japan.470 } # Informed that kitsune is suspicious
		}
	}
}

# Kitsune is suspicious - inform target?
character_event = {
	id = japan.470
	desc = EVTDESC_JAPAN_470
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	
	option = {
		name = EVTOPTA_JAPAN_470 # Yes!
		
		FROM = {
			event_target:kitsune_target = {
				character_event = { id = japan.471 } # Inform target
			}
		}
		
		add_rival = FROM
	}
	
	option = {
		name = EVTOPTB_JAPAN_463 # No!
		
		ai_chance = {
			factor = 0
		}
	}
}

# Target notified - might ignore or confront
character_event = {
	id = japan.471
	desc = EVTDESC_JAPAN_471
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	
	option = {
		name = EVTOPTA_JAPAN_471 # I don't believe you!
		
		FROM = {
			character_event = { id = japan.472 days = 1 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = paranoid
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_471 # I will confront her!
		
		FROMFROM = {
			character_event = { id = japan.473 days = 1 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = trusting
			}
		}
	}
}

# Inform courtier that they were ignored
character_event = {
	id = japan.472
	desc = EVTDESC_JAPAN_472
	picture = GFX_evt_upsetting_letter
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_472 # I see...
		
		prestige = -25
	}
}

# Kitsune confronted - charm target?
character_event = {
	id = japan.473
	desc = EVTDESC_JAPAN_473
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	
	option = {
		name = EVTOPTA_JAPAN_473 # This is no longer funny!
		
		FROM = {
			character_event = { id = japan.474 days = 1 }
		}
		
		leave_court_and_die_effect = yes
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				FROM = {
					trait = trusting
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_473 # Time to turn on the charm!
		
		random_list = {
			50 = {
				modifier = {
					factor = 256
					has_character_flag = kitsune_nine_tails
				}
				modifier = {
					factor = 128
					has_character_flag = kitsune_eight_tails
				}
				modifier = {
					factor = 64
					has_character_flag = kitsune_seven_tails
				}
				modifier = {
					factor = 32
					has_character_flag = kitsune_six_tails
				}
				modifier = {
					factor = 16
					has_character_flag = kitsune_five_tails
				}
				modifier = {
					factor = 8
					has_character_flag = kitsune_four_tails
				}
				modifier = {
					factor = 4
					has_character_flag = kitsune_three_tails
				}
				modifier = {
					factor = 2
					has_character_flag = kitsune_two_tails
				}
				modifier = {
					factor = 2
					intrigue = 40
				}
				modifier = {
					factor = 2
					intrigue = 36
				}
				modifier = {
					factor = 2
					intrigue = 32
				}
				modifier = {
					factor = 2
					intrigue = 28
				}
				modifier = {
					factor = 2
					intrigue = 24
				}
				modifier = {
					factor = 2
					intrigue = 20
				}
				modifier = {
					factor = 2
					intrigue = 12
				}
				character_event = { id = japan.476 days = 1 } # Target charmed
			}
			50 = {
				modifier = {
					factor = 2
					FROM = {
						intrigue = 40
					}
				}
				modifier = {
					factor = 2
					FROM = {
						intrigue = 36
					}
				}
				modifier = {
					factor = 2
					FROM = {
						intrigue = 32
					}
				}
				modifier = {
					factor = 2
					FROM = {
						intrigue = 28
					}
				}
				modifier = {
					factor = 2
					FROM = {
						intrigue = 24
					}
				}
				modifier = {
					factor = 2
					FROM = {
						intrigue = 20
					}
				}
				modifier = {
					factor = 2
					FROM = {
						intrigue = 16
					}
				}
				character_event = { id = japan.479 days = 1 } # Target not charmed
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = honest
			}
		}
	}
}

# Kitsune elected to flee - inform target
character_event = {
	id = japan.474
	desc = EVTDESC_JAPAN_474
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_474 # She *was* a kitsune!
		
		FROMFROMFROM = {
			character_event = { id = japan.475 }
		}
		
		prestige = -10
	}
}

# Inform courtier that they've been vindicated
character_event = {
	id = japan.475
	desc = EVTDESC_JAPAN_475
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_475 # Told you!
		
		prestige = 25
	}
}

# Target charmed
character_event = {
	id = japan.476
	desc = EVTDESC_JAPAN_476
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_476 # Child's play!
		
		prestige = 25
		
		FROMFROM = {
			character_event = { id = japan.477 }
		}
	}
}

# Inform target
character_event = {
	id = japan.477
	desc = EVTDESC_JAPAN_477
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_477 # She's the most trustworthiest human ever!
		
		prestige = -10
		
		FROMFROMFROMFROM = {
			character_event = { id = japan.478 }
		}
	}
}

# Inform suspicious courtier that they've been discredited
character_event = {
	id = japan.478
	desc = EVTDESC_JAPAN_478
	picture = GFX_evt_upsetting_letter
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_478 # I see...
		
		prestige = -25
	}
}

# Target not charmed - time to flee!
character_event = {
	id = japan.479
	desc = EVTDESC_JAPAN_479
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	
	option = {
		name = EVTOPTA_JAPAN_479 # This is no longer funny!
		
		FROMFROM = {
			character_event = { id = japan.480 }
		}
		
		leave_court_and_die_effect = yes
	}
}

# Inform target
character_event = {
	id = japan.480
	desc = EVTDESC_JAPAN_480
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_480 # She *was* a kitsune!
		
		FROMFROMFROM = {
			character_event = { id = japan.481 }
		}
		
		prestige = -10
	}
}

# Inform courtier that they've been vindicated
character_event = {
	id = japan.481
	desc = EVTDESC_JAPAN_481
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_481 # Told you!
		
		prestige = 25
	}
}

# Kitsune is old but doesn't look like it - confront her?
character_event = {
	id = japan.482
	desc = EVTDESC_JAPAN_482
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	
	option = {
		name = EVTOPTA_JAPAN_482 # I'm imagining things...
		
		prestige = -10
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = paranoid
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_482 # I will confront her!
		
		FROM = {
			character_event = { id = japan.483 days = 1 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = trusting
			}
		}
	}
}

# Confronted - charm target?
character_event = {
	id = japan.483
	desc = EVTDESC_JAPAN_483
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	
	option = {
		name = EVTOPTA_JAPAN_483 # This is no longer funny!
		
		FROM = {
			character_event = { id = japan.484 days = 1 }
		}
		
		leave_court_and_die_effect = yes
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				FROM = {
					trait = trusting
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_483 # Time to turn on the charm!
		
		random_list = {
			50 = {
				modifier = {
					factor = 256
					has_character_flag = kitsune_nine_tails
				}
				modifier = {
					factor = 128
					has_character_flag = kitsune_eight_tails
				}
				modifier = {
					factor = 64
					has_character_flag = kitsune_seven_tails
				}
				modifier = {
					factor = 32
					has_character_flag = kitsune_six_tails
				}
				modifier = {
					factor = 16
					has_character_flag = kitsune_five_tails
				}
				modifier = {
					factor = 8
					has_character_flag = kitsune_four_tails
				}
				modifier = {
					factor = 4
					has_character_flag = kitsune_three_tails
				}
				modifier = {
					factor = 2
					has_character_flag = kitsune_two_tails
				}
				modifier = {
					factor = 2
					intrigue = 40
				}
				modifier = {
					factor = 2
					intrigue = 36
				}
				modifier = {
					factor = 2
					intrigue = 32
				}
				modifier = {
					factor = 2
					intrigue = 28
				}
				modifier = {
					factor = 2
					intrigue = 24
				}
				modifier = {
					factor = 2
					intrigue = 20
				}
				modifier = {
					factor = 2
					intrigue = 12
				}
				character_event = { id = japan.485 days = 1 } # Target charmed
			}
			50 = {
				modifier = {
					factor = 2
					FROM = {
						intrigue = 40
					}
				}
				modifier = {
					factor = 2
					FROM = {
						intrigue = 36
					}
				}
				modifier = {
					factor = 2
					FROM = {
						intrigue = 32
					}
				}
				modifier = {
					factor = 2
					FROM = {
						intrigue = 28
					}
				}
				modifier = {
					factor = 2
					FROM = {
						intrigue = 24
					}
				}
				modifier = {
					factor = 2
					FROM = {
						intrigue = 20
					}
				}
				modifier = {
					factor = 2
					FROM = {
						intrigue = 16
					}
				}
				character_event = { id = japan.487 days = 1 } # Target not charmed
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = honest
			}
		}
	}
}

# Kitsune fled - inform target
character_event = {
	id = japan.484
	desc = EVTDESC_JAPAN_484
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_484 # She *was* a kitsune!
		
		prestige = 25
	}
}

# Target charmed
character_event = {
	id = japan.485
	desc = EVTDESC_JAPAN_485
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_485 # Child's play!
		
		prestige = 25
		
		FROMFROM = {
			character_event = { id = japan.486 }
		}
	}
}

# Inform target
character_event = {
	id = japan.486
	desc = EVTDESC_JAPAN_486
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_486 # She's the most trustworthiest human ever!
		
		prestige = -25
	}
}

# Target not charmed - time to flee!
character_event = {
	id = japan.487
	desc = EVTDESC_JAPAN_487
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	
	option = {
		name = EVTOPTA_JAPAN_487 # This is no longer funny!
		
		FROMFROM = {
			character_event = { id = japan.488 }
		}
		
		leave_court_and_die_effect = yes
	}
}

# Inform target
character_event = {
	id = japan.488
	desc = EVTDESC_JAPAN_488
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_488 # She *was* a kitsune!
		
		prestige = 25
	}
}

# Curse target to be ill?
character_event = {
	id = japan.489
	desc = EVTDESC_JAPAN_489
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_489 # Yes!
		
		event_target:kitsune_target = {
			character_event = { id = japan.490 } # Inform target
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_489 # No!
		
		ai_chance = {
			factor = 0
		}
	}
}

# Target becomes ill
character_event = {
	id = japan.490
	desc = EVTDESC_JAPAN_490
	picture = GFX_evt_illness
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_490 # I don't feel so good...
		
		if = {
			limit = {
				has_dlc = "Reapers"
			}
			random_list = {
				1 = {
					give_pneumonic_effect = yes
				}
				1 = {
					give_flu_effect = yes
				}
				1 = {
					give_food_poisoning_effect = yes
				}
			}
		}
		else = {
			add_trait = ill
		}
	}
}

# Kitsune teaches her child a few tricks
character_event = {
	id = japan.491
	desc = EVTDESC_JAPAN_491
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		random_child = {
			limit = {
				is_inaccessible_or_incapable_trigger = yes
				is_alive = yes
				is_adult = no
				NOT = {
					has_character_flag = kitsune_lesson
				}
			}
			preferred_limit = {
				is_female = yes
			}
			set_character_flag = kitsune_lesson
			save_event_target_as = kitsune_lesson_target
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_491 # Mother knows best!
		
		event_target:kitsune_lesson_target = {
			character_event = { id = japan.492 } # Inform target
		}
	}
}

# Child informed
character_event = {
	id = japan.492
	desc = EVTDESC_JAPAN_492
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_492 # What a strange lesson...
		
		change_diplomacy = 1
		change_intrigue = 1
	}
}

# Kitsune is visited by foxes
character_event = {
	id = japan.493
	desc = EVTDESC_JAPAN_493
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_493 # Hello, my furry friends!
		
		event_target:kitsune_target = {
			character_event = { id = japan.494 } # Inform target
		}
	}
}

# Target informed of fox visit
character_event = {
	id = japan.494
	desc = EVTDESC_JAPAN_494
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_494 # How odd...
	}
}

# Kitsune visits someone's dreams
character_event = {
	id = japan.495
	desc = EVTDESC_JAPAN_495
	picture = GFX_evt_sleeping_town_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		top_liege = {
			random_realm_lord = {
				limit = {
					is_playable = yes
					is_adult = yes
					is_inaccessible_or_incapable_trigger = no
				}
				save_event_target_as = kitsune_dream_target
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_495 # I will pay them a visit!
		
		prestige = 25
		
		event_target:kitsune_dream_target = {
			character_event = { id = japan.496 } # Inform target
		}
	}
}

# Dreamer informed
character_event = {
	id = japan.496
	desc = EVTDESC_JAPAN_496
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_496 # How odd...
	}
}

# Kitsune feeds by having sex
character_event = {
	id = japan.497
	desc = EVTDESC_JAPAN_497
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_497 # Time to feed!
		
		add_character_modifier = {
			modifier = invigorating_love
			months = 12
		}
		
		event_target:kitsune_target = {
			character_event = { id = japan.498 } # Inform target
		}
	}
}

# Target informed
character_event = {
	id = japan.498
	desc = EVTDESC_JAPAN_498
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_498 # That was... exhausting...
		
		if = {
			limit = {
				trait = celibate
			}
			remove_trait = celibate
		}
		
		unprotected_sex_effect = yes
		
		add_character_modifier = {
			modifier = fierce_lovemaking
			months = 12
		}
	}
}

# Develops hatred of (preferably Buddhist) priest
character_event = {
	id = japan.499
	desc = EVTDESC_JAPAN_499
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		top_liege = {
			random_realm_lord = {
				limit = {
					is_theocracy = yes
					NOT = {
						any_rival = {
							character = ROOT
						}
					}
				}
				preferred_limit = {
					religion = buddhist
				}
				save_event_target_as = kitsune_priest
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_499 # Such a turbulent priest...
		
		add_rival = event_target:kitsune_priest
		
		event_target:kitsune_target = {
			character_event = { id = japan.500 } # Inform target
		}
	}
}

# Target informed
character_event = {
	id = japan.500
	desc = EVTDESC_JAPAN_500
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_500 # I see...
	}
}

# Gets rid of (preferably Buddhist) rival priest
character_event = {
	id = japan.501
	desc = EVTDESC_JAPAN_501
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		top_liege = {
			random_realm_lord = {
				limit = {
					is_theocracy = yes
					any_rival = {
						character = ROOT
					}
				}
				preferred_limit = {
					religion = buddhist
				}
				save_event_target_as = kitsune_priest
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_501 # Such a turbulent priest...
		
		event_target:kitsune_priest = {
			death = {
				death_reason = death_murder_unknown
			}
		}
		
		event_target:kitsune_target = {
			character_event = { id = japan.502 } # Inform target
		}
	}
}

# Target informed
character_event = {
	id = japan.502
	desc = EVTDESC_JAPAN_502
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_502 # I see...
	}
}

# Imprisoned kitsune escapes
character_event = {
	id = japan.503
	desc = EVTDESC_JAPAN_503
	picture = GFX_evt_hiding_from_pursuers
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_503 # This puny cell can't hold me!
		
		prestige = 25
		
		imprison = no
		
		host = {
			character_event = { id = japan.504 } # Inform jailor
		}
		
		event_target:kitsune_target = {
			character_event = { id = japan.505 } # Inform target
		}
	}
}

# Jailor informed
character_event = {
	id = japan.504
	desc = EVTDESC_JAPAN_504
	picture = GFX_evt_hiding_from_pursuers
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_504 # I see...
	}
}

# Target informed
character_event = {
	id = japan.505
	desc = EVTDESC_JAPAN_505
	picture = GFX_evt_hiding_from_pursuers
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_505 # That's great!
	}
}

### Daughter of kitsune

# on_adulthood - daughter of kitsune might discover that she's a kitsune
character_event = {
	id = japan.506
	hide_window = yes
	
	is_triggered_only = yes
	
	only_women = yes
	
	trigger = {
		OR = {
			mother_even_if_dead = {
				trait = kitsune
			}
			mother = {
				has_character_flag = recessive_kitsune
			}
		}
	}
	
	immediate = {
		random_list = {
			98 = {} # Not kitsune
			1 = {
				health = 2
				set_character_flag = recessive_kitsune # Small chance of skipping a generation
			}
			1 = {
				health = 2
				character_event = {	id = japan.507 } # Kitsune
			}
		}
	}
}

# Kitsune's daughter is kitsune
character_event = {
	id = japan.507
	desc = EVTDESC_JAPAN_507
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_507 # My true nature cannot remain hidden!
		
		prestige = 25
		
		set_character_flag = kitsune_one_tail
		change_diplomacy = 1
		change_intrigue = 1
		
		add_trait = kitsune
		
		if = {
			limit = {
				NOT = {
					trait = elusive_shadow
				}
			}
			remove_education_effect = yes
			add_trait = elusive_shadow
		}
		
		remove_all_negative_congenital_traits_effect = yes
		
		if = {
			limit = {
				NOT = {
					trait = fair
				}
			}
			add_trait = fair
		}
		if = {
			limit = {
				NOT = {
					trait = celibate
				}
			}
			remove_trait = celibate
		}
		if = {
			limit = {
				NOT = {
					trait = lustful
				}
			}
			add_trait = lustful
		}
		if = {
			limit = {
				NOT = {
					trait = deceitful
				}
			}
			add_trait = deceitful
		}
		if = {
			limit = {
				NOT = {
					trait = shrewd
				}
			}
			add_trait = shrewd
		}
		if = {
			limit = {
				NOT = {
					trait = gregarious
				}
			}
			add_trait = gregarious
		}
		
		character_event = { id = japan.508 days = 365 random = 180 }
	}
}

# Kitsune daughter event selection - subset of mother's events
character_event = {
	id = japan.508
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				num_of_lovers = 1
			}
			random_lover = {
				preferred_limit = {
					any_spouse = {
						character = ROOT
					}
				}
				preferred_limit = {
					any_consort = {
						character = ROOT
					}
				}
				save_event_target_as = kitsune_target
			}
		}
		else_if = {
			limit = {
				is_married = yes
			}
			spouse = {
				save_event_target_as = kitsune_target
			}
		}
		else_if = {
			limit = {
				is_consort = yes
			}
			random_consort = {
				save_event_target_as = kitsune_target
			}
		}
		random_list = {
			1 = {
				modifier = {
					factor = 0
					has_character_flag = kitsune_nine_tails
				}
				character_event = { id = japan.455 } # Kitsune gets another tail
			}
			1 = { # Less likely; we don't want the player to get their traits changed frequently if this is a player...
				modifier = {
					factor = 0
					NAND = {
						trait = elusive_shadow
						trait = fair
						NOT = {
							trait = celibate
						}
						trait = lustful
						trait = deceitful
						trait = shrewd
						trait = gregarious
					}
				}
				character_event = { id = japan.456 } # Kitsune's traits change back
			}
			10 = {
				modifier = {
					factor = 0
					NOT = {
						event_target:kitsune_target = {
							OR = {
								any_spouse = {
									is_inaccessible_or_incapable_trigger = no
									NOT = {
										character = ROOT
									}
								}
								any_consort = {
									is_inaccessible_or_incapable_trigger = no
									NOT = {
										character = ROOT
									}
								}
								any_lover = {
									is_inaccessible_or_incapable_trigger = no
									NOT = {
										character = ROOT
									}
								}
							}
						}
					}
				}
				modifier = {
					factor = 0
					event_target:kitsune_target = {
						is_alive = no
					}
				}
				character_event = { id = japan.463 } # Kitsune removes "obstacles"
			}
			10 = {
				modifier = {
					factor = 0
					NOT = {
						event_target:kitsune_target = {
							is_inaccessible_or_incapable_trigger = no
							is_landed = yes
						}
					}
				}
				modifier = {
					factor = 0
					event_target:kitsune_target = {
						is_alive = no
					}
				}
				character_event = { id = japan.466 } # Kitsune impresses courtier
			}
			# Can't get the slip-up event; that'd kill us...
			# Can't get the "too young" event; that'd kill us
			10 = {
				modifier = {
					factor = 0
					NOT = {
						event_target:kitsune_target = {
							is_ill = no
							is_alive = yes
							is_inaccessible_or_incapable_trigger = no
						}
					}
				}
				modifier = {
					factor = 0
					event_target:kitsune_target = {
						is_alive = no
					}
				}
				character_event = { id = japan.489 } # Kitsune makes target ill
			}
			10 = {
				modifier = {
					factor = 0
					NOT = {
						any_child = {
							is_inaccessible_or_incapable_trigger = yes
							is_alive = yes
							is_adult = no
							NOT = {
								has_character_flag = kitsune_lesson
							}
						}
					}
				}
				character_event = { id = japan.491 } # Kitsune gives her child a lesson
			}
			10 = {
				character_event = { id = japan.493 } # Kitsune is visited by foxes
			}
			10 = {
				character_event = { id = japan.495 } # Kitsune visits someone's dreams
			}
			10 = {
				modifier = {
					factor = 0
					NOT = {
						event_target:kitsune_target = {
							is_alive = yes
							is_inaccessible_or_incapable_trigger = no
						}
					}
				}
				modifier = {
					factor = 0
					trait = celibate
				}
				modifier = {
					factor = 0
					event_target:kitsune_target = {
						is_alive = no
					}
				}
				character_event = { id = japan.497 } # Kitsune feeds on sex
			}
			10 = {
				modifier = {
					factor = 0
					NOT = {
						top_liege = {
							any_realm_lord = {
								is_theocracy = yes
								NOT = {
									any_rival = {
										character = ROOT
									}
								}
							}
						}
					}
				}
				character_event = { id = japan.499 } # Kitsune disliks priest
			}
			10 = {
				modifier = {
					factor = 0
					NOT = {
						top_liege = {
							any_realm_lord = {
								is_theocracy = yes
								any_rival = {
									character = ROOT
								}
							}
						}
					}
				}
				character_event = { id = japan.501 } # Kitsune kills priest
			}
			100 = {
				modifier = {
					factor = 0
					NOT = {
						prisoner = yes
					}
				}
				character_event = { id = japan.503 } # Kitsune escapes prison
			}
			100 = {}
		}
		repeat_event = { id = japan.508 days = 365 random = 365 }
	}
}

##### The Moon Princess (Kaguya-hime/Breony Freitnor)

# Hidden first event
character_event = {
	id = japan.509
	hide_window = yes
	
	is_triggered_only = yes
	
	religion = catholic
	only_rulers = yes
	
	trigger = {
		controls_religion = yes
		NOT = {
			has_global_flag = get_medieval
		}
		year = 1337
		NOT = {
			has_game_rule = {
				name = supernatural_events # Sufficiently advanced technology and all that...
				value = off
			}
		}
	}
	
	immediate = {
		set_global_flag = get_medieval
		2485 = {
			province_event = { id = japan.510 days = 3650 random = 7300 }
		}
	}
}

# And hidden second event
province_event = {
	id = japan.510
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				has_game_rule = {
					name = supernatural_events # Sufficiently advanced technology and all that...
					value = unrestricted
				}
			}
			any_playable_ruler = {
				limit = {
					any_realm_province = {
						OR = {
							region = world_japan
							region = world_japan_islands
							region = custom_yezo
						}
					}
				}
				character_event = { id = japan.511 } # Actual event
			}
		}
		else = {
			any_player = {
				limit = {
					any_realm_province = {
						OR = {
							region = world_japan
							region = world_japan_islands
							region = custom_yezo
						}
					}
				}
				character_event = { id = japan.511 } # Actual event
			}
		}
	}
}

# Hear of a strange woman with strange hair - investigate?
character_event = {
	id = japan.511
	desc = EVTDESC_JAPAN_511
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_511 # I'll go speak to her
		
		character_event = { id = japan.512 days = 15 random = 15 } # The meeting
		
		ai_chance = {
			factor = 1
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_511 # Nah!
		
		ai_chance = {
			factor = 100
		}
	}
}

# Meeting the pink-haired woman
character_event = {
	id = japan.512
	desc = EVTDESC_JAPAN_512
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_512 # Let me know if you need anything!
		
		random_list = {
			50 = {
				character_event = { id = japan.513 days = 180 random = 180 } # She leaves
			}
			50 = {
				modifier = {
					factor = 0.1
					ai = yes
				}
				character_event = { id = japan.514 days = 180 random = 180 } # She wants help
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_512 # Well, I don't care...
	}
}

# Pink-haired woman leaves
character_event = {
	id = japan.513
	desc = EVTDESC_JAPAN_513
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_513 # Well, that's that...
	}
}

# Supplies requested
character_event = {
	id = japan.514
	desc = EVTDESC_JAPAN_514
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_514 # I can spare the money
		
		wealth = -1000
		
		random_list = {
			50 = {
				character_event = { id = japan.515 days = 180 random = 180 } # It didn't work!
			}
			50 = {
				modifier = {
					factor = 0.1
					ai = yes
				}
				character_event = { id = japan.516 days = 180 random = 180 } # It worked!
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = greedy
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_514 # I don't think so!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = charitable
				wealth = 1000
			}
		}
	}
}

# It didn't work out
character_event = {
	id = japan.515
	desc = EVTDESC_JAPAN_515
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_515 # Well, that's that...
	}
}

# It worked out - have a reward!
character_event = {
	id = japan.516
	desc = EVTDESC_JAPAN_516
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_516 # This will be useful!
		
		culture_techpoints = 1000
		economy_techpoints = 1000
		military_techpoints = 1000
	}
}



##### Scandalous Saio/Saiin

# Hidden on_five_year_pulse event to see if scandalous
character_event = {
	id = japan.517
	hide_window = yes
	
	is_triggered_only = yes
	
	religion = shinto
	only_rulers = yes
	only_women = yes
	min_age = 16
	
	trigger = {
		trait = imperial_priestess
		tier = baron
		OR = {
			government = japanese_monastic_feudal_government # Expected
			is_theocracy = yes # In case something has gone wrong
		}
		any_demesne_title = {
			OR = {
				title = b_ise
				title = b_kamo
			}
			holding_type = temple
		}
		NOT = {
			has_character_flag = scandalous_saio_saiin
		}
		is_virgin_trigger = no
		k_chrysanthemum_throne = {
			has_holder = yes
			holder_scope = {
				dynasty = ROOT
			}
		}
	}
	
	immediate = {
		random_list = {
			50 = {
				# High Intrigue lets you conceal it a bit
				modifier = {
					factor = 2
					intrigue = 40
				}
				modifier = {
					factor = 2
					intrigue = 36
				}
				modifier = {
					factor = 2
					intrigue = 32
				}
				modifier = {
					factor = 2
					intrigue = 28
				}
				modifier = {
					factor = 2
					intrigue = 24
				}
				modifier = {
					factor = 2
					intrigue = 20
				}
				modifier = {
					factor = 2
					intrigue = 16
				}
				modifier = {
					factor = 2
					intrigue = 12
				}
				
				# Certain traits makes it more likely people trust you're doing your job... or make you better at hiding things!
				modifier = {
					factor = 2
					trait = detached_priest
				}
				modifier = {
					factor = 5
					trait = martial_cleric
				}
				modifier = {
					factor = 10
					trait = scholarly_theologian
				}
				modifier = {
					factor = 20
					trait = mastermind_theologian
				}
				modifier = {
					factor = 10
					is_smart_trigger = yes
				}
				modifier = {
					factor = 5
					trait = schemer
				}
				modifier = {
					factor = 10
					trait = mystic
				}
				modifier = {
					factor = 10
					trait = scholar
				}
				modifier = {
					factor = 5
					trait = socializer
				}
				modifier = {
					factor = 10
					trait = theologian
				}
				modifier = {
					factor = 100
					trait = celibate
				}
				modifier = {
					factor = 10
					trait = chaste
				}
				modifier = {
					factor = 5
					trait = temperate
				}
				modifier = {
					factor = 2
					trait = charitable
				}
				modifier = {
					factor = 5
					trait = diligent
				}
				modifier = {
					factor = 5
					trait = patient
				}
				modifier = {
					factor = 2
					trait = kind
				}
				modifier = {
					factor = 10
					trait = content
				}
				modifier = {
					factor = 2
					trait = deceitful
				}
				modifier = {
					factor = 2
					trait = erudite
				}
				modifier = {
					factor = 5
					trait = gregarious
				}
				modifier = {
					factor = 2
					trait = honest # You're lying, but people don't think you're hiding stuff in general...
				}
				modifier = {
					factor = 5
					trait = just
				}
				modifier = {
					factor = 5
					trait = shy
				}
				modifier = {
					factor = 5
					trait = paranoid
				}
				modifier = {
					factor = 10
					trait = zealous
				}
				modifier = {
					factor = 5
					trait = indian_pilgrim
				}
				
				# The JMO helps
				modifier = {
					factor = 10
					society_member_of = monastic_order_japanese
				}
				
				# Not discovered
			}
			50 = {
				# Some things really are a problem
				modifier = {
					factor = 1000
					is_devil_worshiper_trigger = yes
				}
				modifier = {
					factor = 1000
					any_child_even_if_dead = {
						always = yes
					}
				}
				modifier = {
					factor = 10
					has_lover = yes
				}
				modifier = {
					factor = 10
					has_focus = focus_seduction
				}
				
				# Some traits make it less likely that people will trust you
				modifier = {
					factor = 10
					is_dumb_trigger = yes
				}
				modifier = {
					factor = 10
					trait = hedonist
				}
				modifier = {
					factor = 10
					trait = seductress
				}
				modifier = {
					factor = 10
					trait = lustful
				}
				modifier = {
					factor = 2
					trait = gluttonous
				}
				modifier = {
					factor = 2
					trait = greedy
				}
				modifier = {
					factor = 2
					trait = slothful
				}
				modifier = {
					factor = 2
					trait = wroth
				}
				modifier = {
					factor = 5
					trait = envious
				}
				modifier = {
					factor = 5
					trait = proud
				}
				modifier = {
					factor = 10
					trait = ambitious
				}
				modifier = {
					factor = 5
					trait = arbitrary
				}
				modifier = {
					factor = 10
					trait = cynical
				}
				modifier = {
					factor = 10
					trait = trusting
				}
				
				# Diseases
				modifier = {
					factor = 10
					trait = lovers_pox
				}
				modifier = {
					factor = 10
					trait = has_aztec_disease
				}
				modifier = {
					factor = 10
					trait = syphilitic
				}
				
				# Pregnant
				modifier = {
					factor = 2
					is_pregnant = yes # Stacks with others
				}
				modifier = {
					factor = 2.5
					trait = pregnant
				}
				modifier = {
					factor = 5
					trait = hard_pregnancy
				}
				modifier = {
					factor = 5
					trait = troubled_pregnancy
				}
				modifier = {
					factor = 10
					trait = pregnancy_finishing
				}
				
				# Modifiers
				modifier = {
					factor = 10
					has_character_modifier = incestuous_adulteress
				}
				modifier = {
					factor = 10
					has_character_modifier = adulteress
				}
				modifier = {
					factor = 10
					has_character_modifier = cradle_robber
				}
				modifier = {
					factor = 10
					has_character_modifier = adulterous_priest
				}
				
				# Discovered
				set_character_flag = scandalous_saio_saiin
				character_event = { id = japan.518 }
			}
		}
	}
}

# If scandalous Saio/Saiin, reveal it to us
character_event = {
	id = japan.518
	desc = EVTDESC_JAPAN_518
	picture = GFX_evt_scandal
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_518 # Um, oops?
		
		piety = -100
		
		k_chrysanthemum_throne = {
			holder_scope = {
				character_event = { id = japan.519 days = 7 random = 7 }
			}
		}
	}
}

# If scandalous Saio/Saiin is unplayable, inform the Tenno and make it possible to appoint a replacement
character_event = {
	id = japan.519
	desc = EVTDESC_JAPAN_519
	picture = GFX_evt_scandal
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		random_courtier = {
			limit = {
				dynasty = ROOT
				is_female = yes
				is_close_relative = ROOT
				is_adult = no
				is_married = no
				is_consort = no
				religion = shinto
				is_inaccessible_or_incapable_trigger = no
				is_landed = no
				is_ruler = no
				is_heir = no
				NOR = {
					trait = incapable
					trait = inbred
					trait = imbecile
				}
				NOR = {
					trait = maimed
					trait = infirm
					trait = wounded
					trait = severely_injured
					trait = one_eyed
					trait = one_handed
					trait = one_legged
					trait = disfigured
					trait = mangled
				}
				NOT = {
					prisoner = yes
				}
				NOR = {
					has_character_modifier = incestuous_adulterer
					has_character_modifier = incestuous_adulteress
					has_character_modifier = adulteress
					has_character_modifier = adulterer
					has_character_modifier = known_sodomite
					has_character_modifier = known_sodomite_pagan
					has_character_modifier = cradle_robber
					has_character_modifier = adulterous_priest
				}
				is_ill = no
			}
			preferred_limit = {
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			save_event_target_as = saio_saiin_replacement
		}
	}
	
	option = {
		trigger = {
			event_target:saio_saiin_replacement = {
				always = yes
			}
		}
		name = EVTOPTA_JAPAN_519 # Replace her at once!
		
		piety = -100

		event_target:saio_saiin_replacement = {
			if = {
				limit = {
					is_betrothed = yes
				}
				break_betrothal = yes
			}
			add_trait = japanese_monastic_trait
		}
		# Give the title to the new holder; if the same person holds b_ise and b_kamo, give away Kamo
		if = {
			limit = {
				FROM = {
					has_landed_title = b_kamo
					b_kamo = {
						holding_type = temple
					}
				}
			}
			b_kamo = {
				grant_title_no_opinion = event_target:saio_saiin_replacement
			}
			event_target:saio_saiin_replacement = {
				if = {
					limit = {
						NOT = {
							has_character_flag = i_am_saiin
						}
					}
					set_character_flag = i_am_saiin
					set_character_flag = ai_flag_refuse_marriage
					add_trait = imperial_priestess
					piety = 100
				}
			}
		}
		if = {
			limit = {
				FROM = {
					has_landed_title = b_ise
					b_ise = {
						holding_type = temple
					}
				}
			}
			b_ise = {
				grant_title_no_opinion = event_target:saio_saiin_replacement
			}
			event_target:saio_saiin_replacement = {
				if = {
					limit = {
						NOT = {
							has_character_flag = i_am_saiin
						}
					}
					set_character_flag = i_am_saio
					set_character_flag = ai_flag_refuse_marriage
					add_trait = imperial_priestess
					piety = 100
				}
			}
		}
		# Ensure the proper liege is set
		event_target:saio_saiin_replacement = {
			set_defacto_liege = ROOT
		}
		
		# Move FROM to our court
		FROM = {
			remove_trait = japanese_monastic_trait
			remove_trait = imperial_priestess
			clr_character_flag = ai_flag_refuse_marriage
			move_character = ROOT
			piety = -100
		}
		
		ai_chance = {
			factor = 100
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_519 # Recall her at once!
		
		piety = -100
		prestige = -100
		
		if = {
			limit = {
				FROM = {
					has_landed_title = b_kamo
					b_kamo = {
						holding_type = temple
					}
				}
			}
			b_kamo = {
				grant_title_no_opinion = ROOT
			}
		}
		if = {
			limit = {
				FROM = {
					has_landed_title = b_ise
					b_ise = {
						holding_type = temple
					}
				}
			}
			b_ise = {
				grant_title_no_opinion = ROOT
			}
		}
		
		# Move FROM to our court
		FROM = {
			remove_trait = japanese_monastic_trait
			remove_trait = imperial_priestess
			move_character = ROOT
			piety = -100
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				event_target:saio_saiin_replacement = {
					always = yes
				}
			}
		}
	}
	
	option = {
		name = EVTOPTC_JAPAN_519 # Leave her be!
		
		piety = -200
		prestige = -200
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOR = {
					any_lover = {
						character = FROM
					}
					any_friend = {
						character = FROM
					}
					AND = {
						OR = {
							trait = arbitrary
							trait = cynical
						}
						NOR = {
							trait = just
							trait = zealous
						}
						NOT = {
							any_rival = {
								character = FROM
							}
						}
					}
				}
			}
			modifier = {
				factor = 0.01
				trait = zealous
			}
		}
	}
}



##### Foreigners on your Shores

### Arrival + event selection

# Foreigners arrive
character_event = {
	id = japan.520
	desc = EVTDESC_JAPAN_520
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	only_playable = yes
	min_age = 16
	
	trigger = {
		is_inaccessible_or_incapable_trigger = no
		# You're "Japanese enough"
		OR = {
			religion = shinto
			AND = {
				culture_group = japonic
				religion = buddhist
			}
		}
		
		# You have a port in Japan
		any_realm_province = {
			port = yes
			OR = {
				region = world_japan
				region = world_japan_islands
				region = custom_yezo
			}
		}
		
		# There's a foreign province the foreigner can come from
		any_independent_ruler = {
			NOR = {
				character = ROOT
				any_realm_lord = {
					character = ROOT
				}
			}
			any_realm_province = {
				port = yes
				can_naval_path_to = c_ise # Doesn't matter which province we pick...
				NOR = { # More interesting to use this instead of the normal check
					religion = shinto
					culture_group = japonic
					religion = buddhist
				}
				NOR = {
					region = world_japan
					region = world_japan_islands
					region = custom_yezo
				}
			}
		}
	}
	
	immediate = {
		# Select the province where the foreigner arrived
		random_realm_province = {
			limit = {
				port = yes
				OR = {
					region = world_japan
					region = world_japan_islands
					region = custom_yezo
				}
			}
			save_event_target_as = foreigner_landfall_province
		}
		
		# Select the province the foreigner came from
		random_independent_ruler = {
			limit = {
				NOR = {
					character = ROOT
					any_realm_lord = {
						character = ROOT
					}
				}
				any_realm_province = {
					port = yes
					can_naval_path_to = c_ise # Doesn't matter which province we pick...
					NOR = { # More interesting to use this instead of the normal check
						religion = shinto
						culture_group = japonic
						religion = buddhist
					}
					NOR = {
						region = world_japan
						region = world_japan_islands
						region = custom_yezo
					}
				}
			}
			random_realm_province = {
				limit = {
					port = yes
					can_naval_path_to = c_ise # Doesn't matter which province we pick...
					NOR = { # More interesting to use this instead of the normal check
						religion = shinto
						culture_group = japonic
						religion = buddhist
					}
					NOR = {
						region = world_japan
						region = world_japan_islands
						region = custom_yezo
					}
				}
				# Some preferences regarding religion/culture
				preferred_limit = {
					OR = {
						religion_group = christian
						religion_group = jewish_group
						religion_group = muslim
						religion = hindu
					}
					NOR = {
						culture_group = paleosiberian
						culture_group = altaic
						culture_group = chinese_group
						culture_group = koreanic
					}
				}
				preferred_limit = {
					OR = {
						religion_group = christian
						religion_group = jewish_group
						religion_group = muslim
						religion = hindu
					}
				}
				preferred_limit = {
					NOR = {
						culture_group = paleosiberian
						culture_group = altaic
						culture_group = chinese_group
						culture_group = koreanic
					}
				}
				save_event_target_as = foreigner_origin_province
			}
		}
		
		# Create the foreigner
		random_list = {
			50 = {
				create_character = {
					age = 25
					female = no
					dynasty = random
					culture = event_target:foreigner_origin_province
					religion = event_target:foreigner_origin_province
					attributes = {
						diplomacy = 4
						martial = 4
						stewardship = 4
						intrigue = 4
						learning = 4
					}
					random_traits = no
				}
			}
			50 = {
				create_character = {
					age = 25
					female = yes
					dynasty = random
					culture = event_target:foreigner_origin_province
					religion = event_target:foreigner_origin_province
					attributes = {
						diplomacy = 4
						martial = 4
						stewardship = 4
						intrigue = 4
						learning = 4
					}
					random_traits = no
				}
			}
		}
		new_character = {
			save_event_target_as = foreigner_in_japan
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = ai_flag_refuse_conversion
			set_character_flag = no_court_invites
			if = {
				limit = {
					religion = hindu
				}
				add_trait = kshatriya
			}
			
			# Randomize the actual foreigner we get
			random_list = {
				1 = {
					set_character_flag = foreigner_is_warrior
					# Stats
					change_diplomacy = 1
					change_martial = 4
					change_stewardship = 1
					change_intrigue = -3
					change_learning = -3
					
					# Education
					random_list = {
						40 = {
							add_trait = brilliant_strategist
						}
						30 = {
							add_trait = skilled_tactician
						}
						20 = {
							add_trait = tough_soldier
						}
						10 = {
							add_trait = misguided_warrior
						}
					}
					
					# Some guaranteed traits
					add_trait = brave
					add_trait = strong
					add_trait = ambitious
					add_random_commander_trait_effect = yes
					add_one_duel_experience_modifier = yes
					random_list = {
						1 = {
							add_trait = duelist
						}
						1 = {
							add_trait = strategist
						}
					}
					
					# And some possible random extras
					random_list = {
						1 = {
							add_trait = lefthanded
						}
						1 = {
							add_trait = ugly
						}
						1 = {
							add_trait = giant
						}
						1 = {
							add_trait = poet
						}
						1 = {
							add_trait = shrewd
						}
						1 = {
							add_trait = wroth
						}
						1 = {
							add_trait = patient
						}
						1 = {
							add_trait = chaste
						}
						1 = {
							add_trait = envious
						}
						1 = {
							add_trait = proud
						}
						1 = {
							add_trait = arbitrary
						}
						1 = {
							add_trait = cruel
						}
						1 = {
							add_trait = deceitful
						}
						1 = {
							add_trait = just
						}
						1 = {
							add_trait = zealous
						}
						1 = {
							add_trait = wounded
						}
						1 = {
							add_maimed_trait_effect = yes
						}
						1 = {
							add_random_commander_trait_effect = yes
						}
						1 = {
							add_one_duel_experience_modifier = yes
						}
					}
				}
				1 = {
					set_character_flag = foreigner_is_scholar
					# Stats
					change_diplomacy = 1
					change_martial = 2
					change_stewardship = 1
					change_intrigue = -3
					change_learning = -1
					
					# Education
					random_list = {
						40 = {
							add_trait = mastermind_theologian
						}
						30 = {
							add_trait = scholarly_theologian
						}
						20 = {
							add_trait = martial_cleric
						}
						10 = {
							add_trait = detached_priest
						}
					}
					
					# Some guaranteed traits
					add_trait = diligent
					add_trait = patient
					add_trait = shy
					random_list = {
						1 = {
							add_trait = scholar
						}
						1 = {
							add_trait = mystic
						}
					}
					
					# And some possible random extras
					random_list = {
						1 = {
							add_trait = weak
						}
						1 = {
							add_trait = fair
						}
						1 = {
							add_trait = poet
						}
						1 = {
							add_trait = celibate
						}
						1 = {
							add_trait = chaste
						}
						1 = {
							add_trait = humble
						}
						1 = {
							add_trait = proud
						}
						1 = {
							add_trait = envious
						}
						1 = {
							add_trait = erudite
						}
						1 = {
							add_trait = craven
						}
						1 = {
							add_trait = trusting
						}
					}
				}
				1 = {
					set_character_flag = foreigner_is_zealot
					# Stats
					change_diplomacy = -1
					change_martial = 2
					change_stewardship = -2
					change_intrigue = -2
					change_learning = 3
					
					# Education
					random_list = {
						40 = {
							add_trait = mastermind_theologian
						}
						30 = {
							add_trait = scholarly_theologian
						}
						20 = {
							add_trait = martial_cleric
						}
						10 = {
							add_trait = detached_priest
						}
					}
					
					# Some guaranteed traits
					add_trait = zealous
					add_trait = erudite
					add_trait = ambitious
					random_list = {
						1 = {
							add_trait = scholar
						}
						1 = {
							add_trait = theologian
						}
					}
					
					# And some possible random extras
					random_list = {
						1 = {
							add_trait = genius
						}
						1 = {
							add_trait = weak
						}
						1 = {
							add_trait = groomed
						}
						1 = {
							add_trait = celibate
						}
						1 = {
							add_trait = poet
						}
						1 = {
							add_trait = chaste
						}
						1 = {
							add_trait = temperate
						}
						1 = {
							add_trait = charitable
						}
						1 = {
							add_trait = diligent
						}
						1 = {
							add_trait = patient
						}
						1 = {
							add_trait = kind
						}
						1 = {
							add_trait = humble
						}
						1 = {
							add_trait = lustful
						}
						1 = {
							add_trait = greedy
						}
						1 = {
							add_trait = wroth
						}
						1 = {
							add_trait = envious
						}
						1 = {
							add_trait = proud
						}
						1 = {
							add_trait = arbitrary
						}
						1 = {
							add_trait = brave
						}
						1 = {
							add_trait = cruel
						}
						1 = {
							add_trait = deceitful
						}
						1 = {
							add_trait = gregarious
						}
						1 = {
							add_trait = honest
						}
						1 = {
							add_trait = just
						}
						1 = {
							add_trait = paranoid
						}
						1 = {
							add_trait = stubborn
						}
						1 = {
							add_random_commander_trait_effect = yes
						}
					}
				}
				1 = {
					set_character_flag = foreigner_is_spy
					# Stats
					change_diplomacy = 1
					change_martial = -1
					change_stewardship = -3
					change_intrigue = 4
					change_learning = -1
					
					# Education
					random_list = {
						40 = {
							add_trait = elusive_shadow
						}
						30 = {
							add_trait = intricate_webweaver
						}
						20 = {
							add_trait = flamboyant_schemer
						}
						10 = {
							add_trait = amateurish_plotter
						}
					}
					
					# Some guaranteed traits
					add_trait = deceitful
					add_trait = paranoid
					add_trait = quick
					random_list = {
						1 = {
							add_trait = schemer
						}
						1 = {
							add_trait = socializer
						}
					}
					
					# And some possible random extras
					random_list = {
						1 = {
							add_trait = lunatic
						}
						1 = {
							add_trait = fair
						}
						1 = {
							add_trait = lefthanded
						}
						1 = {
							add_trait = patient
						}
						1 = {
							add_trait = diligent
						}
						1 = {
							remove_trait = quick
							add_trait = genius
						}
						1 = {
							add_trait = greedy
						}
						1 = {
							add_trait = envious
						}
						1 = {
							add_trait = ambitious
						}
						1 = {
							add_trait = brave
						}
						1 = {
							add_trait = craven
						}
						1 = {
							add_trait = content
						}
						1 = {
							add_trait = cynical
						}
						1 = {
							add_trait = gregarious
						}
						1 = {
							add_trait = shy
						}
					}
				}
				1 = {
					set_character_flag = foreigner_is_thief
					# Stats
					change_diplomacy = 2
					change_martial = -3
					change_stewardship = 1
					change_intrigue = 3
					change_learning = -3
					
					# Education
					random_list = {
						40 = {
							add_trait = elusive_shadow
						}
						30 = {
							add_trait = intricate_webweaver
						}
						20 = {
							add_trait = flamboyant_schemer
						}
						10 = {
							add_trait = amateurish_plotter
						}
					}
					
					# Some guaranteed traits
					add_trait = ambitious
					add_trait = greedy
					add_trait = craven
					random_list = {
						1 = {
							add_trait = schemer
						}
						1 = {
							add_trait = architect
						}
					}
					
					# And some possible random extras
					random_list = {
						1 = {
							add_trait = genius
						}
						1 = {
							add_trait = quick
						}
						1 = {
							add_trait = diligent
						}
						1 = {
							add_trait = patient
						}
						1 = {
							add_trait = envious
						}
						1 = {
							add_trait = arbitrary
						}
						1 = {
							add_trait = cynical
						}
						1 = {
							add_trait = paranoid
						}
						1 = {
							add_trait = shy
						}
					}
				}
				1 = {
					set_character_flag = foreigner_is_seducer
					# Stats
					change_diplomacy = 3
					change_martial = -2
					change_stewardship = -2
					change_intrigue = 4
					change_learning = -3
					
					# Education
					random_list = {
						40 = {
							add_trait = elusive_shadow
						}
						30 = {
							add_trait = intricate_webweaver
						}
						20 = {
							add_trait = flamboyant_schemer
						}
						10 = {
							add_trait = amateurish_plotter
						}
						40 = {
							add_trait = grey_eminence
						}
						30 = {
							add_trait = charismatic_negotiator
						}
						20 = {
							add_trait = underhanded_rogue
						}
						10 = {
							add_trait = naive_appeaser
						}
					}
					
					# Some guaranteed traits
					add_trait = lustful
					add_trait = deceitful
					add_trait = fair
					random_list = {
						1 = {
							add_trait = hedonist
						}
						1 = {
							modifier = {
								factor = 0
								is_female = yes
							}
							add_trait = seducer
						}
						1 = {
							modifier = {
								factor = 0
								is_female = no
							}
							add_trait = seductress
						}
						1 = {
							add_trait = socializer
						}
					}
					
					# And some possible random extras
					random_list = {
						1 = {
							add_trait = genius
						}
						1 = {
							add_trait = quick
						}
						1 = {
							add_trait = strong
						}
						1 = {
							add_trait = poet
						}
						1 = {
							add_trait = patient
						}
						1 = {
							add_trait = envious
						}
						1 = {
							add_trait = proud
						}
						1 = {
							add_trait = ambitious
						}
						1 = {
							add_trait = brave
						}
						1 = {
							add_trait = craven
						}
						1 = {
							add_trait = cynical
						}
						1 = {
							add_trait = gregarious
						}
						1 = {
							add_trait = paranoid
						}
					}
				}
				1 = {
					set_character_flag = foreigner_is_merchant
					# Stats
					change_diplomacy = 2
					change_martial = -2
					change_stewardship = 4
					change_intrigue = -2
					change_learning = -2
					
					# Education
					random_list = {
						40 = {
							add_trait = midas_touched
						}
						30 = {
							add_trait = fortune_builder
						}
						20 = {
							add_trait = thrifty_clerk
						}
						10 = {
							add_trait = indulgent_wastrel
						}
						40 = {
							add_trait = grey_eminence
						}
						30 = {
							add_trait = charismatic_negotiator
						}
						20 = {
							add_trait = underhanded_rogue
						}
						10 = {
							add_trait = naive_appeaser
						}
					}
					
					# Some guaranteed traits
					add_trait = greedy
					add_trait = gregarious
					add_trait = cynical
					random_list = {
						1 = {
							add_trait = socializer
						}
						1 = {
							add_trait = administrator
						}
					}
					
					# And some possible random extras
					random_list = {
						1 = {
							add_trait = drunkard
						}
						1 = {
							add_trait = quick
						}
						1 = {
							add_trait = genius
						}
						1 = {
							add_trait = ugly
						}
						1 = {
							add_trait = is_fat
						}
						1 = {
							add_trait = diligent
						}
						1 = {
							add_trait = temperate
						}
						1 = {
							add_trait = humble
						}
						1 = {
							add_trait = gluttonous
						}
						1 = {
							add_trait = slothful
						}
						1 = {
							add_trait = envious
						}
						1 = {
							add_trait = proud
						}
						1 = {
							add_trait = ambitious
						}
						1 = {
							add_trait = arbitrary
						}
						1 = {
							add_trait = brave
						}
						1 = {
							add_trait = content
						}
						1 = {
							add_trait = craven
						}
						1 = {
							add_trait = deceitful
						}
						1 = {
							add_trait = honest
						}
						1 = {
							add_trait = just
						}
						1 = {
							add_trait = stubborn
						}
					}
				}
				1 = {
					set_character_flag = foreigner_is_troublemaker
					# Stats
					change_diplomacy = -2
					change_martial = 3
					change_stewardship = -2
					change_intrigue = 3
					change_learning = -2
					
					# Education
					random_list = {
						40 = {
							add_trait = skilled_tactician
						}
						30 = {
							add_trait = intricate_webweaver
						}
						20 = {
							add_trait = tough_soldier
						}
						10 = {
							add_trait = flamboyant_schemer
						}
					}
					
					# Some guaranteed traits
					add_trait = arbitrary
					add_trait = wroth
					add_trait = envious
					random_list = {
						1 = {
							add_trait = schemer
						}
						1 = {
							add_trait = mystic
						}
						1 = {
							add_trait = duelist
						}
						1 = {
							add_trait = hedonist
						}
					}
					
					# And some possible random extras
					random_list = {
						1 = {
							add_trait = shrewd
						}
						1 = {
							add_trait = lunatic
						}
						1 = {
							add_trait = lustful
						}
						1 = {
							add_trait = greedy
						}
						1 = {
							add_trait = proud
						}
						1 = {
							add_trait = ambitious
						}
						1 = {
							add_trait = brave
						}
						1 = {
							add_trait = cruel
						}
						1 = {
							add_trait = cynical
						}
						1 = {
							add_trait = deceitful
						}
						1 = {
							add_trait = gregarious
						}
						1 = {
							add_trait = paranoid
						}
						1 = {
							add_trait = zealous
						}
					}
				}
				1 = {
					set_character_flag = foreigner_is_fool
					# Stats
					change_diplomacy = -2
					change_martial = -2
					change_stewardship = -2
					change_intrigue = -2
					change_learning = -2
					
					# Education
					random_list = {
						20 = {
							add_trait = naive_appeaser
						}
						20 = {
							add_trait = misguided_warrior
						}
						20 = {
							add_trait = indulgent_wastrel
						}
						20 = {
							add_trait = amateurish_plotter
						}
						20 = {
							add_trait = detached_priest
						}
					}
					
					# Some guaranteed traits
					add_trait = slothful
					add_trait = content
					add_trait = honest
					
					# And some possible random extras
					random_list = {
						1 = {
							add_trait = drunkard
						}
						1 = {
							add_trait = slow
						}
						1 = {
							add_trait = imbecile
						}
						1 = {
							add_trait = uncouth
						}
						1 = {
							add_trait = temperate
						}
						1 = {
							add_trait = kind
						}
						1 = {
							add_trait = humble
						}
						1 = {
							add_trait = gluttonous
						}
						1 = {
							add_trait = craven
						}
						1 = {
							add_trait = just
						}
						1 = {
							add_trait = shy
						}
						1 = {
							add_trait = trusting
						}
					}
				}
				1 = {
					set_character_flag = foreigner_is_crazy
					# Stats
					change_diplomacy = -1
					change_martial = -1
					change_stewardship = -1
					change_intrigue = -1
					change_learning = -1
					
					# Education
					random_list = {
						20 = {
							add_trait = grey_eminence
						}
						20 = {
							add_trait = brilliant_strategist
						}
						20 = {
							add_trait = midas_touched
						}
						20 = {
							add_trait = elusive_shadow
						}
						20 = {
							add_trait = mastermind_theologian
						}
					}
					
					# Some guaranteed traits
					random_list = {
						1 = {
							add_trait = lunatic
						}
						1 = {
							add_trait = possessed
						}
						1 = {
							add_trait = lunatic
							add_trait = possessed
						}
					}
					add_trait = arbitrary
					random_list = {
						1 = {
							add_trait = impaler
						}
						1 = {
							add_trait = mystic
						}
					}
					
					# And some possible random extras
					random_list = {
						1 = {
							add_trait = is_malnourished
						}
						1 = {
							add_trait = genius
						}
						1 = {
							add_trait = quick
						}
						1 = {
							add_trait = stutter
						}
						1 = {
							add_trait = lisp
						}
						1 = {
							add_trait = weak
						}
						1 = {
							add_trait = lefthanded
						}
						1 = {
							add_trait = poet
						}
						1 = {
							add_trait = diligent
						}
						1 = {
							add_trait = patient
						}
						1 = {
							add_trait = groomed
						}
						1 = {
							add_trait = humble
						}
						1 = {
							add_trait = lustful
						}
						1 = {
							add_trait = greedy
						}
						1 = {
							add_trait = wroth
						}
						1 = {
							add_trait = envious
						}
						1 = {
							add_trait = proud
						}
						1 = {
							add_trait = ambitious
						}
						1 = {
							add_trait = brave
						}
						1 = {
							add_trait = craven
						}
						1 = {
							add_trait = cruel
						}
						1 = {
							add_trait = cynical
						}
						1 = {
							add_trait = deceitful
						}
						1 = {
							add_trait = paranoid
						}
						1 = {
							add_trait = shy
						}
						1 = {
							add_trait = stubborn
						}
						1 = {
							add_trait = zealous
						}
					}
				}
			}
			
			# Small chance of homosexual foreigner
			random = {
				chance = 10
				add_trait = homosexual
			}
			
			# Randomize age a bit
			random_list = {
				1 = {
					add_age = 10
				}
				1 = {
					add_age = 9
				}
				1 = {
					add_age = 8
				}
				1 = {
					add_age = 7
				}
				1 = {
					add_age = 6
				}
				1 = {
					add_age = 5
				}
				1 = {
					add_age = 4
				}
				1 = {
					add_age = 3
				}
				1 = {
					add_age = 2
				}
				1 = {
					add_age = 1
				}
				1 = {
					# No change
				}
				1 = {
					add_age = -1
				}
				1 = {
					add_age = -2
				}
				1 = {
					add_age = -3
				}
				1 = {
					add_age = -4
				}
				1 = {
					add_age = -5
				}
				1 = {
					add_age = -6
				}
				1 = {
					add_age = -7
				}
				1 = {
					add_age = -8
				}
				1 = {
					add_age = -9
				}
			}
			
			# Small chance of PCS boost
			random_list = {
				10 = {
					modifier = {
						factor = 0.1
						has_character_flag = foreigner_is_warrior
					}
					# Nothing
				}
				1 = {
					add_one_duel_experience_modifier = yes
				}
				1 = {
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
				}
				1 = {
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
				}
				1 = {
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
				}
				1 = {
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_520 # Kill the foreigner!
		
		event_target:foreigner_in_japan = {
			death = {
				death_reason = death_execution
				killer = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = kind
			}
			modifier = {
				factor = 0.1
				trait = humble
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_520 # Accept the 
		
		save_event_target_as = foreigners_host
		event_target:foreigner_in_japan = {
			character_event = { id = japan.521 days = 180 random = 180 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = cruel
			}
			modifier = {
				factor = 0.1
				trait = proud
			}
		}
	}
}

# Event selection
character_event = {
	id = japan.521
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		ai = yes
		is_ruler = no
		event_target:foreigners_host = {
			is_alive = yes
		}
	}
	
	immediate = {
		if = {
			limit = {
				is_inaccessible_or_incapable_trigger = no
				event_target:foreigners_host = {
					is_inaccessible_or_incapable_trigger = no
					is_landed = yes
				}
			}
			random_list = {
				1 = {
					modifier = {
						factor = 0
						num_of_friends = 5
					}
					modifier = {
						factor = 10
						has_education_diplomacy_trigger = yes
					}
					# Foreigner makes a friend
					character_event = { id = japan.522 }
				}
				1 = {
					modifier = {
						factor = 0
						num_of_rivals = 5
					}
					modifier = {
						factor = 10
						OR = {
							has_character_flag = foreigner_is_warrior
							has_character_flag = foreigner_is_zealot
							has_character_flag = foreigner_is_troublemaker
							has_character_flag = foreigner_is_fool
						}
					}
					# Foreigner makes a rival
					character_event = { id = japan.525 }
				}
				1 = {
					modifier = {
						factor = 0
						NOT = {
							has_dlc = "Holy Fury"
						}
					}
					modifier = {
						factor = 0
						event_target:foreigners_host = {
							NOR = {
								religion = shinto
								AND = {
									culture_group = japonic
									religion = buddhist
								}
								religion = ryukyuan_pagan
								religion = ryukyuan_pagan_reformed
							}
						}
					}
					modifier = {
						factor = 0
						society_member_of = warriors_of_the_rising_sun
					}
					modifier = {
						factor = 0.5
						NOT = {
							martial = 15
						}
					}
					modifier = {
						factor = 0
						NOT = {
							martial = 10
						}
					}
					modifier = {
						factor = 0
						NOT = {
							combat_rating = 20
						}
					}
					modifier = {
						factor = 0.1
						NOT = {
							combat_rating = 40
						}
					}
					modifier = {
						factor = 10
						has_character_flag = foreigner_is_warrior
					}
					modifier = {
						factor = 5
						trait = brave
					}
					modifier = {
						factor = 5
						has_education_martial_trigger = yes
					}
					modifier = {
						factor = 0.5
						is_female = yes
					}
					modifier = {
						factor = 0
						trait = craven
					}
					# Foreigner wants to join the WotRS
					event_target:foreigners_host = {
						character_event = { id = japan.528 }
					}
				}
				1 = {
					modifier = {
						factor = 0.1
						trait = craven
					}
					modifier = {
						factor = 0.1
						NOT = {
							has_character_flag = foreigner_is_warrior
						}
					}
					modifier = {
						factor = 0.1
						has_education_martial_trigger = no
					}
					modifier = {
						factor = 0
						NOT = {
							combat_rating = 20
						}
					}
					# Foreigner fights bandits
					character_event = { id = japan.532 }
				}
				1 = {
					modifier = {
						factor = 10
						OR = {
							has_character_flag = foreigner_is_warrior
							has_character_flag = foreigner_is_troublemaker
							has_character_flag = foreigner_is_fool
							has_character_flag = foreigner_is_crazy
						}
					}
					modifier = {
						factor = 0
						trait = kind
					}
					modifier = {
						factor = 0.1
						trait = craven
					}
					modifier = {
						factor = 0.1
						NOT = {
							combat_rating = 20
						}
					}
					modifier = {
						factor = 0.5
						has_education_martial_trigger = no
					}
					# Foreigner in bar brawl
					character_event = { id = japan.542 }
				}
				1 = {
					modifier = {
						factor = 10
						has_character_flag = foreigner_is_warrior
					}
					modifier = {
						factor = 0
						NOT = {
							combat_rating = 20
						}
					}
					modifier = {
						factor = 0.1
						NOT = {
							combat_rating = 40
						}
					}
					modifier = {
						factor = 0.1
						has_education_martial_trigger = no
					}
					# Foreigner teaches someone fighting tricks
					character_event = { id = japan.547 }
				}
				1 = {
					modifier = {
						factor = 10
						OR = {
							has_character_flag = foreigner_is_warrior
							has_character_flag = foreigner_is_zealot
							has_character_flag = foreigner_is_troublemaker
							has_character_flag = foreigner_is_crazy
						}
					}
					modifier = {
						factor = 10
						trait = proud
					}
					modifier = {
						factor = 0.1
						trait = humble
					}
					modifier = {
						factor = 0.1
						trait = gregarious
					}
					modifier = {
						factor = 0.1
						trait = kind
					}
					# Foreigner insults peasants
					character_event = { id = japan.550 }
				}
				1 = {
					modifier = {
						factor = 0.1
						has_education_learning_trigger = no
					}
					modifier = {
						factor = 10
						trait = scholar
					}
					modifier = {
						factor = 0
						NOT = {
							learning = 15
						}
					}
					# Foreigner shares insights
					character_event = { id = japan.552 }
				}
				1 = {
					modifier = {
						factor = 0.1
						has_education_learning_trigger = no
					}
					modifier = {
						factor = 10
						trait = scholar
					}
					modifier = {
						factor = 10
						has_character_flag = foreigner_is_scholar
					}
					# Foreigner teaches someone something
					character_event = { id = japan.553 }
				}
				1 = {
					modifier = {
						factor = 0.1
						has_character_flag = foreigner_wrote_book
					}
					modifier = {
						factor = 0.1
						has_education_learning_trigger = no
					}
					modifier = {
						factor = 10
						trait = scholar
					}
					modifier = {
						factor = 0.1
						NOT = {
							learning = 15
						}
					}
					modifier = {
						factor = 10
						has_character_flag = foreigner_is_scholar
					}
					# Foreigner writes book
					character_event = { id = japan.556 }
				}
				1 = {
					modifier = {
						factor = 0
						has_education_learning_trigger = no
					}
					modifier = {
						factor = 0
						NOT = {
							trait = zealous
						}
					}
					modifier = {
						factor = 0
						NOT = {
							learning = 10
						}
					}
					modifier = {
						factor = 0.25
						NOT = {
							diplomacy = 10
						}
					}
					modifier = {
						factor = 0.1
						NOR = {
							has_character_flag = foreigner_is_zealot
							has_character_flag = foreigner_is_troublemaker
							has_character_flag = foreigner_is_crazy
						}
					}
					modifier = {
						factor = 0
						NOT = {
							event_target:foreigners_host = {
								any_courtier = {
									is_landed = no
									is_inaccessible_or_incapable_trigger = no
									NOR = {
										religion = ROOT
										has_character_flag = ai_flag_refuse_conversion
										trait = zealous
									}
								}
							}
						}
					}
					# Foreigner converts courtier
					character_event = { id = japan.560 }
				}
				1 = {
					modifier = {
						factor = 0
						has_education_learning_trigger = no
					}
					modifier = {
						factor = 0
						NOT = {
							trait = zealous
						}
					}
					modifier = {
						factor = 0
						NOT = {
							learning = 15
						}
					}
					modifier = {
						factor = 0.1
						NOR = {
							has_character_flag = foreigner_is_zealot
							has_character_flag = foreigner_is_troublemaker
							has_character_flag = foreigner_is_crazy
						}
					}
					modifier = {
						factor = 0
						NOT = {
							event_target:foreigners_host = {
								any_realm_province = {
									NOT = {
										religion = ROOT
									}
								}
							}
						}
					}
					# Foreigner converts courtier
					event_target:foreigners_host = {
						character_event = { id = japan.562 }
					}
				}
				1 = {
					modifier = {
						factor = 0
						NOT = {
							intrigue = 15
						}
					}
					modifier = {
						factor = 0.1
						has_education_intrigue_trigger = no
					}
					modifier = {
						factor = 0.1
						NOT = {
							has_character_flag = foreigner_is_spy
						}
					}
					modifier = {
						factor = 0
						NOT = {
							event_target:foreigners_host = {
								any_courtier_or_vassal = {
									is_inaccessible_or_incapable_trigger = no
									NOR = {
										any_friend = {
											character = ROOT
										}
										any_lover = {
											character = ROOT
										}
									}
									has_plot = yes
									NOT = {
										plot_is_known_by = event_target:foreigners_host
									}
								}
							}
						}
					}
					# Foreigner detects plot
					character_event = { id = japan.563 }
				}
				1 = {
					modifier = {
						factor = 0.1
						has_education_intrigue_trigger = no
					}
					modifier = {
						factor = 0
						trait = honest
					}
					modifier = {
						factor = 0
						trait = just
					}
					modifier = {
						factor = 10
						trait = greedy
					}
					modifier = {
						factor = 0.1
						NOT = {
							intrigue = 10
						}
					}
					modifier = {
						factor = 0
						NOR = {
							has_character_flag = foreigner_is_thief
							has_character_flag = foreigner_is_troublemaker
						}
					}
					# Foreigner steals from courtier
					character_event = { id = japan.566 }
				}
				1 = {
					modifier = {
						factor = 0.1
						has_education_intrigue_trigger = no
					}
					modifier = {
						factor = 0
						trait = honest
					}
					modifier = {
						factor = 0
						trait = just
					}
					modifier = {
						factor = 10
						trait = greedy
					}
					modifier = {
						factor = 0.1
						NOT = {
							intrigue = 10
						}
					}
					modifier = {
						factor = 0
						NOR = {
							has_character_flag = foreigner_is_thief
							has_character_flag = foreigner_is_troublemaker
						}
					}
					# Foreigner steals from vassal
					character_event = { id = japan.570 }
				}
				1 = {
					modifier = {
						factor = 0.1
						NOR = {
							has_education_intrigue_trigger = yes
							has_education_diplomacy_trigger = yes
						}
					}
					modifier = {
						factor = 0
						trait = celibate
					}
					modifier = {
						factor = 0
						trait = chaste
					}
					modifier = {
						factor = 0.1
						NOR = {
							intrigue = 10
							diplomacy = 10
						}
					}
					modifier = {
						factor = 5
						trait = lustful
					}
					modifier = {
						factor = 5
						OR = {
							trait = seducer
							trait = seductress
						}
					}
					modifier = {
						factor = 0
						NOR = {
							has_character_flag = foreigner_is_seducer
							has_character_flag = foreigner_is_troublemaker
						}
					}
					modifier = {
						factor = 0
						NOT = {
							event_target:foreigners_host = {
								any_courtier = {
									is_landed = no
									is_inaccessible_or_incapable_trigger = no
									is_adult = yes
									NOR = {
										any_rival = {
											character = ROOT
										}
										any_lover = {
											character = ROOT
										}
									}
									OR = {
										AND = {
											is_female = no
											NOT = {
												trait = homosexual
											}
											ROOT = {
												is_female = yes
												NOT = {
													trait = homosexual
												}
											}
										}
										AND = {
											is_female = yes
											NOT = {
												trait = homosexual
											}
											ROOT = {
												is_female = no
												NOT = {
													trait = homosexual
												}
											}
										}
										AND = {
											is_female = no
											trait = homosexual
											ROOT = {
												is_female = no
												trait = homosexual
											}
										}
										AND = {
											is_female = yes
											trait = homosexual
											ROOT = {
												is_female = yes
												trait = homosexual
											}
										}
									}
								}
							}
						}
					}
					# Foreigner attempts seduction of courtier
					character_event = { id = japan.576 }
				}
				1 = {
					modifier = {
						factor = 0.1
						NOR = {
							has_education_intrigue_trigger = yes
							has_education_diplomacy_trigger = yes
						}
					}
					modifier = {
						factor = 0
						trait = celibate
					}
					modifier = {
						factor = 0
						trait = chaste
					}
					modifier = {
						factor = 0.1
						NOR = {
							intrigue = 10
							diplomacy = 10
						}
					}
					modifier = {
						factor = 5
						trait = lustful
					}
					modifier = {
						factor = 5
						OR = {
							trait = seducer
							trait = seductress
						}
					}
					modifier = {
						factor = 0
						NOR = {
							has_character_flag = foreigner_is_seducer
							has_character_flag = foreigner_is_troublemaker
						}
					}
					modifier = {
						factor = 0
						NOR = {
							event_target:foreigners_host = {
								any_realm_lord = {
									is_inaccessible_or_incapable_trigger = no
									is_adult = yes
									NOR = {
										any_rival = {
											character = ROOT
										}
										any_lover = {
											character = ROOT
										}
									}
									OR = {
										AND = {
											is_female = no
											NOT = {
												trait = homosexual
											}
											ROOT = {
												is_female = yes
												NOT = {
													trait = homosexual
												}
											}
										}
										AND = {
											is_female = yes
											NOT = {
												trait = homosexual
											}
											ROOT = {
												is_female = no
												NOT = {
													trait = homosexual
												}
											}
										}
										AND = {
											is_female = no
											trait = homosexual
											ROOT = {
												is_female = no
												trait = homosexual
											}
										}
										AND = {
											is_female = yes
											trait = homosexual
											ROOT = {
												is_female = yes
												trait = homosexual
											}
										}
									}
								}
							}
							event_target:foreigners_host = {
								is_inaccessible_or_incapable_trigger = no
								is_adult = yes
								NOR = {
									any_rival = {
										character = ROOT
									}
									any_lover = {
										character = ROOT
									}
								}
								OR = {
									AND = {
										is_female = no
										NOT = {
											trait = homosexual
										}
										ROOT = {
											is_female = yes
											NOT = {
												trait = homosexual
											}
										}
									}
									AND = {
										is_female = yes
										NOT = {
											trait = homosexual
										}
										ROOT = {
											is_female = no
											NOT = {
												trait = homosexual
											}
										}
									}
									AND = {
										is_female = no
										trait = homosexual
										ROOT = {
											is_female = no
											trait = homosexual
										}
									}
									AND = {
										is_female = yes
										trait = homosexual
										ROOT = {
											is_female = yes
											trait = homosexual
										}
									}
								}
							}
						}
					}
					# Foreigner attempts seduction of ruler
					character_event = { id = japan.580 }
				}
				1 = {
					modifier = {
						factor = 0
						NOT = {
							has_dlc = "Reapers"
						}
					}
					modifier = {
						factor = 0
						NOT = {
							has_education_stewardship_trigger = yes
						}
					}
					modifier = {
						factor = 0.1
						NOT = {
							stewardship = 15
						}
					}
					modifier = {
						factor = 0.1
						NOT = {
							has_character_flag = foreigner_is_merchant
						}
					}
					# Foreigner improves local prosperity
					event_target:foreigners_host = {
						character_event = { id = japan.586 }
					}
				}
				1 = {
					modifier = {
						factor = 0.1
						NOR = {
							has_character_flag = foreigner_is_zealot
							has_character_flag = foreigner_is_troublemaker
							has_character_flag = foreigner_is_fool
							has_character_flag = foreigner_is_crazy
						}
					}
					modifier = {
						factor = 0.1
						diplomacy = 15
					}
					modifier = {
						factor = 0
						trait = gregarious
					}
					modifier = {
						factor = 0
						event_target:foreigners_host = {
							NOT = {
								any_courtier = {
									is_landed = no
									is_inaccessible_or_incapable_trigger = no
								}
							}
						}
					}
					# Foreigner upsets courtier
					character_event = { id = japan.587 }
				}
				1 = {
					modifier = {
						factor = 0.1
						NOR = {
							has_character_flag = foreigner_is_zealot
							has_character_flag = foreigner_is_troublemaker
							has_character_flag = foreigner_is_fool
							has_character_flag = foreigner_is_crazy
						}
					}
					modifier = {
						factor = 0.1
						diplomacy = 15
					}
					modifier = {
						factor = 0
						trait = gregarious
					}
					modifier = {
						factor = 0
						event_target:foreigners_host = {
							NOT = {
								any_realm_lord = {
									is_inaccessible_or_incapable_trigger = no
								}
							}
						}
					}
					# Foreigner upsets vassal
					character_event = { id = japan.590 }
				}
				1 = {
					modifier = {
						factor = 0.1
						NOR = {
							has_character_flag = foreigner_is_zealot
							has_character_flag = foreigner_is_troublemaker
							has_character_flag = foreigner_is_fool
							has_character_flag = foreigner_is_crazy
						}
					}
					modifier = {
						factor = 0.1
						diplomacy = 15
					}
					modifier = {
						factor = 0
						trait = gregarious
					}
					# Foreigner upsets host
					event_target:foreigners_host = {
						character_event = { id = japan.593 }
					}
				}
				1 = {
					modifier = {
						factor = 0.1
						NOR = {
							has_character_flag = foreigner_is_troublemaker
							has_character_flag = foreigner_is_fool
							has_character_flag = foreigner_is_crazy
						}
					}
					modifier = {
						factor = 0.1
						OR = {
							diplomacy = 15
							martial = 15
							stewardship = 15
							intrigue = 15
							learning = 15
						}
					}
					# Foreigner is useless
					event_target:foreigners_host = {
						character_event = { id = japan.594 }
					}
				}
				1 = {
					modifier = {
						factor = 0.1
						NOR = {
							has_character_flag = foreigner_is_troublemaker
							has_character_flag = foreigner_is_crazy
						}
					}
					modifier = {
						factor = 0
						NOR = {
							trait = lunatic
							trait = possessed
						}
					}
					# Foreigner is crazy - attempts murder
					character_event = { id = japan.595 }
				}
				1 = {
					modifier = {
						factor = 0.1
						NOR = {
							has_character_flag = foreigner_is_troublemaker
							has_character_flag = foreigner_is_crazy
						}
					}
					modifier = {
						factor = 0
						NOR = {
							trait = lunatic
							trait = possessed
						}
					}
					# Foreigner is crazy - picks up completely random religion or culture
					character_event = { id = japan.600 }
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = foreigner_is_zealot
					}
					modifier = {
						factor = 0
						trait = zealous
					}
					modifier = {
						factor = 10
						trait = sympathy_indian
					}
					modifier = {
						factor = 10
						trait = cynical
					}
					modifier = {
						factor = 0
						event_target:foreigners_host = {
							OR = {
								religion = ROOT
								NOR = {
									religion = shinto
									religion = buddhist
								}
							}
						}
					}
					# Foreigner converts religion
					character_event = { id = japan.602 }
				}
				1 = {
					modifier = {
						factor = 0
						has_character_flag = foreigner_is_zealot
					}
					modifier = {
						factor = 0
						trait = proud
					}
					modifier = {
						factor = 10
						trait = humble
					}
					modifier = {
						factor = 0
						event_target:foreigners_host = {
							OR = {
								culture = ROOT
								NOT = {
									culture_group = japonic
								}
							}
						}
					}
					# Foreigner converts culture
					character_event = { id = japan.603 }
				}
				1 = {
					modifier = {
						factor = 0
						is_married = yes
					}
					modifier = {
						factor = 0
						trait = celibate
					}
					modifier = {
						factor = 0
						trait = homosexual # Can't marry someone appropriate...
					}
					modifier = {
						factor = 0.1
						num_of_lovers = 2
					}
					modifier = {
						factor = 0.1
						has_character_flag = foreigner_is_seducer
					}
					# Foreigner wishes to marry
					character_event = { id = japan.604 }
				}
				10 = {} # Nothing
			}
		}
		repeat_event = { id = japan.521 days = 365 random = 365 }
	}
}

### Foreigner makes a friend

# Foreigner made a friend
character_event = {
	id = japan.522
	desc = EVTDESC_JAPAN_522
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			50 = {
				modifier = {
					factor = 0
					event_target:foreigners_host = {
						OR = {
							any_friend = {
								character = ROOT
							}
							any_lover = {
								character = ROOT
							}
							any_rival = {
								character = ROOT
							}
						}
					}
				}
				event_target:foreigners_host = {
					save_event_target_as = foreigners_target
				}
			}
			50 = {
				modifier = {
					factor = 0
					NOT = {
						event_target:foreigners_host = {
							is_inaccessible_or_incapable_trigger = no
							NOR = {
								any_friend = {
									character = ROOT
								}
								any_lover = {
									character = ROOT
								}
								any_rival = {
									character = ROOT
								}
							}
						}
					}
				}
				event_target:foreigners_host = {
					random_courtier_or_vassal = {
						limit = {
							is_inaccessible_or_incapable_trigger = no
							NOR = {
								any_friend = {
									character = ROOT
								}
								any_lover = {
									character = ROOT
								}
								any_rival = {
									character = ROOT
								}
							}
						}
						save_event_target_as = foreigners_target
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_522 # Best friends forever!
		
		event_target:foreigners_target = {
			add_friend = ROOT
			character_event = { id = japan.523 } # Inform friend
			if = {
				limit = {
					NOT = {
						event_target:foreigners_host = {
							character = PREV
						}
					}
				}
				event_target:foreigners_host = {
					character_event = { id = japan.524 } # Inform host
				}
			}
		}
	}
}

# Inform new friend
character_event = {
	id = japan.523
	desc = EVTDESC_JAPAN_523
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_523 # Best friends forever!
		add_friend = FROM
	}
}

# Inform host (if not friend)
character_event = {
	id = japan.524
	desc = EVTDESC_JAPAN_524
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_524 # Sounds good!
	}
}

### Foreigner makes a rival

# Foreigner made a rival
character_event = {
	id = japan.525
	desc = EVTDESC_JAPAN_525
	picture = GFX_evt_scandal
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		event_target:foreigners_host = {
			random_courtier_or_vassal = {
				limit = {
					is_inaccessible_or_incapable_trigger = no
					NOR = {
						any_friend = {
							character = ROOT
						}
						any_lover = {
							character = ROOT
						}
						any_rival = {
							character = ROOT
						}
					}
				}
				save_event_target_as = foreigners_target
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_525 # I hate them!
		
		event_target:foreigners_target = {
			add_rival = ROOT
			character_event = { id = japan.526 } # Inform rival
		}
		event_target:foreigners_host = {
			character_event = { id = japan.527 } # Inform host
		}
	}
}

# Inform new rival
character_event = {
	id = japan.526
	desc = EVTDESC_JAPAN_526
	picture = GFX_evt_scandal
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_526 # I hate FROM!
		add_rival = FROM
	}
}

# Inform host
character_event = {
	id = japan.527
	desc = EVTDESC_JAPAN_527
	picture = GFX_evt_scandal
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_527 # I see...
	}
}

### Foreigner wants to join the WotRS

# Foreigner makes request
character_event = {
	id = japan.528
	desc = EVTDESC_JAPAN_528
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_528 # Very well; I'll make introductions!
		
		if = {
			limit = {
				society_member_of = warriors_of_the_rising_sun
			}
			change_society_currency = -100
		}
		else = {
			if = {
				limit = {
					OR = {
						religion = shinto
						AND = {
							culture_group = japonic
							religion = buddhist
						}
					}
				}
				prestige = -100
			}
			else = {
				prestige = -250
			}
		}
		
		FROM = {
			character_event = { id = japan.529 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				any_rival = {
					character = FROM
				}
			}
			modifier = {
				factor = 0.1
				FROM = {
					is_female = yes
				}
				is_female = no
				NOR = {
					any_friend = {
						character = FROM
					}
					any_lover = {
						character = FROM
					}
				}
			}
			modifier = {
				factor = 0.1
				NOT = {
					opinion = {
						who = FROM
						value = 25
					}
				}
			}
			modifier = {
				factor = 0
				NOT = {
					opinion = {
						who = FROM
						value = -25
					}
				}
			}
			modifier = { # The other option is better!
				factor = 0
				society_member_of = warriors_of_the_rising_sun
				society_rank >= 2
			}
		}
	}
	
	option = {
		trigger = {
			society_member_of = warriors_of_the_rising_sun
			society_rank >= 2
		}
		
		name = EVTOPTB_JAPAN_528 # Very well; I'll train you myself!
		
		FROM = {
			character_event = { id = japan.530 }
		}
		
		if = {
			limit = {
				has_quest = quest_rising_sun_get_student
			}
			character_event = { id = risingsun.640 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				any_rival = {
					character = FROM
				}
			}
			modifier = {
				factor = 10
				has_quest = quest_rising_sun_get_student
			}
			modifier = {
				factor = 0.1
				FROM = {
					is_female = yes
				}
				is_female = no
				NOR = {
					any_friend = {
						character = FROM
					}
					any_lover = {
						character = FROM
					}
				}
			}
			modifier = {
				factor = 0.1
				NOT = {
					opinion = {
						who = FROM
						value = 25
					}
				}
			}
			modifier = {
				factor = 0
				NOT = {
					opinion = {
						who = FROM
						value = -25
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTC_JAPAN_528 # You, a WotRS? Ha!
		
		add_rival = FROM
		
		FROM = {
			character_event = { id = japan.531 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				opinion = {
					who = FROM
					value = -25
				}
			}
			modifier = {
				factor = 0
				opinion = {
					who = FROM
					value = 25
				}
			}
			modifier = {
				factor = 0.1
				FROM = {
					is_female = no
				}
			}
			modifier = {
				factor = 0.1
				FROM = {
					has_education_martial_trigger = yes
				}
			}
			modifier = {
				factor = 0
				OR = {
					any_friend = {
						character = FROM
					}
					any_lover = {
						character = FROM
					}
				}
			}
			modifier = {
				factor = 100
				any_rival = {
					character = FROM
				}
			}
		}
	}
}

# Request accepted
character_event = {
	id = japan.529
	desc = EVTDESC_JAPAN_529
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_529 # Just as planned!
		
		if = {
			limit = {
				is_in_society = yes
			}
			leave_society = yes
		}
		set_character_flag = special_rising_sun_character # Ignores religion
		join_society = warriors_of_the_rising_sun
	}
}
		
# Request accepted - FROM is mentor
character_event = {
	id = japan.530
	desc = EVTDESC_JAPAN_530
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_530 # That's more than I expected!
		
		if = {
			limit = {
				is_in_society = yes
			}
			leave_society = yes
		}
		set_character_flag = special_rising_sun_character # Ignores religion
		join_society = warriors_of_the_rising_sun
		
		# Mentor stuff
		opinion = {
			who = FROM
			modifier = opinion_rising_sun_student
		}
		reverse_opinion = {
			who = FROM
			modifier = opinion_rising_sun_mentor
		}
		hidden_tooltip = {
			set_variable = {
				which = rising_sun_student
				value = 0
			}
		}
		character_event = { id = risingsun.73 days = 60 random = 60} # Select an event to send
	}
}

# Request refused
character_event = {
	id = japan.531
	desc = EVTDESC_JAPAN_531
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_531 # "Not good enough"?
		
		add_rival = FROM
	}
}

### Foreigner fights bandits

# Bandits are upon you - fight or flee?
character_event = {
	id = japan.532
	desc = EVTDESC_JAPAN_532
	picture = GFX_evt_bandits
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_532 # I will fight!
		
		prestige = 10
		
		random_list = {
			25 = {
				modifier = {
					factor = 0
					NOT = {
						combat_rating = 20
					}
				}
				modifier = {
					factor = 10
					combat_rating = 40
				}
				character_event = { id = japan.533 days = 1 } # You win
			}
			25 = {
				modifier = {
					factor = 0.1
					combat_rating = 20
				}
				character_event = { id = japan.535 days = 1 } # You got wounded
			}
			25 = {
				modifier = {
					factor = 0.1
					combat_rating = 20
				}
				modifier = {
					factor = 0
					combat_rating = 40
				}
				character_event = { id = japan.537 days = 1 } # You got maimed
			}
			25 = {
				modifier = {
					factor = 0.1
					combat_rating = 20
				}
				modifier = {
					factor = 0
					combat_rating = 40
				}
				character_event = { id = japan.539 days = 1 } # You died
			}
		}
		
		if = {
			limit = {
				trait = craven
			}
			remove_trait = craven
		}
		else = {
			add_trait = brave
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = craven
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_532 # I will flee!
		
		prestige = -25
		
		event_target:foreigners_host = {
			character_event = { id = japan.541 days = 1 } # Foreigner is cowardly
		}
		
		if = {
			limit = {
				trait = brave
			}
			remove_trait = brave
		}
		else = {
			add_trait = craven
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = brave
			}
		}
	}
}

# Foreigner won
character_event = {
	id = japan.533
	desc = EVTDESC_JAPAN_533
	picture = GFX_evt_bandits
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_533 # Good riddance!
		
		prestige = 25
		
		event_target:foreigners_host = {
			character_event = { id = japan.534 } # Inform host
		}
	}
}

# Inform host - clean victory
character_event = {
	id = japan.534
	desc = EVTDESC_JAPAN_534
	picture = GFX_evt_bandits
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_534 # I see...
	}
}

# Foreigner won but got injured
character_event = {
	id = japan.535
	desc = EVTDESC_JAPAN_535
	picture = GFX_evt_bandits
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_535 # Good riddance!
		
		prestige = 10
		
		add_trait = wounded
		
		event_target:foreigners_host = {
			character_event = { id = japan.536 } # Inform host
		}
	}
}

# Inform host - injured
character_event = {
	id = japan.536
	desc = EVTDESC_JAPAN_536
	picture = GFX_evt_bandits
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_536 # I see...
	}
}

# Foreigner won but got maimed
character_event = {
	id = japan.537
	desc = EVTDESC_JAPAN_537
	picture = GFX_evt_bandits
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_537 # Good riddance!
		
		prestige = -10
		
		add_maimed_trait_effect = yes
		
		event_target:foreigners_host = {
			character_event = { id = japan.538 } # Inform host
		}
	}
}

# Inform host - maimed
character_event = {
	id = japan.538
	desc = EVTDESC_JAPAN_538
	picture = GFX_evt_bandits
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_538 # I see...
	}
}

# Foreigner killed
character_event = {
	id = japan.539
	desc = EVTDESC_JAPAN_539
	picture = GFX_evt_bloody_man
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_539 # This cannot be!
		
		prestige = -25
		
		death = {
			death_reason = death_battle
		}
		
		event_target:foreigners_host = {
			character_event = { id = japan.540 } # Inform host
		}
	}
}

# Inform host - killed
character_event = {
	id = japan.540
	desc = EVTDESC_JAPAN_540
	picture = GFX_evt_bloody_man
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_540 # I see...
	}
}

# Inform host - foreigner fled
character_event = {
	id = japan.541
	desc = EVTDESC_JAPAN_541
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_541 # I see...
	}
}

### Foreigner in bar brawl

# Brawl time
character_event = {
	id = japan.542
	desc = EVTDESC_JAPAN_542
	picture = GFX_evt_brothel
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_542 # Bar brawl! Yay!
		
		random_list = {
			33 = {
				modifier = {
					factor = 0
					NOT = {
						combat_rating = 20
					}
				}
				character_event = { id = japan.543 }
			}
			34 = {
				modifier = {
					factor = 0
					combat_rating = 40
				}
				character_event = { id = japan.544 }
			}
			33 = {
				modifier = {
					factor = 0
					combat_rating = 20
				}
				character_event = { id = japan.545 }
			}
		}
		
		event_target:foreigners_host = {
			character_event = { id = japan.546 } # Inform host
		}
	}
}

# It goes well
character_event = {
	id = japan.543
	desc = EVTDESC_JAPAN_543
	picture = GFX_evt_brothel
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_543 # Haha!
		
		prestige = 10
	}
}

# Injured
character_event = {
	id = japan.544
	desc = EVTDESC_JAPAN_544
	picture = GFX_evt_brothel
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_544 # Ha!
		
		add_trait = wounded
	}
}

# Maimed
character_event = {
	id = japan.545
	desc = EVTDESC_JAPAN_545
	picture = GFX_evt_brothel
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_545 # Ow!
		
		prestige = -10
		
		add_maimed_trait_effect = yes
	}
}

# Inform host - foreigner is brawling
character_event = {
	id = japan.546
	desc = EVTDESC_JAPAN_546
	picture = GFX_evt_brothel
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_546 # I don't know...
		
		prestige = -5
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				OR = {
					trait = arbitrary
					trait = cruel
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_546 # Throw FROM in a cell!
		
		FROM = {
			imprison = ROOT
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = just
			}
		}
	}
	
	option = {
		name = EVTOPTC_JAPAN_546 # Off with FROM's head!
		
		FROM = {
			death = {
				death_reason = death_execution
				killer = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = kind
			}
		}
	}
}

### Foreigner teaches someone fighting tricks

# Teach someone
character_event = {
	id = japan.547
	desc = EVTDESC_JAPAN_547
	picture = GFX_evt_dueling_knights_hf
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	immediate = {
		event_target:foreigners_host = {
			random_courtier_or_vassal = {
				limit = {
					is_inaccessible_or_incapable_trigger = no
					NOT = {
						any_rival = {
							character = ROOT
						}
					}
					combat_rating_diff = {
						character = ROOT
						value <= -5
					}
				}
				preferred_limit = {
					OR = {
						any_friend = {
							character = ROOT
						}
						any_lover = {
							character = ROOT
						}
					}
				}
				save_event_target_as = foreigners_target
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_547 # I have some tricks to teach!
		
		event_target:foreigners_target = {
			character_event = { id = japan.548 } # Target approached
		}
	}
}

# Target approached
character_event = {
	id = japan.548
	desc = EVTDESC_JAPAN_548
	picture = GFX_evt_dueling_knights_hf
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_548 # Sure!
		
		add_one_duel_experience_modifier = yes
		
		prestige = -10
		FROM = {
			prestige = 10
		}
		
		event_target:foreigners_host = {
			character_event = { id = japan.549 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = proud
			}
			modifier = {
				factor = 0.1
				trait = slothful
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_548 # No!
		
		FROM = {
			prestige = -10
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = humble
			}
			modifier = {
				factor = 0.1
				trait = diligent
			}
		}
	}
}

# Inform host
character_event = {
	id = japan.549
	desc = EVTDESC_JAPAN_549
	picture = GFX_evt_dueling_knights_hf
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_549 # I see...
	}
}

### Foreigner insults peasants

# Foreigner insults peasants
character_event = {
	id = japan.550
	desc = EVTDESC_JAPAN_550
	picture = GFX_evt_noble_haughty_talking_to_peasants
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		event_target:foreigners_host = {
			random_realm_province = {
				save_event_target_as = foreigners_target_province
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_550 # Good-for-nothing peasants!
		
		event_target:foreigners_host = {
			character_event = { id = japan.551 }
		}
	}
}

# Inform host
character_event = {
	id = japan.551
	desc = EVTDESC_JAPAN_551
	picture = GFX_evt_noble_haughty_talking_to_peasants
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_551 # Curses!
		
		prestige = -10
		
		event_target:foreigners_target_province = {
			add_province_modifier = {
				name = peasant_unrest
				years = 10
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				OR = {
					trait = arbitrary
					trait = cruel
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_551 # Throw FROM in a cell!
		
		FROM = {
			imprison = ROOT
		}
		
		event_target:foreigners_target_province = {
			add_province_modifier = {
				name = peasant_unrest
				years = 10
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = just
			}
		}
	}
	
	option = {
		name = EVTOPTC_JAPAN_551 # Off with FROM's head!
		
		FROM = {
			death = {
				death_reason = death_execution
				killer = ROOT
			}
		}
		
		event_target:foreigners_target_province = {
			add_province_modifier = {
				name = peasant_unrest
				years = 10
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = kind
			}
		}
	}
}

### Foreigner shares insights

# Foreigner gives host insights
character_event = {
	id = japan.552
	desc = EVTDESC_JAPAN_552
	picture = GFX_evt_china_invades
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_552 # Great!
		
		culture_techpoints = 15
		economy_techpoints = 15
		military_techpoints = 15
	}
}

### Foreigner teaches someone something

# Foreigner teaches someone something
character_event = {
	id = japan.553
	desc = EVTDESC_JAPAN_553
	picture = GFX_evt_china_invades
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		event_target:foreigners_host = {
			random_courtier_or_vassal = {
				limit = {
					is_inaccessible_or_incapable_trigger = no
					NOT = {
						any_rival = {
							character = ROOT
						}
					}
					combat_rating_diff = {
						character = ROOT
						value <= -5
					}
				}
				preferred_limit = {
					OR = {
						any_friend = {
							character = ROOT
						}
						any_lover = {
							character = ROOT
						}
					}
				}
				save_event_target_as = foreigners_target
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_553 # I have some knowledge to share!
		
		event_target:foreigners_target = {
			character_event = { id = japan.554 } # Target approached
		}
	}
}

# Inform target
character_event = {
	id = japan.554
	desc = EVTDESC_JAPAN_554
	picture = GFX_evt_china_invades
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_554 # Sure!
		
		prestige = -10
		
		random_list = {
			20 = {
				modifier = {
					factor = 2
					FROM = {
						diplomacy = 20
					}
				}
				modifier = {
					factor = 0
					FROM = {
						NOT = {
							diplomacy = 5
						}
					}
				}
				change_diplomacy = 1
			}
			20 = {
				modifier = {
					factor = 2
					FROM = {
						martial = 20
					}
				}
				modifier = {
					factor = 0
					FROM = {
						NOT = {
							martial = 5
						}
					}
				}
				change_martial = 1
			}
			20 = {
				modifier = {
					factor = 2
					FROM = {
						stewardship = 20
					}
				}
				modifier = {
					factor = 0
					FROM = {
						NOT = {
							stewardship = 5
						}
					}
				}
				change_stewardship = 1
			}
			20 = {
				modifier = {
					factor = 2
					FROM = {
						intrigue = 20
					}
				}
				modifier = {
					factor = 0
					FROM = {
						NOT = {
							intrigue = 5
						}
					}
				}
				change_intrigue = 1
			}
			20 = {
				modifier = {
					factor = 2
					FROM = {
						learning = 20
					}
				}
				modifier = {
					factor = 0
					FROM = {
						NOT = {
							learning = 5
						}
					}
				}
				change_learning = 1
			}
		}
		
		FROM = {
			prestige = 10
		}
		
		event_target:foreigners_host = {
			character_event = { id = japan.555 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = proud
			}
			modifier = {
				factor = 0.1
				trait = slothful
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_554 # No!
		
		FROM = {
			prestige = -10
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = humble
			}
			modifier = {
				factor = 0.1
				trait = diligent
			}
		}
	}
}

# Inform host (if not target)
character_event = {
	id = japan.555
	desc = EVTDESC_JAPAN_555
	picture = GFX_evt_china_invades
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_555 # I see...
	}
}

### Foreigner writes book

# Foreigner writes book
character_event = {
	id = japan.556
	desc = EVTDESC_JAPAN_556
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_556 # I dedicate this to my host!
		
		set_character_flag = foreigner_wrote_book
		
		random_list = {
			20 = {
				modifier = {
					factor = 0.1
					has_education_diplomacy_trigger = no
				}
				modifier = {
					factor = 0.1
					OR = {
						has_character_flag = wrote_a_beginners_guide_to_isolationism
						has_character_flag = wrote_keeping_your_head
						has_character_flag = wrote_the_tale_of_dynasty
					}
				}
				random_list = {
					50 = {
						modifier = {
							factor = 0
							diplomacy = 20
						}
						add_artifact = a_beginners_guide_to_isolationism
						set_character_flag = wrote_a_beginners_guide_to_isolationism
						set_character_flag = foreigner_wrote_bad_book
						new_artifact = {
							save_event_target_as = foreigners_book
						}
					}
					25 = {
						add_artifact = keeping_your_head
						set_character_flag = wrote_keeping_your_head
						set_character_flag = foreigner_wrote_average_book
						new_artifact = {
							save_event_target_as = foreigners_book
						}
					}
					15 = {
						modifier = {
							factor = 0
							NOT = {
								diplomacy = 10
							}
						}
						add_artifact = the_tale_of_dynasty
						set_character_flag = wrote_the_tale_of_dynasty
						set_character_flag = foreigner_wrote_good_book
						new_artifact = {
							set_name = "the_tale_of_dynasty_foreigners_host"
							set_description = "the_tale_of_dynasty_foreigners_host_desc"
							save_event_target_as = foreigners_book
						}
					}
				}
			}
			20 = {
				modifier = {
					factor = 0.1
					has_education_martial_trigger = no
				}
				modifier = {
					factor = 0.1
					OR = {
						has_character_flag = wrote_they_have_curved_swords
						has_character_flag = wrote_katanas_are_just_better
						has_character_flag = wrote_warriors_of_the_rising_sun
					}
				}
				random_list = {
					50 = {
						modifier = {
							factor = 0
							martial = 20
						}
						add_artifact = they_have_curved_swords
						set_character_flag = wrote_they_have_curved_swords
						set_character_flag = foreigner_wrote_bad_book
						new_artifact = {
							save_event_target_as = foreigners_book
						}
					}
					25 = {
						add_artifact = katanas_are_just_better
						set_character_flag = wrote_katanas_are_just_better
						set_character_flag = foreigner_wrote_average_book
						new_artifact = {
							save_event_target_as = foreigners_book
						}
					}
					15 = {
						modifier = {
							factor = 0
							NOT = {
								martial = 10
							}
						}
						add_artifact = the_warriors_of_the_rising_sun
						set_character_flag = wrote_warriors_of_the_rising_sun
						set_character_flag = foreigner_wrote_good_book
						new_artifact = {
							save_event_target_as = foreigners_book
						}
					}
				}
			}
			20 = {
				modifier = {
					factor = 0.1
					has_education_stewardship_trigger = no
				}
				modifier = {
					factor = 0.1
					OR = {
						has_character_flag = wrote_cherry_blossoms_are_pretty
						has_character_flag = wrote_bureaucracy_for_dummies
						has_character_flag = wrote_the_provinces_of_realm
					}
				}
				random_list = {
					50 = {
						modifier = {
							factor = 0
							stewardship = 20
						}
						add_artifact = cherry_blossoms_are_pretty
						set_character_flag = wrote_cherry_blossoms_are_pretty
						set_character_flag = foreigner_wrote_bad_book
						new_artifact = {
							save_event_target_as = foreigners_book
						}
					}
					25 = {
						add_artifact = bureaucracy_for_dummies
						set_character_flag = wrote_bureaucracy_for_dummies
						set_character_flag = foreigner_wrote_average_book
						new_artifact = {
							save_event_target_as = foreigners_book
						}
					}
					15 = {
						modifier = {
							factor = 0
							NOT = {
								stewardship = 10
							}
						}
						add_artifact = the_provinces_of_realm
						set_character_flag = wrote_the_provinces_of_realm
						set_character_flag = foreigner_wrote_good_book
						new_artifact = {
							set_name = "the_provinces_of_realm_foreigners_host"
							set_description = "the_provinces_of_realm_foreigners_host_desc"
							save_event_target_as = foreigners_book
						}
					}
				}
			}
			20 = {
				modifier = {
					factor = 0.1
					has_education_intrigue_trigger = no
				}
				modifier = {
					factor = 0.1
					OR = {
						has_character_flag = wrote_highly_visible_ninja
						has_character_flag = wrote_how_to_wall_climb
						has_character_flag = wrote_conservation_of_ninjutsu
					}
				}
				random_list = {
					50 = {
						modifier = {
							factor = 0
							intrigue = 20
						}
						add_artifact = highly_visible_ninja
						set_character_flag = wrote_highly_visible_ninja
						set_character_flag = foreigner_wrote_bad_book
						new_artifact = {
							save_event_target_as = foreigners_book
						}
					}
					25 = {
						add_artifact = how_to_wall_climb
						set_character_flag = wrote_how_to_wall_climb
						set_character_flag = foreigner_wrote_average_book
						new_artifact = {
							save_event_target_as = foreigners_book
						}
					}
					15 = {
						modifier = {
							factor = 0
							NOT = {
								intrigue = 10
							}
						}
						add_artifact = conservation_of_ninjutsu
						set_character_flag = wrote_conservation_of_ninjutsu
						set_character_flag = foreigner_wrote_good_book
						new_artifact = {
							save_event_target_as = foreigners_book
						}
					}
				}
			}
			20 = {
				modifier = {
					factor = 0.1
					has_education_learning_trigger = no
				}
				modifier = {
					factor = 0.1
					OR = {
						has_character_flag = wrote_how_to_haiku
						has_character_flag = wrote_hiragana_katakana_and_kanji
						has_character_flag = wrote_the_location_history_of_realm
					}
				}
				random_list = {
					50 = {
						modifier = {
							factor = 0
							intrigue = 20
						}
						add_artifact = how_to_haiku
						set_character_flag = wrote_how_to_haiku
						set_character_flag = foreigner_wrote_bad_book
						new_artifact = {
							save_event_target_as = foreigners_book
						}
					}
					25 = {
						add_artifact = hiragana_katakana_and_kanji
						set_character_flag = wrote_hiragana_katakana_and_kanji
						set_character_flag = foreigner_wrote_average_book
						new_artifact = {
							save_event_target_as = foreigners_book
						}
					}
					15 = {
						modifier = {
							factor = 0
							NOT = {
								intrigue = 10
							}
						}
						add_artifact = the_location_history_of_realm
						set_character_flag = wrote_the_location_history_of_realm
						set_character_flag = foreigner_wrote_good_book
						new_artifact = {
							set_name = "the_location_history_of_realm_foreigners_host"
							set_description = "the_location_history_of_realm_foreigners_host_desc"
							save_event_target_as = the_location_history_of_realm
						}
					}
				}
			}
		}
		
		if = {
			limit = {
				has_character_flag = foreigner_wrote_bad_book
			}
			clr_character_flag = foreigner_wrote_bad_book
			event_target:foreigners_host = {
				character_event = { id = japan.557 } # Inform host
			}
		}
		else_if = {
			limit = {
				has_character_flag = foreigner_wrote_average_book
			}
			clr_character_flag = foreigner_wrote_average_book
			event_target:foreigners_host = {
				character_event = { id = japan.558 } # Inform host
			}
		}
		else_if = {
			limit = {
				has_character_flag = foreigner_wrote_good_book
			}
			clr_character_flag = foreigner_wrote_good_book
			event_target:foreigners_host = {
				character_event = { id = japan.559 } # Inform host
			}
		}
	}
}

# Host gets book - poor book
character_event = {
	id = japan.557
	desc = EVTDESC_JAPAN_557
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_557 # I accept this gift!
		
		FROM = {
			prestige = 25
		}
		
		event_target:foreigners_book = {
			transfer_artifact = {
				from = FROM
				to = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				NOT = {
					trait = humble
				}
			}
			modifier = {
				factor = 0.1
				trait = charitable
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_557 # Keep it!
		
		event_target:foreigners_book = {
			transfer_artifact = {
				from = FROM
				to = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = humble
			}
			modifier = {
				factor = 0.1
				NOT = {
					trait = charitable
				}
			}
		}
	}
}

# Host gets book - decent book
character_event = {
	id = japan.558
	desc = EVTDESC_JAPAN_558
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_558 # I accept this gift!
		
		FROM = {
			prestige = 50
		}
		
		event_target:foreigners_book = {
			transfer_artifact = {
				from = FROM
				to = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = charitable
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_558 # Keep it!
		
		event_target:foreigners_book = {
			transfer_artifact = {
				from = FROM
				to = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				NOT = {
					trait = charitable
				}
			}
		}
	}
}

# Host gets book - great book
character_event = {
	id = japan.559
	desc = EVTDESC_JAPAN_559
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_559 # I accept this gift!
		
		FROM = {
			prestige = 100
		}
		
		event_target:foreigners_book = {
			transfer_artifact = {
				from = FROM
				to = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = humble
			}
			modifier = {
				factor = 0.1
				trait = charitable
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_559 # Keep it!
		
		event_target:foreigners_book = {
			transfer_artifact = {
				from = FROM
				to = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = proud
			}
			modifier = {
				factor = 0.1
				NOT = {
					trait = charitable
				}
			}
		}
	}
}

### Foreigner converts courtier

# Foreigner picks a target
character_event = {
	id = japan.560
	desc = EVTDESC_JAPAN_560
	picture = GFX_evt_religious_exultation
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		event_target:foreigners_host = {
			random_courtier = {
				limit = {
					is_landed = no
					is_inaccessible_or_incapable_trigger = no
					NOR = {
						religion = ROOT
						has_character_flag = ai_flag_refuse_conversion
						trait = zealous
					}
				}
				save_event_target_as = foreigners_target
			}
		}
		FROM = {
			piety = 25
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_560 # Convert now!
		
		event_target:foreigners_target = {
			religion = ROOT
		}
		event_target:foreigners_host = {
			character_event = { id = japan.561 } # Inform the host
		}
	}
}

# Inform host
character_event = {
	id = japan.561
	desc = EVTDESC_JAPAN_561
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			religion = FROM
		}
		name = EVTOPTA_JAPAN_561 # Great!
	}
	
	option = {
		trigger = {
			NOT = {
				religion = FROM
			}
		}
		name = EVTOPTB_JAPAN_561 # I see...
		
		prestige = -10
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				OR = {
					trait = zealous
					trait = cruel
				}
			}
		}
	}
	
	option = {
		trigger = {
			NOT = {
				religion = FROM
			}
		}
		name = EVTOPTC_JAPAN_561 # Throw FROM in a cell!
		
		FROM = {
			imprison = ROOT
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = cynical
			}
		}
	}
	
	option = {
		trigger = {
			NOT = {
				religion = FROM
			}
		}
		name = EVTOPTD_JAPAN_561 # Off with FROM's head!
		
		FROM = {
			death = {
				death_reason = death_execution
				killer = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = kind
			}
		}
	}
}

### Foreigner converts province

# Inform host
character_event = {
	id = japan.562
	desc = EVTDESC_JAPAN_562
	picture = GFX_evt_religious_exultation
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		random_realm_province = {
			limit = {
				NOT = {
					religion = FROM
				}
			}
			save_event_target_as = foreigners_target_province
		}
		FROM = {
			piety = 25
		}
	}
	
	option = {
		trigger = {
			religion = FROM
		}
		name = EVTOPTA_JAPAN_562 # Great!
		
		event_target:foreigners_target_province = {
			religion = FROM
		}
	}
	
	option = {
		trigger = {
			NOT = {
				religion = FROM
			}
		}
		name = EVTOPTB_JAPAN_562 # I see...
		
		piety = -25
		
		event_target:foreigners_target_province = {
			religion = FROM
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				OR = {
					trait = zealous
					trait = cruel
				}
			}
		}
	}
	
	option = {
		trigger = {
			NOT = {
				religion = FROM
			}
		}
		name = EVTOPTC_JAPAN_562 # Throw FROM in a cell!
		
		FROM = {
			imprison = ROOT
		}
		
		event_target:foreigners_target_province = {
			religion = FROM
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = cynical
			}
		}
	}
	
	option = {
		trigger = {
			NOT = {
				religion = FROM
			}
		}
		
		name = EVTOPTD_JAPAN_562 # Off with FROM's head!
		
		event_target:foreigners_target_province = {
			religion = FROM
		}
		
		FROM = {
			death = {
				death_reason = death_execution
				killer = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = kind
			}
		}
	}
}

### Foreigner detects plot

# Plot discovered
character_event = {
	id = japan.563
	desc = EVTDESC_JAPAN_563
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		event_target:foreigners_host = {
			random_courtier_or_vassal = {
				limit = {
					is_inaccessible_or_incapable_trigger = no
					NOR = {
						any_friend = {
							character = ROOT
						}
						any_lover = {
							character = ROOT
						}
					}
					has_plot = yes
					NOT = {
						plot_is_known_by = event_target:foreigners_host
					}
				}
				preferred_limit = {
					any_rival = {
						character = ROOT
					}
					any_rival = {
						character =  event_target:foreigners_host
					}
				}
				preferred_limit = {
					any_rival = {
						character = ROOT
					}
				}
				preferred_limit = {
					any_rival = {
						character = event_target:foreigners_host
					}
				}
				save_event_target_as = foreigners_target
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_563 # I know what you plan!
		
		event_target:foreigners_target = {
			reveal_plot = ROOT
			character_event = { id = japan.564 } # Inform the plotter
		}
		event_target:foreigners_host = {
			character_event = { id = japan.565 } # Inform the host
		}
	}
}

# Inform discovered plotter
character_event = {
	id = japan.564
	desc = EVTDESC_JAPAN_564
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_564 # Curses!
		
		prestige = -25
	}
}

# Inform host
character_event = {
	id = japan.565
	desc = EVTDESC_JAPAN_565
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_565 # I see...
		
		event_target:foreigners_target = {
			reveal_plot = ROOT
		}
	}
}

### Foreigner steals from courtier

# Foreigner picks target
character_event = {
	id = japan.566
	desc = EVTDESC_JAPAN_566
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		event_target:foreigners_host = {
			random_courtier = {
				limit = {
					is_landed = no
					is_inaccessible_or_incapable_trigger = no
					NOR = {
						any_friend = {
							character = ROOT
						}
						any_lover = {
							character = ROOT
						}
					}
				}
				preferred_limit = {
					any_rival = {
						character = ROOT
					}
				}
				save_event_target_as = foreigners_target
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_566 # Such pretty baubles!
		
		random_list = {
			50 = {
				modifier = {
					factor = 0
					attribute_diff = {
						character = event_target:foreigners_target
						attribute = intrigue
						value <= -10
					}
				}
				modifier = {
					factor = 0.1
					attribute_diff = {
						character = event_target:foreigners_target
						attribute = intrigue
						value <= -1
					}
				}
				# It goes well
				character_event = { id = japan.567 days = 1 }
			}
			50 = {
				modifier = {
					factor = 0
					attribute_diff = {
						character = event_target:foreigners_target
						attribute = intrigue
						value >= 10
					}
				}
				modifier = {
					factor = 0.1
					attribute_diff = {
						character = event_target:foreigners_target
						attribute = intrigue
						value >= 1
					}
				}
				# It goes poorly
				character_event = { id = japan.568 days = 1 }
			}
		}
	}
}

# It goes well
character_event = {
	id = japan.567
	desc = EVTDESC_JAPAN_567
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_567 # Great!
		
		wealth = 25
		
		event_target:foreigners_target = {
			wealth = -25
		}
	}
}

# It goes poorly
character_event = {
	id = japan.568
	desc = EVTDESC_JAPAN_568
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_568 # Curses
		
		prestige = -10
		
		event_target:foreigners_target = {
			add_rival = ROOT
		}
		event_target:foreigners_host = {
			character_event = { id = japan.569 } # Inform host
		}
	}
}

# Infrom host if it went poorly
character_event = {
	id = japan.569
	desc = EVTDESC_JAPAN_569
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	option = {
		name = EVTOPTA_JAPAN_569 # I don't know...
		
		prestige = -5
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				OR = {
					trait = just
					trait = cruel
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_569 # Throw FROM in a cell!
		
		FROM = {
			imprison = ROOT
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = arbitrary
			}
		}
	}
	
	option = {
		name = EVTOPTC_JAPAN_569 # Off with FROM's head!
		
		FROM = {
			death = {
				death_reason = death_execution
				killer = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = kind
			}
		}
	}
}

### Foreigner steals from vassal

# Foreigner picks target
character_event = {
	id = japan.570
	desc = EVTDESC_JAPAN_570
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		event_target:foreigners_host = {
			random_realm_lord = {
				limit = {
					is_inaccessible_or_incapable_trigger = no
					NOR = {
						any_friend = {
							character = ROOT
						}
						any_lover = {
							character = ROOT
						}
					}
				}
				preferred_limit = {
					any_rival = {
						character = ROOT
					}
				}
				save_event_target_as = foreigners_target
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_570 # Such pretty baubles!
		
		random_list = {
			50 = {
				modifier = {
					factor = 0
					attribute_diff = {
						character = event_target:foreigners_target
						attribute = intrigue
						value <= -10
					}
				}
				modifier = {
					factor = 0.1
					attribute_diff = {
						character = event_target:foreigners_target
						attribute = intrigue
						value <= -1
					}
				}
				# It goes well
				character_event = { id = japan.571 days = 1 }
			}
			50 = {
				modifier = {
					factor = 0
					attribute_diff = {
						character = event_target:foreigners_target
						attribute = intrigue
						value >= 10
					}
				}
				modifier = {
					factor = 0.1
					attribute_diff = {
						character = event_target:foreigners_target
						attribute = intrigue
						value >= 1
					}
				}
				# It goes poorly
				character_event = { id = japan.573 days = 1 }
			}
		}
	}
}

# It goes well
character_event = {
	id = japan.571
	desc = EVTDESC_JAPAN_571
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_571 # Great!
		
		wealth = 50
		
		event_target:foreigners_target = {
			character_event = { id = japan.572 } # Inform target
		}
	}
}

# Inform vassal - money is missing
character_event = {
	id = japan.572
	desc = EVTDESC_JAPAN_572
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_572 # Who did this?
		
		wealth = -50
	}
}

# It goes poorly - imprisoned
character_event = {
	id = japan.573
	desc = EVTDESC_JAPAN_573
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_571 # Great!
		
		prestige = -25
		
		imprison = event_target:foreigners_target
		
		event_target:foreigners_target = {
			add_rival = ROOT
			character_event = { id = japan.574 } # Inform target
		}
	}
}

# Inform vassal - foreigner was imprisoned
character_event = {
	id = japan.574
	desc = EVTDESC_JAPAN_574
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_574 # Thievery will not go unpunished!
		
		add_rival = FROM
		
		event_target:foreigners_host = {
			character_event = { id = japan.575 } # Inform host
		}
	}
}

# Infrom host if it went poorly
character_event = {
	id = japan.575
	desc = EVTDESC_JAPAN_575
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_575 # I see...
	}
}

### Foreigner attempts seduction of courtier

# Foreigner picks target
character_event = {
	id = japan.576
	desc = EVTDESC_JAPAN_576
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		event_target:foreigners_host = {
			random_courtier = {
				limit = {
					is_landed = no
					is_inaccessible_or_incapable_trigger = no
					is_adult = yes
					NOR = {
						any_rival = {
							character = ROOT
						}
						any_lover = {
							character = ROOT
						}
					}
					OR = {
						AND = {
							is_female = no
							NOT = {
								trait = homosexual
							}
							ROOT = {
								is_female = yes
								NOT = {
									trait = homosexual
								}
							}
						}
						AND = {
							is_female = yes
							NOT = {
								trait = homosexual
							}
							ROOT = {
								is_female = no
								NOT = {
									trait = homosexual
								}
							}
						}
						AND = {
							is_female = no
							trait = homosexual
							ROOT = {
								is_female = no
								trait = homosexual
							}
						}
						AND = {
							is_female = yes
							trait = homosexual
							ROOT = {
								is_female = yes
								trait = homosexual
							}
						}
					}
				}
				preferred_limit = {
					is_attractive_trigger = yes
				}
				save_event_target_as = foreigners_target
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_576 # Yes!
		
		event_target:foreigners_target = {
			character_event = { id = japan.577 days = 1 } # Other party approached
		}
		
		piety = -10
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = chaste
			}
			modifier = {
				factor = 0
				trait = celibate
			}
			modifier = {
				factor = 0
				is_ascetic_trigger = yes
				NOT = {
					trait = lustful
				}
			}
			modifier = {
				factor = 0.1
				event_target:foreigners_target = {
					is_unattractive_trigger = yes
				}
			}
			modifier = {
				factor = 5
				event_target:foreigners_target = {
					is_attractive_trigger = yes
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_576 # I don't think so!
		
		piety = 10
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = lustful
			}
			modifier = {
				factor = 0
				OR = {
					trait = seducer
					trait = seductress
				}
			}
		}
	}
}

# Target approached
character_event = {
	id = japan.577
	desc = EVTDESC_JAPAN_577
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_577 # Yes!
		FROM = {
			save_event_target_as = sex_partner
		}
		unprotected_sex_effect_event_target = yes
		
		FROM = {
			character_event = { id = japan.579 } # Tumbling
		}
		
		piety = -10
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = chaste
			}
			modifier = {
				factor = 0
				trait = celibate
			}
			modifier = {
				factor = 0
				is_ascetic_trigger = yes
				NOT = {
					trait = lustful
				}
			}
			modifier = {
				factor = 0.1
				FROM = {
					is_unattractive_trigger = yes
				}
			}
			modifier = {
				factor = 5
				FROM = {
					is_attractive_trigger = yes
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_577 # I don't think so!
		
		FROM = {
			character_event = { id = japan.578 } # Shot down
		}
		
		piety = 10
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = lustful
			}
			modifier = {
				factor = 0
				OR = {
					trait = seducer
					trait = seductress
				}
			}
		}
	}
}

# Target turned down foreigner
character_event = {
	id = japan.578
	desc = EVTDESC_JAPAN_578
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_578 # I see...
	}
}

# Target accepted - lovers?
character_event = {
	id = japan.579
	desc = EVTDESC_JAPAN_579
	picture = GFX_evt_lovers
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_579 # Yes!
		
		add_lover = FROM
	}
	
	option = {
		name = EVTOPTB_JAPAN_579 # No!
	}
}

### Foreigner attempts seduction of ruler

# Foreigner picks target
character_event = {
	id = japan.580
	desc = EVTDESC_JAPAN_580
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			50 = {
				modifier = {
					factor = 0
					NOT = {
						event_target:foreigners_host = {
							any_realm_lord = {
								is_inaccessible_or_incapable_trigger = no
								is_adult = yes
								NOR = {
									any_rival = {
										character = ROOT
									}
									any_lover = {
										character = ROOT
									}
								}
								OR = {
									AND = {
										is_female = no
										NOT = {
											trait = homosexual
										}
										ROOT = {
											is_female = yes
											NOT = {
												trait = homosexual
											}
										}
									}
									AND = {
										is_female = yes
										NOT = {
											trait = homosexual
										}
										ROOT = {
											is_female = no
											NOT = {
												trait = homosexual
											}
										}
									}
									AND = {
										is_female = no
										trait = homosexual
										ROOT = {
											is_female = no
											trait = homosexual
										}
									}
									AND = {
										is_female = yes
										trait = homosexual
										ROOT = {
											is_female = yes
											trait = homosexual
										}
									}
								}
							}
						}
					}
				}
				event_target:foreigners_host = {
					random_courtier = {
						limit = {
							is_landed = no
							is_inaccessible_or_incapable_trigger = no
							is_adult = yes
							NOR = {
								any_rival = {
									character = ROOT
								}
								any_lover = {
									character = ROOT
								}
							}
							OR = {
								AND = {
									is_female = no
									NOT = {
										trait = homosexual
									}
									ROOT = {
										is_female = yes
										NOT = {
											trait = homosexual
										}
									}
								}
								AND = {
									is_female = yes
									NOT = {
										trait = homosexual
									}
									ROOT = {
										is_female = no
										NOT = {
											trait = homosexual
										}
									}
								}
								AND = {
									is_female = no
									trait = homosexual
									ROOT = {
										is_female = no
										trait = homosexual
									}
								}
								AND = {
									is_female = yes
									trait = homosexual
									ROOT = {
										is_female = yes
										trait = homosexual
									}
								}
							}
						}
						preferred_limit = {
							is_attractive_trigger = yes
						}
						save_event_target_as = foreigners_target
					}
				}
			}
			50 = {
				modifier = {
					factor = 0
					NOT = {
						event_target:foreigners_host = {
							is_inaccessible_or_incapable_trigger = no
							is_adult = yes
							NOR = {
								any_rival = {
									character = ROOT
								}
								any_lover = {
									character = ROOT
								}
							}
							OR = {
								AND = {
									is_female = no
									NOT = {
										trait = homosexual
									}
									ROOT = {
										is_female = yes
										NOT = {
											trait = homosexual
										}
									}
								}
								AND = {
									is_female = yes
									NOT = {
										trait = homosexual
									}
									ROOT = {
										is_female = no
										NOT = {
											trait = homosexual
										}
									}
								}
								AND = {
									is_female = no
									trait = homosexual
									ROOT = {
										is_female = no
										trait = homosexual
									}
								}
								AND = {
									is_female = yes
									trait = homosexual
									ROOT = {
										is_female = yes
										trait = homosexual
									}
								}
							}
						}
					}
				}
				event_target:foreigners_host = {
					save_event_target_as = foreigners_target
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_580 # Yes!
		
		event_target:foreigners_target = {
			character_event = { id = japan.581 days = 1 } # Other party approached
		}
		
		piety = -10
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = chaste
			}
			modifier = {
				factor = 0
				trait = celibate
			}
			modifier = {
				factor = 0
				is_ascetic_trigger = yes
				NOT = {
					trait = lustful
				}
			}
			modifier = {
				factor = 0.1
				event_target:foreigners_target = {
					is_unattractive_trigger = yes
				}
			}
			modifier = {
				factor = 5
				event_target:foreigners_target = {
					is_attractive_trigger = yes
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_580 # I don't think so!
		
		piety = 10
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = lustful
			}
			modifier = {
				factor = 0
				OR = {
					trait = seducer
					trait = seductress
				}
			}
		}
	}
}

# Target approached
character_event = {
	id = japan.581
	desc = EVTDESC_JAPAN_581
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_581 # Yes!
		FROM = {
			save_event_target_as = sex_partner
		}
		unprotected_sex_effect_event_target = yes
		
		FROM = {
			character_event = { id = japan.583 } # Tumbling
		}
		
		piety = -10
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = chaste
			}
			modifier = {
				factor = 0
				trait = celibate
			}
			modifier = {
				factor = 0
				is_ascetic_trigger = yes
				NOT = {
					trait = lustful
				}
			}
			modifier = {
				factor = 0.1
				FROM = {
					is_unattractive_trigger = yes
				}
			}
			modifier = {
				factor = 5
				FROM = {
					is_attractive_trigger = yes
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_581 # I don't think so!
		
		FROM = {
			character_event = { id = japan.582 } # Shot down
		}
		
		piety = 10
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = lustful
			}
			modifier = {
				factor = 0
				OR = {
					trait = seducer
					trait = seductress
				}
			}
		}
	}
}

# Target turned down foreigner
character_event = {
	id = japan.582
	desc = EVTDESC_JAPAN_582
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_582 # I see...
	}
}

# Target accepted - lovers?
character_event = {
	id = japan.583
	desc = EVTDESC_JAPAN_583
	picture = GFX_evt_lovers
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_583 # Yes!
		
		add_lover = FROM
		
		FROM = {
			character_event = { id = japan.584 days = 1 } # Inform FROM
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_583 # No!
		
		FROM = {
			character_event = { id = japan.585 days = 1 } # Inform FROM
		}
	}
}

# Lovers
character_event = {
	id = japan.584
	desc = EVTDESC_JAPAN_584
	picture = GFX_evt_lovers
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_584 # That's great!
		
		add_lover = FROM
	}
}

# Not lovers
character_event = {
	id = japan.585
	desc = EVTDESC_JAPAN_585
	picture = GFX_evt_lovers
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_585 # I see...
	}
}

### Foreigner improves local prosperity

# Prosperity improves
character_event = {
	id = japan.586
	desc = EVTDESC_JAPAN_586
	picture = GFX_evt_prospering_province
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	immediate = {
		random_realm_province = {
			save_event_target_as = foreigners_target_province
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_586 # That's nice!
		
		event_target:foreigners_target_province = {
			hidden_tooltip = {
				change_variable = { which = prosperity_value value = 6 }
			}
		}
	}
}

### Foreigner upsets courtier

# Pick someone to upset
character_event = {
	id = japan.587
	desc = EVTDESC_JAPAN_587
	picture = GFX_evt_scandal
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		event_target:foreigners_host = {
			random_courtier = {
				limit = {
					is_landed = no
					is_inaccessible_or_incapable_trigger = no
				}
				preferred_limit = {
					NOR = {
						any_friend = {
							character = ROOT
						}
						any_lover = {
							character = ROOT
						}
					}
				}
				save_event_target_as = foreigners_target
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_587 # Oops!
		
		prestige = -10
		
		event_target:foreigners_target = {
			character_event = { id = japan.588 } # Inform target
		}
	}
}

# Courtier gets upset
character_event = {
	id = japan.588
	desc = EVTDESC_JAPAN_588
	picture = GFX_evt_scandal
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_588 # How rude!
		
		opinion = {
			who = FROM
			modifier = opinion_dislike
		}
		
		event_target:foreigners_host = {
			character_event = { id = japan.589 } # Inform host
		}
	}
}

# Inform host
character_event = {
	id = japan.589
	desc = EVTDESC_JAPAN_589
	picture = GFX_evt_scandal
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_589 # I don't know...
		
		prestige = -5
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				OR = {
					trait = arbitrary
					trait = cruel
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_589 # Throw FROM in a cell!
		
		FROM = {
			imprison = ROOT
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = just
			}
		}
	}
	
	option = {
		name = EVTOPTC_JAPAN_589 # Off with FROM's head!
		
		FROM = {
			death = {
				death_reason = death_execution
				killer = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = kind
			}
		}
	}
}

### Foreigner upsets vassal

# Pick someone to upset
character_event = {
	id = japan.590
	desc = EVTDESC_JAPAN_590
	picture = GFX_evt_scandal
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		event_target:foreigners_host = {
			random_realm_lord = {
				limit = {
					is_inaccessible_or_incapable_trigger = no
				}
				preferred_limit = {
					NOR = {
						any_friend = {
							character = ROOT
						}
						any_lover = {
							character = ROOT
						}
					}
				}
				save_event_target_as = foreigners_target
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_590 # Oops!
		
		prestige = -10
		
		event_target:foreigners_target = {
			character_event = { id = japan.591 } # Inform target
		}
	}
}

# Vassal gets upset
character_event = {
	id = japan.591
	desc = EVTDESC_JAPAN_591
	picture = GFX_evt_scandal
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_591 # How rude!
		
		opinion = {
			who = FROM
			modifier = opinion_dislike
		}
		
		event_target:foreigners_host = {
			character_event = { id = japan.592 } # Inform host
		}
	}
}

# Inform host
character_event = {
	id = japan.592
	desc = EVTDESC_JAPAN_592
	picture = GFX_evt_scandal
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_592 # I don't know...
		
		prestige = -5
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				OR = {
					trait = arbitrary
					trait = cruel
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_592 # Throw FROM in a cell!
		
		FROM = {
			imprison = ROOT
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = just
			}
		}
	}
	
	option = {
		name = EVTOPTC_JAPAN_592 # Off with FROM's head!
		
		FROM = {
			death = {
				death_reason = death_execution
				killer = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = kind
			}
		}
	}
}

### Foreigner upsets host

# Host is insulted
character_event = {
	id = japan.593
	desc = EVTDESC_JAPAN_593
	picture = GFX_evt_scandal
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_593 # How rude!
		
		prestige = -10
		
		opinion = {
			who = FROM
			modifier = opinion_dislike
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				OR = {
					trait = arbitrary
					trait = proud
					trait = cruel
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_593 # Throw FROM in a cell!
		
		FROM = {
			imprison = ROOT
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = just
				NOT = {
					trait = proud
				}
			}
			modifier = {
				factor = 0.01
				trait = just
			}
		}
	}
	
	option = {
		name = EVTOPTC_JAPAN_593 # Off with FROM's head!
		
		FROM = {
			death = {
				death_reason = death_execution
				killer = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = kind
				NOT = {
					trait = proud
				}
			}
			modifier = {
				factor = 0.01
				trait = kind
			}
		}
	}
}

### Foreigner is useless

# Foreigner is useless - inform host
character_event = {
	id = japan.594
	desc = EVTDESC_JAPAN_594
	picture = GFX_evt_scandal
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_594 # I see...
		
		prestige = -10
	}
}

### Foreigner is crazy - attempts murder

# Foreigner picks target
character_event = {
	id = japan.595
	desc = EVTDESC_JAPAN_595
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		event_target:foreigners_host = {
			random_courtier = {
				limit = {
					is_inaccessible_or_incapable_trigger = no
					is_landed = no
				}
				# The foreigner is crazy, so no preferences!
				save_event_target_as = foreigners_target
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_595 # The voices' command is clear!
		
		random_list = {
			50 = {
				modifier = {
					factor = 0
					attribute_diff = {
						character = event_target:foreigners_target
						attribute = intrigue
						value <= -10
					}
				}
				modifier = {
					factor = 0.1
					attribute_diff = {
						character = event_target:foreigners_target
						attribute = intrigue
						value <= -1
					}
				}
				# It goes well
				character_event = { id = japan.596 days = 1 }
			}
			50 = {
				modifier = {
					factor = 0
					attribute_diff = {
						character = event_target:foreigners_target
						attribute = intrigue
						value >= 10
					}
				}
				modifier = {
					factor = 0.1
					attribute_diff = {
						character = event_target:foreigners_target
						attribute = intrigue
						value >= 1
					}
				}
				# It goes poorly
				character_event = { id = japan.598 days = 1 }
			}
		}
	}
}

# Murder attempt succeeds
character_event = {
	id = japan.596
	desc = EVTDESC_JAPAN_596
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_596 # Do not want!
		
		event_target:foreigners_host = {
			character_event = { id = japan.597 } # Inform host
		}
		
		hidden_tooltip = {
			save_event_target_as = target_victim
			FROM = { character_event = { id = 10 } } # Consequences of discovery
			clear_event_target = target_victim
		}
		death = {
			death_reason = death_murder
			killer = FROM
		}
	}
}

# Infrom host
character_event = {
	id = japan.597
	desc = EVTDESC_JAPAN_597
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_597 # I don't know...
		
		prestige = -25
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				OR = {
					trait = just
					trait = cruel
					any_close_relative = {
						character = FROM
					}
					any_spouse_even_if_dead = {
						character = FROM
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_597 # Throw FROM in a cell!
		
		FROM = {
			imprison = ROOT
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = arbitrary
				NOR = {
					any_close_relative = {
						character = FROM
					}
					any_spouse_even_if_dead = {
						character = FROM
					}
				}
			}
			modifier = {
				factor = 0.01
				trait = arbitrary
			}
		}
	}
	
	option = {
		name = EVTOPTC_JAPAN_597 # Off with FROM's head!
		
		FROM = {
			death = {
				death_reason = death_execution
				killer = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = kind
				NOR = {
					any_close_relative = {
						character = FROM
					}
					any_spouse_even_if_dead = {
						character = FROM
					}
				}
			}
			modifier = {
				factor = 0.01
				trait = kind
			}
		}
	}
}

# Murder attempt fails
character_event = {
	id = japan.598
	desc = EVTDESC_JAPAN_598
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_598 # I got away!
		
		event_target:foreigners_host = {
			character_event = { id = japan.599 } # Inform host
		}
		
		add_rival = FROM
	}
}

# Inform host
character_event = {
	id = japan.599
	desc = EVTDESC_JAPAN_599
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_599 # I don't know...
		
		prestige = -25
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				OR = {
					trait = just
					trait = cruel
					any_close_relative = {
						character = FROM
					}
					any_spouse_even_if_dead = {
						character = FROM
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_599 # Throw FROM in a cell!
		
		FROM = {
			imprison = ROOT
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = arbitrary
				NOR = {
					any_close_relative = {
						character = FROM
					}
					any_spouse_even_if_dead = {
						character = FROM
					}
				}
			}
			modifier = {
				factor = 0.01
				trait = arbitrary
			}
		}
	}
	
	option = {
		name = EVTOPTC_JAPAN_599 # Off with FROM's head!
		
		FROM = {
			death = {
				death_reason = death_execution
				killer = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = kind
				NOR = {
					any_close_relative = {
						character = FROM
					}
					any_spouse_even_if_dead = {
						character = FROM
					}
				}
			}
			modifier = {
				factor = 0.01
				trait = kind
			}
		}
	}
}

### Foreigner is crazy - picks up completely random religion or culture

# Foreigner picks up random religion or culture
character_event = {
	id = japan.600
	desc = EVTDESC_JAPAN_600
	picture = GFX_evt_religious_exultation
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		random_independent_ruler = {
			limit = {
				any_realm_province = {
					NOR = {
						religion = ROOT
						culture = ROOT
					}
				}
			}
			random_realm_province = {
				limit = {
					NOR = {
						religion = ROOT
						culture = ROOT
					}
				}
				save_event_target_as = foreigners_target_province
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_600 # New day, new me!
		
		religion = event_target:foreigners_target_province
		culture = event_target:foreigners_target_province
		
		event_target:foreigners_host = {
			character_event = { id = japan.601 } # Inform host
		}
	}
}

# Inform host
character_event = {
	id = japan.601
	desc = EVTDESC_JAPAN_601
	picture = GFX_evt_religious_exultation
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_601 # I see...
	}
}

### Foreigner converts religion

# Inform host
character_event = {
	id = japan.602
	desc = EVTDESC_JAPAN_602
	picture = GFX_evt_religious_exultation
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_602 # That's great!
		
		FROM = {
			religion = ROOT
		}
		
		piety = 10
	}
}

### Foreigner converts culture

# Inform host
character_event = {
	id = japan.603
	desc = EVTDESC_JAPAN_603
	picture = GFX_evt_religious_exultation
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_JAPAN_603 # That's great!
		
		FROM = {
			culture = ROOT
		}
		
		prestige = 10
	}
}

### Foreigner wishes to marry

# Check to see if there's a preferred spouse
character_event = {
	id = japan.604
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				event_target:foreigners_host = {
					any_courtier = {
						is_landed = no
						is_inaccessible_or_incapable_trigger = no
						is_married = no
						is_consort = no
						num_of_consorts = 0
						any_lover = {
							character = ROOT
						}
						is_betrothed = no
						is_ascetic_trigger = no
						# In case something odd has happened
						NOT = {
							trait = homosexual
						}
						is_opposite_sex = ROOT
					}
				}
			}
			event_target:foreigners_host = {
				random_courtier = {
					limit = {
						is_landed = no
						is_inaccessible_or_incapable_trigger = no
						is_married = no
						is_consort = no
						num_of_consorts = 0
						any_lover = {
							character = ROOT
						}
						is_betrothed = no
						is_ascetic_trigger = no
						# In case something odd has happened
						NOT = {
							trait = homosexual
						}
						is_opposite_sex = ROOT
					}
					preferred_limit = {
						NOT = {
							num_of_lovers = 2
						}
					}
					save_event_target_as = foreigners_choice
				}
				character_event = { id = japan.605 } # Host approached about marriage
			}
		}
		else_if = {
			limit = {
				event_target:foreigners_host = {
					any_courtier = {
						is_adult = yes
						is_landed = no
						is_inaccessible_or_incapable_trigger = no
						is_married = no
						is_consort = no
						num_of_consorts = 0
						any_friend = {
							character = ROOT
						}
						is_betrothed = no
						is_ascetic_trigger = no
						# In case something odd has happened
						NOT = {
							trait = homosexual
						}
						is_opposite_sex = ROOT
					}
				}
			}
			event_target:foreigners_host = {
				random_courtier = {
					limit = {
						is_adult = yes
						is_landed = no
						is_inaccessible_or_incapable_trigger = no
						is_married = no
						is_consort = no
						num_of_consorts = 0
						any_friend = {
							character = ROOT
						}
						is_betrothed = no
						is_ascetic_trigger = no
						# In case something odd has happened
						NOT = {
							trait = homosexual
						}
						is_opposite_sex = ROOT
					}
					preferred_limit = {
						NOT = {
							num_of_lovers = 1
						}
					}
					save_event_target_as = foreigners_choice
				}
				character_event = { id = japan.605 } # Host approached about marriage
			}
		}
		else = {
			character_event = { id = japan.606 } # Host approached about marriage
		}
	}
}

# Request is made - has a preference
character_event = {
	id = japan.605
	desc = EVTDESC_JAPAN_605
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		# Figure out a dynastic option
		if = {
			limit = {
				event_target:foreigners_choice = {
					NOT = {
						dynasty = ROOT
					}
				}
			}
			random_courtier = {
				limit = {
					dynasty = ROOT
					is_adult = yes
					is_landed = no
					is_inaccessible_or_incapable_trigger = no
					is_married = no
					is_consort = no
					num_of_consorts = 0
					NOT = {
						any_rival = {
							character = FROM
						}
					}
					is_betrothed = no
					is_ascetic_trigger = no
					# In case something odd has happened
					NOT = {
						trait = homosexual
					}
					is_opposite_sex = ROOT
				}
				preferred_limit = {
					any_lover = {
						character = FROM
					}
				}
				preferred_limit = {
					any_friend = {
						character = FROM
					}
				}
				preferred_limit = {
					NOT = {
						num_of_lovers = 1
					}
				}
				save_event_target_as = dynastic_choice
			}
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_605 # Sure!
		
		if = {
			limit = {
				FROM = {
					is_female = no
				}
			}
			FROM = {
				add_spouse = event_target:foreigners_choice
			}
		}
		else = {
			FROM = {
				add_spouse_matrilineal = event_target:foreigners_choice
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = humble
			}
			modifier = {
				factor = 0
				trait = proud
			}
			modifier = {
				factor = 0
				any_rival = {
					character = FROM
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_605 # I have a better choice; my kins(wo)man!
		
		if = {
			limit = {
				FROM = {
					is_female = no
				}
			}
			FROM = {
				add_spouse = event_target:dynastic_choice
			}
		}
		else = {
			FROM = {
				add_spouse_matrilineal = event_target:dynastic_choice
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					trait = humble
				}
			}
			modifier = {
				factor = 0
				any_rival = {
					character = FROM
				}
			}
		}
	}
	
	option = {
		name = EVTOPTC_JAPAN_605 # I can find a commoner for you...
		
		if = {
			limit = {
				FROM = {
					is_female = no
				}
			}
			create_character = {
				age = 25
				female = yes
				dynasty = none
				culture = ROOT
				religion = ROOT
				random_traits = yes
			}
			new_character = {
				add_spouse = FROM
			}
		}
		else = {
			create_character = {
				age = 25
				female = no
				dynasty = none
				culture = ROOT
				religion = ROOT
				random_traits = yes
			}
			new_character = {
				add_spouse_matrilineal = FROM
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.01
				NOT = {
					trait = proud
				}
			}
			modifier = {
				factor = 0
				any_rival = {
					character = FROM
				}
			}
		}
	}
	
	option = {
		name = EVTOPTD_JAPAN_605 # You don't deserve a spouse!
		
		add_rival = FROM
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOR = {
					trait = cruel
					any_rival = {
						character = FROM
					}
				}
			}
		}
	}
}

# Request is made - general
character_event = {
	id = japan.606
	desc = EVTDESC_JAPAN_606
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		# Figure out a non-dynastic option
		random_courtier = {
			limit = {
				NOT = {
					dynasty = ROOT
				}
				is_adult = yes
				is_landed = no
				is_inaccessible_or_incapable_trigger = no
				is_married = no
				is_consort = no
				num_of_consorts = 0
				NOT = {
					any_rival = {
						character = FROM
					}
				}
				is_betrothed = no
				is_ascetic_trigger = no
				# In case something odd has happened
				NOT = {
					trait = homosexual
				}
				is_opposite_sex = ROOT
			}
			preferred_limit = {
				any_lover = {
					character = FROM
				}
			}
			preferred_limit = {
				any_friend = {
					character = FROM
				}
			}
			preferred_limit = {
				NOT = {
					num_of_lovers = 1
				}
			}
			save_event_target_as = non_dynastic_choice
		}
		
		# Figure out a dynastic option
		random_courtier = {
			limit = {
				dynasty = ROOT
				is_adult = yes
				is_landed = no
				is_inaccessible_or_incapable_trigger = no
				is_married = no
				is_consort = no
				num_of_consorts = 0
				NOT = {
					any_rival = {
						character = FROM
					}
				}
				is_betrothed = no
				is_ascetic_trigger = no
				# In case something odd has happened
				NOT = {
					trait = homosexual
				}
				is_opposite_sex = ROOT
			}
			preferred_limit = {
				any_lover = {
					character = FROM
				}
			}
			preferred_limit = {
				any_friend = {
					character = FROM
				}
			}
			preferred_limit = {
				NOT = {
					num_of_lovers = 1
				}
			}
			save_event_target_as = dynastic_choice
		}
	}
	
	option = {
		name = EVTOPTA_JAPAN_606 # I have a non-dynastic choice in mind!
		
		if = {
			limit = {
				FROM = {
					is_female = no
				}
			}
			FROM = {
				add_spouse = event_target:non_dynastic_choice
			}
		}
		else = {
			FROM = {
				add_spouse_matrilineal = event_target:non_dynastic_choice
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = humble
			}
			modifier = {
				factor = 0
				trait = proud
			}
			modifier = {
				factor = 0
				any_rival = {
					character = FROM
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_JAPAN_606 # I have a kins(wo)man in mind!
		
		if = {
			limit = {
				FROM = {
					is_female = no
				}
			}
			FROM = {
				add_spouse = event_target:dynastic_choice
			}
		}
		else = {
			FROM = {
				add_spouse_matrilineal = event_target:dynastic_choice
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					trait = humble
				}
			}
			modifier = {
				factor = 0
				any_rival = {
					character = FROM
				}
			}
		}
	}
	
	option = {
		name = EVTOPTC_JAPAN_606 # I can find a commoner for you...
		
		if = {
			limit = {
				FROM = {
					is_female = no
				}
			}
			create_character = {
				age = 25
				female = yes
				dynasty = none
				culture = ROOT
				religion = ROOT
				random_traits = yes
			}
			new_character = {
				add_spouse = FROM
			}
		}
		else = {
			create_character = {
				age = 25
				female = no
				dynasty = none
				culture = ROOT
				religion = ROOT
				random_traits = yes
			}
			new_character = {
				add_spouse_matrilineal = FROM
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.01
				NOT = {
					trait = proud
				}
			}
			modifier = {
				factor = 0
				any_rival = {
					character = FROM
				}
			}
		}
	}
	
	option = {
		name = EVTOPTD_JAPAN_606 # You don't deserve a spouse!
		
		add_rival = FROM
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOR = {
					trait = cruel
					any_rival = {
						character = FROM
					}
				}
			}
		}
	}
}

# Regent inheritance
character_event = {
	id = japan.607
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	
	trigger = {
		OR = {
			has_character_flag = i_am_japanese_regent
			has_character_flag = i_am_japanese_regent2
		}
	}
	
	immediate = {
		log = "Regency inheritance!"
		if = {
			limit = {
				OR = {
					liege = {
						religion = shinto
						OR = {
							controls_religion = yes
							has_character_flag = temporarily_japanese_imperial
						}
					}
					liege_before_war = {
						religion = shinto
						OR = {
							controls_religion = yes
							has_character_flag = temporarily_japanese_imperial
						}
					}
				}
				has_character_flag = i_am_japanese_regent
			}
			add_trait = japanese_regent
			clr_character_flag = i_am_japanese_regent
			if = {
				limit = {
					liege = {
						religion = shinto
						OR = {
							controls_religion = yes
							has_character_flag = temporarily_japanese_imperial
						}
					}
				}
				liege = {
					regent = {
						log = "[This.GetBestName] is the initial Regent!"
						remove_title = title_regent
					}
				}
				log = "[This.GetBestName] is the new Regent!"
				give_minor_title = title_regent
				give_minor_title = title_appointed_regent
			}
			log = "[This.GetBestName] is the new Regent!"
		}
		else_if = {
			limit = {
				OR = {
					liege = {
						real_tier = emperor
					}
					liege_before_war = {
						real_tier = emperor
					}
				}
				has_character_flag = i_am_japanese_regent2
			}
			add_trait = japanese_regent2
			clr_character_flag = i_am_japanese_regent2
			if = {
				limit = {
					liege = {
						real_tier = emperor
					}
				}
				liege = {
					regent = {
						log = "[This.GetBestName] is the initial Regent!"
						remove_title = title_regent
					}
				}
				give_minor_title = title_regent
				give_minor_title = title_appointed_regent
			}
			log = "[This.GetBestName] is the new Regent!"
		}
		else = {
			clr_character_flag = i_am_japanese_regent
			clr_character_flag = i_am_japanese_regent2
			log = "[This.GetBestName] is not the new Regent!"
			give_minor_title = title_regent
		}
	}
}

# Saio/Saiin marriage failsafe on_marriage
character_event = {
	id = japan.608
	hide_window = yes
	
	is_triggered_only = yes
	
	religion = shinto
	
	only_women = yes
	only_rulers = yes
	
	trigger = {
		trait = imperial_priestess
	}
	
	immediate = {
		if = {
			limit = {
				tier = baron
				k_chrysanthemum_throne = {
					has_holder = yes
				}
			}
			k_chrysanthemum_throne = {
				holder_scope = {
					ROOT = {
						any_demesne_title = {
							grant_title = PREVPREV
						}
						move_character = PREV
						clr_character_flag = i_am_saio
						clr_character_flag = i_am_saiin
						clr_character_flag = ai_flag_refuse_marriage
						remove_trait = imperial_priestess
					}
				}
			}
		}
		else = {
			clr_character_flag = i_am_saio
			clr_character_flag = i_am_saiin
			clr_character_flag = ai_flag_refuse_marriage
			remove_trait = imperial_priestess
		}
	}
}

# Extra check for succession law
character_event = {
	id = japan.609
	hide_window = yes
	
	is_triggered_only = yes
	
	religion = shinto
	only_playable = yes

	trigger = {
		OR = {
			controls_religion = yes
			has_character_flag = temporarily_japanese_imperial
		}
		OR = {
			primary_title = {
				NOT = {
					has_law = tenno
				}
			}
			k_chrysanthemum_throne = {
				NOT = {
					has_law = tenno
				}
			}
		}
	}
	
	immediate = {
		primary_title = {
			add_law = tenno
		}
		k_chrysanthemum_throne = {
			add_law = tenno
		}
	}
}

# Extra usurpation handling for japanese_regent
character_event = {
	id = japan.610
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		FROMFROM = {
			trait = japanese_regent
			liege = {
				character = ROOT
			}
		}
		liege = {
			religion = shinto
			controls_religion = yes
			trait = under_regency
		}
		NOT = {
			has_landed_title = k_chrysanthemum_throne
		}
		OR = {
			religion = shinto
			AND = {
				culture_group = japonic
				religion = buddhist
			}
		}
	}
	
	immediate = {
		FROMFROM = {
			remove_trait = japanese_regent
		}
		add_trait = japanese_regent
		if = {
			regent = {
				log = "[This.GetBestName] is the initial Regent!"
				remove_title = title_regent
			}
		}
		log = "[This.GetBestName] is the new Regent!"
		give_minor_title = title_regent
		give_minor_title = title_appointed_regent
	}
}

# Extra usurpation handling for japanese_regent2
character_event = {
	id = japan.611
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		FROMFROM = {
			trait = japanese_regent2
			liege = {
				character = ROOT
			}
		}
		liege = {
			OR = {
				AND = {
					religion = shinto
					controls_religion = no
				}
				AND = {
					culture_group = japonic
					religion = buddhist
				}
			}
			trait = under_regency2
		}
		NOT = {
			has_landed_title = k_chrysanthemum_throne
		}
		OR = {
			religion = shinto
			AND = {
				culture_group = japonic
				religion = buddhist
			}
		}
	}
	
	immediate = {
		FROMFROM = {
			remove_trait = japanese_regent2
		}
		add_trait = japanese_regent2
		if = {
			regent = {
				log = "[This.GetBestName] is the initial Regent!"
				remove_title = title_regent
			}
		}
		log = "[This.GetBestName] is the new Regent!"
		give_minor_title = title_regent
		give_minor_title = title_appointed_regent
	}
}