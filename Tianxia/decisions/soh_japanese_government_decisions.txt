decisions = {
	japanese_government_0 = { # Confucian Bureaucracy
		only_playable = yes
		ai = no # The AI won't do it, so it doesn't need to see it
		potential = {
			is_feudal = yes
			#OR = {
			#	religion = shinto
			#	AND = {
			#		religion = buddhist
			#		culture_group = japonic
			#	}
			#}
			controls_religion = no # The Tenno has his own government
			NOT = {
				is_government_potential = chinese_imperial_government # If we could be Chinese Imperial, that takes precedence
			}
			OR = {
				government = japanese_feudal_government
				government = japanese_monastic_feudal_government
			}
		}
		allow = {
			war = no
			is_inaccessible_or_incapable_trigger = no
			has_regent = no
			is_adult = yes
		}
		effect = {
			hidden_tooltip = {
				remove_trait = japanese_feudal_trait
				remove_trait = japanese_monastic_trait
			}
			character_event = { id = japan.8 }
		}
		ai_will_do = {
			factor = 0 # Going Bureaucratic will restrict your options
		}
	}
	
	japanese_government_1 = { # Japanese Feudal
		only_playable = yes
		ai_check_interval = 120
		is_high_prio = yes
		potential = {
			is_feudal = yes
			OR = {
				religion = shinto
				AND = {
					religion = buddhist
					culture_group = japonic
				}
			}
			controls_religion = no # The Tenno has his own government
			NOT = {
				is_government_potential = chinese_imperial_government # If we could be Chinese Imperial, that takes precedence
			}
			NOT = {
				trait = japanese_feudal_trait
			}
		}
		allow = {
			war = no
			is_inaccessible_or_incapable_trigger = no
			has_regent = no
			is_adult = yes
			OR = {
				independent = yes
				NOT = {
					any_liege = {
						OR = {
							government = chinese_imperial_government
							government = japanese_imperial_government
							government = chinese_vassal_government
						}
					}
					prestige = 500
				}
				AND = {
					NOT = {
						any_liege = {
							government = chinese_imperial_government
						}
					}
					any_liege = {
						OR = {
							government = japanese_imperial_government
							government = chinese_vassal_government
						}
						ROOT = {
							vassals_can_change_to_japanese_feudal_trigger = yes
						}
					}
				}
			}
		}
		effect = {
			if = {
				limit = {
					NOT = {
						government = japanese_monastic_feudal_government
					}
				}
				if = {
					limit = {
						OR = {
							liege = {
								OR = {
									government = japanese_feudal_government
									government = japanese_monastic_feudal_government
								}
							}
							any_owned_bloodline = {
								has_bloodline_flag = bloodline_japanese_feudal
								bloodline_is_active_for = ROOT
							}
							independent = yes
						}
					}
					prestige = -500
				}
				else_if = {
					limit = {
						NOT = {
							any_liege = {
								OR = {
									government = japanese_imperial_government
									government = chinese_vassal_government
								}
								NOR = {
									has_regent = yes
									is_inaccessible_or_incapable_trigger = yes
								}
							}
						}
					}
					prestige = -1000
				}
				prestige = -2500
			}
			hidden_tooltip = {
				add_trait = japanese_feudal_trait
				remove_trait = japanese_monastic_trait
			}
			character_event = { id = japan.8 }
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.01
				always = yes # Slow it down
			}
			modifier = {
				factor = 0
				trait = japanese_monastic_trait # If you're Japanese Monastic Feudal, keep that as it is less restrictive
			}
		}
	}
	
	japanese_government_2 = { # Japanese Monastic Feudal
		only_playable = yes
		ai_check_interval = 120
		is_high_prio = yes
		potential = {
			is_feudal = yes
			religion = shinto
			controls_religion = no # The Tenno has his own government
			NOT = {
				is_government_potential = chinese_imperial_government # If we could be Chinese Imperial, that takes precedence
			}
			NOT = {
				trait = japanese_monastic_trait
			}
		}
		allow = {
			war = no
			is_inaccessible_or_incapable_trigger = no
			has_regent = no
			is_adult = yes
			can_become_japanese_monastic_feudal_trigger = yes
		}
		effect = {
			if = {
				limit = {
					capital_scope = {
						religion = shinto
						county = {
							OR = {
								any_direct_de_jure_vassal_title = {
									is_holy_site = shinto
								}
								is_holy_site = shinto
							}
						}
						culture = PREV
					}
					OR = {
						culture_group = japonic
						k_chrysanthemum_throne = {
							holder_scope = {
								culture = PREV
							}
						}
					}
				}
				piety = -2000
			}
			else = {
				piety = -5000
			}
			hidden_tooltip = {
				add_trait = japanese_monastic_trait
				remove_trait = japanese_feudal_trait
			}
			character_event = { id = japan.8 }
		}
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.01
				always = yes # Slow it down
			}
			modifier = {
				factor = 0
				NOT = {
					trait = zealous # We don't want everyone to flip to it just because they have the piety
				}
			}
		}
	}
	
	recreate_japan = { # The Tenno's government prevents empire creation, so this is necessary
		only_playable = yes
		is_high_prio = yes
		only_independent = yes
		ai_check_interval = 12
		potential = {
			controls_religion = yes
			religion = shinto
			independent = yes
			is_tributary = no
			e_japan = {
				has_holder = no
			}
		}
		allow = {
			war = no
			is_inaccessible_or_incapable_trigger = no
			has_actual_regency_trigger = no
			is_adult = yes
			# Controls all of Honshu, Kyushu, and Shikoku
			completely_controls_region = world_japan_south
			completely_controls_region = world_japan_north
		}
		effect = {
			set_character_flag = restoring_japan
			primary_title = {
				e_japan = {
					grant_title = ROOT
					copy_title_laws = PREV
					#copy_title_history = PREV # This could result in undesirable rulers showing up in e_japan's history, so don't do this!
				}
			}
			# Destroy any other empire controlled by ROOT
			any_demesne_title = {
				limit = {
					tier = emperor
					NOT = {
						title = e_japan
					}
				}
				destroy_landed_title = THIS
			}
			clr_character_flag = restoring_japan
		}
	}
	
	take_over_regency = {
		ai_check_interval = 3
		is_high_prio = yes
		only_playable = yes
		potential = {
			trait = japanese_regent
			liege = {
				religion = shinto
				controls_religion = yes
				trait = under_regency
				regent = {
					OR = {
						NOT = {
							trait = japanese_regent
						}
						is_ruler = no
						has_regent = yes
					}
				}
			}
		}
		
		allow = {
			is_inaccessible_or_incapable_trigger = no
			has_actual_regency_trigger = no
			custom_tooltip = {
				text = is_not_busy_trigger_tooltip
				hidden_tooltip = { NOT = { has_character_flag = do_not_disturb } }
			}
		}
		
		effect = {
			liege = {
				regent = {
					remove_trait = japanese_regent
					remove_title = title_regent
				}
			}
			liege = {
				ROOT = {
					give_minor_title = title_regent
					give_minor_title = title_appointed_regent
				}
			}
		}
		
		ai_will_do = {
			factor = 100
		}
	}
	
	take_over_regency2 = {
		ai_check_interval = 3
		is_high_prio = yes
		only_playable = yes
		potential = {
			is_playable = yes
			trait = japanese_regent2
			liege = {
				OR = {
					AND = {
						religion = shinto
						controls_religion = no
					}
					AND = {
						religion = buddhist
						culture_group = japonic
					}
				}
				NOT = {
					government = chinese_imperial_government
				}
				trait = under_regency2
				regent = {
					OR = {
						NOT = {
							trait = japanese_regent2
						}
						is_ruler = no
						has_regent = yes
					}
				}
			}
		}
		
		allow = {
			is_inaccessible_or_incapable_trigger = no
			has_actual_regency_trigger = no
			custom_tooltip = {
				text = is_not_busy_trigger_tooltip
				hidden_tooltip = { NOT = { has_character_flag = do_not_disturb } }
			}
		}
		
		effect = {
			liege = {
				regent = {
					remove_trait = japanese_regent2
					remove_title = title_regent
				}
			}
			liege = {
				ROOT = {
					give_minor_title = title_regent
					give_minor_title = title_appointed_regent
				}
			}
		}
		
		ai_will_do = {
			factor = 100
		}
	}
	
	end_regency_ask_nicely = {
		only_playable = yes
		ai_check_interval = 12
		
		potential = {
			religion = shinto
			controls_religion = yes
			trait = under_regency
			NOT = { trait = incapable }
			OR = {
				NOT = {
					has_character_flag = asked_to_end_regency
					had_character_flag = { flag = asked_to_end_regency days = 1825 }
				}
			}
		}
		
		allow = {
			OR = {
				AND = {
					prestige = 2000
					regent = {
						custom_tooltip = {
							text = has_regency_bloodline
							any_owned_bloodline = {
								has_bloodline_flag = regency_bloodline
								bloodline_is_active_for = PREV
							}
						}
					}
				}
				AND = {
					prestige = 1000
					regent = {
						custom_tooltip = {
							text = has_no_regency_bloodline
							NOT = {
								any_owned_bloodline = {
									has_bloodline_flag = regency_bloodline
									bloodline_is_active_for = PREV
								}
							}
						}
					}
				}
			}
			has_actual_regency_trigger = no
			custom_tooltip = {
				text = is_not_busy_trigger_tooltip
				hidden_tooltip = { NOT = { has_character_flag = do_not_disturb } }
			}
		}
		
		effect = {
			clr_character_flag = asked_to_end_regency
			set_character_flag = asked_to_end_regency
			if = {
				limit = {
					regent = {
						custom_tooltip = {
							text = has_regency_bloodline
							any_owned_bloodline = {
								has_bloodline_flag = regency_bloodline
								bloodline_is_active_for = PREV
							}
						}
					}
				}
				prestige = -2000
			}
			else = {
				prestige = -1000
			}
			if = {
				limit = {
					regent = {
						NOT = {
							higher_tier_than = baron
						}
					}
				}
				remove_trait = under_regency
				any_character = {
					remove_trait = japanese_regent
				}
			}
			else = {
				regent = {
					letter_event = { id = japan.24 }
				}
			}
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOR = {
					regent = {
						NOT = {
							higher_tier_than = baron
						}
					}
					regent = {
						OR = {
							trait = kind
							trait = content
							trait = humble
						}
						NOR = {
							trait = ambitious
							trait = proud
							trait = envious
						}
					}
					regent = {
						NOT = {
							relative_power_to_liege = 0.1
						}
					}
				}
			}
			modifier = {
				factor = 0
				regent = {
					higher_tier_than = baron
				}
				war = yes
			}
			modifier = {
				factor = 0.01
				regent = {
					higher_tier_than = baron
				}
				trait = content
			}
			modifier = {
				factor = 0.2
				regent = {
					higher_tier_than = baron
				}
				OR = {
					trait = dull
					trait = slow
				}
			}
			modifier = {
				factor = 0.2
				regent = {
					higher_tier_than = baron
				}
				trait = kind
			}
			modifier = {
				factor = 0
				regent = {
					higher_tier_than = baron
				}
				regent = {
					reverse_opinion = {
						who = ROOT
						value = 50
					}
				}
				OR = {
					trait = envious
					trait = deceitful
					trait = ambitious
				}			
			}		
			modifier = {
				factor = 0
				regent = {
					higher_tier_than = baron
				}
				regent = {
					reverse_opinion = {
						who = ROOT
						value = 25
					}
				}
				NOT = {
					OR = {
						trait = envious
						trait = deceitful
						trait = ambitious
					}
				}
			}
			modifier = {
				factor = 0.2
				regent = {
					higher_tier_than = baron
				}
				regent = {
					reverse_opinion = {
						who = ROOT
						value = 0
					}
				}
				NOT = {
					OR = {
						trait = envious
						trait = deceitful
						trait = ambitious
					}
				}
			}
			modifier = {
				factor = 0.2
				regent = {
					higher_tier_than = baron
				}
				regent = {
					reverse_opinion = {
						who = ROOT
						value = 25
					}
				}
				OR = {
					trait = envious
					trait = deceitful
					trait = ambitious
				}
			}
			modifier = {
				factor = 1.5
				regent = {
					higher_tier_than = baron
				}
				NOT = {
					regent = {
						reverse_opinion = {
							who = ROOT
							value = -50
						}
					}
				}
			}
			modifier = {
				factor = 1.5
				regent = {
					higher_tier_than = baron
				}
				NOT = {
					regent = {
						reverse_opinion = {
							who = ROOT
							value = -75
						}
					}
				}
			}
			modifier = {
				factor = 1.5
				regent = {
					higher_tier_than = baron
				}
				is_smart_trigger = yes
			}
			modifier = {
				factor = 2.0
				regent = {
					higher_tier_than = baron
				}
				trait = envious
			}
			modifier = {
				factor = 2.0
				regent = {
					higher_tier_than = baron
				}
				trait = deceitful
			}
			modifier = {
				factor = 4.0
				regent = {
					higher_tier_than = baron
				}
				trait = ambitious
			}
			# If we're the top liege, make us more likely to try to depose the regent
			modifier = {
				factor = 2.0
				regent = {
					higher_tier_than = baron
				}
				tier = emperor
			}
			# If the regent is low tier, make us more likely to try to depose the regent
			modifier = {
				factor = 1.5
				regent = {
					higher_tier_than = baron
				}
				regent = {
					NOT = {
						tier = king
					}
				}
			}
			modifier = {
				factor = 1.5
				regent = {
					higher_tier_than = baron
				}
				regent = {
					NOR = {
						tier = king
						tier = duke
					}
				}
			}
			# Make the liege less eager to replace a regent that belongs to a regency bloodline
			modifier = {
				factor = 0.5
				regent = {
					higher_tier_than = baron
				}
				regent = {
					any_owned_bloodline = {
						has_bloodline_flag = regency_bloodline
						bloodline_is_active_for = PREV
					}
				}
			}
		}
	}
	
	become_regent_ask_nicely = {
		only_playable = yes
		is_high_prio = yes
		ai_check_interval = 60
		
		potential = {
			liege = {
				religion = shinto
				controls_religion = yes
				has_regent = no
			}
			NOT = {
				religion = shinto
				controls_religion = yes
			}
			OR = {
				religion = shinto
				AND = {
					religion = buddhist
					culture_group = japonic
				}
			}
			OR = {
				NOT = {
					has_character_flag = asked_for_regency
					had_character_flag = { flag = asked_for_regency days = 1825 }
				}
			}
		}
		
		allow = {
			OR = {
				prestige = 1000
				AND = {
					custom_tooltip = {
						text = has_regency_bloodline
						any_owned_bloodline = {
							has_bloodline_flag = regency_bloodline
							bloodline_is_active_for = PREV
						}
					}
					prestige = 500
				}
			}
			has_actual_regency_trigger = no
			liege = {
				NOR = {
					has_actual_regency_trigger = yes
					trait = under_regency
					war = yes
				}
			}
			OR = {
				is_voter = yes # Safe to use here!
				among_most_powerful_vassals = 7
				custom_tooltip = {
					text = has_regency_bloodline
					any_owned_bloodline = {
						has_bloodline_flag = regency_bloodline
						bloodline_is_active_for = PREV
					}
				}
			}
			custom_tooltip = {
				text = is_not_busy_trigger_tooltip
				hidden_tooltip = { NOT = { has_character_flag = do_not_disturb } }
			}
		}
		
		effect = {
			clr_character_flag = asked_for_regency
			set_character_flag = asked_for_regency
			if = {
				limit = {
					custom_tooltip = {
						text = has_regency_bloodline
						any_owned_bloodline = {
							has_bloodline_flag = regency_bloodline
							bloodline_is_active_for = PREV
						}
					}
				}
				prestige = -500
			}
			else = {
				prestige = -1000
			}
			liege = {
				letter_event = { id = japan.27 }
			}
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				OR = {
					trait = kind
					trait = content
					trait = humble
				}
				NOR = {
					trait = ambitious
					trait = proud
					trait = envious
				}
			}
			modifier = {
				factor = 0
				war = yes
			}
			modifier = {
				factor = 0.01
				trait = content
			}
			modifier = {
				factor = 0.2
				OR = {
					trait = dull
					trait = slow
				}
			}
			modifier = {
				factor = 0.2
				trait = kind
			}
			modifier = {
				factor = 0
				liege = {
					reverse_opinion = {
						who = ROOT
						value = 50
					}
				}
				OR = {
					trait = envious
					trait = deceitful
					trait = ambitious
				}			
			}		
			modifier = {
				factor = 0
				liege = {
					reverse_opinion = {
						who = ROOT
						value = 25
					}
				}
				NOT = {
					OR = {
						trait = envious
						trait = deceitful
						trait = ambitious
					}
				}
			}
			modifier = {
				factor = 0.2
				liege = {
					reverse_opinion = {
						who = ROOT
						value = 0
					}
				}
				NOT = {
					OR = {
						trait = envious
						trait = deceitful
						trait = ambitious
					}
				}
			}
			modifier = {
				factor = 0.2
				liege = {
					reverse_opinion = {
						who = ROOT
						value = 25
					}
				}
				OR = {
					trait = envious
					trait = deceitful
					trait = ambitious
				}
			}
			modifier = {
				factor = 1.5
				NOT = {
					liege = {
						reverse_opinion = {
							who = ROOT
							value = -50
						}
					}
				}
			}
			modifier = {
				factor = 1.5
				NOT = {
					liege = {
						reverse_opinion = {
							who = ROOT
							value = -75
						}
					}
				}
			}
			modifier = {
				factor = 1.5
				is_smart_trigger = yes
			}
			modifier = {
				factor = 2.0
				trait = envious
			}
			modifier = {
				factor = 2.0
				trait = deceitful
			}
			modifier = {
				factor = 4.0
				trait = ambitious
			}
			# If our liege is only king-tier, make us more likely to act
			modifier = {
				factor = 2.0
				liege = {
					tier = king
				}
			}
			# If we're a king, make us more likely to act
			modifier = {
				factor = 2
				tier = king
			}
		}
	}
	
	overthrow_my_regent_decision = {
		only_playable = yes
		is_high_prio = yes
		ai_check_interval = 3
		
		potential = {
			religion = shinto
			controls_religion = yes
			trait = under_regency
			NOT = { has_character_flag = overthrow_my_regent_decision_taken }
		}
		allow = {
			war = no
			has_actual_regency_trigger = no
			# We've got a good amount of prestige; this hopefully prevents weak historical regents from being overthrown in an instant
			OR = {
				AND = {
					prestige = 2000
					regent = {
						custom_tooltip = {
							text = has_regency_bloodline
							any_owned_bloodline = {
								has_bloodline_flag = regency_bloodline
								bloodline_is_active_for = PREV
							}
						}
					}
				}
				AND = {
					prestige = 1000
					regent = {
						custom_tooltip = {
							text = has_no_regency_bloodline
							NOT = {
								any_owned_bloodline = {
									has_bloodline_flag = regency_bloodline
									bloodline_is_active_for = PREV
								}
							}
						}
					}
				}
			}
			will_liege_enforce_peace = no
			has_liege_enforced_peace = no
			NOT = {
				regent = {
					reverse_has_truce = ROOT
				}
			}
			regent = {
				is_landed = yes
				trait = japanese_regent
				NOT = {
					trait = treasure_fleet_preparation
				}
			}
			custom_tooltip = {
				text = is_not_busy_trigger_tooltip
				hidden_tooltip = { NOT = { has_character_flag = do_not_disturb } }
			}
			NOT = {
				trait = treasure_fleet_preparation
			}
		}
		effect = {
			set_character_flag = overthrow_my_regent_decision_taken
			if = {
				limit = {
					regent = {
						custom_tooltip = {
							text = has_regency_bloodline
							any_owned_bloodline = {
								has_bloodline_flag = regency_bloodline
								bloodline_is_active_for = PREV
							}
						}
					}
				}
				prestige = -2000
			}
			else = {
				prestige = -1000
			}
			if = {
				limit = {
					regent = {
						NOT = {
							leads_faction = faction_regent_loyalists
						}
					}
				}
				regent = {
					letter_event = { id = japan.58 } # Non-faction version
				}
			}
			else = {
				regent = {
					letter_event = { id = japan.61 } # Faction version
				}
			}
		}
		ai_will_do = {
			factor = 1
			
			# Reversed faction ultimatum logic, plus relative_power_to_liege checks if there isn't a faction
			modifier = {
				factor = 0.1
				OR = {
					regent = { 
						faction_power = {
							faction = faction_regent_loyalists
							power = 0.75
						}
					}
					regent = {
						relative_power_to_liege = 0.75
					}
				}
			}
			
			modifier = {
				factor = 0.1
				OR = {
					regent = { 
						faction_power = {
							faction = faction_regent_loyalists
							power = 1.0
						}
					}
					regent = {
						relative_power_to_liege = 1.0
					}
				}
			}	

			modifier = {
				factor = 0
				OR = {
					regent = { 
						faction_power = {
							faction = faction_regent_loyalists
							power = 1.5
						}
					}
					regent = {
						relative_power_to_liege = 1.5
					}
				}
			}
			
			modifier = { # If the liege is already fighting a regency war, slow it down to avoid war spam
				factor = 0.05
				regent = {
					any_war = {
						using_cb = take_over_regency_war
					}
				}
			}
		}
	}
	
	end_regency_ask_nicely_shogun = {
		only_playable = yes
		ai_check_interval = 12
		
		potential = {
			real_tier = emperor
			OR = {
				religion = shinto
				AND = {
					religion = buddhist
					culture_group = japonic
				}
			}
			trait = under_regency2
			NOT = { trait = incapable }
			OR = {
				NOT = {
					has_character_flag = asked_to_end_regency
					had_character_flag = { flag = asked_to_end_regency days = 1825 }
				}
			}
		}
		
		allow = {
			OR = {
				AND = {
					prestige = 2000
					regent = {
						custom_tooltip = {
							text = has_regency_bloodline
							any_owned_bloodline = {
								has_bloodline_flag = regency_bloodline
								bloodline_is_active_for = PREV
							}
						}
					}
				}
				AND = {
					prestige = 1000
					regent = {
						custom_tooltip = {
							text = has_no_regency_bloodline
							NOT = {
								any_owned_bloodline = {
									has_bloodline_flag = regency_bloodline
									bloodline_is_active_for = PREV
								}
							}
						}
					}
				}
			}
			has_actual_regency_trigger = no
			custom_tooltip = {
				text = is_not_busy_trigger_tooltip
				hidden_tooltip = { NOT = { has_character_flag = do_not_disturb } }
			}
		}
		
		effect = {
			clr_character_flag = asked_to_end_regency
			set_character_flag = asked_to_end_regency
			if = {
				limit = {
					regent = {
						custom_tooltip = {
							text = has_regency_bloodline
							any_owned_bloodline = {
								has_bloodline_flag = regency_bloodline
								bloodline_is_active_for = PREV
							}
						}
					}
				}
				prestige = -2000
			}
			else = {
				prestige = -1000
			}
			if = {
				limit = {
					regent = {
						NOT = {
							higher_tier_than = baron
						}
					}
				}
				regent = {
					remove_trait = japanese_regent2
				}
				remove_trait = under_regency2
			}
			else = {
				regent = {
					letter_event = { id = japan.77 }
				}
			}
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOR = {
					regent = {
						NOT = {
							higher_tier_than = baron
						}
					}
					regent = {
						OR = {
							trait = kind
							trait = content
							trait = humble
						}
						NOR = {
							trait = ambitious
							trait = proud
							trait = envious
						}
					}
					regent = {
						NOT = {
							relative_power_to_liege = 0.1
						}
					}
				}
			}
			modifier = {
				factor = 0
				regent = {
					higher_tier_than = baron
				}
				war = yes
			}
			modifier = {
				factor = 0.01
				regent = {
					higher_tier_than = baron
				}
				trait = content
			}
			modifier = {
				factor = 0.2
				regent = {
					higher_tier_than = baron
				}
				OR = {
					trait = dull
					trait = slow
				}
			}
			modifier = {
				factor = 0.2
				regent = {
					higher_tier_than = baron
				}
				trait = kind
			}
			modifier = {
				factor = 0
				regent = {
					higher_tier_than = baron
				}
				regent = {
					reverse_opinion = {
						who = ROOT
						value = 50
					}
				}
				OR = {
					trait = envious
					trait = deceitful
					trait = ambitious
				}			
			}		
			modifier = {
				factor = 0
				regent = {
					higher_tier_than = baron
				}
				regent = {
					reverse_opinion = {
						who = ROOT
						value = 25
					}
				}
				NOT = {
					OR = {
						trait = envious
						trait = deceitful
						trait = ambitious
					}
				}
			}
			modifier = {
				factor = 0.2
				regent = {
					higher_tier_than = baron
				}
				regent = {
					reverse_opinion = {
						who = ROOT
						value = 0
					}
				}
				NOT = {
					OR = {
						trait = envious
						trait = deceitful
						trait = ambitious
					}
				}
			}
			modifier = {
				factor = 0.2
				regent = {
					higher_tier_than = baron
				}
				regent = {
					reverse_opinion = {
						who = ROOT
						value = 25
					}
				}
				OR = {
					trait = envious
					trait = deceitful
					trait = ambitious
				}
			}
			modifier = {
				factor = 1.5
				regent = {
					higher_tier_than = baron
				}
				NOT = {
					regent = {
						reverse_opinion = {
							who = ROOT
							value = -50
						}
					}
				}
			}
			modifier = {
				factor = 1.5
				regent = {
					higher_tier_than = baron
				}
				NOT = {
					regent = {
						reverse_opinion = {
							who = ROOT
							value = -75
						}
					}
				}
			}
			modifier = {
				factor = 1.5
				regent = {
					higher_tier_than = baron
				}
				is_smart_trigger = yes
			}
			modifier = {
				factor = 2.0
				regent = {
					higher_tier_than = baron
				}
				trait = envious
			}
			modifier = {
				factor = 2.0
				regent = {
					higher_tier_than = baron
				}
				trait = deceitful
			}
			modifier = {
				factor = 4.0
				regent = {
					higher_tier_than = baron
				}
				trait = ambitious
			}
			# If we're the top liege, make us more likely to try to depose the regent
			modifier = {
				factor = 2.0
				regent = {
					higher_tier_than = baron
				}
				tier = emperor
			}
			# If the regent is low tier, make us more likely to try to depose the regent
			modifier = {
				factor = 1.5
				regent = {
					higher_tier_than = baron
				}
				regent = {
					NOT = {
						tier = king
					}
				}
			}
			modifier = {
				factor = 1.5
				regent = {
					higher_tier_than = baron
				}
				regent = {
					NOR = {
						tier = king
						tier = duke
					}
				}
			}
			# Make the liege less eager to replace a regent that belongs to a regency bloodline
			modifier = {
				factor = 0.5
				regent = {
					higher_tier_than = baron
				}
				regent = {
					any_owned_bloodline = {
						has_bloodline_flag = regency_bloodline
						bloodline_is_active_for = PREV
					}
				}
			}
		}
	}
	
	become_regent_ask_nicely_shogun = {
		only_playable = yes
		is_high_prio = yes
		ai_check_interval = 60
		
		potential = {
			liege = {
				OR = {
					AND = {
						religion = shinto
						controls_religion = no
					}
					AND = {
						religion = buddhist
						culture_group = japonic
					}
				}
				NOT = {
					government = chinese_imperial_government
				}
				has_regent = no
			}
			# The Tenno can't become the Regent
			NOT = {
				religion = shinto
				controls_religion = yes
			}
			OR = {
				religion = shinto
				AND = {
					religion = buddhist
					culture_group = japonic
				}
			}
			OR = {
				NOT = {
					has_character_flag = asked_for_regency
					had_character_flag = { flag = asked_for_regency days = 1825 }
				}
			}
		}
		
		allow = {
			OR = {
				prestige = 1000
				AND = {
					custom_tooltip = {
						text = has_regency_bloodline
						any_owned_bloodline = {
							has_bloodline_flag = regency_bloodline
							bloodline_is_active_for = PREV
						}
					}
					prestige = 500
				}
			}
			has_actual_regency_trigger = no
			liege = {
				NOR = {
					has_actual_regency_trigger = yes
					trait = under_regency
					war = yes
				}
			}
			OR = {
				is_voter = yes # Safe to use here!
				among_most_powerful_vassals = 7
				custom_tooltip = {
					text = has_regency_bloodline
					any_owned_bloodline = {
						has_bloodline_flag = regency_bloodline
						bloodline_is_active_for = PREV
					}
				}
			}
			custom_tooltip = {
				text = is_not_busy_trigger_tooltip
				hidden_tooltip = { NOT = { has_character_flag = do_not_disturb } }
			}
		}
		
		effect = {
			clr_character_flag = asked_for_regency
			set_character_flag = asked_for_regency
			if = {
				limit = {
					custom_tooltip = {
						text = has_regency_bloodline
						any_owned_bloodline = {
							has_bloodline_flag = regency_bloodline
							bloodline_is_active_for = PREV
						}
					}
				}
				prestige = -500
			}
			else = {
				prestige = -1000
			}
			liege = {
				letter_event = { id = japan.80 }
			}
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				OR = {
					trait = kind
					trait = content
					trait = humble
				}
				NOR = {
					trait = ambitious
					trait = proud
					trait = envious
				}
			}
			modifier = {
				factor = 0
				war = yes
			}
			modifier = {
				factor = 0.01
				trait = content
			}
			modifier = {
				factor = 0.2
				OR = {
					trait = dull
					trait = slow
				}
			}
			modifier = {
				factor = 0.2
				trait = kind
			}
			modifier = {
				factor = 0
				liege = {
					reverse_opinion = {
						who = ROOT
						value = 50
					}
				}
				OR = {
					trait = envious
					trait = deceitful
					trait = ambitious
				}			
			}		
			modifier = {
				factor = 0
				liege = {
					reverse_opinion = {
						who = ROOT
						value = 25
					}
				}
				NOT = {
					OR = {
						trait = envious
						trait = deceitful
						trait = ambitious
					}
				}
			}
			modifier = {
				factor = 0.2
				liege = {
					reverse_opinion = {
						who = ROOT
						value = 0
					}
				}
				NOT = {
					OR = {
						trait = envious
						trait = deceitful
						trait = ambitious
					}
				}
			}
			modifier = {
				factor = 0.2
				liege = {
					reverse_opinion = {
						who = ROOT
						value = 25
					}
				}
				OR = {
					trait = envious
					trait = deceitful
					trait = ambitious
				}
			}
			modifier = {
				factor = 1.5
				NOT = {
					liege = {
						reverse_opinion = {
							who = ROOT
							value = -50
						}
					}
				}
			}
			modifier = {
				factor = 1.5
				NOT = {
					liege = {
						reverse_opinion = {
							who = ROOT
							value = -75
						}
					}
				}
			}
			modifier = {
				factor = 1.5
				is_smart_trigger = yes
			}
			modifier = {
				factor = 2.0
				trait = envious
			}
			modifier = {
				factor = 2.0
				trait = deceitful
			}
			modifier = {
				factor = 4.0
				trait = ambitious
			}
			# If we're a king, make us more likely to act
			modifier = {
				factor = 2
				tier = king
			}
		}
	}
	
	overthrow_my_regent_decision_shogun = {
		only_playable = yes
		is_high_prio = yes
		ai_check_interval = 3
		
		potential = {
			OR = {
				AND = {
					religion = shinto
					controls_religion = no
				}
				AND = {
					religion = buddhist
					culture_group = japonic
				}
			}
			NOT = {
				government = chinese_imperial_government
			}
			trait = under_regency2
			NOT = { has_character_flag = overthrow_my_regent_decision_taken }
		}
		allow = {
			war = no
			has_actual_regency_trigger = no
			# We've got a good amount of prestige; this hopefully prevents weak historical regents from being overthrown in an instant
			OR = {
				AND = {
					prestige = 2000
					regent = {
						custom_tooltip = {
							text = has_regency_bloodline
							any_owned_bloodline = {
								has_bloodline_flag = regency_bloodline
								bloodline_is_active_for = PREV
							}
						}
					}
				}
				AND = {
					prestige = 1000
					regent = {
						custom_tooltip = {
							text = has_no_regency_bloodline
							NOT = {
								any_owned_bloodline = {
									has_bloodline_flag = regency_bloodline
									bloodline_is_active_for = PREV
								}
							}
						}
					}
				}
			}
			NOT = {
				regent = {
					reverse_has_truce = ROOT
				}
			}
			regent = {
				is_landed = yes
				trait = japanese_regent2
				NOT = {
					trait = treasure_fleet_preparation
				}
			}
			custom_tooltip = {
				text = is_not_busy_trigger_tooltip
				hidden_tooltip = { NOT = { has_character_flag = do_not_disturb } }
			}
			NOT = {
				trait = treasure_fleet_preparation
			}
		}
		effect = {
			set_character_flag = overthrow_my_regent_decision_taken
			if = {
				limit = {
					regent = {
						custom_tooltip = {
							text = has_regency_bloodline
							any_owned_bloodline = {
								has_bloodline_flag = regency_bloodline
								bloodline_is_active_for = PREV
							}
						}
					}
				}
				prestige = -2000
			}
			else = {
				prestige = -1000
			}
			if = {
				limit = {
					regent = {
						NOT = {
							leads_faction = faction_regent_loyalists2
						}
					}
				}
				regent = {
					letter_event = { id = japan.97 } # Non-faction version
				}
			}
			else = {
				regent = {
					letter_event = { id = japan.100 } # Faction version
				}
			}
		}
		ai_will_do = {
			factor = 1
			
			# Reversed faction ultimatum logic, plus relative_power_to_liege checks if there isn't a faction
			modifier = {
				factor = 0.1
				OR = {
					regent = { 
						faction_power = {
							faction = faction_regent_loyalists2
							power = 0.75
						}
					}
					regent = {
						relative_power_to_liege = 0.75
					}
				}
			}
			
			modifier = {
				factor = 0.1
				OR = {
					regent = { 
						faction_power = {
							faction = faction_regent_loyalists2
							power = 1.0
						}
					}
					regent = {
						relative_power_to_liege = 1.0
					}
				}
			}	

			modifier = {
				factor = 0
				OR = {
					regent = { 
						faction_power = {
							faction = faction_regent_loyalists2
							power = 1.5
						}
					}
					regent = {
						relative_power_to_liege = 1.5
					}
				}
			}
			
			modifier = { # If the liege is already fighting a regency war, slow it down to avoid war spam
				factor = 0.05
				regent = {
					any_war = {
						using_cb = take_over_regency_war2
					}
				}
			}
		}
	}
	
	meddle_in_succession = {
		only_playable = yes
		is_high_prio = yes
		ai = no # The AI does this on_yearly_pulse
		potential = {
			trait = japanese_regent
			liege = {
				religion = shinto
				controls_religion = yes
				trait = under_regency
				primary_title = {
					has_law = regent_succession_control_1
				}
			}
		}
		allow = {
			has_regent = no
			liege = {
				regent = {
					character = ROOT
				}
				has_actual_regency_trigger = no # We already win if this is the case!
			}
			OR = {
				prestige = 500
				AND = {
					has_character_modifier = meddled_in_succession
					prestige = 100
				}
			}
		}
		effect = {
			if = {
				limit = {
					NOT = {
						has_character_modifier = meddled_in_succession
					}
				}
				prestige = -500
				liege = {
					opinion = {
						who = ROOT
						modifier = opinion_opposing_my_preferred_heir
					}
					current_heir = {
						opinion = {
							who = ROOT
							modifier = opinion_opposing_my_claim
						}
					}
					ROOT = {
						add_character_modifier = {
							modifier = meddled_in_succession
							days = 730
						}
					}
					recalc_succession = yes
					current_heir = {
						opinion = {
							who = ROOT
							modifier = opinion_backing_my_claim
						}
					}
				}
			}
			else = {
				prestige = -100
				remove_character_modifier = meddled_in_succession
				ROOT = {
					add_character_modifier = {
						modifier = meddled_in_succession
						days = 730
					}
				}
			}
			liege = {
				character_event = { id = japan.412 }
			}
		}
		
		ai_will_do = {
			factor = 0 # The AI does this on_yearly_pulse!
		}
	}
	
	nullify_succession_meddling = {
		only_playable = yes
		is_high_prio = yes
		ai = no # The AI does this on_yearly_pulse and on_death
		potential = {
			trait = under_regency
			religion = shinto
			controls_religion = yes
			regent = {
				trait = japanese_regent
				has_character_modifier = meddled_in_succession
			}
			primary_title = {
				has_law = regent_succession_control_1
			}
		}
		allow = {
			has_actual_regency_trigger = no
			prestige = 500
		}
		effect = {
			prestige = -500
			regent = {
				opinion = {
					who = ROOT
					modifier = opinion_opposing_my_preferred_heir
				}
				ROOT = {
					current_heir = {
						opinion = {
							who = ROOT
							modifier = opinion_opposing_my_claim
						}
					}
				}
				remove_character_modifier = meddled_in_succession
				ROOT = {
					recalc_succession = yes
					current_heir = {
						opinion = {
							who = ROOT
							modifier = opinion_backing_my_claim
						}
					}
				}
			}
			regent = {
				character_event = { id = japan.414 }
			}
		}
		
		ai_will_do = {
			factor = 0 # The AI does this on_yearly_pulse and on_death!
		}
	}
	
	increase_lieges_regent_powers = {
		only_playable = yes
		ai_check_interval = 60
		potential = {
			liege = {
				OR = {
					trait = under_regency
					trait = under_regency2
				}
				primary_title = {
					NOT = {
						has_law = regent_succession_control_1
					}
				}
			}
			regent = {
				character = ROOT
			}
			OR = {
				trait = japanese_regent
				trait = japanese_regent2
			}
		}
		
		allow = {
			war = no
			has_actual_regency_trigger = no
			liege = {
				NOT = {
					has_character_modifier = recent_regent_power_change
				}
			}
			prestige = 1000
		}
		
		effect = {
			prestige = -1000
			liege = {
				increase_regent_powers_effect = yes
				character_event = { id = japan.419 }
				add_character_modifier = {
					modifier = recent_regent_power_change
					months = 120
				}
			}
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.01
				always = yes
			}
			modifier = {
				factor = 0
				trait = content
			}
			modifier = {
				factor = 0.1
				trait = humble
			}
			modifier = {
				factor = 0.1
				trait = just
			}
			modifier = {
				factor = 10
				trait = ambitious
			}
			modifier = {
				factor = 5
				trait = envious
			}
			modifier = {
				factor = 2
				trait = proud
			}
			modifier = {
				factor = 5
				trait = deceitful
			}
		}
	}
	
	decrese_my_regents_powers = {
		only_playable = yes
		ai_check_interval = 60
		potential = {
			OR = {
				trait = under_regency
				trait = under_regency2
			}
			primary_title = {
				NOT = {
					has_law = regent_marriage_control_0
				}
			}
			regent = {
				OR = {
					trait = japanese_regent
					trait = japanese_regent2
				}
			}
		}
		
		allow = {
			war = no
			has_actual_regency_trigger = no
			NOT = {
				has_character_modifier = recent_regent_power_change
			}
			prestige = 1000
		}
		
		effect = {
			prestige = -1000
			decrease_regent_powers_effect = yes
			regent = {
				character_event = { id = japan.420 }
			}
			add_character_modifier = {
				modifier = recent_regent_power_change
				months = 120
			}
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.01
				always = yes
			}
			modifier = {
				factor = 0
				trait = content
			}
			modifier = {
				factor = 0.1
				trait = humble
			}
			modifier = {
				factor = 0.1
				trait = just
			}
			modifier = {
				factor = 10
				trait = ambitious
			}
			modifier = {
				factor = 5
				trait = envious
			}
			modifier = {
				factor = 2
				trait = proud
			}
			modifier = {
				factor = 5
				trait = deceitful
			}
		}
	}
	
	regent_transfer_money = {
		only_playable = yes
		ai_check_interval = 60
		potential = {
			liege = {
				OR = {
					trait = under_regency
					trait = under_regency2
				}
				primary_title = {
					has_law = regent_treasury_control_1
				}
			}
			regent = {
				character = ROOT
			}
			OR = {
				trait = japanese_regent
				trait = japanese_regent2
			}
			OR = {
				ai = no
				NOT = {
					wealth = 10000
				}
				trait = greedy
			}
		}
		
		allow = {
			has_actual_regency_trigger = no
			prestige = 250
			liege = {
				NOT = {
					has_opinion_modifier = {
						who = ROOT
						modifier = took_money
					}
				}
			}
			liege = {
				scaled_wealth = {
					value = 1
					min = 25
				}
			}
		}
		
		effect = {
			prestige = -250
			liege = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 1
					min = 25
					max = 1000
				}
				character_event = { id = japan.425 } # Inform the liege
			}
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.01
				always = yes
			}
			modifier = {
				factor = 0
				trait = content
			}
			modifier = {
				factor = 0.1
				trait = humble
			}
			modifier = {
				factor = 0.1
				trait = just
			}
			modifier = {
				factor = 10
				trait = ambitious
			}
			modifier = {
				factor = 5
				trait = envious
			}
			modifier = {
				factor = 2
				trait = proud
			}
			modifier = {
				factor = 5
				trait = deceitful
			}
			modifier = {
				factor = 10
				trait = greedy
			}
			modifier = {
				factor = 0.1
				trait = charitable
			}
		}
	}
	
	integrate_ezo = {
		is_high_prio = yes
		only_playable = yes
		only_independent = yes
		ai_check_interval = 12

		potential = {
			tier = emperor
			has_landed_title = e_japan
			is_alternate_start = no
			NOT = {
				has_global_flag = ezo_integrated
			}
			NOT = {
				k_yezo = {
					de_jure_liege = e_japan
				}
			}
			OR = {
				religion = shinto
				AND = {
					culture_group = japonic
					religion = buddhist
				}
			}
		}

		allow = {
			# We're appropriately Japanese
			OR = {
				religion = shinto
				AND = {
					culture_group = japonic
					religion = buddhist
				}
			}
			
			is_adult = yes
			war = no
			has_regent = no # The stricter version
			prestige = 5000
			wealth = 1000
			is_tributary = no
			
			# We control the kingdom and the initial de jure
			completely_controls = k_yezo
			completely_controls_region = custom_yezo
			completely_controls_region = world_japan # You need the original too!
			
			# The title is unheld or controlled by us or an acceptable vassal
			custom_tooltip = {
				text = ezo_has_no_holder_is_mine_or_belongs_to_a_good_vassal
				OR = {
					k_yezo = {
						has_holder = no
					}
					k_yezo = {
						holder_scope = {
							character = ROOT
						}
					}
					k_yezo = {
						holder_scope = {
							OR = {
								religion = shinto
								AND = {
									culture_group = japonic
									religion = buddhist
								}
							}
							war = no
							liege = {
								character = ROOT
							}
						}
					}
				}
			}
			
			# We have a relevant government that's not Chinese Imperial or CVG
			OR = {
				government = japanese_imperial_government
				government = japanese_feudal_government
				government = japanese_monastic_feudal_government
			}
			
			# The de jure liege doesn't exist
			k_yezo = {
				dejure_liege_title = {
					has_holder = no
				}
			}
		}

		effect = {
			wealth = -1000

			set_global_flag = ezo_integrated
			
			k_yezo = {
				show_scope_change = no
				de_jure_liege = e_japan
			}
		}
	}
	
	integrate_ryukyu = {
		is_high_prio = yes
		only_playable = yes
		only_independent = yes
		ai_check_interval = 12

		potential = {
			tier = emperor
			has_landed_title = e_japan
			is_alternate_start = no
			NOT = {
				has_global_flag = ryukyu_integrated
			}
			NOT = {
				k_ryukyu = {
					de_jure_liege = e_japan
				}
			}
			OR = {
				religion = shinto
				AND = {
					culture_group = japonic
					religion = buddhist
				}
			}
		}

		allow = {
			# We're appropriately Japanese
			OR = {
				religion = shinto
				AND = {
					culture_group = japonic
					religion = buddhist
				}
			}
			
			is_adult = yes
			war = no
			has_regent = no # The stricter version
			prestige = 5000
			wealth = 1000
			is_tributary = no
			
			# We control the kingdom and the initial de jure
			completely_controls = k_ryukyu
			completely_controls_region = world_japan_islands
			completely_controls_region = world_japan # You need the original too!
			
			# The title is unheld or controlled by us or an acceptable vassal
			custom_tooltip = {
				text = ryukyu_has_no_holder_is_mine_or_belongs_to_a_good_vassal
				OR = {
					k_ryukyu = {
						has_holder = no
					}
					k_ryukyu = {
						holder_scope = {
							character = ROOT
						}
					}
					k_ryukyu = {
						holder_scope = {
							OR = {
								religion = shinto
								AND = {
									culture_group = japonic
									religion = buddhist
								}
							}
							war = no
							liege = {
								character = ROOT
							}
						}
					}
				}
			}
			
			# We have a relevant government that's not Chinese Imperial or CVG
			OR = {
				government = japanese_imperial_government
				government = japanese_feudal_government
				government = japanese_monastic_feudal_government
			}
			
			# The de jure liege doesn't exist
			k_ryukyu = {
				dejure_liege_title = {
					has_holder = no
				}
			}
		}

		effect = {
			wealth = -1000

			set_global_flag = ryukyu_integrated
			
			k_ryukyu = {
				show_scope_change = no
				de_jure_liege = e_japan
			}
		}
	}
}

targeted_decisions = {
	regent_get_vassal_from_liege = {
		filter = realm
		ai_target_filter = realm
		ai_check_interval = 60
		only_playable = yes
		
		potential = {
			OR = {
				AND = {
					tier = count
					FROM = {
						NOT = {
							tier = count
						}
					}
				}
				AND = {
					tier = duke
					FROM = {
						tier = king
					}
				}
			}
			liege = {
				religion = shinto
				controls_religion = yes
				trait = under_regency
				independent = yes # If there is a Shogun, don't let the Regent meddle as much
			}
		}
		
		from_potential = {
			trait = japanese_regent
			has_minor_title = title_regent
			liege = {
				religion = shinto
				controls_religion = yes
				trait = under_regency
				independent = yes # If there is a Shogun, don't let the Regent meddle as much
				primary_title = {
					has_law = regent_vassal_control_1
				}
			}
			has_regent = no # Should be impossible if you have the "Regent" minor title, but best to be certain
		}
		
		allow = {
			OR = {
				AND = {
					tier = count
					FROM = {
						prestige = 500
					}
				}
				AND = {
					tier = duke
					FROM = {
						prestige = 1000
					}
				}
			}
			FROM = {
				liege = {
					NOT = {
						has_opinion_modifier = {
							who = FROM
							modifier = took_a_vassal
						}
					}
					war = no
				}
				war = no
			}
			war = no
		}
		
		effect = {
			if = {
				limit = {
					tier = count
				}
				FROM = {
					prestige = -500
				}
			}
			else_if = {
				limit = {
					tier = duke
				}
				FROM = {
					prestige = -1000
				}
			}
			set_defacto_liege = FROM
			FROM = {
				liege = {
					letter_event = { id = japan.40 }
				}
			}
			letter_event = { id = japan.41 }
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.01
				always = yes # Slow it down!
			}
			modifier = {
				factor = 0
				FROM = {
					trait = content
				}
			}
			# Don't make us too likely to try this
			modifier = {
				factor = 0
				FROM = {
					NOR = {
						trait = ambitious
						trait = envious
						trait = proud
						liege = {
							OR = {
								NOT = {
									reverse_opinion = {
										who = FROM
										value = -25
									}
								}
								any_rival = {
									character = FROM
								}
							}
						}
						ROOT = {
							de_jure_liege = FROM
						}
					}
				}
			}
			# If we don't have a lot of prestige, don't bother
			modifier = {
				factor = 0.1
				OR = {
					AND = {
						tier = count
						FROM = {
							NOT = {
								prestige = 1000
							}
						}
					}
					AND = {
						tier = duke
						FROM = {
							NOT = {
								prestige = 2000
							}
						}
					}
				}
			}
			modifier = {
				factor = 5
				FROM = {
					trait = ambitious
				}
			}
			modifier = {
				factor = 2
				FROM = {
					trait = envious
				}
			}
			modifier = {
				factor = 2
				FROM = {
					trait = proud
				}
			}
			modifier = {
				factor = 2
				FROM = {
					trait = greedy
				}
			}
			modifier = {
				factor = 2
				FROM = {
					trait = deceitful
				}
			}
			modifier = {
				factor = 0.1
				tier = duke
				FROM = {
					NOT = {
						trait = ambitious
					}
				}
			}
			modifier = {
				factor = 0.5
				tier = count
				FROM = {
					NOT = {
						trait = ambitious
					}
				}
			}
		}
	}
	
	regent_marry_liege_to_my_dynasty = {
		filter = liege
		ai_target_filter = liege
		third_party_filter = dynasty
		ai_third_party_filter = dynasty
		third_party = FROM
		ai_check_interval = 60
		only_playable = yes
		
		potential = {
			# Our liege is the Tenno, is an adult, and has a Permanent Regency
			is_adult = yes
			is_female = no
			religion = shinto
			controls_religion = yes
			trait = under_regency
			# The current spouse can't be the mother of the heir
			current_heir = {
				NAND = {
					dynasty = ROOT
					father = {
						character = ROOT
					}
					mother = {
						spouse = {
							character = ROOT
						}
					}
				}
			}
			spouse = {
				NOR = {
					# Spouse must not be (known to be) pregnant
					trait = pregnant
					trait = hard_pregnancy
					trait = troubled_pregnancy
					trait = pregnancy_finishing
					# If the Tenno loves their spouse, they'll probably care more (particularly if a player), so let's just forbid ending that...
					any_lover = {
						character = ROOT
					}
					dynasty = FROM # If we've already done this, don't do it again!
					is_playable = yes # A playable spouse probably has enough power to oppose it
				}
			}
			NOT = {
				dynasty = FROM # No need for marriage ties
			}
		}
		
		from_potential = {
			trait = japanese_regent
			has_minor_title = title_regent
			liege = {
				religion = shinto
				controls_religion = yes
				trait = under_regency
				primary_title = {
					has_law = regent_marriage_control_1
				}
			}
			has_regent = no # Should be impossible if you have the "Regent" minor title, but best to be certain
		}
		
		allow = {
			NOT = {
				has_opinion_modifier = {
					who = FROM
					modifier = changed_my_spouse
				}
			}
			FROM = {
				prestige = 500
			}
		}
		
		third_party_potential = {
			show_only_failed_conditions = yes
			FROMFROM = {
				show_scope_change = no
				is_female = yes
				has_negative_congenital_trigger = no
				OR = {
					# Already a consort of the Tenno
					AND = {
						any_consort = {
							character = ROOT
						}
						NOT = {
							any_lover = {
								NOT = {
									character = ROOT
								}
							}
						}
					}
					# Subset of is_virgin_trigger; blocking Lustful is a bit too harsh...
					AND = {
						NOR = {
							any_lover = { always = yes }
							any_child_even_if_dead = { always = yes }
							any_spouse_even_if_dead = { always = yes }
							any_consort = { always = yes } # This is missing in vanilla but should probably be here...
							has_focus = focus_seduction
							trait = pregnant
							trait = hard_pregnancy # This is missing in vanilla but should probably be here...
							trait = troubled_pregnancy # This is missing in vanilla but should probably be here...
							trait = pregnancy_finishing # This is missing in vanilla but should probably be here...
							#trait = lustful
							trait = hedonist
							trait = seducer
							trait = seductress
							trait = lovers_pox
							trait = has_aztec_disease
							trait = syphilitic
							has_character_modifier = incestuous_adulteress
							has_character_modifier = adulteress
							has_character_modifier = cradle_robber
							has_character_modifier = adulterous_priest
						}
						OR = {
							NOT = { age = 25 }
							trait = celibate
							trait = chaste
							trait = shy
							is_ascetic_trigger = yes
						}
					}
				}
				# Close relative of yours
				custom_tooltip = {
					text = is_close_relative_or_same_dynasty_tt
					OR = {
						is_close_relative = ROOT_FROM
						dynasty = ROOT_FROM
					}
				}
				#custom_tooltip = {
					#text = is_adult_under_35_tt
					is_adult = yes
					NOT = { age = 35 } # Needs to be of childbearing age, with a decent margin
					ROOT = {
						spouse = {
							is_older_than = FROMFROM # Needs to be younger than the Tenno's spouse to be an attractive match
						}
					}
				#}
				NOT = { is_landed = yes }
				NOT = { is_ruler = yes }
				NOT = { is_heir = yes }
				# Either in our court or a concubine of the Tenno
				OR = {
					employer = {
						character = ROOT_FROM
					}
					any_consort = {
						character = ROOT
					}
				}
				custom_tooltip = {
					text = is_not_incapable_inbred_or_imbecile_tt
					NOT = { trait = incapable }
					NOT = { trait = inbred }
					NOT = { trait = imbecile }
				}
				custom_tooltip = {
					text = is_not_maimed_or_infirm_tt
					NOT = { trait = maimed }
					NOT = { trait = infirm }
				}
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				custom_tooltip = {
					text = is_not_one_eyed_handed_legged_disfigured_or_mangled_tt
					NOT = { trait = one_eyed }
					NOT = { trait = one_handed }
					NOT = { trait = one_legged }
					NOT = { trait = disfigured }
					NOT = { trait = mangled }
				}
				OR = {
					NOT = { prisoner = yes }
					host = {
						character = ROOT_FROM
					}
				}
				# If there would be no children the marriage is useless
				custom_tooltip = {
					text = is_not_ascetic_or_celibate_tt
					NOT = { is_ascetic_trigger = yes }
					NOT = { trait = celibate }
				}
				# Don't marry off our lovers or someone that's pregnant
				NOR = {
					trait = pregnant # Known to be pregnant
					trait = hard_pregnancy
					trait = troubled_pregnancy
					trait = pregnancy_finishing
					any_lover = {
						character = ROOT_FROM
					}
				}
			}
		}
		
		third_party_allow = {
			show_only_failed_conditions = yes
			FROMFROM = {
				is_ill = no
				is_inaccessible_or_incapable_trigger = no
			}
		}
		
		effect = {
			FROM = {
				prestige = -500
			}
			letter_event = { id = japan.42 } # Inform the liege and carry things out
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.5
				always = yes
			}
			modifier = {
				factor = 0.01
				spouse = {
					OR = {
						# We like the spouse
						reverse_opinion = {
							who = FROM
							value = 50
						}
						any_friend = {
							character = FROM
						}
						any_lover = {
							character = FROM
						}
					}
				}
				FROM = {
					NOR = {
						trait = deceitful
						trait = ambitious
					}
				}
			}
			modifier = {
				factor = 5
				FROM = {
					trait = ambitious
				}
			}
			modifier = {
				factor = 0
				FROM = {
					trait = content
				}
			}
			modifier = {
				factor = 0
				trait = celibate # Unlikely to have an effect...
			}
		}
	}
	
	shogun_get_vassal_from_tenno = {
		only_playable = yes
		only_independent = yes
		filter = realm
		ai_target_filter = realm
		ai_check_interval = 60
		
		potential = {
			OR = {
				tier = count
				tier = duke
			}
			liege = {
				religion = shinto
				controls_religion = yes
			}
		}
		
		from_potential = {
			real_tier = emperor
			OR = {
				religion = shinto
				AND = {
					religion = buddhist
					culture_group = japonic
				}
			}
			NOT = {
				government = chinese_imperial_government # If the Tenno isn't the subject of a CI ruler, that ruler isn't a Shogun
			}
			any_vassal = {
				religion = shinto
				controls_religion = yes
			}
		}
		
		allow = {
			OR = {
				AND = {
					tier = count
					FROM = {
						prestige = 500
					}
				}
				AND = {
					tier = duke
					FROM = {
						prestige = 1000
					}
				}
			}
			ROOT = {
				liege = {
					NOT = {
						has_opinion_modifier = {
							who = FROM
							modifier = took_a_vassal
						}
					}
					war = no
				}
				war = no
			}
			FROM = {
				war = no
				has_regent = no # If you've got a regent for any reason, you can't steal the Tenno's vassals
			}
		}
		
		effect = {
			if = {
				limit = {
					tier = count
				}
				FROM = {
					prestige = -500
				}
			}
			else_if = {
				limit = {
					tier = duke
				}
				FROM = {
					prestige = -1000
				}
			}
			set_defacto_liege = FROM
			FROM = {
				any_vassal = {
					limit = {
						religion = shinto
						controls_religion = yes
					}
					letter_event = { id = japan.66 }
				}
			}
			letter_event = { id = japan.67 }
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.01
				always = yes # Slow it down!
			}
			modifier = {
				factor = 0
				FROM = {
					trait = content
				}
			}
			# Don't make us too likely to try this
			modifier = {
				factor = 0
				FROM = {
					NOR = {
						trait = ambitious
						trait = envious
						trait = proud
						liege = {
							OR = {
								NOT = {
									reverse_opinion = {
										who = FROM
										value = -25
									}
								}
								any_rival = {
									character = FROM
								}
							}
						}
						ROOT = {
							de_jure_liege = FROM
						}
					}
				}
			}
			# If we don't have a lot of prestige, don't bother
			modifier = {
				factor = 0.1
				OR = {
					AND = {
						tier = count
						FROM = {
							NOT = {
								prestige = 1000
							}
						}
					}
					AND = {
						tier = duke
						FROM = {
							NOT = {
								prestige = 2000
							}
						}
					}
				}
			}
			modifier = {
				factor = 5
				FROM = {
					trait = ambitious
				}
			}
			modifier = {
				factor = 2
				FROM = {
					trait = envious
				}
			}
			modifier = {
				factor = 2
				FROM = {
					trait = proud
				}
			}
			modifier = {
				factor = 2
				FROM = {
					trait = greedy
				}
			}
			modifier = {
				factor = 2
				FROM = {
					trait = deceitful
				}
			}
		}
	}
	
	#shogun_marry_liege_to_my_dynasty = {
	#	filter = vassals
	#	ai_target_filter = vassals
	#	third_party_filter = realm
	#	ai_third_party_filter = realm
	#	third_party = FROM
	#	ai_check_interval = 60
	#	
	#	potential = {
	#		always = no # Deprecated; this should remain a Regent power!
	#		# Our liege is the Tenno, is an adult, and has a Permanent Regency
	#		is_adult = yes
	#		is_female = no
	#		religion = shinto
	#		controls_religion = yes
	#		# The current spouse can't be the mother of the heir
	#		current_heir = {
	#			NAND = {
	#				dynasty = ROOT
	#				father = {
	#					character = ROOT
	#				}
	#				mother = {
	#					spouse = {
	#						character = ROOT
	#					}
	#				}
	#			}
	#		}
	#		spouse = {
	#			NOR = {
	#				# Spouse must not be (known to be) pregnant
	#				trait = pregnant
	#				trait = hard_pregnancy
	#				trait = troubled_pregnancy
	#				trait = pregnancy_finishing
	#				# If the Tenno loves their spouse, they'll probably care more (particularly if a player), so let's just forbid ending that...
	#				any_lover = {
	#					character = ROOT
	#				}
	#				dynasty = FROM # If we've already done this, don't do it again!
	#				is_playable = yes # A playable spouse probably has enough power to oppose it
	#			}
	#		}
	#		NOT = {
	#			dynasty = FROM # No need for marriage ties
	#		}
	#	}
	#	
	#	from_potential = {
	#		is_playable = yes
	#		real_tier = emperor
	#		OR = {
	#			religion = shinto
	#			AND = {
	#				religion = buddhist
	#				culture_group = japonic
	#			}
	#		}
	#		NOT = {
	#			government = chinese_imperial_government # If the Tenno isn't the subject of a CI ruler, that ruler isn't a Shogun
	#		}
	#		any_vassal = {
	#			religion = shinto
	#			controls_religion = yes
	#		}
	#	}
	#	
	#	allow = {
	#		NOT = {
	#			has_opinion_modifier = {
	#				who = FROM
	#				modifier = changed_my_spouse
	#			}
	#		}
	#		FROM = {
	#			prestige = 500
	#			has_regent = no # If you've got a regent for any reason, you can't interfere in the Tenno's marriage
	#		}
	#	}
	#	
	#	third_party_potential = {
	#		show_only_failed_conditions = yes
	#		FROMFROM = {
	#			show_scope_change = no
	#			is_female = yes
	#			has_negative_congenital_trigger = no
	#			OR = {
	#				# Already a consort of the Tenno
	#				AND = {
	#					any_consort = {
	#						character = ROOT
	#					}
	#					NOT = {
	#						any_lover = {
	#							NOT = {
	#								character = ROOT
	#							}
	#						}
	#					}
	#				}
	#				# Subset of is_virgin_trigger; blocking Lustful is a bit too harsh...
	#				AND = {
	#					NOR = {
	#						any_lover = { always = yes }
	#						any_child_even_if_dead = { always = yes }
	#						any_spouse_even_if_dead = { always = yes }
	#						any_consort = { always = yes } # This is missing in vanilla but should probably be here...
	#						has_focus = focus_seduction
	#						trait = pregnant
	#						trait = hard_pregnancy # This is missing in vanilla but should probably be here...
	#						trait = troubled_pregnancy # This is missing in vanilla but should probably be here...
	#						trait = pregnancy_finishing # This is missing in vanilla but should probably be here...
	#						#trait = lustful
	#						trait = hedonist
	#						trait = seducer
	#						trait = seductress
	#						trait = lovers_pox
	#						trait = has_aztec_disease
	#						trait = syphilitic
	#					}
	#					OR = {
	#						NOT = { age = 25 }
	#						trait = celibate
	#						trait = chaste
	#						trait = shy
	#						is_ascetic_trigger = yes
	#					}
	#				}
	#			}
	#			# Close relative of yours
	#			custom_tooltip = {
	#				text = is_close_relative_or_same_dynasty_tt
	#				OR = {
	#					is_close_relative = ROOT_FROM
	#					dynasty = ROOT_FROM
	#				}
	#			}
	#			#custom_tooltip = {
	#				#text = is_adult_under_35_tt
	#				is_adult = yes
	#				NOT = { age = 35 } # Needs to be of childbearing age, with a decent margin
	#				ROOT = {
	#					spouse = {
	#						is_older_than = FROMFROM # Needs to be younger than the Tenno's spouse to be an attractive match
	#					}
	#				}
	#			#}
	#			NOT = { is_landed = yes }
	#			NOT = { is_ruler = yes }
	#			NOT = { is_heir = yes }
	#			# Either in our court or a concubine of the Tenno
	#			OR = {
	#				employer = {
	#					character = ROOT_FROM
	#				}
	#				any_consort = {
	#					character = ROOT
	#				}
	#			}
	#			custom_tooltip = {
	#				text = is_not_incapable_inbred_or_imbecile_tt
	#				NOT = { trait = incapable }
	#				NOT = { trait = inbred }
	#				NOT = { trait = imbecile }
	#			}
	#			custom_tooltip = {
	#				text = is_not_maimed_or_infirm_tt
	#				NOT = { trait = maimed }
	#				NOT = { trait = infirm }
	#			}
	#			custom_tooltip = {
	#				text = is_not_wounded_severely_injured_tt
	#				NOT = { trait = wounded }
	#				NOT = { trait = severely_injured }
	#			}
	#			custom_tooltip = {
	#				text = is_not_one_eyed_handed_legged_disfigured_or_mangled_tt
	#				NOT = { trait = one_eyed }
	#				NOT = { trait = one_handed }
	#				NOT = { trait = one_legged }
	#				NOT = { trait = disfigured }
	#				NOT = { trait = mangled }
	#			}
	#			OR = {
	#				NOT = { prisoner = yes }
	#				host = {
	#					character = ROOT_FROM
	#				}
	#			}
	#			# If there would be no children the marriage is useless
	#			custom_tooltip = {
	#				text = is_not_ascetic_or_celibate_tt
	#				NOT = { is_ascetic_trigger = yes }
	#				NOT = { trait = celibate }
	#			}
	#			# Don't marry off our lovers or someone that's pregnant
	#			NOR = {
	#				trait = pregnant # Known to be pregnant
	#				trait = hard_pregnancy
	#				trait = troubled_pregnancy
	#				trait = pregnancy_finishing
	#				any_lover = {
	#					character = ROOT_FROM
	#				}
	#			}
	#		}
	#	}
	#	
	#	third_party_allow = {
	#		show_only_failed_conditions = yes
	#		FROMFROM = {
	#			is_ill = no
	#			is_inaccessible_or_incapable_trigger = no
	#		}
	#	}
	#	
	#	effect = {
	#		FROM = {
	#			prestige = -500
	#		}
	#		letter_event = { id = japan.68 } # Inform the Tenno and carry things out
	#	}
	#	
	#	ai_will_do = {
	#		factor = 1
	#		modifier = {
	#			factor = 0.5
	#			always = yes
	#		}
	#		modifier = {
	#			factor = 0.01
	#			spouse = {
	#				OR = {
	#					# We like the spouse
	#					reverse_opinion = {
	#						who = FROM
	#						value = 50
	#					}
	#					any_friend = {
	#						character = FROM
	#					}
	#					any_lover = {
	#						character = FROM
	#					}
	#				}
	#			}
	#			FROM = {
	#				NOR = {
	#					trait = deceitful
	#					trait = ambitious
	#				}
	#			}
	#		}
	#		modifier = {
	#			factor = 5
	#			FROM = {
	#				trait = ambitious
	#			}
	#		}
	#		modifier = {
	#			factor = 0
	#			FROM = {
	#				trait = content
	#			}
	#		}
	#		modifier = {
	#			factor = 0
	#			trait = celibate # Unlikely to have an effect...
	#		}
	#	}
	#}
	
	regent_get_vassal_from_liege2 = {
		only_playable = yes
		filter = realm
		ai_target_filter = realm
		ai_check_interval = 60
		
		potential = {
			OR = {
				AND = {
					tier = count
					FROM = {
						NOT = {
							tier = count
						}
					}
				}
				AND = {
					tier = duke
					FROM = {
						tier = king
					}
				}
			}
			liege = {
				real_tier = emperor
				OR = {
					AND = {
						religion = shinto
						controls_religion = no
					}
					AND = {
						religion = buddhist
						culture_group = japonic
					}
				}
				NOT = {
					government = chinese_imperial_government
				}
				trait = under_regency2
			}
		}
		
		from_potential = {
			trait = japanese_regent2
			has_minor_title = title_regent
			liege = {
				real_tier = emperor
				OR = {
					AND = {
						religion = shinto
						controls_religion = no
					}
					AND = {
						religion = buddhist
						culture_group = japonic
					}
				}
				NOT = {
					government = chinese_imperial_government
				}
				trait = under_regency2
			}
			has_regent = no # Should be impossible if you have the "Regent" minor title, but best to be certain
		}
		
		allow = {
			OR = {
				AND = {
					tier = count
					FROM = {
						prestige = 500
					}
				}
				AND = {
					tier = duke
					FROM = {
						prestige = 1000
					}
				}
			}
			FROM = {
				liege = {
					NOT = {
						has_opinion_modifier = {
							who = FROM
							modifier = took_a_vassal
						}
					}
					war = no
				}
				war = no
			}
			war = no
		}
		
		effect = {
			if = {
				limit = {
					tier = count
				}
				FROM = {
					prestige = -500
				}
			}
			else_if = {
				limit = {
					tier = duke
				}
				FROM = {
					prestige = -1000
				}
			}
			set_defacto_liege = FROM
			FROM = {
				liege = {
					letter_event = { id = japan.40 }
				}
			}
			letter_event = { id = japan.41 }
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.01
				always = yes # Slow it down!
			}
			modifier = {
				factor = 0
				FROM = {
					trait = content
				}
			}
			# Don't make us too likely to try this
			modifier = {
				factor = 0
				FROM = {
					NOR = {
						trait = ambitious
						trait = envious
						trait = proud
						liege = {
							OR = {
								NOT = {
									reverse_opinion = {
										who = FROM
										value = -25
									}
								}
								any_rival = {
									character = FROM
								}
							}
						}
						ROOT = {
							de_jure_liege = FROM
						}
					}
				}
			}
			# If we don't have a lot of prestige, don't bother
			modifier = {
				factor = 0.1
				OR = {
					AND = {
						tier = count
						FROM = {
							NOT = {
								prestige = 1000
							}
						}
					}
					AND = {
						tier = duke
						FROM = {
							NOT = {
								prestige = 2000
							}
						}
					}
				}
			}
			modifier = {
				factor = 5
				FROM = {
					trait = ambitious
				}
			}
			modifier = {
				factor = 2
				FROM = {
					trait = envious
				}
			}
			modifier = {
				factor = 2
				FROM = {
					trait = proud
				}
			}
			modifier = {
				factor = 2
				FROM = {
					trait = greedy
				}
			}
			modifier = {
				factor = 2
				FROM = {
					trait = deceitful
				}
			}
			modifier = {
				factor = 0.1
				tier = duke
				FROM = {
					NOT = {
						trait = ambitious
					}
				}
			}
			modifier = {
				factor = 0.5
				tier = count
				FROM = {
					NOT = {
						trait = ambitious
					}
				}
			}
		}
	}
	
	regent_marry_liege_to_my_dynasty2 = {
		filter = liege
		ai_target_filter = liege
		third_party_filter = dynasty
		ai_third_party_filter = dynasty
		third_party = FROM
		ai_check_interval = 60
		only_playable = yes
		
		potential = {
			# Our liege is the Tenno, is an adult, and has a Permanent Regency
			is_adult = yes
			is_female = no
			AND = {
				real_tier = emperor
				OR = {
					AND = {
						religion = shinto
						controls_religion = no
					}
					AND = {
						religion = buddhist
						culture_group = japonic
					}
				}
				NOT = {
					government = chinese_imperial_government
				}
				trait = under_regency2
			}
			# The current spouse can't be the mother of the heir
			current_heir = {
				NAND = {
					dynasty = ROOT
					father = {
						character = ROOT
					}
					mother = {
						spouse = {
							character = ROOT
						}
					}
				}
			}
			spouse = {
				NOR = {
					# Spouse must not be (known to be) pregnant
					trait = pregnant
					trait = hard_pregnancy
					trait = troubled_pregnancy
					trait = pregnancy_finishing
					# If the Tenno loves their spouse, they'll probably care more (particularly if a player), so let's just forbid ending that...
					any_lover = {
						character = ROOT
					}
					dynasty = FROM # If we've already done this, don't do it again!
					is_playable = yes # A playable spouse probably has enough power to oppose it
				}
			}
			NOT = {
				dynasty = FROM # No need for marriage ties
			}
		}
		
		from_potential = {
			trait = japanese_regent2
			has_minor_title = title_regent
			liege = {
				real_tier = emperor
				OR = {
					AND = {
						religion = shinto
						controls_religion = no
					}
					AND = {
						religion = buddhist
						culture_group = japonic
					}
				}
				NOT = {
					government = chinese_imperial_government
				}
				trait = under_regency2
			}
			has_regent = no # Should be impossible if you have the "Regent" minor title, but best to be certain
		}
		
		allow = {
			NOT = {
				has_opinion_modifier = {
					who = FROM
					modifier = changed_my_spouse
				}
			}
			FROM = {
				prestige = 500
			}
		}
		
		third_party_potential = {
			show_only_failed_conditions = yes
			FROMFROM = {
				show_scope_change = no
				is_female = yes
				has_negative_congenital_trigger = no
				OR = {
					# Already a consort of the Tenno
					AND = {
						any_consort = {
							character = ROOT
						}
						NOT = {
							any_lover = {
								NOT = {
									character = ROOT
								}
							}
						}
					}
					# Subset of is_virgin_trigger; blocking Lustful is a bit too harsh...
					AND = {
						NOR = {
							any_lover = { always = yes }
							any_child_even_if_dead = { always = yes }
							any_spouse_even_if_dead = { always = yes }
							any_consort = { always = yes } # This is missing in vanilla but should probably be here...
							has_focus = focus_seduction
							trait = pregnant
							trait = hard_pregnancy # This is missing in vanilla but should probably be here...
							trait = troubled_pregnancy # This is missing in vanilla but should probably be here...
							trait = pregnancy_finishing # This is missing in vanilla but should probably be here...
							#trait = lustful
							trait = hedonist
							trait = seducer
							trait = seductress
							trait = lovers_pox
							trait = has_aztec_disease
							trait = syphilitic
						}
						OR = {
							NOT = { age = 25 }
							trait = celibate
							trait = chaste
							trait = shy
							is_ascetic_trigger = yes
						}
					}
				}
				# Close relative of yours
				custom_tooltip = {
					text = is_close_relative_or_same_dynasty_tt
					OR = {
						is_close_relative = ROOT_FROM
						dynasty = ROOT_FROM
					}
				}
				#custom_tooltip = {
					#text = is_adult_under_35_tt
					is_adult = yes
					NOT = { age = 35 } # Needs to be of childbearing age, with a decent margin
					ROOT = {
						spouse = {
							is_older_than = FROMFROM # Needs to be younger than the Tenno's spouse to be an attractive match
						}
					}
				#}
				NOT = { is_landed = yes }
				NOT = { is_ruler = yes }
				NOT = { is_heir = yes }
				# Either in our court or a concubine of the Tenno
				OR = {
					employer = {
						character = ROOT_FROM
					}
					any_consort = {
						character = ROOT
					}
				}
				custom_tooltip = {
					text = is_not_incapable_inbred_or_imbecile_tt
					NOT = { trait = incapable }
					NOT = { trait = inbred }
					NOT = { trait = imbecile }
				}
				custom_tooltip = {
					text = is_not_maimed_or_infirm_tt
					NOT = { trait = maimed }
					NOT = { trait = infirm }
				}
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				custom_tooltip = {
					text = is_not_one_eyed_handed_legged_disfigured_or_mangled_tt
					NOT = { trait = one_eyed }
					NOT = { trait = one_handed }
					NOT = { trait = one_legged }
					NOT = { trait = disfigured }
					NOT = { trait = mangled }
				}
				OR = {
					NOT = { prisoner = yes }
					host = {
						character = ROOT_FROM
					}
				}
				# If there would be no children the marriage is useless
				custom_tooltip = {
					text = is_not_ascetic_or_celibate_tt
					NOT = { is_ascetic_trigger = yes }
					NOT = { trait = celibate }
				}
				# Don't marry off our lovers or someone that's pregnant
				NOR = {
					trait = pregnant # Known to be pregnant
					trait = hard_pregnancy
					trait = troubled_pregnancy
					trait = pregnancy_finishing
					any_lover = {
						character = ROOT_FROM
					}
				}
			}
		}
		
		third_party_allow = {
			show_only_failed_conditions = yes
			FROMFROM = {
				is_ill = no
				is_inaccessible_or_incapable_trigger = no
			}
		}
		
		effect = {
			letter_event = { id = japan.42 } # Inform the liege and carry things out
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.5
				always = yes
			}
			modifier = {
				factor = 0.01
				spouse = {
					OR = {
						# We like the spouse
						reverse_opinion = {
							who = FROM
							value = 50
						}
						any_friend = {
							character = FROM
						}
						any_lover = {
							character = FROM
						}
					}
				}
				FROM = {
					NOR = {
						trait = deceitful
						trait = ambitious
					}
				}
			}
			modifier = {
				factor = 5
				FROM = {
					trait = ambitious
				}
			}
			modifier = {
				factor = 0
				FROM = {
					trait = content
				}
			}
			modifier = {
				factor = 0
				trait = celibate # Unlikely to have an effect...
			}
		}
	}
	
	grant_minamoto_surname = {
		only_playable = yes
		filter = dynasty
		ai = no
		
		from_potential = {
			ai = no
			religion = shinto
			controls_religion = yes
			dynasty = 1000027000 # Imperial Family
		}
		
		potential = {
			ai = yes
			dynasty = 1000027000 # Imperial Family
			is_alive = yes
			is_landed = no
			FROM = {
				NOT = {
					is_descendant_of = ROOT
				}
			}
		}
		
		allow = {
			FROM = {
				has_actual_regency_trigger = no
				OR = {
					AND = {
						custom_tooltip = {
							text = is_not_the_first_minamoto
							has_global_flag = minamoto_exist
						}
						prestige = 250
					}
					prestige = 1000
				}
				NOT = {
					current_heir = {
						character = ROOT # No getting around the Regent's pick with this!
					}
				}
			}
		}
		
		effect = {
			FROM = {
				if = {
					limit = {
						custom_tooltip = {
							text = is_not_the_first_minamoto
							has_global_flag = minamoto_exist
						}
					}
					prestige = -250
				}
				else = {
					prestige = -1000
				}
			}
			
			# Disinherit and change the dynasty
			dynasty = 1000027002 # Minamoto
			add_trait = disinherited # Not that it matters with the new succession law...

			# Change the dynasty of all descendants of ROOT
			FROM = {
				any_dynasty_member_even_if_dead = {
					limit = {
						dynasty = 1000027000
						is_descendant_of = ROOT
					}
					dynasty = 1000027002 # Minamoto
				}
			}
		}
		
		ai_will_do = {
			factor = 0 # Risks the AI stupiding the Imperial Family into going extinct
		}
	}
	
	regent_release_prisoner = {
		filter = realm
		ai_target_filter = dynasty
		ai_check_interval = 12
		from_potential = {
			OR = {
				trait = japanese_regent
				trait = japanese_regent2
			}
			liege = {
				regent = {
					character = FROM
				}
				OR = {
					trait = under_regency
					trait = under_regency2
				}
				primary_title = {
					has_law = regent_prisoner_control_1
				}
			}
		}
		
		potential = {
			prisoner = yes
			host = {
				regent = {
					character = FROM
				}
			}
		}
		
		allow = {
			FROM = {
				has_actual_regency_trigger = no
				prestige = 100
			}
		}
		
		effect = {
			FROM = {
				prestige = -100
			}
			prisoner = no
			FROM = {
				liege = {
					character_event = { id = japan.421 }
				}
				character_event = { id = japan.422 } # Ping the Regent, then inform the prisoner
			}
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.01
				always = yes
			}
			modifier = {
				factor = 0
				any_rival = {
					character = FROM
				}
			}
			modifier = {
				factor = 10
				any_friend = {
					character = FROM
				}
			}
			modifier = {
				factor = 10
				any_lover = {
					character = FROM
				}
			}
			modifier = {
				factor = 10
				is_close_relative = FROM
			}
			modifier = {
				factor = 10
				FROM = {
					current_heir = {
						character = ROOT
					}
				}
			}
		}
	}
	
	regent_execute_prisoner = {
		filter = realm
		ai_target_filter = rivals
		ai_check_interval = 12
		from_potential = {
			OR = {
				trait = japanese_regent
				trait = japanese_regent2
			}
			liege = {
				regent = {
					character = FROM
				}
				OR = {
					trait = under_regency
					trait = under_regency2
				}
				primary_title = {
					has_law = regent_execution_control_1
				}
			}
		}
		
		potential = {
			prisoner = yes
			host = {
				regent = {
					character = FROM
				}
				NOT = {
					dynasty = PREV
				}
			}
		}
		
		allow = {
			FROM = {
				has_actual_regency_trigger = no
				prestige = 250
			}
		}
		
		effect = {
			FROM = {
				prestige = -250
			}
			FROM = {
				liege = {
					character_event = { id = japan.423 }
				}
				character_event = { id = japan.424 } # Ping the Regent, then inform the prisoner
			}
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.01
				always = yes
			}
			modifier = {
				factor = 0
				trait = kind
			}
			modifier = {
				factor = 0
				any_friend = {
					character = FROM
				}
			}
			modifier = {
				factor = 0
				any_lover = {
					character = FROM
				}
			}
			modifier = {
				factor = 0.1
				is_close_relative = FROM
			}
			modifier = {
				factor = 0.1
				dynasty = FROM
				FROM = {
					is_any_kinslayer_trigger = no
				}
			}
			modifier = {
				factor = 10
				trait = cruel
			}
		}
	}
}

title_decisions = {
	regent_get_title_from_liege = {
		filter = realm_owned
		ai_target_filter = realm_owned
		ai_check_interval = 60
		only_playable = yes
		
		potential = {
			OR = {
				AND = {
					tier = count
					# We can't take the capital (or Yamashiro, if the liege has a different capital)
					NOR = {
						title = c_yamashiro
						FROM = {
							liege = {
								capital_scope = {
									county = {
										title = ROOT
									}
								}
							}
						}
					}
				}
				tier = duke
				AND = {
					FROM = {
						liege = {
							tier = emperor # If the Tenno isn't an emperor taking a kingdom would make us stop being his vassal...
						}
					}
					tier = king
					NOT = {
						title = k_chrysanthemum_throne # That would be a full usurpation!
					}
				}
			}
			# Only the Tenno's demesne can be targeted!
			holder_scope = {
				religion = shinto
				controls_religion = yes
				trait = under_regency
			}
		}
		
		from_potential = {
			trait = japanese_regent
			has_minor_title = title_regent
			liege = {
				religion = shinto
				controls_religion = yes
				trait = under_regency
				independent = yes # If there is a Shogun, don't let the Regent meddle as much
				primary_title = {
					has_law = regent_title_control_1
				}
			}
			has_regent = no # Should be impossible if you have the "Regent" minor title, but best to be certain
		}
		
		allow = {
			OR = {
				AND = {
					tier = count
					FROM = {
						prestige = 500
					}
				}
				AND = {
					tier = duke
					FROM = {
						prestige = 1000
					}
				}
				AND = {
					tier = king
					FROM = {
						prestige = 2500
					}
				}
			}
			FROM = {
				liege = {
					NOT = {
						has_opinion_modifier = {
							who = FROM
							modifier = took_a_title
						}
					}
					war = no
				}
				war = no
			}
		}
		
		effect = {
			if = {
				limit = {
					tier = count
				}
				FROM = {
					prestige = -500
				}
			}
			else_if = {
				limit = {
					tier = duke
				}
				FROM = {
					prestige = -1000
				}
			}
			else_if = {
				limit = {
					tier = king
				}
				FROM = {
					prestige = -2500
				}
			}
			grant_title_no_opinion = FROM
			FROM = {
				liege = {
					letter_event = { id = japan.43 }
				}
			}
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.01
				always = yes # Slow it down!
			}
			modifier = {
				factor = 0
				FROM = {
					trait = content
				}
			}
			# Don't make us too likely to try this
			modifier = {
				factor = 0
				FROM = {
					NOR = {
						trait = ambitious
						trait = envious
						trait = proud
						liege = {
							OR = {
								NOT = {
									reverse_opinion = {
										who = FROM
										value = -25
									}
								}
								any_rival = {
									character = FROM
								}
							}
						}
						ROOT = {
							claimed_by = FROM
						}
					}
				}
			}
			# If we don't have a lot of prestige, don't bother
			modifier = {
				factor = 0.1
				OR = {
					AND = {
						tier = count
						FROM = {
							NOT = {
								prestige = 1000
							}
						}
					}
					AND = {
						tier = duke
						FROM = {
							NOT = {
								prestige = 2000
							}
						}
					}
					AND = {
						tier = king
						FROM = {
							NOT = {
								prestige = 5000
							}
						}
					}
				}
			}
			modifier = {
				factor = 5
				FROM = {
					trait = ambitious
				}
			}
			modifier = {
				factor = 2
				FROM = {
					trait = envious
				}
			}
			modifier = {
				factor = 2
				FROM = {
					trait = proud
				}
			}
			modifier = {
				factor = 2
				FROM = {
					trait = greedy
				}
			}
			modifier = {
				factor = 2
				FROM = {
					trait = deceitful
				}
			}
			modifier = {
				factor = 0.1
				tier = king
				FROM = {
					NOR = {
						trait = ambitious
						capital_scope = {
							duchy = {
								title = ROOT
							}
						}
					}
				}
			}
			modifier = {
				factor = 0.5
				tier = duke
				FROM = {
					NOR = {
						trait = ambitious
						capital_scope = {
							kingdom = {
								title = ROOT
							}
						}
					}
				}
			}
		}
	}
	
	shogun_get_title_from_tenno = {
		filter = realm_owned
		ai_target_filter = realm_owned
		ai_check_interval = 60
		only_playable = yes
		only_independent = yes
		
		potential = {
			OR = {
				AND = {
					tier = count
					# We can't take the capital (or Yamashiro, if the liege has a different capital)
					NOR = {
						title = c_yamashiro
						FROM = {
							liege = {
								capital_scope = {
									county = {
										title = ROOT
									}
								}
							}
						}
					}
				}
				tier = duke
				AND = {
					tier = king
					NOT = {
						title = k_chrysanthemum_throne # That would be a full usurpation; the Tenno is of course the real ruler and the Shogun definitely serves him!
					}
				}
			}
			# Only the Tenno's demesne can be targeted!
			holder_scope = {
				religion = shinto
				controls_religion = yes
			}
		}
		
		from_potential = {
			real_tier = emperor
			OR = {
				religion = shinto
				AND = {
					religion = buddhist
					culture_group = japonic
				}
			}
			NOT = {
				government = chinese_imperial_government # If the Tenno isn't the subject of a CI ruler, that ruler isn't a Shogun
			}
			any_vassal = {
				religion = shinto
				controls_religion = yes
			}
		}
		
		allow = {
			OR = {
				AND = {
					tier = count
					FROM = {
						prestige = 500
					}
				}
				AND = {
					tier = duke
					FROM = {
						prestige = 1000
					}
				}
				AND = {
					tier = king
					FROM = {
						prestige = 2500
					}
				}
			}
			holder_scope = {
				NOT = {
					has_opinion_modifier = {
						who = FROM
						modifier = took_a_title
					}
				}
				war = no
			}
			FROM = {
				war = no
				has_regent = no # If you've got a regent for any reason, you can't steal the Tenno's titles
			}
		}
		
		effect = {
			if = {
				limit = {
					tier = count
				}
				FROM = {
					prestige = -500
				}
			}
			else_if = {
				limit = {
					tier = duke
				}
				FROM = {
					prestige = -1000
				}
			}
			else_if = {
				limit = {
					tier = king
				}
				FROM = {
					prestige = -2500
				}
			}
			grant_title_no_opinion = FROM
			FROM = {
				any_vassal = {
					limit = {
						religion = shinto
						controls_religion = yes
					}
					letter_event = { id = japan.69 }
				}
			}
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.01
				always = yes # Slow it down!
			}
			modifier = {
				factor = 0
				FROM = {
					trait = content
				}
			}
			# Don't make us too likely to try this
			modifier = {
				factor = 0
				FROM = {
					NOR = {
						trait = ambitious
						trait = envious
						trait = proud
						liege = {
							OR = {
								NOT = {
									reverse_opinion = {
										who = FROM
										value = -25
									}
								}
								any_rival = {
									character = FROM
								}
							}
						}
						ROOT = {
							claimed_by = FROM
						}
					}
				}
			}
			# If we don't have a lot of prestige, don't bother
			modifier = {
				factor = 0.1
				OR = {
					AND = {
						tier = count
						FROM = {
							NOT = {
								prestige = 1000
							}
						}
					}
					AND = {
						tier = duke
						FROM = {
							NOT = {
								prestige = 2000
							}
						}
					}
					AND = {
						tier = king
						FROM = {
							NOT = {
								prestige = 5000
							}
						}
					}
				}
			}
			modifier = {
				factor = 5
				FROM = {
					trait = ambitious
				}
			}
			modifier = {
				factor = 2
				FROM = {
					trait = envious
				}
			}
			modifier = {
				factor = 2
				FROM = {
					trait = proud
				}
			}
			modifier = {
				factor = 2
				FROM = {
					trait = greedy
				}
			}
			modifier = {
				factor = 2
				FROM = {
					trait = deceitful
				}
			}
		}
	}
	
	regent_get_title_from_liege2 = {
		filter = realm_owned
		ai_target_filter = realm_owned
		ai_check_interval = 60
		only_playable = yes
		
		potential = {
			OR = {
				AND = {
					tier = count
					# We can't take the capital (or Yamashiro, if the liege has a different capital)
					NOR = {
						title = c_yamashiro
						FROM = {
							liege = {
								capital_scope = {
									county = {
										title = ROOT
									}
								}
							}
						}
					}
				}
				tier = duke
				AND = {
					FROM = {
						liege = {
							tier = emperor # If the Tenno isn't an emperor taking a kingdom would make us stop being his vassal...
						}
					}
					tier = king
					NOT = {
						title = k_chrysanthemum_throne # That would be a full usurpation!
					}
				}
			}
			# Only the Tenno's demesne can be targeted!
			holder_scope = {
				real_tier = emperor
				OR = {
					AND = {
						religion = shinto
						controls_religion = no
					}
					AND = {
						religion = buddhist
						culture_group = japonic
					}
				}
				NOT = {
					government = chinese_imperial_government
				}
				trait = under_regency2
			}
		}
		
		from_potential = {
			is_playable = yes
			trait = japanese_regent2
			has_minor_title = title_regent
			liege = {
				real_tier = emperor
				OR = {
					AND = {
						religion = shinto
						controls_religion = no
					}
					AND = {
						religion = buddhist
						culture_group = japonic
					}
				}
				NOT = {
					government = chinese_imperial_government
				}
				trait = under_regency2
			}
			has_regent = no # Should be impossible if you have the "Regent" minor title, but best to be certain
		}
		
		allow = {
			OR = {
				AND = {
					tier = count
					FROM = {
						prestige = 500
					}
				}
				AND = {
					tier = duke
					FROM = {
						prestige = 1000
					}
				}
				AND = {
					tier = king
					FROM = {
						prestige = 2500
					}
				}
			}
			FROM = {
				liege = {
					NOT = {
						has_opinion_modifier = {
							who = FROM
							modifier = took_a_title
						}
					}
					war = no
				}
				war = no
			}
		}
		
		effect = {
			if = {
				limit = {
					tier = count
				}
				FROM = {
					prestige = -500
				}
			}
			else_if = {
				limit = {
					tier = duke
				}
				FROM = {
					prestige = -1000
				}
			}
			else_if = {
				limit = {
					tier = king
				}
				FROM = {
					prestige = -2500
				}
			}
			grant_title_no_opinion = FROM
			FROM = {
				liege = {
					letter_event = { id = japan.43 }
				}
			}
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.01
				always = yes # Slow it down!
			}
			modifier = {
				factor = 0
				FROM = {
					trait = content
				}
			}
			# Don't make us too likely to try this
			modifier = {
				factor = 0
				FROM = {
					NOR = {
						trait = ambitious
						trait = envious
						trait = proud
						liege = {
							OR = {
								NOT = {
									reverse_opinion = {
										who = FROM
										value = -25
									}
								}
								any_rival = {
									character = FROM
								}
							}
						}
						ROOT = {
							claimed_by = FROM
						}
					}
				}
			}
			# If we don't have a lot of prestige, don't bother
			modifier = {
				factor = 0.1
				OR = {
					AND = {
						tier = count
						FROM = {
							NOT = {
								prestige = 1000
							}
						}
					}
					AND = {
						tier = duke
						FROM = {
							NOT = {
								prestige = 2000
							}
						}
					}
					AND = {
						tier = king
						FROM = {
							NOT = {
								prestige = 5000
							}
						}
					}
				}
			}
			modifier = {
				factor = 5
				FROM = {
					trait = ambitious
				}
			}
			modifier = {
				factor = 2
				FROM = {
					trait = envious
				}
			}
			modifier = {
				factor = 2
				FROM = {
					trait = proud
				}
			}
			modifier = {
				factor = 2
				FROM = {
					trait = greedy
				}
			}
			modifier = {
				factor = 2
				FROM = {
					trait = deceitful
				}
			}
			modifier = {
				factor = 0.1
				tier = king
				FROM = {
					NOR = {
						trait = ambitious
						capital_scope = {
							duchy = {
								title = ROOT
							}
						}
					}
				}
			}
			modifier = {
				factor = 0.5
				tier = duke
				FROM = {
					NOR = {
						trait = ambitious
						capital_scope = {
							kingdom = {
								title = ROOT
							}
						}
					}
				}
			}
		}
	}
}