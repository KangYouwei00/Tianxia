# Iyomante events
# By Silverswee(e)per

namespace = iyomante

##### Preparation

# Preparation begins
character_event = {
	id = iyomante.1
	desc = EVTDESC_IYOMANTE_1
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		# Clear old flags
		clr_character_flag = coming_to_iyomante
		clr_character_flag = do_not_disturb
		clr_character_flag = guest_iyomante_started
		clr_character_flag = host_iyomante_started
		clr_character_flag = iyomante_little_sake
		clr_character_flag = iyomante_many_nusa
		clr_character_flag = iyomante_no_sacrifice
		clr_character_flag = iyomante_normal_nusa
		clr_character_flag = iyomante_normal_sake
		clr_character_flag = iyomante_plentiful_sake
		clr_character_flag = iyomante_single_inaw
		clr_character_flag = lavishly_food
		clr_character_flag = low_food
		clr_character_flag = medium_food
		clr_character_flag = recent_iyomante
		clr_character_flag = sent_invitations
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_1 # Time for the preparations to begin
		
		character_event = { id = iyomante.2 days = 1 random = 2 } # Inaw/nusa
		character_event = { id = iyomante.3 days = 4 random = 2 } # Sake
		character_event = { id = iyomante.4 days = 7 random = 2 } # Food preparation
		character_event = { id = iyomante.5 days = 10 random = 2 } # Invitations
	}
}

# Preparing inaw (sing.)/nusa (plur.)
character_event = {
	id = iyomante.2
	desc = EVTDESC_IYOMANTE_2
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_2 # We must prepare plenty of nusa!
		
		wealth = -10
		piety = 25
		
		set_character_flag = iyomante_many_nusa
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = cynical
				NOT = {
					trait = charitable
				}
			}
			modifier = {
				factor = 0.1
				trait = cynical
				trait = charitable
			}
			modifier = {
				factor = 0.1
				trait = greedy
				trait = zealous
			}
			modifier = {
				factor = 0
				trait = greedy
				NOT = {
					trait = zealous
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_IYOMANTE_2 # Prepare a reasonable amount of nusa
		
		piety = 10
		wealth = -5
		
		set_character_flag = iyomante_normal_nusa
		
		if = {
			limit = {
				trait = greedy
			}
			remove_trait = greedy
		}
		else_if = {
			limit = {
				NOT = {
					trait = charitable
				}
			}
			random = {
				chance = 15
				add_trait = charitable
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = cynical
				NOT = {
					trait = charitable
				}
			}
			modifier = {
				factor = 0.1
				trait = cynical
				trait = charitable
			}
			modifier = {
				factor = 0.1
				trait = greedy
				trait = zealous
			}
			modifier = {
				factor = 0
				trait = greedy
				NOT = {
					trait = zealous
				}
			}
		}
	}
	
	option = {
		name = EVTOPTC_IYOMANTE_2 # A single inaw is all I want
		
		piety = -10
		
		set_character_flag = iyomante_single_inaw
		
		if = {
			limit = {
				trait = zealous
			}
			remove_trait = zealous
		}
		else_if = {
			limit = {
				NOT = {
					trait = cynical
				}
			}
			random = {
				chance = 15
				add_trait = cynical
			}
		}
		if = {
			limit = {
				trait = charitable
			}
			remove_trait = charitable
		}
		else_if = {
			limit = {
				NOT = {
					trait = greedy
				}
			}
			random = {
				chance = 15
				add_trait = greedy
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = zealous
			}
			modifier = {
				factor = 0.1
				trait = charitable
				NOT = {
					trait = cynical
				}
			}
		}
	}
}

# Preparing sake
character_event = {
	id = iyomante.3
	desc = EVTDESC_IYOMANTE_3
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_3 # The kamuy deserves plentiful sake!
		
		wealth = -10
		piety = 25
		
		set_character_flag = iyomante_plentiful_sake
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = cynical
				NOT = {
					trait = charitable
				}
			}
			modifier = {
				factor = 0.1
				trait = cynical
				trait = charitable
			}
			modifier = {
				factor = 0.1
				trait = greedy
				trait = zealous
			}
			modifier = {
				factor = 0
				trait = greedy
				NOT = {
					trait = zealous
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_IYOMANTE_3 # The kamuy deserves sufficient sake
		
		piety = 10
		wealth = -5
		
		set_character_flag = iyomante_normal_sake
		
		if = {
			limit = {
				trait = greedy
			}
			remove_trait = greedy
		}
		else_if = {
			limit = {
				NOT = {
					trait = charitable
				}
			}
			random = {
				chance = 15
				add_trait = charitable
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = cynical
				NOT = {
					trait = charitable
				}
			}
			modifier = {
				factor = 0.1
				trait = cynical
				trait = charitable
			}
			modifier = {
				factor = 0.1
				trait = greedy
				trait = zealous
			}
			modifier = {
				factor = 0
				trait = greedy
				NOT = {
					trait = zealous
				}
			}
		}
	}
	
	option = {
		name = EVTOPTC_IYOMANTE_3 # The kamuy shouldn't get much sake
		
		piety = -10
		
		set_character_flag = iyomante_little_sake
		
		if = {
			limit = {
				trait = zealous
			}
			remove_trait = zealous
		}
		else_if = {
			limit = {
				NOT = {
					trait = cynical
				}
			}
			random = {
				chance = 15
				add_trait = cynical
			}
		}
		if = {
			limit = {
				trait = charitable
			}
			remove_trait = charitable
		}
		else_if = {
			limit = {
				NOT = {
					trait = greedy
				}
			}
			random = {
				chance = 15
				add_trait = greedy
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = zealous
			}
			modifier = {
				factor = 0.1
				trait = charitable
				NOT = {
					trait = cynical
				}
			}
		}
	}
}

# Food preparations - copied from vanilla
character_event = {
	id = iyomante.4
	desc = EVTDESC_IYOMANTE_4
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no

	is_triggered_only = yes

	trigger = {
		has_character_modifier = iyomante_in_progress
		NOT = {
			has_character_flag = lavishly_food
		}
		NOT = {
			has_character_flag = medium_food
		}
		NOT = {
			has_character_flag = low_food
		}
	}

	option = {
		name = "EVTOPTA72003" #Spend lavishly on food
		gain_weight_small_effect = yes
		weight_trait_check_effect = yes
		trigger = { NOT = { trait = temperate } }
		ai_chance = {

			factor = 30

			modifier = {
				factor = 0.5
				trait = greedy
			}
			modifier = {
				factor = 3
				trait = gluttonous
			}
			modifier = {
				factor = 0.1
				trait = temperate
			}
			modifier = {
				factor = 2
				primary_title = { higher_tier_than = DUKE }
			}
		}
		set_character_flag = lavishly_food
		treasury = -20
		prestige = 10
	}
	option = {
		name = "EVTOPTB72003" #Spend medium on food
		ai_chance = {
			factor = 30

			modifier = {
				factor = 0.5
				NOT = { trait = greedy }
			}
			modifier = {
				factor = 2
				NOT = { trait = gluttonous }
			}
			modifier = {
				factor = 2
				primary_title = { tier = DUKE }
			}
		}
		set_character_flag = medium_food
		treasury = -10
	}
	option = {
		name = "EVTOPTC72003" #Spend low on food
		trigger = { NOT = { trait = gluttonous } }
		ai_chance = {
			factor = 30

			modifier = {
				factor = 2.5
				trait = greedy
			}
			modifier = {
				factor = 0.1
				trait = gluttonous
			}
			modifier = {
				factor = 2
				primary_title = { tier = COUNT }
			}
		}
		set_character_flag = low_food
		treasury = -5
		prestige = -5
	}
}

# Time to send invitations
character_event = {
	id = iyomante.5
	desc = EVTDESC_IYOMANTE_5
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes

	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no

	trigger = {
		has_character_modifier = iyomante_in_progress
		OR = {
			has_character_flag = lavishly_food
			has_character_flag = medium_food
			has_character_flag = low_food
		}
		NOT = {
			has_character_flag = sent_invitations
		}
	}
	
	option = {
		name = "EVTOPTA72010"
		set_character_flag = sent_invitations
		custom_tooltip = {
			text = EVTTOOLTIP1_RoI_1000
		}
		hidden_tooltip = {
			character_event = { id = iyomante.8 days = 10 } # Start of Iyomante
			any_vassal = {
				limit = {
					NOT = { is_inaccessible_trigger = yes }
					prisoner = no
					NOT = { has_character_flag = do_not_disturb }
					NOT = { trait = incapable }
					NOT = { has_character_modifier = iyomante_in_progress }
					war = no
					is_adult = yes
					NOT = {
						trait = treasure_fleet_preparation
					}
				}
				letter_event = {
					id = iyomante.6
					days = 2
					#tooltip = "EVTTOOLTIP72011"
				}
			}
		}
	}
}

# Vassal gets invitation
letter_event = {
	id = iyomante.6
	desc = EVTDESC_IYOMANTE_6

	is_triggered_only = yes

	trigger = { NOT = { is_inaccessible_trigger = yes } }

	option = {
		name = EVTOPTA_IYOMANTE_6 # Travel to the Iyomante
		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				opinion = { who = from value = -40 }
			}
			modifier  = {
				factor = 2
				opinion = { who = from value = -20 }
			}
		}
		set_character_flag = coming_to_iyomante
		set_character_flag = do_not_disturb
	}
	option = {
		name = EVTOPTB_IYOMANTE_6 # Refuse
		ai_chance = {
			factor = 1
			modifier  = {
				factor = 2
				NOT = { opinion = { who = from value = -60 } }
			}
			modifier  = {
				factor = 2
				NOT = { opinion = { who = from value = -80 } }
			}
		}
		FROM = {
			letter_event = {
				id = iyomante.7
				days = 1
				random = 2
				tooltip = "EVTTOOLTIP72012"
			}
		}
	}
}

# Vassal refused invitation
letter_event = {
	id = iyomante.7
	desc = EVTDESC_IYOMANTE_7

	is_triggered_only = yes

	option = {
		name = "EVTOPTA72012"
		opinion = {
			modifier = opinion_dislike
			who = FROM
			years = 10
		}
	}
}



##### Arrival

# Guests arrive - host
character_event = {
	id = iyomante.8
	desc = EVTDESC_IYOMANTE_8
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_8 # Welcome! Welcome!
		
		set_character_flag = host_iyomante_started
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_iyomante
			}
			set_character_flag = guest_iyomante_started
			character_event = { id = iyomante.9 } # Vassals informed
		}
		
		character_event = { id = iyomante.10 days = 2 } # Event group 1 event selection
	}
}

# Guest arrives - guest
character_event = {
	id = iyomante.9
	desc = EVTDESC_IYOMANTE_9
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_9 # I hope this will be fun!
	}
}



##### Event group 1

# Event selection
character_event = {
	id = iyomante.10
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	immediate = {
		# Food complaints - based on vanilla
		random_list = {
			10 = { #Lavish food (vassal)
				modifier = {
					factor = 0
					NOR = {
						has_character_flag = lavishly_food
						any_vassal = {
							has_character_flag = coming_to_iyomante
							war = no
						}
					}
				}
				any_vassal = {
					limit = { 
						has_character_flag = coming_to_iyomante
						war = no
					}
					score_value = { #Prioritizes selecting an interesting courtier...
						value = 10
						interesting_courtier_selection_score = yes
					}
					character_event = { id = iyomante.11 days = 1 } # High food
				}
			}
			10 = { #Medium food (vassal)
				modifier = {
					factor = 0
					NOR = {
						has_character_flag = medium_food
						any_vassal = {
							has_character_flag = coming_to_iyomante
							war = no
						}
					}
				}
				any_vassal = {
					limit = { 
						has_character_flag = coming_to_iyomante
						war = no
					}
					score_value = { #Prioritizes selecting an interesting courtier...
						value = 10
						interesting_courtier_selection_score = yes
					}
					character_event = { id = iyomante.12 days = 1 } # Medium food
				}
			}
			10 = { #Low food (vassal)
				modifier = {
					factor = 0
					NOR = {
						has_character_flag = low_food
						any_vassal = {
							has_character_flag = coming_to_iyomante
							war = no
						}
					}
				}
				any_vassal = {
					limit = { 
						has_character_flag = coming_to_iyomante
						war = no
					}
					score_value = { #Prioritizes selecting an interesting courtier...
						value = 10
						interesting_courtier_selection_score = yes
					}
					character_event = { id = iyomante.13 days = 1 } # Low food
				}
			}
		}
		
		# Possible friendship or rivalry
		random_list = {
			10 = {
				modifier = {
					factor = 0
					NOT = {
						any_vassal = {
							has_character_flag = coming_to_iyomante
							war = no
							NOR = {
								any_friend = {
									character = ROOT
								}
								any_lover = {
									character = ROOT
								}
								any_rival = {
									character = ROOT
								}
							}
						}
					}
				}
				any_vassal = {
					limit = { 
						has_character_flag = coming_to_iyomante
						war = no
						NOR = {
							any_friend = {
								character = ROOT
							}
							any_lover = {
								character = ROOT
							}
							any_rival = {
								character = ROOT
							}
						}
					}
					score_value = { #Prioritizes selecting an interesting courtier...
						value = 10
						interesting_courtier_selection_score = yes
					}
					save_event_target_as = iyomante_friend
					ROOT = {
						character_event = { id = iyomante.16 days = 3 random = 2 } # Host made a friend
					}
				}
			}
			10 = {
				modifier = {
					factor = 0
					NOT = {
						any_vassal = {
							count = 2
							has_character_flag = coming_to_iyomante
							war = no
							NOT = {
								ROOT = {
									any_vassal = {
										NOT = {
											character = PREVPREV
										}
										has_character_flag = coming_to_iyomante
										war = no
										NOR = {
											any_friend = {
												character = PREVPREV
											}
											any_lover = {
												character = PREVPREV
											}
											any_rival = {
												character = PREVPREV
											}
										}
									}
								}
							}
						}
					}
				}
				any_vassal = {
					limit = { 
						has_character_flag = coming_to_iyomante
						war = no
						ROOT = {
							any_vassal = {
								NOT = {
									character = PREVPREV
								}
								has_character_flag = coming_to_iyomante
								war = no
								NOR = {
									any_friend = {
										character = PREVPREV
									}
									any_lover = {
										character = PREVPREV
									}
									any_rival = {
										character = PREVPREV
									}
								}
							}
						}
					}
					score_value = { #Prioritizes selecting an interesting courtier...
						value = 10
						interesting_courtier_selection_score = yes
					}
					save_event_target_as = iyomante_friend_character_1
				}
				any_vassal = {
					limit = {
						NOT = {
							character = event_target:iyomante_friend_character_1
						}
						has_character_flag = coming_to_iyomante
						war = no
						NOR = {
							any_friend = {
								character = event_target:iyomante_friend_character_1
							}
							any_lover = {
								character = event_target:iyomante_friend_character_1
							}
							any_rival = {
								character = event_target:iyomante_friend_character_1
							}
						}
					}
					score_value = { #Prioritizes selecting an interesting courtier...
						value = 10
						interesting_courtier_selection_score = yes
					}
					save_event_target_as = iyomante_friend_character_2
				}
				event_target:iyomante_friend_character_1 = {
					character_event = { id = iyomante.18 days = 3 random = 2 } # Vassal befriended another vassal
				}
			}
			10 = {
				modifier = {
					factor = 0
					NOT = {
						any_vassal = {
							count = 2
							has_character_flag = coming_to_iyomante
							war = no
							NOT = {
								ROOT = {
									any_vassal = {
										NOT = {
											character = PREVPREV
										}
										has_character_flag = coming_to_iyomante
										war = no
										NOR = {
											any_friend = {
												character = PREVPREV
											}
											any_lover = {
												character = PREVPREV
											}
											any_rival = {
												character = PREVPREV
											}
										}
									}
								}
							}
						}
					}
				}
				any_vassal = {
					limit = { 
						has_character_flag = coming_to_iyomante
						war = no
						ROOT = {
							any_vassal = {
								NOT = {
									character = PREVPREV
								}
								has_character_flag = coming_to_iyomante
								war = no
								NOR = {
									any_friend = {
										character = PREVPREV
									}
									any_lover = {
										character = PREVPREV
									}
									any_rival = {
										character = PREVPREV
									}
								}
							}
						}
					}
					score_value = { #Prioritizes selecting an interesting courtier...
						value = 10
						interesting_courtier_selection_score = yes
					}
					save_event_target_as = iyomante_rival_character_1
				}
				any_vassal = {
					limit = {
						NOT = {
							character = event_target:iyomante_rival_character_1
						}
						has_character_flag = coming_to_iyomante
						war = no
						NOR = {
							any_friend = {
								character = event_target:iyomante_rival_character_1
							}
							any_lover = {
								character = event_target:iyomante_rival_character_1
							}
							any_rival = {
								character = event_target:iyomante_rival_character_1
							}
						}
					}
					score_value = { #Prioritizes selecting an interesting courtier...
						value = 10
						interesting_courtier_selection_score = yes
					}
					save_event_target_as = iyomante_rival_character_2
				}
				event_target:iyomante_rival_character_1 = {
					character_event = { id = iyomante.21 days = 3 random = 2 } # Vassal befriended another vassal
				}
			}
		}
		
		# Bear event
		random_list = {
			5 = {
				# Bear escapes
				character_event = { id = iyomante.24 days = 6 random = 3 }
			}
			5 = {
				# Bear hurts someone
				character_event = { id = iyomante.26 days = 6 random = 3 }
			}
			10 = {
				# Bear breaks free but it goes well
				character_event = { id = iyomante.29 days = 6 random = 3 }
			}
			30 = {
				modifier = {
					factor = 0
					NOT = {
						any_vassal = {
							has_character_flag = coming_to_iyomante
							war = no
						}
					}
				}
				# Bear is truly impressive
				character_event = { id = iyomante.31 days = 6 random = 3 }
				
			}
			10 = {
				modifier = {
					factor = 0
					NOT = {
						any_vassal = {
							has_character_flag = coming_to_iyomante
							war = no
						}
					}
				}
				# Bear is truly unimpressive
				character_event = { id = iyomante.33 days = 6 random = 3 }
			}
			40 = {
				# Nothing
			}
		}
		
		# Go to the next event selection
		character_event = { id = iyomante.35 days = 10 random = 2 }
	}
}

### Food complaints - based on vanilla

# Lavish Food
character_event = {
	id = iyomante.11
	desc = EVTDESC_IYOMANTE_11
	picture = GFX_evt_feast

	only_rulers = yes
	capable_only = yes
	prisoner = no
	
	trigger = {
		FROM = {
			has_character_modifier = iyomante_in_progress
		}
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_IYOMANTE_11 # Approve publicly
		trigger = {
			NOT = { trait = temperate }
		}
		gain_weight_small_effect = yes
		weight_trait_check_effect = yes
		ai_chance = {
			factor = 40

			modifier = {
				factor = 5
				trait = gluttonous
			}
		}
		FROM = {
			character_event = { id = iyomante.14 }
		}
	}
	option = {
		name = EVTOPTB_IYOMANTE_11 # Disapprove
		trigger = {
			NOT = { trait = gluttonous }
		}
		ai_chance = {
			factor = 20

			modifier = {
				factor = 5
				trait = temperate
			}
		}
		FROM = {
			character_event = { id = iyomante.15 }
		}
	}
	option = {
		name = EVTOPTC_IYOMANTE_11 # Say nothing
		prestige = -10
	}
}

# Medium Food
character_event = {
	id = iyomante.12
	desc = EVTDESC_IYOMANTE_12
	picture = GFX_evt_feast

	only_rulers = yes
	capable_only = yes
	prisoner = no
	
	trigger = {
		FROM = {
			has_character_modifier = iyomante_in_progress
		}
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_IYOMANTE_12 # Approve publicly
		FROM = {
			character_event = { id = iyomante.14 }
		}
	}
	option = {
		name = EVTOPTB_IYOMANTE_12 # Disapprove publicly
		FROM = {
			character_event = { id = iyomante.15 }
		}
	}
	option = {
		name = EVTOPTC_IYOMANTE_12 # Say nothing
		prestige = -10
	}
}

# Low Food
character_event = {
	id = iyomante.13
	desc = EVTDESC_IYOMANTE_13
	picture = GFX_evt_feast

	only_rulers = yes
	capable_only = yes
	prisoner = no
	
	trigger = {
		FROM = {
			has_character_modifier = iyomante_in_progress
		}
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_IYOMANTE_13 # Approve publicly
		trigger = {
			NOT = { trait = gluttonous }
		}
		ai_chance = {
			factor = 20

			modifier = {
				factor = 5
				trait = temperate
			}
		}
		FROM = {
			character_event = { id = iyomante.14 }
		}
	}
	option = {
		name = EVTOPTB_IYOMANTE_13 # Disapprove publicly
		trigger = {
			NOT = { trait = temperate }
		}
		ai_chance = {
			factor = 40

			modifier = {
				factor = 5
				trait = gluttonous
			}
		}
		FROM = {
			character_event = { id = iyomante.15 }
		}
	}
	option = {
		name = EVTOPTC_IYOMANTE_13 # Say nothing
		prestige = -10
	}
}

# Liege is glad you liked the food at the feast
character_event = {
	id = iyomante.14
	desc = EVTDESC_IYOMANTE_14
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_IYOMANTE_14 # Good!
		opinion = {
			modifier = opinion_happy
			who = FROM
			years = 10
		}
		reverse_opinion = {
			modifier = opinion_approves
			who = FROM
			years = 10
		}
	}
}

# Liege dislikes you complaining about the food at the feast
character_event = {
	id = iyomante.15
	desc = EVTDESC_IYOMANTE_15
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_IYOMANTE_15 # Shut up!
		opinion = {
			modifier = opinion_irritated
			who = FROM
			years = 10
		}
		reverse_opinion = {
			modifier = opinion_disapprove
			who = FROM
			years = 10
		}
	}
}

### Friendship or rivalry

# Friendship with guest - host
character_event = {
	id = iyomante.16
	desc = EVTDESC_IYOMANTE_16
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_16 # That's great!
		
		event_target:iyomante_friend = {
			add_friend = ROOT
			character_event = { id = iyomante.17 } # Inform guest
		}
	}
}

# Friendship with host - guest
character_event = {
	id = iyomante.17
	desc = EVTDESC_IYOMANTE_17
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_17 # That's great!
		
		add_friend = FROM
	}
}

# Friendship with other guest - guest 1
character_event = {
	id = iyomante.18
	desc = EVTDESC_IYOMANTE_18
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_18 # That's great!
		
		event_target:iyomante_friend_character_2 = {
			add_friend = ROOT
			character_event = { id = iyomante.19 } # Inform other guest
		}
		
		FROM = {
			character_event = { id = iyomante.20 } # Inform host
		}
	}
}

# Friendship with other guest - guest 2
character_event = {
	id = iyomante.19
	desc = EVTDESC_IYOMANTE_19
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_19 # That's great!
		
		add_friend = FROM
	}
}

# Inform host
character_event = {
	id = iyomante.20
	desc = EVTDESC_IYOMANTE_20
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_20 # I see...
	}
}

# Rivalry with other guest - guest 1
character_event = {
	id = iyomante.21
	desc = EVTDESC_IYOMANTE_21
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_21 # I hate them!
		
		event_target:iyomante_rival_character_2 = {
			add_rival = ROOT
			character_event = { id = iyomante.22 } # Inform other guest
		}
		
		FROM = {
			character_event = { id = iyomante.23 } # Inform host
		}
	}
}

# Rivalry with other guest - guest 2
character_event = {
	id = iyomante.22
	desc = EVTDESC_IYOMANTE_22
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_22 # I hate them!
		
		add_rival = FROM
	}
}

# Inform host
character_event = {
	id = iyomante.23
	desc = EVTDESC_IYOMANTE_23
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_23 # I see...
	}
}

### Poor preparations

# Bear tied up very poorly - it escapes - host
character_event = {
	id = iyomante.24
	desc = EVTDESC_IYOMANTE_24
	picture = GFX_evt_stressed_ruler
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_24 # Oh no!
		
		prestige = -100
		
		set_character_flag = iyomante_no_sacrifice
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			character_event = { id = iyomante.25 } # Inform guests
		}
	}
}

# Inform guests that the bear escaped
character_event = {
	id = iyomante.25
	desc = EVTDESC_IYOMANTE_25
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_25 # How embarassing!
	}
}

# Bear tied up very poorly - it wounds someone - host
character_event = {
	id = iyomante.26
	desc = EVTDESC_IYOMANTE_26
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	immediate = {
		if = {
			limit = {
				any_vassal = {
					has_character_flag = coming_to_iyomante
					war = no
				}
			}
			any_vassal = {
				limit = { 
					has_character_flag = coming_to_iyomante
					war = no
				}
				score_value = { #Prioritizes selecting an interesting courtier...
					value = 10
					interesting_courtier_selection_score = yes
				}
				save_event_target_as = iyomante_wounded_guest
			}
		}
		else = {
			any_courtier = {
				limit = {
					is_landed = no
					is_inaccessible_or_incapable_trigger = no
				}
				score_value = { #Prioritizes selecting an interesting courtier...
					value = 10
					interesting_courtier_selection_score = yes
				}
				save_event_target_as = iyomante_wounded_guest
			}
		}
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_26 # That's bad...
		
		prestige = -50
		
		event_target:iyomante_wounded_guest = {
			character_event = { id = iyomante.27 } # Inform wounded guest
		}
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
				NOT = {
					character = event_target:iyomante_wounded_guest
				}
			}
			character_event = { id = iyomante.28 } # Inform other guests
		}
	}
}

# Inform wounded guest
character_event = {
	id = iyomante.27
	desc = EVTDESC_IYOMANTE_27
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_27 # Ow!
		
		add_trait = wounded
	}
}

# Inform other guests
character_event = {
	id = iyomante.28
	desc = EVTDESC_IYOMANTE_28
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_28 # At least I didn't get hurt...
	}
}

# Bear tied up very poorly - it goes well - host
character_event = {
	id = iyomante.29
	desc = EVTDESC_IYOMANTE_29
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_29 # That could have been bad...
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			character_event = { id = iyomante.30 } # Inform guests
		}
	}
}

# Inform guests
character_event = {
	id = iyomante.30
	desc = EVTDESC_IYOMANTE_30
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_30 # That could have been bad...
	}
}

### Impressive/unimpressive bear

# Host has impressive bear - guest
character_event = {
	id = iyomante.31
	desc = EVTDESC_IYOMANTE_31
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_31 # Impressive!
		
		FROM = {
			character_event = { id = iyomante.32 } # Inform host
		}
	}
}

# Host told that guest was impressed
character_event = {
	id = iyomante.32
	desc = EVTDESC_IYOMANTE_32
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_32 # That's great!
		
		prestige = 25
	}
}

# Host has an unimpressive bear - guest
character_event = {
	id = iyomante.33
	desc = EVTDESC_IYOMANTE_33
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_33 # Unimpressive!
		
		FROM = {
			character_event = { id = iyomante.34 } # Inform host
		}
	}
}

# Host told that guest was unimpressed
character_event = {
	id = iyomante.34
	desc = EVTDESC_IYOMANTE_34
	picture = GFX_evt_stressed_ruler
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_34 # I see...
		
		prestige = -25
	}
}

##### Event group 2

# Event selection (see if the child event happens and if the whole thing should be bypassed because the bear escaped)
character_event = {
	id = iyomante.35
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	immediate = {
		# Check if the sacrifice still is possible and handle that
		if = {
			limit = {
				NOT = {
					has_character_flag = iyomante_no_sacrifice
				}
			}
			random_list = {
				5 = {
					modifier = {
						factor = 0
						NOT = {
							any_courtier = {
								is_landed = no
								is_adult = no
								is_inaccessible_or_incapable_trigger = no
								religion_openly_ainu_or_reformed_trigger = yes
								NOT = {
									trait = cruel
								}
							}
						}
					}
					random_courtier = {
						limit = {
							is_landed = no
							is_adult = no
							is_inaccessible_or_incapable_trigger = no
							religion_openly_ainu_or_reformed_trigger = yes
							NOT = {
								trait = cruel
							}
						}
						preferred_limit = {
							OR = {
								trait = kind
								trait = affectionate
							}
						}
						save_event_target_as = bear_sacrifice_child
					}
					character_event = { id = iyomante.36 } # Child wants to save the bear
				}
				95 = {
					character_event = { id = iyomante.39 } # Go to actual sacrifice
				}
			}
		}
		else = {
			character_event = { id = iyomante.72 } # Alternative sake event
		}
		
		# Going to the next event selection is handled elsewhere!
	}
}

### Bear sacrifice - child branch

# Child wants to save the bear - host
character_event = {
	id = iyomante.36
	desc = EVTDESC_IYOMANTE_36
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_36 # Fine!
		
		set_character_flag = iyomante_no_sacrifice
	
		character_event = { id = iyomante.72 days = 2 } # Alternative sake event
		
		custom_tooltip = {
			text = iyomante_bear_saved
			random_list = {
				50 = {
					create_character = {
						age = 16 # Though the bear would be 2-3 years old, it would be an adult bear, so this is best
						name = "Kamuy"
						dynasty = none
						female = no
						culture = bear
						religion = ainu_pagan
						trait = bear # Fertility/etc. blocker, similar to Horse/Cat trait
						trait = strong
						trait = zealous
						trait = kind
						trait = gluttonous
					}
				}
				50 = {
					create_character = {
						age = 16 # Though the bear would be 2-3 years old, it would be an adult bear, so this is best
						name = "Kamuy"
						dynasty = none
						female = yes
						culture = bear
						religion = ainu_pagan
						trait = bear # Fertility/etc. blocker, similar to Horse/Cat trait
						trait = strong
						trait = zealous
						trait = kind
						trait = gluttonous
					}
				}
			}
			new_character = {
				set_character_flag = ai_flag_refuse_concubinage
				set_character_flag = ai_flag_refuse_marriage
				set_character_flag = ai_flag_refuse_conversion
				set_character_flag = no_court_invites
				if = {
					limit = {
						ROOT = {
							religion = ainu_pagan_reformed
						}
					}
					religion = ainu_pagan_reformed
				}
				opinion = {
					who = event_target:bear_sacrifice_child
					modifier = opinion_loyal_servant
				}
				set_character_flag = ai_flag
			}
		}
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			character_event = { id = iyomante.37 } # Inform guests
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = zealous
			}
			modifier = {
				factor = 0.1
				NOT = {
					trait = kind
				}
			}
			modifier = {
				factor = 0
				trait = cruel
			}
		}
	}
	
	option = {
		name = EVTOPTB_IYOMANTE_36 # Not happening!
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			character_event = { id = iyomante.38 } # Inform guests
		}
		
		character_event = { id = iyomante.39 days = 2 } # Go to the actual sacrifice
		
		event_target:bear_sacrifice_child = {
			add_rival = ROOT
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = cynical
			}
			modifier = {
				factor = 0.1
				trait = kind
			}
		}
	}
}

# Bear saved - guest
character_event = {
	id = iyomante.37
	desc = EVTDESC_IYOMANTE_37
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_37 # An odd decision...
	}
}

# Bear not saved - guest
character_event = {
	id = iyomante.38
	desc = EVTDESC_IYOMANTE_38
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_38 # Probably the right decision...
	}
}

### Bear sacrifice - arrows

# Shooting the bear - who takes the first shot?
character_event = {
	id = iyomante.39
	desc = EVTDESC_IYOMANTE_39
	picture = GFX_evt_longbowman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	immediate = {
		any_vassal = {
			limit = { 
				has_character_flag = coming_to_iyomante
				war = no
				OR = {
					AND = {
						is_female = no
						NOT = {
							has_religion_feature = religion_matriarchal
						}
					}
					AND = {
						is_female = yes
						NOT = {
							has_religion_feature = religion_patriarchal
						}
					}
				}
			}
			score_value = { #Prioritizes selecting an interesting courtier...
				value = 10
				interesting_courtier_selection_score = yes
			}
			save_event_target_as = iyomante_archer_1
		}
		any_courtier = {
			limit = {
				is_landed = no
				is_inaccessible_or_incapable_trigger = no
				OR = {
					AND = {
						is_female = no
						NOT = {
							has_religion_feature = religion_matriarchal
						}
					}
					AND = {
						is_female = yes
						NOT = {
							has_religion_feature = religion_patriarchal
						}
					}
				}
			}
			score_value = { #Prioritizes selecting an interesting courtier...
				value = 10
				interesting_courtier_selection_score = yes
			}
			save_event_target_as = iyomante_archer_2
		}
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_39 # I will take the first shot!
		
		random_list = {
			75 = {
				modifier = {
					factor = 0
					NOT = {
						combat_rating = 1
					}
				}
				character_event = { id = iyomante.40 days = 2 } # It goes well
			}
			25 = {
				modifier = {
					factor = 0
					combat_rating = 40
				}
				character_event = { id = iyomante.42 days = 2 } # It goes poorly
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.01
				NOR = {
					combat_rating = 1
					trait = proud
				}
			}
		}
	}
	
	option = {
		trigger = {
			event_target:iyomante_archer_1 = {
				always = yes
			}
		}
		name = EVTOPTB_IYOMANTE_39 # A vassal will take the shot
		
		event_target:iyomante_archer_1 = {
			random_list = {
				75 = {
					modifier = {
						factor = 0
						NOT = {
							combat_rating = 1
						}
					}
					character_event = { id = iyomante.44 days = 2 } # It goes well
				}
				25 = {
					modifier = {
						factor = 0
						combat_rating = 40
					}
					character_event = { id = iyomante.47 days = 2 } # It goes poorly
				}
			}
		}
		
		ai_chance = {
			factor = 100
		}
	}
	
	option = {
		trigger = {
			event_target:iyomante_archer_2 = {
				always = yes
			}
		}
		name = EVTOPTC_IYOMANTE_39 # A a courtier will take the shot
		
		event_target:iyomante_archer_2 = {
			random_list = {
				75 = {
					modifier = {
						factor = 0
						NOT = {
							combat_rating = 1
						}
					}
					character_event = { id = iyomante.44 days = 2 } # It goes well
				}
				25 = {
					modifier = {
						factor = 0
						combat_rating = 40
					}
					character_event = { id = iyomante.47 days = 2 } # It goes poorly
				}
			}
		}
		
		ai_chance = {
			factor = 100
		}
	}
	
	after = {
		character_event = { id = iyomante.50 days = 4 } # Bear has been killed
	}
}

# Host takes the first shot - it goes well - host
character_event = {
	id = iyomante.40
	desc = EVTDESC_IYOMANTE_40
	picture = GFX_evt_longbowman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_40 # As expected!
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			character_event = { id = iyomante.41 } # Inform guests
		}
	}
}

# Host takes the first shot - it goes well - guest
character_event = {
	id = iyomante.41
	desc = EVTDESC_IYOMANTE_41
	picture = GFX_evt_longbowman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_41 # As expected!
	}
}

# Host takes the first shot - it goes poorly - host
character_event = {
	id = iyomante.42
	desc = EVTDESC_IYOMANTE_42
	picture = GFX_evt_longbowman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_42 # That's not good...
		
		prestige = -25
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			character_event = { id = iyomante.43 } # Inform guests
		}
	}
}

# Host takes the first shot - it goes poorly - guest
character_event = {
	id = iyomante.43
	desc = EVTDESC_IYOMANTE_43
	picture = GFX_evt_longbowman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_43 # How embarassing!
	}
}

# Guest takes the first shot - it goes well - guest
character_event = {
	id = iyomante.44
	desc = EVTDESC_IYOMANTE_44
	picture = GFX_evt_longbowman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_44 # As expected!
		
		prestige = 5
		
		FROM = {
			character_event = { id = iyomante.45 } # Inform host
			any_vassal = {
				limit = {
					ai = no
					has_character_flag = coming_to_iyomante
					NOT = {
						character = ROOT
					}
				}
				character_event = { id = iyomante.46 } # Inform other guests
			}
		}
	}
}

# Guest takes the first shot - it goes well - host
character_event = {
	id = iyomante.45
	desc = EVTDESC_IYOMANTE_45
	picture = GFX_evt_longbowman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_45 # As expected!
	}
}

# Guest takes the first shot - it goes well - other guests
character_event = {
	id = iyomante.46
	desc = EVTDESC_IYOMANTE_46
	picture = GFX_evt_longbowman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_46 # As expected!
	}
}

# Guest takes the first shot - it goes poorly - guest
character_event = {
	id = iyomante.47
	desc = EVTDESC_IYOMANTE_47
	picture = GFX_evt_longbowman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_47 # That went poorly...
		
		prestige = -25
		
		FROM = {
			character_event = { id = iyomante.48 } # Inform host
			any_vassal = {
				limit = {
					ai = no
					has_character_flag = coming_to_iyomante
					NOT = {
						character = ROOT
					}
				}
				character_event = { id = iyomante.49 } # Inform other guests
			}
		}
	}
}

# Guest takes the first shot - it goes poorly - host
character_event = {
	id = iyomante.48
	desc = EVTDESC_IYOMANTE_48
	picture = GFX_evt_longbowman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_48 # How embarassing!
	}
}

# Guest takes the first shot - it goes poorly - other guests
character_event = {
	id = iyomante.49
	desc = EVTDESC_IYOMANTE_49
	picture = GFX_evt_longbowman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_49 # How embarassing!
	}
}

### Bear sacrifice - drinking the blood

# Time to drink the blood - host
character_event = {
	id = iyomante.50
	desc = EVTDESC_IYOMANTE_50
	picture = GFX_evt_magic_ritual
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_50 # Thank you, kamuy!
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_iyomante
			}
			if = {
				limit = {
					OR = {
						religion_openly_ainu_or_reformed_trigger = yes
						true_religion = ainu_pagan
						true_religion = ainu_pagan_reformed
					}
				}
				character_event = { id = iyomante.51 } # Ainu guest is informed
			}
			else = {
				character_event = { id = iyomante.52 } # Non-Ainu guest might react poorly
			}
		}
		
		character_event = { id = iyomante.53 days = 2 } # Inaw/nusa
	}
}

# Time to drink the blood - Ainu guest
character_event = {
	id = iyomante.51
	desc = EVTDESC_IYOMANTE_51
	picture = GFX_evt_magic_ritual
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_51 # Thank you, kamuy!
	}
}

# Time to drink the blood - other guest
character_event = {
	id = iyomante.52
	desc = EVTDESC_IYOMANTE_52
	picture = GFX_evt_magic_ritual
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOR = {
				religion_group = pagan_group
				true_religion_group = pagan_group
			}
		}
		name = EVTOPTA_IYOMANTE_52 # How barbaric!
		
		if = {
			limit = {
				trait = humble
			}
			remove_trait = humble
		}
		else_if = {
			limit = {
				NOT = {
					trait = proud
				}
			}
			add_trait = proud
		}
		
		if = {
			limit = {
				trait = cynical
			}
			remove_trait = cynical
		}
		else_if = {
			limit = {
				NOT = {
					trait = zealous
				}
			}
			add_trait = zealous
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 10
				trait = proud
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				religion_group = pagan_group
				true_religion_group = pagan_group
			}
		}
		name = EVTOPTB_IYOMANTE_52 # These Ainu customs sure are strange...
		
		if = {
			limit = {
				trait = humble
			}
			remove_trait = humble
		}
		else_if = {
			limit = {
				NOT = {
					trait = proud
				}
			}
			add_trait = proud
		}
		
		if = {
			limit = {
				trait = cynical
			}
			remove_trait = cynical
		}
		else_if = {
			limit = {
				NOT = {
					trait = zealous
				}
			}
			add_trait = zealous
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 10
				trait = proud
			}
		}
	}
	
	option = {
		trigger = {
			NOT = {
				trait = zealous
			}
		}
		
		name = EVTOPTC_IYOMANTE_52 # A curious ritual...
		
		if = {
			limit = {
				NOT = {
					trait = sympathy_pagans
				}
			}
			add_trait = sympathy_pagans
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				NOR = {
					religion_group = pagan_group
					true_religion_group = pagan_group
					trait = sympathy_pagans
				}
			}
		}
	}
}

### Bear sacrifice - inaw/nusa

# Hidden event to select the appropriate event
character_event = {
	id = iyomante.53
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	immediate = {
		if = {
			limit = {
				has_character_flag = iyomante_many_nusa
			}
			character_event = { id = iyomante.54 } # Plentiful nusa
		}
		else_if = {
			limit = {
				has_character_flag = iyomante_normal_nusa
			}
			character_event = { id = iyomante.56 } # Enough nusa
		}
		else_if = {
			limit = {
				has_character_flag = iyomante_single_inaw
			}
			character_event = { id = iyomante.58 } # A single inaw
		}
		
		# Go to the sake event
		character_event = { id = iyomante.60 days = 2 }
	}
}

# Host offers plentiful nusa - host
character_event = {
	id = iyomante.54
	desc = EVTDESC_IYOMANTE_54
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_54 # For you, kamuy!
		
		piety = 25
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			character_event = { id = iyomante.55 } # Inform guests
		}
	}
}

# Host offers plentiful nusa - guest
character_event = {
	id = iyomante.55
	desc = EVTDESC_IYOMANTE_55
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_55 # An impressive sacrifice!
	}
}

# Host offers a reasonable amount of nusa - host
character_event = {
	id = iyomante.56
	desc = EVTDESC_IYOMANTE_56
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_56 # For you, kamuy!
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			character_event = { id = iyomante.57 } # Inform guests
		}
	}
}


# Host offers a reasonable amount of nusa - guest
character_event = {
	id = iyomante.57
	desc = EVTDESC_IYOMANTE_57
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_57 # A good sacrifice!
	}
}

# Host offers a single inaw - host
character_event = {
	id = iyomante.58
	desc = EVTDESC_IYOMANTE_58
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_58 # I'm sure the kamuy will understand...
		
		piety = -25
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			character_event = { id = iyomante.59 } # Inform guests
		}
	}
}


# Host offers a single inaw - guest
character_event = {
	id = iyomante.59
	desc = EVTDESC_IYOMANTE_59
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_59 # That's all?
	}
}

### Bear sacrifice - sake

# Hidden event to select the appropriate event
character_event = {
	id = iyomante.60
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	immediate = {
		if = {
			limit = {
				has_character_flag = iyomante_plentiful_sake
			}
			character_event = { id = iyomante.61 } # Plentiful sake
		}
		else_if = {
			limit = {
				has_character_flag = iyomante_normal_sake
			}
			character_event = { id = iyomante.63 } # Enough sake
		}
		else_if = {
			limit = {
				has_character_flag = iyomante_little_sake
			}
			character_event = { id = iyomante.65 } # Very little sake
		}
		
		# Go to the meat event
		character_event = { id = iyomante.67 days = 2 }
	}
}

# Host offers plentiful sake - host
character_event = {
	id = iyomante.61
	desc = EVTDESC_IYOMANTE_61
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_61 # For you, kamuy!
		
		piety = 25
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			character_event = { id = iyomante.62 } # Inform guests
		}
	}
}

# Host offers plentiful sake - guest
character_event = {
	id = iyomante.62
	desc = EVTDESC_IYOMANTE_62
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_62 # An impressive sacrifice!
	}
}

# Host offers a reasonable amount of sake - host
character_event = {
	id = iyomante.63
	desc = EVTDESC_IYOMANTE_63
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_63 # For you, kamuy!
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			character_event = { id = iyomante.64 } # Inform guests
		}
	}
}


# Host offers a reasonable amount of sake - guest
character_event = {
	id = iyomante.64
	desc = EVTDESC_IYOMANTE_64
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_64 # A good sacrifice!
	}
}

# Host offers very little sake - host
character_event = {
	id = iyomante.65
	desc = EVTDESC_IYOMANTE_65
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_65 # I'm sure the kamuy will understand...
		
		piety = -25
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			character_event = { id = iyomante.66 } # Inform guests
		}
	}
}


# Host offers very little sake - guest
character_event = {
	id = iyomante.66
	desc = EVTDESC_IYOMANTE_66
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_66 # That's all?
	}
}

### Bear sacrifice - distribute the meat

# Host decides how to distribute the meat
character_event = {
	id = iyomante.67
	desc = EVTDESC_IYOMANTE_67
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	immediate = {
		any_vassal = {
			limit = { 
				has_character_flag = coming_to_iyomante
			}
			score_value = { #Prioritizes selecting an interesting courtier...
				value = 10
				interesting_courtier_selection_score = yes
			}
			save_event_target_as = iyomante_meat_recipient_1
		}
		any_courtier = {
			limit = {
				is_landed = no
				is_inaccessible_or_incapable_trigger = no
			}
			score_value = { #Prioritizes selecting an interesting courtier...
				value = 10
				interesting_courtier_selection_score = yes
			}
			save_event_target_as = iyomante_meat_recipient_2
		}
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_67 # Everyone will get some!
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			character_event = { id = iyomante.68 } # Everyone gets meat
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 10
				trait = just
			}
			modifier = {
				factor = 0.1
				trait = greedy
			}
			modifier = {
				factor = 0.1
				trait = gluttonous
			}
		}
	}
	
	option = {
		trigger = {
			event_target:iyomante_meat_recipient_1 = {
				always = yes
			}
		}
		name = EVTOPTB_IYOMANTE_67 # I'll give everything to a vassal!
		
		event_target:iyomante_meat_recipient_1 = {
			save_event_target_as = iyomante_meat_recipient
			opinion = {
				who = ROOT
				modifier = opinion_generous_iyomante_gift
			}
			character_event = { id = iyomante.69 } # You got all the meat!
		}
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_iyomante
				NOT = {
					character = event_target:iyomante_meat_recipient_1
				}
			}
			opinion = {
				who = ROOT
				modifier = opinion_displeased
			}
			character_event = { id = iyomante.70 } # Someone else got all the meat!
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				any_rival = {
					character = event_target:iyomante_meat_recipient_1
				}
			}
			modifier = {
				factor = 0.1
				trait = greedy
			}
			modifier = {
				factor = 0.1
				trait = gluttonous
			}
		}
	}
	
	option = {
		trigger = {
			event_target:iyomante_meat_recipient_2 = {
				always = yes
			}
		}
		name = EVTOPTC_IYOMANTE_67 # I'll give everything to a courtier!
		
		event_target:iyomante_meat_recipient_2 = {
			save_event_target_as = iyomante_meat_recipient
			opinion = {
				who = ROOT
				modifier = opinion_generous_iyomante_gift
			}
			character_event = { id = iyomante.69 } # You got all the meat!
		}
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_iyomante
			}
			opinion = {
				who = ROOT
				modifier = opinion_displeased
			}
			character_event = { id = iyomante.70 } # Someone else got all the meat!
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				any_rival = {
					character = event_target:iyomante_meat_recipient_2
				}
			}
			modifier = {
				factor = 0.1
				trait = greedy
			}
			modifier = {
				factor = 0.1
				trait = gluttonous
			}
		}
	}
	
	option = {
		name = EVTOPTD_IYOMANTE_67 # I'll keep all the meat!
		
		prestige = 25
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_iyomante
			}
			opinion = {
				who = ROOT
				modifier = opinion_displeased
			}
			character_event = { id = iyomante.71 } # Liege didn't share the meat!
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = charitable
			}
			modifier = {
				factor = 0.1
				trait = temperate
			}
			modifier = {
				factor = 0.1
				trait = content
			}
		}
	}
	
	after = {
		character_event = { id = iyomante.75 days = 2 } # Go to event selection 3
	}
}

# Everyone got something - guest
character_event = {
	id = iyomante.68
	desc = EVTDESC_IYOMANTE_68
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_68 # My thanks!
	}
}

# You got everything
character_event = {
	id = iyomante.69
	desc = EVTDESC_IYOMANTE_69
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_69 # How generous!
	}
}

# Someone else got everything
character_event = {
	id = iyomante.70
	desc = EVTDESC_IYOMANTE_70
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_70 # This isn't right!
	}
}

# Host kept all the meat
character_event = {
	id = iyomante.71
	desc = EVTDESC_IYOMANTE_71
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_71 # This isn't right!
	}
}

### Alternative sake events if the sacrifice didn't happen

# Drink to forget - host
character_event = {
	id = iyomante.72
	desc = EVTDESC_IYOMANTE_72
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_72 # At least we have sake...
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_iyomante
			}
			character_event = { id = iyomante.73 } # Vassals also drink
		}
		
		if = {
			limit = {
				has_character_flag = iyomante_plentiful_sake
			}
			random = {
				chance = 25
				character_event = { id = iyomante.74 days = 1 } # You had way too much to drink
			}
		}
		else_if = {
			limit = {
				has_character_flag = iyomante_normal_sake
			}
			random = {
				chance = 5
				character_event = { id = iyomante.74 days = 1 } # You had way too much to drink
			}
		}
	}
	
	after = {
		character_event = { id = iyomante.75 days = 2 } # Go to event selection 3
	}
}

# Drink to forget - guest
character_event = {
	id = iyomante.73
	desc = EVTDESC_IYOMANTE_73
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_73 # At least we have sake...
		
		# Vassal is less likely to get drunk, seeing as they didn't fail to do the sacrifice
		if = {
			limit = {
				FROM = {
					has_character_flag = iyomante_plentiful_sake
				}
			}
			random = {
				chance = 5
				character_event = { id = iyomante.74 days = 1 } # You had way too much to drink
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = iyomante_plentiful_sake
				}
			}
			random = {
				chance = 1
				character_event = { id = iyomante.74 days = 1 } # You had way too much to drink
			}
		}
	}
}

# Drank way too much
character_event = {
	id = iyomante.74
	desc = EVTDESC_IYOMANTE_74
	picture = GFX_evt_drunk
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_74 # That... was a mistake...
		
		prestige = -25
		
		if = {
			limit = {
				trait = temperate
			}
			remove_trait = temperate
		}
		else = {
			add_trait = drunkard
		}
	}
}

##### Event group 3

# Event selection
character_event = {
	id = iyomante.75
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	immediate = {
		if = {
			limit = {
				NOT = {
					has_character_flag = iyomante_no_sacrifice
				}
			}
			character_event = { id = iyomante.76 } # Bear "doll"
		}
		
		# Yukar
		random_list = {
			50 = {
				character_event = { id = iyomante.78 days = 2 } # Host gets to recite a yukar
			}
			50 = {
				modifier = {
					factor = 0
					NOT = {
						any_vassal = {
							has_character_flag = coming_to_iyomante
							war = no
						}
					}
				}
				any_vassal = {
					limit = { 
						has_character_flag = coming_to_iyomante
						war = no
					}
					score_value = { #Prioritizes selecting an interesting courtier...
						value = 10
						interesting_courtier_selection_score = yes
					}
					character_event = { id = iyomante.85 days = 2 } # Guest gets to recite a yukar
				}
			}
		}
		
		# Go to the end of the Iyomante
		character_event = { id = iyomante.95 days = 6 }
	}
}

### Bear "doll"

# Fur and skull on a spear - host
character_event = {
	id = iyomante.76
	desc = EVTDESC_IYOMANTE_76
	picture = GFX_evt_religious_exultation
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_76 # It has been sent off!
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			character_event = { id = iyomante.77 } # Inform guests
		}
	}
}

# Fur and skull on a spear - guest
character_event = {
	id = iyomante.77
	desc = EVTDESC_IYOMANTE_77
	picture = GFX_evt_religious_exultation
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_77 # It has been sent off!
	}
}

### Yukar - host

# Host gets the opportunity to recite a yukar
character_event = {
	id = iyomante.78
	desc = EVTDESC_IYOMANTE_78
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_78 # Of course I'll do it!
		
		# Checks Learning and Diplomacy - Learning to remember, Diplomacy to be eloquent
		random_list = {
			20 = {
				modifier = {
					factor = 2
					diplomacy = 24
				}
				modifier = {
					factor = 2
					diplomacy = 20
				}
				modifier = {
					factor = 2
					learning = 24
				}
				modifier = {
					factor = 2
					learning = 20
				}
				character_event = { id = iyomante.79 days = 2 } # It goes very well
				any_vassal = {
					limit = {
						ai = no
						has_character_flag = coming_to_iyomante
					}
					character_event = { id = iyomante.80 days = 2 } # Inform guests
				}
			}
			60 = {
				character_event = { id = iyomante.81 days = 2 } # It goes okay
				any_vassal = {
					limit = {
						ai = no
						has_character_flag = coming_to_iyomante
					}
					character_event = { id = iyomante.82 days = 2 } # Inform guests
				}
			}
			20 = {
				modifier = {
					factor = 2
					NOT = {
						diplomacy = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						diplomacy = 4
					}
				}
				modifier = {
					factor = 2
					NOT = {
						learning = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						learning = 4
					}
				}
				character_event = { id = iyomante.83 days = 2 } # It goes very poorly
				any_vassal = {
					limit = {
						ai = no
						has_character_flag = coming_to_iyomante
					}
					character_event = { id = iyomante.84 days = 2 } # Inform guests
				}
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.01
				trait = shy
			}
			modifier = {
				factor = 0.1
				trait = craven
			}
			modifier = {
				factor = 10
				trait = proud
			}
		}
	}
	
	option = {
		name = EVTOPTB_IYOMANTE_78 # I think not!
		
		prestige = -10
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.01
				trait = gregarious
			}
			modifier = {
				factor = 0.1
				trait = brave
			}
			modifier = {
				factor = 10
				trait = humble
			}
		}
	}
}

# Host recites a yukar extremely well - host
character_event = {
	id = iyomante.79
	desc = EVTDESC_IYOMANTE_79
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_79 # That went well!
		
		prestige = 25
		piety = 25
	}
}

# Host recites a yukar extremely well - guest
character_event = {
	id = iyomante.80
	desc = EVTDESC_IYOMANTE_80
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_80 # Impressive!
	}
}

# Host recites a yukar decently - host
character_event = {
	id = iyomante.81
	desc = EVTDESC_IYOMANTE_81
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_81 # That went okay!
		
		prestige = 5
		piety = 5
	}
}

# Host recites a yukar decently - guest
character_event = {
	id = iyomante.82
	desc = EVTDESC_IYOMANTE_82
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_82 # Tolerable!
	}
}

# Host recites a yukar very poorly - host
character_event = {
	id = iyomante.83
	desc = EVTDESC_IYOMANTE_83
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_83 # That went poorly!
		
		prestige = -25
		piety = -25
	}
}

# Host recites a yukar very poorly - guest
character_event = {
	id = iyomante.84
	desc = EVTDESC_IYOMANTE_84
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_84 # That wasn't very good!
	}
}

### Yukar - guest

# Guest gets the opportunity to recite a yukar
character_event = {
	id = iyomante.85
	desc = EVTDESC_IYOMANTE_85
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_85 # Of course I'll do it!
		
		# Checks Learning and Diplomacy - Learning to remember, Diplomacy to be eloquent
		random_list = {
			20 = {
				modifier = {
					factor = 2
					diplomacy = 24
				}
				modifier = {
					factor = 2
					diplomacy = 20
				}
				modifier = {
					factor = 2
					learning = 24
				}
				modifier = {
					factor = 2
					learning = 20
				}
				character_event = { id = iyomante.86 days = 2 } # It goes very well
				FROM = {
					character_event = { id = iyomante.87 days = 2 } # Inform host
					any_vassal = {
						limit = {
							ai = no
							has_character_flag = coming_to_iyomante
							NOT = {
								character = ROOT
							}
						}
						character_event = { id = iyomante.88 days = 2 } # Inform other guests
					}
				}
			}
			60 = {
				character_event = { id = iyomante.89 days = 2 } # It goes okay
				FROM = {
					character_event = { id = iyomante.90 days = 2 } # Inform host
					any_vassal = {
						limit = {
							ai = no
							has_character_flag = coming_to_iyomante
							NOT = {
								character = ROOT
							}
						}
						character_event = { id = iyomante.91 days = 2 } # Inform other guests
					}
				}
			}
			20 = {
				modifier = {
					factor = 2
					NOT = {
						diplomacy = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						diplomacy = 4
					}
				}
				modifier = {
					factor = 2
					NOT = {
						learning = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						learning = 4
					}
				}
				character_event = { id = iyomante.92 days = 2 } # It goes very poorly
				FROM = {
					character_event = { id = iyomante.93 days = 2 } # Inform host
					any_vassal = {
						limit = {
							ai = no
							has_character_flag = coming_to_iyomante
							NOT = {
								character = ROOT
							}
						}
						character_event = { id = iyomante.94 days = 2 } # Inform other guests
					}
				}
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.01
				trait = shy
			}
			modifier = {
				factor = 0.1
				trait = craven
			}
			modifier = {
				factor = 10
				trait = proud
			}
		}
	}
	
	option = {
		name = EVTOPTB_IYOMANTE_85 # I think not!
		
		prestige = -10
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.01
				trait = gregarious
			}
			modifier = {
				factor = 0.1
				trait = brave
			}
			modifier = {
				factor = 10
				trait = humble
			}
		}
	}
}

# Guest recites a yukar extremely well - guest
character_event = {
	id = iyomante.86
	desc = EVTDESC_IYOMANTE_86
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROMFROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_86 # That went well!
		
		prestige = 25
		piety = 25
	}
}

# Guest recites a yukar extremely well - host
character_event = {
	id = iyomante.87
	desc = EVTDESC_IYOMANTE_87
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_87 # Impressive!
	}
}

# Guest recites a yukar extremely well - other guests
character_event = {
	id = iyomante.88
	desc = EVTDESC_IYOMANTE_88
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROMFROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_88 # Impressive!
	}
}

# Guest recites a yukar decently - guest
character_event = {
	id = iyomante.89
	desc = EVTDESC_IYOMANTE_89
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROMFROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_89 # That went okay!
		
		prestige = 5
		piety = 5
	}
}

# Guest recites a yukar decently - host
character_event = {
	id = iyomante.90
	desc = EVTDESC_IYOMANTE_90
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_90  # Tolerable!
	}
}

# Guest recites a yukar decently - other guests
character_event = {
	id = iyomante.91
	desc = EVTDESC_IYOMANTE_91
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROMFROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_91 # Tolerable!
	}
}

# Guest recites a yukar very poorly - guest
character_event = {
	id = iyomante.92
	desc = EVTDESC_IYOMANTE_92
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROMFROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_92 # That went poorly!
		
		prestige = -25
		piety = -25
	}
}

# Guest recites a yukar decently - host
character_event = {
	id = iyomante.93
	desc = EVTDESC_IYOMANTE_93
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_93 # That was't very good!
	}
}

# Guest recites a yukar very poorly - other guests
character_event = {
	id = iyomante.94
	desc = EVTDESC_IYOMANTE_94
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROMFROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_IYOMANTE_94 # That wasn't very good!
	}
}

##### End of Iyomante

# Check which ending is relevant
character_event = {
	id = iyomante.95
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	immediate = {
		if = {
			limit = {
				NOT = {
					has_character_flag = iyomante_no_sacrifice
				}
			}
			character_event = { id = iyomante.96 } # Normal end
		}
		else = {
			character_event = { id = iyomante.98 } # No sacrifice
		}
	}
}

# End of normal Iyomante - host
character_event = {
	id = iyomante.96
	desc = EVTDESC_IYOMANTE_96
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_96 # Until next time!
		
		prestige = 25
		piety = 25
		set_character_flag = recent_iyomante
		
		hidden_tooltip = {
			# Clear flags
			clr_character_flag = coming_to_iyomante
			clr_character_flag = do_not_disturb
			clr_character_flag = guest_iyomante_started
			clr_character_flag = host_iyomante_started
			clr_character_flag = iyomante_little_sake
			clr_character_flag = iyomante_many_nusa
			clr_character_flag = iyomante_no_sacrifice
			clr_character_flag = iyomante_normal_nusa
			clr_character_flag = iyomante_normal_sake
			clr_character_flag = iyomante_plentiful_sake
			clr_character_flag = iyomante_single_inaw
			clr_character_flag = lavishly_food
			clr_character_flag = low_food
			clr_character_flag = medium_food
			clr_character_flag = sent_invitations
			any_vassal = {
				limit = {
					has_character_flag = coming_to_iyomante
				}
				character_event = { id = iyomante.97 } # Inform vassals
				remove_opinion = {
					modifier = opinion_enjoyed_iyomante
					who = ROOT
				}
				remove_opinion = {
					modifier = opinion_did_not_enjoy_iyomante
					who = ROOT
				}
				opinion = {
					modifier = opinion_enjoyed_iyomante
					who = ROOT
					years = 2
				}
				# Clear flags
				clr_character_flag = coming_to_iyomante
				clr_character_flag = do_not_disturb
				clr_character_flag = guest_iyomante_started
				clr_character_flag = host_iyomante_started
				clr_character_flag = iyomante_little_sake
				clr_character_flag = iyomante_many_nusa
				clr_character_flag = iyomante_no_sacrifice
				clr_character_flag = iyomante_normal_nusa
				clr_character_flag = iyomante_normal_sake
				clr_character_flag = iyomante_plentiful_sake
				clr_character_flag = iyomante_single_inaw
				clr_character_flag = lavishly_food
				clr_character_flag = low_food
				clr_character_flag = medium_food
				clr_character_flag = sent_invitations
			}
		}
	}
}

# End of normal Iyomante - guest
character_event = {
	id = iyomante.97
	desc = EVTDESC_IYOMANTE_97
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_97 # Until next time!
		
		prestige = 5
		piety = 5
	}
}

# End of Iyomante without a sacrifice - host
character_event = {
	id = iyomante.98
	desc = EVTDESC_IYOMANTE_98
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_98 # Maybe the next one will be a proper one...
		
		prestige = -10
		piety = -10
		set_character_flag = recent_iyomante
		
		hidden_tooltip = {
			clr_character_flag = coming_to_iyomante
			clr_character_flag = do_not_disturb
			clr_character_flag = guest_iyomante_started
			clr_character_flag = host_iyomante_started
			clr_character_flag = iyomante_little_sake
			clr_character_flag = iyomante_many_nusa
			clr_character_flag = iyomante_no_sacrifice
			clr_character_flag = iyomante_normal_nusa
			clr_character_flag = iyomante_normal_sake
			clr_character_flag = iyomante_plentiful_sake
			clr_character_flag = iyomante_single_inaw
			clr_character_flag = lavishly_food
			clr_character_flag = low_food
			clr_character_flag = medium_food
			clr_character_flag = sent_invitations
			any_vassal = {
				limit = {
					has_character_flag = coming_to_iyomante
				}
				character_event = { id = iyomante.99 } # Inform vassals
				remove_opinion = {
					modifier = opinion_enjoyed_iyomante
					who = ROOT
				}
				remove_opinion = {
					modifier = opinion_did_not_enjoy_iyomante
					who = ROOT
				}
				opinion = {
					modifier = opinion_did_not_enjoy_iyomante
					who = ROOT
					years = 2
				}
				# Clear flags
				clr_character_flag = coming_to_iyomante
				clr_character_flag = do_not_disturb
				clr_character_flag = guest_iyomante_started
				clr_character_flag = host_iyomante_started
				clr_character_flag = iyomante_little_sake
				clr_character_flag = iyomante_many_nusa
				clr_character_flag = iyomante_no_sacrifice
				clr_character_flag = iyomante_normal_nusa
				clr_character_flag = iyomante_normal_sake
				clr_character_flag = iyomante_plentiful_sake
				clr_character_flag = iyomante_single_inaw
				clr_character_flag = lavishly_food
				clr_character_flag = low_food
				clr_character_flag = medium_food
				clr_character_flag = sent_invitations
			}
		}
	}
}

# End of Iyomante without a sacrifice - guest
character_event = {
	id = iyomante.99
	desc = EVTDESC_IYOMANTE_99
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_IYOMANTE_99 # Maybe the next one will be a proper one...
	}
}

# Iyomante cancelled - host
character_event = {
	id = iyomante.100
	desc = EVTDESC_IYOMANTE_100
	picture = GFX_evt_feast

	only_rulers = yes
	war = yes

	mean_time_to_happen = {
		days = 1
	}

	trigger = {
		has_character_modifier = iyomante_in_progress
	}

	option = {
		name = EVTOPTA_IYOMANTE_100 # I see...
		hidden_tooltip = {
			remove_character_modifier = iyomante_in_progress
			# Clear flags
			clr_character_flag = coming_to_iyomante
			clr_character_flag = do_not_disturb
			clr_character_flag = guest_iyomante_started
			clr_character_flag = host_iyomante_started
			clr_character_flag = iyomante_little_sake
			clr_character_flag = iyomante_many_nusa
			clr_character_flag = iyomante_no_sacrifice
			clr_character_flag = iyomante_normal_nusa
			clr_character_flag = iyomante_normal_sake
			clr_character_flag = iyomante_plentiful_sake
			clr_character_flag = iyomante_single_inaw
			clr_character_flag = lavishly_food
			clr_character_flag = low_food
			clr_character_flag = medium_food
			clr_character_flag = recent_iyomante
			clr_character_flag = sent_invitations
			any_vassal = {
				limit = {
					has_character_flag = guest_iyomante_started
				}
				# Clear flags
				clr_character_flag = coming_to_iyomante
				clr_character_flag = do_not_disturb
				clr_character_flag = guest_iyomante_started
				clr_character_flag = host_iyomante_started
				clr_character_flag = iyomante_little_sake
				clr_character_flag = iyomante_many_nusa
				clr_character_flag = iyomante_no_sacrifice
				clr_character_flag = iyomante_normal_nusa
				clr_character_flag = iyomante_normal_sake
				clr_character_flag = iyomante_plentiful_sake
				clr_character_flag = iyomante_single_inaw
				clr_character_flag = lavishly_food
				clr_character_flag = low_food
				clr_character_flag = medium_food
				clr_character_flag = recent_iyomante
				clr_character_flag = sent_invitations
				letter_event = { id = iyomante.101 } # Inform vassals
			}
			any_courtier = {
				# Clear flags
				clr_character_flag = coming_to_iyomante
				clr_character_flag = do_not_disturb
				clr_character_flag = guest_iyomante_started
				clr_character_flag = host_iyomante_started
				clr_character_flag = iyomante_little_sake
				clr_character_flag = iyomante_many_nusa
				clr_character_flag = iyomante_no_sacrifice
				clr_character_flag = iyomante_normal_nusa
				clr_character_flag = iyomante_normal_sake
				clr_character_flag = iyomante_plentiful_sake
				clr_character_flag = iyomante_single_inaw
				clr_character_flag = lavishly_food
				clr_character_flag = low_food
				clr_character_flag = medium_food
				clr_character_flag = recent_iyomante
				clr_character_flag = sent_invitations
			}
		}
	}
}

# Iyomante cancelled - vassals
letter_event = {
	id = iyomante.101
	desc = EVTDESC_IYOMANTE_101

	is_triggered_only = yes

	option = {
		name = EVTOPTA_IYOMANTE_101 # I see...
	}
}

# Flag cleanup
character_event = {
	id = iyomante.102
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		# Clear flags
		clr_character_flag = coming_to_iyomante
		clr_character_flag = do_not_disturb
		clr_character_flag = guest_iyomante_started
		clr_character_flag = host_iyomante_started
		clr_character_flag = iyomante_little_sake
		clr_character_flag = iyomante_many_nusa
		clr_character_flag = iyomante_no_sacrifice
		clr_character_flag = iyomante_normal_nusa
		clr_character_flag = iyomante_normal_sake
		clr_character_flag = iyomante_plentiful_sake
		clr_character_flag = iyomante_single_inaw
		clr_character_flag = lavishly_food
		clr_character_flag = low_food
		clr_character_flag = medium_food
		clr_character_flag = sent_invitations
		any_courtier = {
			limit = {
				has_character_flag = guest_iyomante_started
			}
			# Clear flags
			clr_character_flag = coming_to_iyomante
			clr_character_flag = do_not_disturb
			clr_character_flag = guest_iyomante_started
			clr_character_flag = host_iyomante_started
			clr_character_flag = iyomante_little_sake
			clr_character_flag = iyomante_many_nusa
			clr_character_flag = iyomante_no_sacrifice
			clr_character_flag = iyomante_normal_nusa
			clr_character_flag = iyomante_normal_sake
			clr_character_flag = iyomante_plentiful_sake
			clr_character_flag = iyomante_single_inaw
			clr_character_flag = lavishly_food
			clr_character_flag = low_food
			clr_character_flag = medium_food
			clr_character_flag = sent_invitations
		}
		any_vassal = {
			limit = {
				has_character_flag = guest_iyomante_started
			}
			# Clear flags
			clr_character_flag = coming_to_iyomante
			clr_character_flag = do_not_disturb
			clr_character_flag = guest_iyomante_started
			clr_character_flag = host_iyomante_started
			clr_character_flag = iyomante_little_sake
			clr_character_flag = iyomante_many_nusa
			clr_character_flag = iyomante_no_sacrifice
			clr_character_flag = iyomante_normal_nusa
			clr_character_flag = iyomante_normal_sake
			clr_character_flag = iyomante_plentiful_sake
			clr_character_flag = iyomante_single_inaw
			clr_character_flag = lavishly_food
			clr_character_flag = low_food
			clr_character_flag = medium_food
			clr_character_flag = sent_invitations
		}
	}
}