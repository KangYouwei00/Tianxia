###########################################
#
# Conversion Decisions for Sons of Heaven
#
###########################################

# Written by Hansol "LumberKing" Lee

decisions = {

	convert_to_confucianism = {

		icon_religion = confucian

		potential = {
			ai = no
			is_playable = yes
			religion_group = chinese_group
			NOT = { religion = confucian }
			is_theocracy = no
		}
		allow = {
			is_adult = yes
			prestige = 500
			NOT = { trait = zealous }
			any_realm_province = {
				religion = confucian
			}
			custom_tooltip = {
				text = chinese_has_not_converted
				NOT = { has_character_flag = china_converted }
			}
		}
		effect = {
			if = {
				limit = { higher_tier_than = BARON }
				religion_authority = {
					modifier = ruler_converted_from
				}
			}
			religion = confucian
			if = {
				limit = { higher_tier_than = BARON }
				hidden_tooltip = {
					religion_authority = {
						modifier = ruler_converted_to
					}
				}
			}
			set_character_flag = china_converted
			prestige = -500
			piety = 100
			hidden_tooltip = { character_event = { id = SoH.110 } } # Choose branch
		}
		revoke_allowed = {
			always = no
		}
		ai_will_do = {
			factor = 1

			modifier = { # Slow down
				factor = 0.1
			}
			modifier = { # Don't convert away from liege's religion
				factor = 0
				liege = { religion = ROOT }
			}
			modifier = { # Don't start rocking the boat if all your provinces are under foreign religious influence
				factor = 0
				NOT = {
					any_realm_province = {
						religion_group = chinese_group
					}
				}
			}
			modifier = { # NEVER consider it unless your liege or, if independent, all your vassals are confucian and they don't like you
				factor = 0
				NOT = {
					OR = {
						AND = {
							independent = yes
							NOT = {
								any_vassal = {
									NOT = { religion = confucian }
								}
							}
							NOT = {
								any_vassal = {
									opinion = {
										who = ROOT
										value = 25
									}
								}
							}
						}
						AND = {
							liege = { religion = confucian }
							opinion = {
								who = liege
								value = 25
							}
						}
					}
				}
			}
			modifier = { # More likely to do it sooner
				factor = 3
				trait = cynical
			}
			modifier = { # Sometimes you really need to hurry up
				factor = 5
				higher_tier_than = DUKE
				num_of_vassals = 5
			}
		}
	}

	convert_to_amidism = {
	
		icon_religion = amidist
	
		potential = {
			ai = no
			is_playable = yes
			OR = {
				religion_group = chinese_group
				religion = japanese_pagan_reformed
				AND = {
					religion = buddhist
					trait = mahayana_buddhist
				}
			}
			NOT = { religion = amidist }
			is_theocracy = no
		}
		allow = {
			is_adult = yes
			prestige = 500
			NOT = { trait = zealous }
			any_realm_province = {
				religion = amidist
			}
			custom_tooltip = {
				text = chinese_has_not_converted
				NOT = { has_character_flag = china_converted }
			}
		}
		effect = {
			if = {
				limit = { higher_tier_than = BARON }
				religion_authority = {
					modifier = ruler_converted_from
				}
			}
			religion = amidist
			if = {
				limit = { higher_tier_than = BARON }
				hidden_tooltip = {
					religion_authority = {
						modifier = ruler_converted_to
					}
				}
			}
			set_character_flag = china_converted
			prestige = -500
			piety = 100
			hidden_tooltip = { character_event = { id = SoH.111 } } # Choose branch
		}
		revoke_allowed = {
			always = no
		}
		ai_will_do = {
			factor = 1

			modifier = { # Slow down
				factor = 0.1
			}
			modifier = { # Don't convert away from liege's religion
				factor = 0
				liege = { religion = ROOT }
			}
			modifier = { # Don't start rocking the boat if all your provinces are under foreign religious influence
				factor = 0
				NOT = {
					any_realm_province = {
						religion_group = chinese_group
					}
				}
			}
			modifier = { # NEVER consider it unless your liege or, if independent, all your vassals are amidist and they don't like you
				factor = 0
				NOT = {
					OR = {
						AND = {
							independent = yes
							NOT = {
								any_vassal = {
									NOT = { religion = amidist }
								}
							}
							NOT = {
								any_vassal = {
									opinion = {
										who = ROOT
										value = 25
									}
								}
							}
						}
						AND = {
							liege = { religion = amidist }
							opinion = {
								who = liege
								value = 25
							}
						}
					}
				}
			}
			modifier = { # More likely to do it sooner
				factor = 3
				trait = cynical
			}
			modifier = { # Sometimes you really need to hurry up
				factor = 5
				higher_tier_than = DUKE
				num_of_vassals = 5
			}
		}
	}

	convert_to_taoism = {
	
		icon_religion = taoist
	
		potential = {
			ai = no
			is_playable = yes
			religion_group = chinese_group
			NOT = { religion = taoist }
			is_theocracy = no
		}
		allow = {
			is_adult = yes
			prestige = 500
			NOT = { trait = zealous }
			any_realm_province = {
				religion = taoist
			}
			custom_tooltip = {
				text = chinese_has_not_converted
				NOT = { has_character_flag = china_converted }
			}
		}
		effect = {
			if = {
				limit = { higher_tier_than = BARON }
				religion_authority = {
					modifier = ruler_converted_from
				}
			}
			religion = taoist
			if = {
				limit = { higher_tier_than = BARON }
				hidden_tooltip = {
					religion_authority = {
						modifier = ruler_converted_to
					}
				}
			}
			set_character_flag = china_converted
			prestige = -500
			piety = 100
			hidden_tooltip = { character_event = { id = SoH.112 } } # Choose branch
		}
		revoke_allowed = {
			always = no
		}
		ai_will_do = {
			factor = 1

			modifier = { # Slow down
				factor = 0.1
			}
			modifier = { # Don't convert away from liege's religion
				factor = 0
				liege = { religion = ROOT }
			}
			modifier = { # Don't start rocking the boat if all your provinces are under foreign religious influence
				factor = 0
				NOT = {
					any_realm_province = {
						religion_group = chinese_group
					}
				}
			}
			modifier = { # NEVER consider it unless your liege or, if independent, all your vassals are taoist and they don't like you
				factor = 0
				NOT = {
					OR = {
						AND = {
							independent = yes
							NOT = {
								any_vassal = {
									NOT = { religion = taoist }
								}
							}
							NOT = {
								any_vassal = {
									opinion = {
										who = ROOT
										value = 25
									}
								}
							}
						}
						AND = {
							liege = { religion = taoist }
							opinion = {
								who = liege
								value = 25
							}
						}
					}
				}
			}
			modifier = { # More likely to do it sooner
				factor = 3
				trait = cynical
			}
			modifier = { # Sometimes you really need to hurry up
				factor = 5
				higher_tier_than = DUKE
				num_of_vassals = 5
			}
		}
	}

	convert_chinese_branch = {
		potential = {
			ai = no
			is_playable = yes
			is_adult = yes
			is_theocracy = no
			religion_group = chinese_group
		}
		allow = {
			NOT = { trait = zealous }
			prestige = 50
			custom_tooltip = {
				text = chinese_has_not_converted
				NOT = { has_character_flag = china_branch_converted }
			}
		}
		effect = {
			set_character_flag = china_branch_converted
			prestige = -50
			piety = 25
			if = {
				limit = { religion = confucian }
				character_event = { id = SoH.115 } # Choose branch
			}
			if = {
				limit = { religion = amidist }
				character_event = { id = SoH.116 } # Choose branch
			}
			if = {
				limit = { religion = taoist }
				character_event = { id = SoH.117 } # Choose branch
			}
		}
		revoke_allowed = {
			always = no
		}
		ai_will_do = {
			factor = 0
		}
	}

	# Pagans can convert to the Confucian faith if their wife or a concubine is a believer
	convert_to_spouse_confucian = {
	
		icon_religion = confucian
	
		potential = {
			ai = no
			is_playable = yes
			religion_group = pagan_group
			controls_religion = no
			NOT = { trait = zealous }
			OR = {
				any_spouse = {
					religion = confucian
					hidden_tooltip = {
						is_alive = yes
					}
				}
				any_consort = {
					religion = confucian
					hidden_tooltip = {
						is_alive = yes
					}
				}
			}
		}
		
		effect = {
			prestige = -500
			religion_authority = {
				modifier = ruler_converted_from
			}
			
			if = {
				limit = {
					trait = cynical
				}
				random = {
					chance = 60
					add_trait = sympathy_pagans
				}
			}
			if = {
				limit = {
					NOT = { trait = cynical }
				}
				random = {
					chance = 50
					add_trait = sympathy_pagans
				}
			}		
			
			religion = confucian

			if = {
				limit = {
					any_courtier = {
						OR = {
							spouse = { character = ROOT }
							is_consort = ROOT
						}
						religion = confucian
						hidden_tooltip = {
							is_alive = yes
						}
						trait = ren_confucian
					}
				}
				add_trait = ren_confucian
			}
			if = {
				limit = {
					any_courtier = {
						OR = {
							spouse = { character = ROOT }
							is_consort = ROOT
						}
						religion = confucian
						hidden_tooltip = {
							is_alive = yes
						}
						trait = li_confucian
					}
				}
				add_trait = li_confucian
			}
			if = {
				limit = {
					any_courtier = {
						OR = {
							spouse = { character = ROOT }
							is_consort = ROOT
						}
						religion = confucian
						hidden_tooltip = {
							is_alive = yes
						}
						trait = zhong_confucian
					}
				}
				add_trait = zhong_confucian
			}
			if = {
				limit = {
					any_courtier = {
						OR = {
							spouse = { character = ROOT }
							is_consort = ROOT
						}
						religion = confucian
						hidden_tooltip = {
							is_alive = yes
						}
						trait = xiao_confucian
					}
				}
				add_trait = xiao_confucian
			}
			piety = 200
		}
		
		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 0
		}
	}

	# Pagans can convert to the Amidist faith if their wife or a concubine is a believer
	convert_to_spouse_amidist = {
	
		icon_religion = amidist	

		potential = {
			ai = no
			is_playable = yes
			religion_group = pagan_group
			controls_religion = no
			NOT = { trait = zealous }
			OR = {
				any_spouse = {
					religion = amidist
					hidden_tooltip = {
						is_alive = yes
					}
				}
				any_consort = {
					religion = amidist
					hidden_tooltip = {
						is_alive = yes
					}
				}
			}
		}
		
		effect = {
			prestige = -500
			religion_authority = {
				modifier = ruler_converted_from
			}
			
			if = {
				limit = {
					trait = cynical
				}
				random = {
					chance = 60
					add_trait = sympathy_pagans
				}
			}
			if = {
				limit = {
					NOT = { trait = cynical }
				}
				random = {
					chance = 50
					add_trait = sympathy_pagans
				}
			}		
			
			religion = amidist
			
			if = {
				limit = {
					any_courtier = {
						OR = {
							spouse = { character = ROOT }
							is_consort = ROOT
						}
						religion = amidist
						hidden_tooltip = {
							is_alive = yes
						}
						trait = buddhaksetra_amidist
					}
				}
				add_trait = buddhaksetra_amidist
			}
			if = {
				limit = {
					any_courtier = {
						OR = {
							spouse = { character = ROOT }
							is_consort = ROOT
						}
						religion = amidist
						hidden_tooltip = {
							is_alive = yes
						}
						trait = dhyana_amidist
					}
				}
				add_trait = dhyana_amidist
			}
			hidden_tooltip = {
				religion_authority = {
					modifier = ruler_converted_to
				}
			}
			piety = 200
		}
		
		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 0
		}
	}

	# Pagans can convert to the Taoist faith if their wife or a concubine is a believer
	convert_to_spouse_taoist = {
	
		icon_religion = taoist
	
		potential = {
			ai = no
			is_playable = yes
			religion_group = pagan_group
			controls_religion = no
			NOT = { trait = zealous }
			OR = {
				any_spouse = {
					religion = taoist
					hidden_tooltip = {
						is_alive = yes
					}
				}
				any_consort = {
					religion = taoist
					hidden_tooltip = {
						is_alive = yes
					}
				}
			}
		}
		
		effect = {
			prestige = -500
			religion_authority = {
				modifier = ruler_converted_from
			}
			
			if = {
				limit = {
					trait = cynical
				}
				random = {
					chance = 60
					add_trait = sympathy_pagans
				}
			}
			if = {
				limit = {
					NOT = { trait = cynical }
				}
				random = {
					chance = 50
					add_trait = sympathy_pagans
				}
			}		
			
			religion = taoist
			
			if = {
				limit = {
					any_courtier = {
						OR = {
							spouse = { character = ROOT }
							is_consort = ROOT
						}
						religion = taoist
						hidden_tooltip = {
							is_alive = yes
						}
						trait = zhengyi_taoist
					}
				}
				add_trait = zhengyi_taoist
			}
			if = {
				limit = {
					any_courtier = {
						OR = {
							spouse = { character = ROOT }
							is_consort = ROOT
						}
						religion = taoist
						hidden_tooltip = {
							is_alive = yes
						}
						trait = quanzhen_taoist
					}
				}
				add_trait = quanzhen_taoist
			}
			hidden_tooltip = {
				religion_authority = {
					modifier = ruler_converted_to
				}
			}
			piety = 200
		}
		
		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 0
		}
	}
}
