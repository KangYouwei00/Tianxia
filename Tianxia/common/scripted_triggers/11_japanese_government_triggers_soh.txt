can_change_to_japanese_feudal_trigger = {
	OR = {
		# Either independent
		AND = {
			independent = yes
			prestige = 500
		}
		# Or the vassal of a top liege with the government
		top_liege = {
			government = japanese_feudal_government
			OR = {
				dynasty = ROOT
				ROOT = {
					prestige = 500
				}
			}
		}
		# Or the vassal of another Japanese-style realm
		AND = {
			top_liege = {
				OR = {
					government = japanese_imperial_government
					government = japanese_bureaucracy_government
					government = japanese_monastic_feudal_government
					government = divine_imperial_government
				}
			}
			OR = {
				# We have a relevant bloodline
				AND = {
					any_owned_bloodline = {
						has_bloodline_flag = bloodline_japanese_feudal
						bloodline_is_active_for = ROOT
					}
					prestige = 500
				}
				# The relevant top liege has a regent
				AND = {
					top_liege = {
						has_regent = yes # Not has_actual_regency_trigger!
					}
					prestige = 1000
				}
				# We simply have a lot of prestige
				prestige = 2500
			}
		}
		# Or the vassal of a Chinese-style realm
		AND = {
			top_liege = {
				OR = {
					government = chinese_imperial_government
					government = chinese_vassal_government
					government = eastern_imperial_government
				}
			}
			OR = {
				# We have a relevant bloodline
				AND = {
					any_owned_bloodline = {
						has_bloodline_flag = bloodline_japanese_feudal
						bloodline_is_active_for = ROOT
					}
					prestige = 1000
				}
				# The top liege has a sub-Average MoH rating
				AND = {
					top_liege = {
						OR = {
							has_character_modifier = mandate_of_heaven_2
							has_character_modifier = mandate_of_heaven_1
						}
					}
					prestige = 1000
				}
				# The relevant top liege has a regent
				AND = {
					top_liege = {
						has_regent = yes # Not has_actual_regency_trigger!
					}
					prestige = 1000
				}
				# We simply have a lot of prestige
				prestige = 2500
			}
		}
		# Or the vassal of something else
		top_liege = {
			NOR = {
				government = japanese_imperial_government
				government = japanese_bureaucracy_government
				government = japanese_eudal_government
				government = japanese_monastic_feudal_government
				government = divine_imperial_government
				government = chinese_imperial_government
				government = chinese_vassal_government
				government = eastern_imperial_government
			}
			prestige = 1000
		}
	}
}

can_change_to_japanese_monastic_feudal_trigger = {
	OR = {
		# Either independent
		AND = {
			independent = yes
			piety = 1000
		}
		# Or the vassal of a top liege with the government
		top_liege = {
			government = japanese_monastic_feudal_government
			OR = {
				dynasty = ROOT
				ROOT = {
					piety = 1000
				}
			}
		}
		# Or the vassal of another Japanese-style realm
		AND = {
			top_liege = {
				OR = {
					government = japanese_imperial_government
					government = japanese_bureaucracy_government
					government = japanese_feudal_government
					government = divine_imperial_government
				}
			}
			OR = {
				# We control a relevant holy site
				AND = {
					controls_relevant_holy_site_for_japanese_monastic_feudal_trigger = yes
					piety = 2500
				}
				# The relevant top liege has a regent
				AND = {
					top_liege = {
						has_regent = yes # Not has_actual_regency_trigger!
					}
					piety = 2500
				}
				# We simply have a lot of piety
				piety = 5000
			}
		}
		# Or the vassal of a Chinese-style realm
		AND = {
			top_liege = {
				OR = {
					government = chinese_imperial_government
					government = chinese_vassal_government
					government = eastern_imperial_government
				}
			}
			OR = {
				# We control a relevant holy site
				AND = {
					controls_relevant_holy_site_for_japanese_monastic_feudal_trigger = yes
					piety = 2500
				}
				# The top liege has a sub-Average MoH rating
				AND = {
					top_liege = {
						OR = {
							has_character_modifier = mandate_of_heaven_2
							has_character_modifier = mandate_of_heaven_1
						}
					}
					piety = 2500
				}
				# The relevant top liege has a regent
				AND = {
					top_liege = {
						has_regent = yes # Not has_actual_regency_trigger!
					}
					piety = 2500
				}
				# We simply have a lot of piety
				piety = 5000
			}
		}
		# Or the vassal of something else
		top_liege = {
			NOR = {
				government = japanese_imperial_government
				government = japanese_bureaucracy_government
				government = japanese_eudal_government
				government = japanese_monastic_feudal_government
				government = divine_imperial_government
				government = chinese_imperial_government
				government = chinese_vassal_government
				government = eastern_imperial_government
			}
			piety = 2500
		}
	}
}

controls_relevant_holy_site_for_japanese_monastic_feudal_trigger = {
	capital_scope = {
		religion = ROOT
		county = {
			OR = {
				any_direct_de_jure_vassal_title = {
					OR = {
						AND = {
							is_holy_site = shinto
							ROOT = {
								religion = shinto
							}
						}
						AND = {
							is_holy_site = ryukyuan_pagan_reformed
							ROOT = {
								religion = ryukyuan_pagan_reformed
							}
						}
					}
				}
				OR = {
					AND = {
						is_holy_site = shinto
						ROOT = {
							religion = shinto
						}
					}
					AND = {
						is_holy_site = ryukyuan_pagan_reformed
						ROOT = {
							religion = ryukyuan_pagan_reformed
						}
					}
				}
			}
		}
		culture = ROOT
	}
	OR = {
		AND = {
			religion = shinto
			OR = {
				culture_group = japonic
				k_chrysanthemum_throne = {
					holder_scope = {
						culture = ROOT
					}
				}
			}
		}
		AND = {
			religion = ryukyuan_pagan_reformed
			OR = {
				culture_group = japonic
				d_ryukuyan_pagan_reformed = {
					holder_scope = {
						culture = ROOT
					}
				}
			}
		}
	}
}

has_actual_regency_trigger = { # TODO: Update for Divine Imperial
	custom_tooltip = {
		text = has_regent_and_is_incapable_of_governing
		is_ruler = yes
		OR = {
			AND = {
				NOR = {
					trait = under_regency
					trait = under_regency2
				}
				has_regent = yes
			}
			AND = {
				OR = {
					trait = under_regency
					trait = under_regency2
				}
				OR = {
					is_incapable = yes
					prisoner = yes
					is_adult = no
					trait = kow_tow_travels
					trait = travelling
					trait = in_hiding
					trait = troubled_pregnancy
					trait = pregnancy_finishing
					trait = on_indian_pilgrimage
					has_character_modifier = failed_to_overthrow_regent # If you recently failed to overthrow your regent, he'll restrict what you can do quite a bit...
					trait = hunting_dragons
					trait = treasure_fleet_voyage
					has_character_modifier = bedridden_illness
				}
			}
		}
	}
}

can_have_japanese_bureaucracy_and_feudal_trigger = {
	OR = {
		AND = {
			religion = shinto
			controls_religion = no
		}
		AND = {
			culture_group = japonic
			religion = buddhist
		}
		religion = ryukyuan_pagan
		AND = {
			has_dlc = "Holy Fury"
			religion = ryukyuan_pagan_reformed
			OR = {
				controls_religion = no
				NOT = {
					religion_has_divine_imperial_reformation_trigger = yes
				}
			}
			OR = {
				religion_has_japanese_government_reformation_trigger = yes
				religion_has_divine_imperial_reformation_trigger = yes
			}
		}
	}
}

can_have_japanese_monastic_feudal_trigger = {
	OR = {
		AND = {
			religion = shinto
			controls_religion = no
		}
		#religion = ryukyuan_pagan # Religion was considered something for women
		AND = {
			has_dlc = "Holy Fury"
			religion = ryukyuan_pagan_reformed
			OR = {
				controls_religion = no
				NOT = {
					religion_has_divine_imperial_reformation_trigger = yes
				}
			}
			OR = {
				religion_has_japanese_government_reformation_trigger = yes
				religion_has_divine_imperial_reformation_trigger = yes
			}
		}
	}
}

religion_has_japanese_government_reformation_trigger = {
	has_religion_feature = religion_tolerant # We don't want GHWs!
	OR = {
		has_religion_feature = religion_no_leader
		has_religion_feature = religion_spiritual
		has_religion_feature = religion_temporal_head
		has_religion_feature = religion_divine_ancestry
	}
	NOR = {
		has_religion_feature = religion_holy_family
		has_religion_feature = religion_jizya
		has_religion_feature = religion_ritual_sacrifice
		has_religion_feature = religion_adventuring
		has_religion_feature = religion_feature_ryukyuan_three_mountains
	}
}

can_have_divine_imperial_trigger = {
	has_dlc = "Holy Fury"
	religion = ryukyuan_pagan_reformed
	controls_religion = yes
	religion_has_divine_imperial_reformation_trigger = yes
}

religion_has_divine_imperial_reformation_trigger = {
	has_religion_feature = religion_tolerant # We don't want GHWs!
	has_religion_feature = religion_divine_ancestry
	NOR = {
		has_religion_feature = religion_harems
		has_religion_feature = religion_holy_family
		has_religion_feature = religion_jizya
		has_religion_feature = religion_ritual_sacrifice
		has_religion_feature = religion_adventuring
		has_religion_feature = religion_feature_ryukyuan_three_mountains
	}
}